var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(d,a,b){if(null==d)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return d+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,a,b){d!=Array.prototype&&d!=Object.prototype&&(d[a]=b.value)};$jscomp.getGlobal=function(d){d=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,d];for(var a=0;a<d.length;++a){var b=d[a];if(b&&b.Math==Math)return b}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,a,b,c){if(a){b=$jscomp.global;d=d.split(".");for(c=0;c<d.length-1;c++){var e=d[c];e in b||(b[e]={});b=b[e]}d=d[d.length-1];c=b[d];a=a(c);a!=c&&null!=a&&$jscomp.defineProperty(b,d,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("String.prototype.repeat",function(d){return d?d:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var c="";a;)if(a&1&&(c+=b),a>>>=1)b+=b;return c}},"es6","es3");$jscomp.findInternal=function(d,a,b){d instanceof String&&(d=String(d));for(var c=d.length,e=0;e<c;e++){var f=d[e];if(a.call(b,f,e,d))return{i:e,v:f}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.raumfeld=xnm.aio.raumfeld||{};
xnm.aio.raumfeld.Player=function(){var d=function(){this._renderer=null};d.prototype.getIP=function(){return this._renderer?this._renderer.ip:null};d.prototype.setIP=function(a){this._renderer&&(this._renderer.ip=a)};d.prototype.getPort=function(){return this._renderer?this._renderer.port:null};d.prototype.setPort=function(a){this._renderer&&(this._renderer.port=a)};d.prototype.getUUID=function(){return this._renderer?this._renderer.uuid:null};d.prototype.executeCommandCreator=function(a,b,c){b&&
b.value?this._executeCommand(b.value,b.ext,function(a){c&&c(a)}):c&&c(Error("command value is empty"))};d.prototype.getStatesCreator=function(a,b,c){this._getStates(function(a,f){if(a)c&&c(a);else{a=[];for(var e=0;e<b.length;e++){var d=b[e];if(d&&d.id&&d.status)switch(d.status.value){case "muted":null!=f.muted&&"undefined"!=typeof f.muted&&a.push({id:d.id,status:f.muted});break;case "volume":null!=f.volume&&"undefined"!=typeof f.volume&&a.push({id:d.id,status:f.volume});break;case "playMode":f.playMode&&
a.push({id:d.id,status:f.playMode});break;case "playState":f.transportState&&a.push({id:d.id,status:f.transportState});break;case "duration":f.playInfo&&f.playInfo.duration&&a.push({id:d.id,status:f.playInfo.duration});break;case "durationS":f.playInfo&&"undefined"!=typeof f.playInfo.durationSec&&null!=f.playInfo.durationSec&&a.push({id:d.id,status:f.playInfo.durationSec});break;case "position":f.playInfo&&f.playInfo.position&&a.push({id:d.id,status:f.playInfo.position});break;case "positionS":f.playInfo&&
"undefined"!=typeof f.playInfo.positionSec&&null!=f.playInfo.positionSec&&a.push({id:d.id,status:f.playInfo.positionSec});break;case "artist":f.playInfo&&f.playInfo.trackMetaData&&f.playInfo.trackMetaData.artist?a.push({id:d.id,status:f.playInfo.trackMetaData.artist}):a.push({id:d.id,status:""});break;case "title":f.playInfo&&f.playInfo.trackMetaData&&f.playInfo.trackMetaData.title?a.push({id:d.id,status:f.playInfo.trackMetaData.title}):a.push({id:d.id,status:""});break;case "album":f.playInfo&&f.playInfo.trackMetaData&&
f.playInfo.trackMetaData.album?a.push({id:d.id,status:f.playInfo.trackMetaData.album}):a.push({id:d.id,status:""});break;case "eqLow":f.eq&&"undefined"!=typeof f.eq.eqLow&&null!=f.eq.eqLow&&a.push({id:d.id,status:parseFloat(f.eq.eqLow)});break;case "eqMid":f.eq&&"undefined"!=typeof f.eq.eqMid&&null!=f.eq.eqMid&&a.push({id:d.id,status:parseFloat(f.eq.eqMid)});break;case "eqHigh":f.eq&&"undefined"!=typeof f.eq.eqHigh&&null!=f.eq.eqHigh&&a.push({id:d.id,status:parseFloat(f.eq.eqHigh)});break;case "shuffle":f.playMode&&
f.playMode.shuffle&&a.push({id:d.id,status:f.playMode.shuffle});break;case "repeat":f.playMode&&f.playMode.repeat&&a.push({id:d.id,status:f.playMode.repeat})}}c&&c(null,a)}})};d.prototype.play=function(a,b,c){if(a&&b&&b["class"]&&b.id){var e=this;a.browseMetaData(b.id,function(f,d){if(f)c&&c(f);else if(0!=b["class"].indexOf("object.container")||b.res&&b.res.url){if(b.res&&b.res.url)f=b.res.url;else{if(!d||!d.meta||!d.meta.res){c&&c(Error("resource url invalid"));return}f=d.meta.res}e._renderer.playResource({url:f},
d.result,c)}else a.uuid?e._renderer.playContainer({containerID:b.id,server_uuid:a.uuid},d.result,c):c&&c(Error("media server uuid invalid"))})}else c&&c(Error("play obj invalid"))};d.prototype.playFromContainer=function(a,b,c,e){if(a&&b&&b.id&&b.parentID)if(a.uuid){var f=this;a.browseMetaData(b.parentID,function(d,p){d?e&&e(d):f._renderer.playContainer({containerID:b.parentID,server_uuid:a.uuid,firstIdx:c},p.result,e)})}else e&&e(Error("media server uuid invalid"));else e&&e(Error("play obj invalid"))};
d.prototype.browser=function(a,b,c,e,f){a?(b||(b=0),c||(c=0),e||(e=0),a.browseChildren(b,c,e,null,function(a,b,c){f&&f(a,b,c)})):f&&f(Error("play obj invalid"))};d.prototype._executeCommand=function(a,b,c){if(this._renderer)switch(a){case "play":this._renderer.play(c);break;case "pause":this._renderer.pause(c);break;case "stop":this._renderer.stop(c);break;case "previous":this._renderer.previous(c);break;case "next":this._renderer.next(c);break;case "mute":this._renderer.mute(function(a){setTimeout(function(){c&&
c(a)},500)});break;case "unmute":this._renderer.unmute(function(a){setTimeout(function(){c&&c(a)},500)});break;case "toggleMute":this._renderer.toggleMute(function(a){setTimeout(function(){c&&c(a)},500)});break;case "volumeUp":this._renderer.volumeUp(c);break;case "volumeDown":this._renderer.volumeDown(c);break;case "setPlayMode":if(!b){c&&c(Error("play mode value invalid"));break}this._renderer.setPlayMode(b,c);break;case "seekTo":if("undefined"==typeof b||null==b){c&&c(Error("seek value invalid"));
break}this._renderer.seekRelTimeSec(b,c);break;case "setVolume":if("undefined"==typeof b||null==b){c&&c(Error("volume value invalid"));break}this._renderer.setVolume(b,c);break;case "shuffleToggle":this.shuffleToggle(c);break;case "repeatSwitch":this.repeatSwitch(c);break;default:c&&c(Error("unknown command"))}else c&&c(Error("renderer not initialized"))};d.prototype._getStates=function(a){if(this._renderer){var b=function(){e--;0==e&&a&&a(null,c)},c={},e=5;this._renderer.getPlayState(function(a,
e){a||(c.transportState=e);b()});this._renderer.getPlayInfo(function(a,e){a||(c.playInfo=e);b()});this._renderer.isMuted(function(a,e){a||(c.muted=e);b()});this._renderer.getVolume(function(a,e){a||(c.volume=e);b()});this.getPlayMode(function(a,e){a||(c.playMode=e);b()})}else a&&a(Error("renderer not initialized"))};d.prototype.getPlayMode=function(a){if(this._renderer){var b=this;this._renderer.getPlayMode(function(c,e){c?a&&a(c):a&&a(null,b._parsePlayMode(e))})}else a&&a(Error("renderer not initialized"))};
d.prototype.setPlayMode=function(a,b){this._renderer?(a=this._buildPlayMode(a),this._renderer.setPlayMode(a,b)):b&&b(Error("renderer not initialized"))};d.prototype._parsePlayMode=function(a){switch(a){case "NORMAL":return{shuffle:"off",repeat:"off"};case "REPEAT_ALL":return{shuffle:"off",repeat:"all"};case "REPEAT_ONE":return{shuffle:"off",repeat:"one"};case "RANDOM":return{shuffle:"on",repeat:"all"};case "SHUFFLE":return{shuffle:"on",repeat:"off"};default:return{shuffle:"off",repeat:"off"}}};d.prototype._buildPlayMode=
function(a){var b=a.shuffle;a=a.repeat;b||(b="off");a||(a="off");return"off"==b&&"off"==a?"NORMAL":"off"==b&&"all"==a?"REPEAT_ALL":"off"==b&&"one"==a?"REPEAT_ONE":"on"==b&&"off"==a?"SHUFFLE":"on"==b&&"all"==a?"RANDOM":"NORMAL"};d.prototype.shuffleToggle=function(a){if(this._renderer){var b=this;this.getPlayMode(function(c,e){c?a&&a(c):(e.shuffle="on"==e.shuffle?"off":"on",b.setPlayMode(e,a))})}else a&&a(Error("renderer not initialized"))};d.prototype.repeatSwitch=function(a){if(this._renderer){var b=
this;this.getPlayMode(function(c,e){c?a&&a(c):(e.repeat="off"==e.shuffle?"off"==e.repeat?"all":"all"==e.repeat?"one":"off":"off"==e.repeat?"all":"off",b.setPlayMode(e,a))})}else a&&a(Error("renderer not initialized"))};d.prototype.equalsTo=function(a){return a&&a instanceof d?this.getIP()==a.getIP()&&this.getPort()==a.getPort():!1};return d}();
xnm.aio.raumfeld.MasterPlayer=function(){var d=function(a,b,c){this._logger="undefined"!=typeof require&&require?require("x.logger.js").getLogger("xnm.aio.raumfeld.MasterDevice"):{log:{}};this.ip=a;this.port=b;this.port||(this.port=47365);this.uuid=c;this._zonePlayer=this._zones=null;this._getInfoCbs=[];this._autoGetInfoTimeout=null};d.prototype.getIP=function(){return this.ip};d.prototype.getPort=function(){return this.port};d.prototype.getUUID=function(){return this.uuid};d.prototype.executeCommandCreator=
function(a,b,c){if(this._zonePlayer)this._zonePlayer.executeCommandCreator(a,b,c);else{var e=this;this.getInfos(function(f){f?c&&c(f):e._zonePlayer?e._zonePlayer.executeCommandCreator(a,b,c):c&&c(f)})}};d.prototype.getStatesCreator=function(a,b,c){if(this._zonePlayer)this._zonePlayer.getStatesCreator(a,b,c);else{var e=this;this.getInfos(function(f){f?c&&c(f):e._zonePlayer?e._zonePlayer.getStatesCreator(a,b,c):c&&c(f)})}};d.prototype.play=function(a,b,c){if(this._zonePlayer)this._zonePlayer.play(a,
b,c);else{var e=this;this.getInfos(function(f){f?c&&c(f):e._zonePlayer?e._zonePlayer.play(a,b,c):c&&c(f)})}};d.prototype.playFromContainer=function(a,b,c,e){if(this._zonePlayer)this._zonePlayer.playFromContainer(a,b,c,e);else{var f=this;this.getInfos(function(d){d?e&&e(d):f._zonePlayer?f._zonePlayer.playFromContainer(a,b,c,e):e&&e(d)})}};d.prototype.browser=function(a,b,c,e,f){if(this._zonePlayer)this._zonePlayer.browser(a,b,c,e,f);else{var d=this;this.getInfos(function(g){g?f&&f(g):d._zonePlayer?
d._zonePlayer.browser(a,b,c,e,f):f&&f(g)})}};d.prototype.getAllRoomInfo=function(a){if(this._zones){var b=[],c;for(c in this._zones.roomPlayers){var e=this._zones.roomPlayers[c];e&&b.push({uuid:e.getUUID(),name:e.getRoomName()})}a&&a(null,b)}else{var d=this;this.getInfos(function(b){b?a&&a(b):d._zones?d.getAllRoomInfo(a):a&&a(b)})}};d.prototype.getAllZoneInfo=function(a){if(this._zones){var b=[],c;for(c in this._zones.zonePlayers){var e=this._zones.zonePlayers[c];e&&b.push({uuid:e.getUUID(),rooms:e.getRooms()})}a&&
a(null,b)}else{var d=this;this.getInfos(function(b){b?a&&a(b):d.getAllZoneInfo(a)})}};d.prototype.getCurrentZone=function(a){if(this._zonePlayer)a&&a(null,this._zonePlayer);else{var b=this;this.getInfos(function(c){c?a&&a(c):this._zonePlayer?b.getCurrentZone(a):a&&a(Error("no current zone"))})}};d.prototype.setCurrentZone=function(a,b){if(a)if(this._zones){var c=this._zones.zonePlayers[a],e=null;c||(e=Error("no such zone"));b&&b(e,c)}else{var d=this;this.getInfos(function(c){c?b&&b(c):d.setCurrentZone(a,
b)})}else b&&b(Error("zone uuid invalid"))};d.prototype.addRoomToZone=function(a,b,c){var e="/"+this.uuid+"/connectRoomToZone?";e+="zoneUDN="+encodeURIComponent("uuid:"+b);e+="&roomUDN="+encodeURIComponent("uuid:"+a);var d=this;this._doGetRequest(this.ip,47365,e,function(a){a?c&&c(a):d.getInfos(c)})};d.prototype.dropRoom=function(a,b){var c="/"+this.uuid+"/dropRoomJob?";c+="roomUDN="+encodeURIComponent("uuid:"+a);var e=this;this._doGetRequest(this.ip,47365,c,function(a){a?b&&b(a):e.getInfos(b)})};
d.prototype.getRoomPlayer=function(a){if(!a||!a.uuid)return null;this._zones||(this._zones={zonePlayers:{},roomPlayers:{},dedicatePlayers:{}});var b=this._zones.roomPlayers[a.uuid];if(b)return b;if(!a.port||!a.port||!a.zone_uuid)return null;b=new xnm.aio.raumfeld.RoomPlayer(a.ip,a.port,a.zone_uuid,a.uuid);b._isDummy=!0;return this._zones.roomPlayers[a.uuid]=b};d.prototype.getDiscoveredRoomPlayer=function(a){if(!a)return null;this._zones||(this._zones={zonePlayers:{},roomPlayers:{},dedicatePlayers:{}});
a=this._zones.roomPlayers[a];return!a||a._isDummy?null:a};d.prototype.getRoomPlayers=function(){if(!this._zones)return null;var a=[],b;for(b in this._zones.roomPlayers)a.push(this._zones.roomPlayers[b]);return a};d.prototype.getDedicatePlayer=function(a){if(!a||!a.uuid)return null;this._zones||(this._zones={zonePlayers:{},roomPlayers:{},dedicatePlayers:{}});var b=this._zones.dedicatePlayers[a.uuid];if(b)return b;if(!a.port||!a.port)return null;b=new xnm.aio.raumfeld.DedicatePlayer(a.ip,a.port,a.uuid);
b._isDummy=!0;return this._zones.dedicatePlayers[a.uuid]=b};d.prototype.getDiscoveredDedicatePlayer=function(a){if(!a)return null;this._zones||(this._zones={zonePlayers:{},roomPlayers:{},dedicatePlayers:{}});a=this._zones.dedicatePlayers[a];return!a||a._isDummy?null:a};d.prototype.getDedicatePlayers=function(a){if(!this._zones)return null;var b=[];for(a in this._zones.dedicatePlayers)b.push(this._zones.dedicatePlayers[a]);return b};d.prototype.getInfos=function(a){var b=this._getInfoCbs.length;a&&
-1==this._getInfoCbs.indexOf(a)&&this._getInfoCbs.push(a);if(0==b){this._autoGetInfoTimeout&&(clearTimeout(this._autoGetInfoTimeout),this._autoGetInfoTimeout=null);var c=this;this._getInfos(function(a,b,d){c._autoGetInfoTimeout=setTimeout(function(){c.getInfos(null)},5E3);var e=c._getInfoCbs;c._getInfoCbs=[];e.forEach(function(c){c&&c(a,b,d)})})}};d.prototype._getInfos=function(a){var b=this;this._listDevices(function(c,e){c?a&&a(c):b._getZones(function(c,d){c?a&&a(c):(b._updateBufferedZones(d,e),
a&&a(null,d,e))})})};d.prototype._getZones=function(a){this._doGetRequest(this.ip,47365,"/"+this.uuid+"/getZones",function(b,c){if(b)a&&a(b);else try{var e={},d=$($.parseXML(c));d.find("zone").each(function(){var a=$(this),b=a.attr("udn");b&&(e[b]={},a.find("room").each(function(){var a=$(this),c=a.attr("udn"),d=a.attr("name");c&&d&&(e[b][c]={name:d,renderer:{}},a.find("renderer").each(function(){var a=$(this),d=a.attr("udn");a=a.attr("name");d&&a&&(e[b][c].renderer[d]=a)}))}))});d.find("unassignedRooms").each(function(){var a=
$(this);e.idle={};a.find("room").each(function(){var a=$(this),b=a.attr("udn"),c=a.attr("name");b&&c&&(e.idle[b]={name:c,renderer:{}},a.find("renderer").each(function(){var a=$(this),c=a.attr("udn");a=a.attr("name");c&&a&&(e.idle[b].renderer[c]=a)}))})});a&&a(null,e)}catch(g){a&&a(g)}})};d.prototype._listDevices=function(a){this._doGetRequest(this.ip,47365,"/"+this.uuid+"/listDevices",function(b,c){if(b)a&&a(b);else try{var e={};$($.parseXML(c)).find("device").each(function(){var a=$(this),b=a.attr("udn");
b&&(e[b]={udn:b,type:a.attr("type"),location:a.attr("location"),name:a.text()},a=require("url").parse(a.attr("location")),e[b].ip=a.hostname,e[b].port=a.port)});a&&a(null,e)}catch(f){a&&a(f)}})};d.prototype._updateBufferedZones=function(a,b){var c=[],e=[],d=[];this._zones||(this._zones={zonePlayers:{},roomPlayers:{},dedicatePlayers:{}});for(var g in a){c.push(g);var p=a[g];if("idle"!=g){var k=g.substr(5),h=b[g];if(h)if(this._zones.zonePlayers[k]){var m=this._zones.zonePlayers[k];m.setIP(h.ip);m.setPort(h.port)}else m=
new xnm.aio.raumfeld.ZonePlayer(h.ip,h.port,k),this._zones.zonePlayers[k]=m}m&&m.clearRoom();for(var v in p){e.push(v);var r=p[v];k=r.name;h=v.substr(5);m&&m.addRoom(h,k);if(this._zones.roomPlayers[h])var n=this._zones.roomPlayers[h];else n=new xnm.aio.raumfeld.RoomPlayer(null,null,null,h),this._zones.roomPlayers[h]=n;n.setZonePlayer(m);n.setRoomName(k);r=r.renderer;for(var u in r){d.push(u);n=u.substr(5);var w=r[u],t=b[u];if(t){if(this._zones.dedicatePlayers[n]){var q=this._zones.dedicatePlayers[n];
q.setIP(t.ip);q.setPort(t.port)}else q=new xnm.aio.raumfeld.DedicatePlayer(t.ip,t.port,n),this._zones.dedicatePlayers[n]=q;q.setName(w);q.setRoom(h,k)}}}}for(var l in this._zones.zonePlayers)-1==c.indexOf("uuid:"+l)&&delete this._zones.zonePlayers[l];for(l in this._zones.roomPlayers)-1==e.indexOf("uuid:"+l)&&delete this._zones.roomPlayers[l];for(l in this._zones.dedicatePlayers)-1==d.indexOf("uuid:"+l)&&delete this._zones.dedicatePlayers[l];if(!this._zonePlayer||!this._zones.zonePlayers[this._zonePlayer.getUUID()])for(l in this._zonePlayer=
null,this._zones.zonePlayers)if(this._zones.zonePlayers[l]){this._zonePlayer=this._zones.zonePlayers[l];break}};d.prototype._doGetRequest=function(a,b,c,e){var d=this;a="http://"+a+":"+b+c;this._logger.log("trace","send get to url:"+a);var g=e;$.ajax({url:a,type:"GET",timeout:2E3,dataType:"text",cache:!0,success:function(a){d._logger.log("trace","http request success:"+a);g&&(g(null,a),g=null)},error:function(a,b){a="http request error:"+(a?a.status:"0")+"-"+b;d._logger.log("trace",a);g&&(g(Error(a)),
g=null)}})};d.prototype.toJSON=function(){return{sys:"raumfeld",ip:this.getIP(),port:this.getPort(),uuid:this.getUUID(),type:"master",model:"Raumfeld"}};d.prototype.equalsTo=function(a){return a&&a instanceof d?this.getIP()==a.getIP()&&this.getPort()==a.getPort():!1};return d}();
xnm.aio.raumfeld.ZonePlayer=function(){var d=function(a,b,c){this._renderer=null;this.rooms={};a&&b&&(this._renderer=this._getRenderer(a,b,c))};d.prototype=new xnm.aio.raumfeld.Player;d.prototype.constructor=d;d.prototype.addRoom=function(a,b){this.rooms[a]=b};d.prototype.clearRoom=function(){this.rooms={}};d.prototype.getRooms=function(){return this.rooms};d.prototype.muteRoom=function(a,b){this._setRoomMute(0,a,1,b)};d.prototype.unmuteRoom=function(a,b){this._setRoomMute(0,a,0,b)};d.prototype.toggleMuteRoom=
function(a,b){var c=this;this.isRoomMuted(a,function(e,d){e?b&&b(e):c._setRoomMute(0,a,d?0:1,b)})};d.prototype.isRoomMuted=function(a,b){this._getRoomMute(0,a,function(a,e){a?b&&b(a):b&&b(null,"1"==e.muted)})};d.prototype.getRoomVolume=function(a,b){this._getRoomVolume(0,a,function(a,e){a?b&&b(a):b&&b(null,e.volume)})};d.prototype.setVolumeRoom=function(a,b,c){this._setRoomVolume(0,a,b,c)};d.prototype.volumeUpRoom=function(a,b){var c=this;this.getRoomVolume(a,function(e,d){e?b&&b(e):(e=parseInt(d),
e+=5,100<e&&(e=100),c._setRoomVolume(0,a,e,b))})};d.prototype.volumeDownRoom=function(a,b){var c=this;this.getRoomVolume(a,function(e,d){e?b&&b(e):(e=parseInt(d),e-=5,0>e&&(e=0),c._setRoomVolume(0,a,e,b))})};d.prototype.getPlayInfo=function(a){this._renderer?this._renderer.getPlayInfo(function(b,c){a&&a(b,c)}):a&&a(Error("no renderer"))};d.prototype._getRenderer=function(a,b,c){if(c){var e=require("xnm.aio.raumfeld.js");if(e.discovery&&e.discovery._mediaRenderer&&(e=e.discovery._mediaRenderer[c]))return e}e=
new (require("x.upnp.js").MediaRenderer);e.init(a,b,c,{avTransport:{type:"urn:schemas-upnp-org:service:AVTransport:1",url:"/TransportService/Control"},connectionManager:{type:"urn:schemas-upnp-org:service:ConnectionManager:1",url:"/ConnectionManager/Control"},renderingControl:{type:"urn:schemas-upnp-org:service:RenderingControl:1",url:"/RenderingService/Control"}});return e};d.prototype._getRoomVolume=function(a,b,c){this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),
this._renderer.renderingControl.type,"GetRoomVolume",{InstanceID:a,Room:"uuid:"+b},function(a,b){a?c&&c(a):(a={},b=b.find("CurrentVolume"),0<b.length&&(a.volume=$(b[0]).text()),c&&c(null,a))})};d.prototype._setRoomVolume=function(a,b,c,e){this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"SetRoomVolume",{InstanceID:a,Room:"uuid:"+b,DesiredVolume:c},function(a){e&&e(a)})};d.prototype._getRoomMute=function(a,b,c){this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),
this._renderer.renderingControl.type,"GetRoomMute",{InstanceID:a,Room:"uuid:"+b},function(a,b){a?c&&c(a):(a={},b=b.find("CurrentMute"),0<b.length&&(a.muted=$(b[0]).text()),c&&c(null,a))})};d.prototype._setRoomMute=function(a,b,c,e){this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"SetRoomMute",{InstanceID:a,Room:"uuid:"+b,DesiredMute:c},function(a){e&&e(a)})};d.prototype.equalsTo=function(a){return a&&a instanceof d?this.getIP()==
a.getIP()&&this.getPort()==a.getPort():!1};d.prototype.toJSON=function(){return{sys:"raumfeld",ip:this.getIP(),port:this.getPort(),uuid:this.getUUID(),type:"zone",model:"Raumfeld"}};return d}();
xnm.aio.raumfeld.RoomPlayer=function(){var d=function(a,b,c,e){this._zonePlayer=null;this.uuid=e;this.name=null;a&&b&&(this._zonePlayer=new xnm.aio.raumfeld.ZonePlayer(a,b,c))};d.prototype.setZonePlayer=function(a){this._zonePlayer=a};d.prototype.getUUID=function(){return this.uuid};d.prototype.setRoomName=function(a){this.name=a};d.prototype.getRoomName=function(){return this.name};d.prototype.executeCommandCreator=function(a,b,c){b&&b.value?this._executeCommand(b.value,b.ext,function(a){c&&c(a)}):
c&&c(Error("command value is empty"))};d.prototype.getStatesCreator=function(a,b,c){this._getStates(function(a,d){if(a)c&&c(a);else{a=[];for(var e=0;e<b.length;e++){var f=b[e];if(f&&f.id&&f.status)switch(f.status.value){case "muted":null!=d.muted&&"undefined"!=typeof d.muted&&a.push({id:f.id,status:d.muted});break;case "volume":null!=d.volume&&"undefined"!=typeof d.volume&&a.push({id:f.id,status:d.volume})}}c&&c(null,a)}})};d.prototype._executeCommand=function(a,b,c){if(this._zonePlayer)if(this.uuid)switch(a){case "mute":this._zonePlayer.muteRoom(this.uuid,
function(a){setTimeout(function(){c&&c(a)},500)});break;case "unmute":this._zonePlayer.unmuteRoom(this.uuid,function(a){setTimeout(function(){c&&c(a)},500)});break;case "toggleMute":this._zonePlayer.toggleMuteRoom(this.uuid,function(a){setTimeout(function(){c&&c(a)},500)});break;case "volumeUp":this._zonePlayer.volumeUpRoom(this.uuid,c);break;case "volumeDown":this._zonePlayer.volumeDownRoom(this.uuid,c);break;case "setVolume":if("undefined"==typeof b||null==b){c&&c(Error("volume value invalid"));
break}this._zonePlayer.setVolumeRoom(this.uuid,b,c);break;default:c&&c(Error("unknown command"))}else c&&c(Error("room uuid invalid"));else c&&c(Error("no zone play for this room"))};d.prototype._getStates=function(a){if(this._zonePlayer)if(this.uuid){var b=function(){d--;0==d&&a&&a(null,c)},c={},d=2;this._zonePlayer.isRoomMuted(this.uuid,function(a,d){a||(c.muted=d);b()});this._zonePlayer.getRoomVolume(this.uuid,function(a,d){a||(c.volume=d);b()})}else a&&a(Error("room uuid invalid"));else a&&a(Error("no zone play for this room"))};
d.prototype.equalsTo=function(a){return a&&a instanceof d&&this._zonePlayer&&a._zonePlayer?this._zonePlayer.getIP()==a._zonePlayer.getIP()&&this._zonePlayer.getPort()==a._zonePlayer.getPort():!1};d.prototype.toJSON=function(){return{sys:"raumfeld",ip:this._zonePlayer?this._zonePlayer.getIP():null,port:this._zonePlayer?this._zonePlayer.getPort():null,uuid:this.uuid,type:"room",model:"Raumfeld",zone_uuid:this._zonePlayer?this._zonePlayer.getUUID():null,server_uuid:null,name:this.name}};return d}();
xnm.aio.raumfeld.DedicatePlayer=function(){var d={},a=function(a,c,d){this.name=this.room=this._renderer=null;a&&c&&(this._renderer=this._getRenderer(a,c,d))};a.prototype=new xnm.aio.raumfeld.Player;a.prototype.constructor=a;a.prototype.setName=function(a){this.name=a};a.prototype.setRoom=function(a,c){this.room={};this.room[a]=c};a.prototype.getEqualizer=function(a){var b=this;this._getFilter(0,function(c,f){c?a&&a(c):(d[b._renderer.uuid]||(d[b._renderer.uuid]={}),d[b._renderer.uuid].eqLow=f.eqLow,
d[b._renderer.uuid].eqMid=f.eqMid,d[b._renderer.uuid].eqHigh=f.eqHigh,a&&a(null,f))})};a.prototype.setEqualizer=function(a,c){var b=this;this._setFilter(0,a,function(e){e?c&&c(e):(d[b._renderer.uuid]||(d[b._renderer.uuid]={}),d[b._renderer.uuid].eqLow=a.eqLow,d[b._renderer.uuid].eqMid=a.eqMid,d[b._renderer.uuid].eqHigh=a.eqHigh,c&&c(null))})};a.prototype._executeCommand=function(a,c,e){if(this._renderer)switch(a){case "eqLowTo":case "eqMidTo":case "eqHighTo":if("undefined"==typeof c||null==c){e&&
e(Error("equlizer value invalid"));break}var b=this,g=d[this._renderer.uuid];if(g&&g.eqLow&&g.eqMid&&g.eqHigh){g={eqLow:g.eqLow,eqMid:g.eqMid,eqHigh:g.eqHigh};-1536>c&&(c=-1536);1536<c&&(c=1536);switch(a){case "eqLowTo":g.eqLow=c;break;case "eqMidTo":g.eqMid=c;break;case "eqHighTo":g.eqHigh=c}this.setEqualizer(g,e)}else this.getEqualizer(function(d){d?e&&e(d):b._executeCommand(a,c,e)});break;default:xnm.aio.raumfeld.Player.prototype._executeCommand.call(this,a,c,e)}else e&&e(Error("renderer not initialized"))};
a.prototype._getStates=function(a){if(this._renderer){var b=function(){f--;0==f&&a&&a(null,d)},d={},f=3;this._renderer.isMuted(function(a,c){a||(d.muted=c);b()});this._renderer.getVolume(function(a,c){a||(d.volume=c);b()});this.getEqualizer(function(a,c){!a&&c&&(d.eq=c);b()})}else a&&a(Error("renderer not initialized"))};a.prototype._getRenderer=function(a,c,d){if(d){var b=require("xnm.aio.raumfeld.js");if(b.discovery&&b.discovery._mediaRenderer&&(b=b.discovery._mediaRenderer[d]))return b}b=new (require("x.upnp.js").MediaRenderer);
b.init(a,c,d,{avTransport:{type:"urn:schemas-upnp-org:service:AVTransport:1",url:"/AVTransport/ctrl"},connectionManager:{type:"urn:schemas-upnp-org:service:ConnectionManager:1",url:"/ConnectionManager/ctrl"},renderingControl:{type:"urn:schemas-upnp-org:service:RenderingControl:1",url:"/RenderingControl/ctrl"}});return b};a.prototype._getFilter=function(a,c){this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"GetFilter",{InstanceID:a},
function(a,b){if(a)c&&c(a);else{a={};var d=b.find("LowDB");0<d.length&&(a.eqLow=$(d[0]).text());d=b.find("MidDB");0<d.length&&(a.eqMid=$(d[0]).text());d=b.find("HighDB");0<d.length&&(a.eqHigh=$(d[0]).text());c&&c(null,a)}})};a.prototype._setFilter=function(a,c,d){this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"SetFilter",{InstanceID:a,LowDB:c.eqLow,MidDB:c.eqMid,HighDB:c.eqHigh},function(a){d&&d(a)})};a.prototype.equalsTo=
function(b){return b&&b instanceof a?this.getIP()==b.getIP()&&this.getPort()==b.getPort():!1};a.prototype.toJSON=function(){return{sys:"raumfeld",ip:this.getIP(),port:this.getPort(),uuid:this.getUUID(),type:"player",model:this._renderer?this._renderer.modelName:null,server_uuid:null,name:this.name,room:this.room}};return a}();
xnm.aio.raumfeld.Discovery=function(){var d=function(){this._logger="undefined"!=typeof require&&require?require("x.logger.js").getLogger("xnm.aio.raumfeld.Discovery"):{log:{}};this._masterPlayer=this._upnpCB=null;this._mediaServer={};this._mediaRenderer={};this._searchRaumfeldCB=[];this._autoSearchTimeout=null;this.searchRaumfeld(null)};d.prototype.getPlayer=function(a){if(!a||!a.type||!a.uuid)return null;if("master"==a.type){if(!this._masterPlayer){if(!a.ip||!a.port)return null;this._masterPlayer=
new xnm.aio.raumfeld.MasterPlayer(a.ip,a.port,a.uuid);this._masterPlayer._isDummy=!0}a=this._masterPlayer}else if("room"==a.type)a=this._masterPlayer.getRoomPlayer(a);else if("player"==a.type)a=this._masterPlayer.getDedicatePlayer(a);else return null;a&&!a._isDummy||this.searchRaumfeld(null);return a};d.prototype.getDiscoveredPlayer=function(a,b){if(!a||!b)return null;if("master"==a)a=this._masterPlayer;else if("room"==a)a=this._masterPlayer.getDiscoveredRoomPlayer(b);else if("player"==a)a=this._masterPlayer.getDiscoveredDedicatePlayer(b);
else return null;a&&!a._isDummy||this.searchRaumfeld(null);return a};d.prototype.getBufferedMediaServers=function(){var a=[],b;for(b in this._mediaServer)if(this._mediaServer.hasOwnProperty(b)){var c=this._mediaServer[b];c.manufacturer&&-1!=c.manufacturer.indexOf("Raumfeld")&&(c._raumfeldMaster=!0);a.push(c)}return a};d.prototype.getBufferedPlayers=function(){if(!this._masterPlayer)return[];var a=null,b;for(b in this._mediaServer)if(this._mediaServer.hasOwnProperty(b)){var c=this._mediaServer[b];
if(c&&c.ip==this._masterPlayer.getIP()){a=c.uuid;break}}if(!a)return[];var d=[];d.push(this._masterPlayer.toJSON());(b=this._masterPlayer.getRoomPlayers())&&b.forEach(function(b){b&&(b=b.toJSON(),b.server_uuid=a,d.push(b))});var f=this;(b=this._masterPlayer.getDedicatePlayers())&&b.forEach(function(b){b=b.toJSON();var c=b.uuid;b.server_uuid=a;if(c=f._mediaRenderer[c])b.model=c.modelName;d.push(b)});return d};d.prototype.searchRaumfeld=function(a){var b=this._searchRaumfeldCB.length;a&&-1==this._searchRaumfeldCB.indexOf(a)&&
this._searchRaumfeldCB.push(a);if(0==b){this._autoSearchTimeout&&(clearTimeout(this._autoSearchTimeout),this._autoSearchTimeout=null);this._search();var c=this;setTimeout(function(){c._autoSearchTimeout=setTimeout(function(){c._logger.log("trace","auto search timeout, search again");c.searchRaumfeld(null)},3E4);var a=c._searchRaumfeldCB;c._searchRaumfeldCB=[];a.forEach(function(a){a&&a()})},5E3)}};d.prototype._search=function(){if(!this._upnpCB){var a=this;this._upnpCB=function(b){a._findUpnpDevice(b)}}this._mediaServer=
{};this._mediaRenderer={};var b=require("x.upnp.js").getDiscoveryService();b.addCallback("upnp:rootdevice",this._upnpCB);b.discoverTarget("upnp:rootdevice")};d.prototype._findUpnpDevice=function(a){if(a){var b=a.uuid;switch(a.deviceType){case "urn:schemas-raumfeld-com:device:ConfigDevice:1":this._logger.log("trace","find raumfeld master");this._masterPlayer||(this._masterPlayer=new xnm.aio.raumfeld.MasterPlayer(a.ip,0,a.uuid));this._masterPlayer._isDummy=!1;this._masterPlayer.ip=a.ip;this._masterPlayer.getInfos(null);
break;case "urn:schemas-upnp-org:device:MediaServer:1":this._logger.log("trace","find media server:"+a.name+" @"+a.ip);this._mediaServer[b]=a;break;case "urn:schemas-upnp-org:device:MediaRenderer:1":this._logger.log("trace","find media renderer:"+a.name+" @"+a.ip),this._mediaRenderer[b]=a}}};return d}();
xnm.aio.raumfeld.DM=function(){var d={master:{command:[{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",
name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"set volume",ref:{value:"setVolume",ext:"%d",extMeta:"0-100"}},{type:"int",name:"seek to (seconds)",ref:{value:"seekTo",ext:"%d"}},{type:"enum",name:"toggle shuffle",ref:{value:"shuffleToggle"}},{type:"enum",name:"switch repeat",ref:{value:"repeatSwitch"}}],status:[{type:"enum",name:"muted",ref:{value:"muted",options:["true","false"]}},{type:"int",name:"volume",ref:{value:"volume",extMeta:"0-100"}},{type:"string",name:"play state",ref:{value:"playState",
options:"STOPPED PLAYING TRANSITIONING PAUSED_PLAYBACK PAUSED_RECORDING RECORDING NO_MEDIA_PRESENT".split(" ")}},{type:"string",name:"track duration",ref:{value:"duration"}},{type:"int",name:"track duration (seconds)",ref:{value:"durationS"}},{type:"string",name:"track position",ref:{value:"position"}},{type:"int",name:"track position (seconds)",ref:{value:"positionS"}},{type:"string",name:"artist",ref:{value:"artist"}},{type:"string",name:"title",ref:{value:"title"}},{type:"string",name:"album",
ref:{value:"album"}},{type:"enum",name:"shuffle state",ref:{value:"shuffle",options:["on","off"]}},{type:"enum",name:"repeat state",ref:{value:"repeat",options:["off","one","all"]}}]},room:{command:[{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"set volume",ref:{value:"setVolume",
ext:"%d",extMeta:"0-100"}}],status:[{type:"enum",name:"muted",ref:{value:"muted",options:["true","false"]}},{type:"int",name:"volume",ref:{value:"volume",extMeta:"0-100"}}]},player:{command:[{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"set volume",ref:{value:"setVolume",
ext:"%d",extMeta:"0-100"}},{type:"int",name:"set equalizer low (db)",ref:{value:"eqLowTo",ext:"%d",extMeta:"-1536-1536"}},{type:"int",name:"set equalizer middel (db)",ref:{value:"eqMidTo",ext:"%d",extMeta:"-1536-1536"}},{type:"int",name:"set equalizer high (db)",ref:{value:"eqHighTo",ext:"%d",extMeta:"-1536-1536"}}],status:[{type:"enum",name:"muted",ref:{value:"muted",options:["true","false"]}},{type:"int",name:"volume",ref:{value:"volume",extMeta:"0-100"}},{type:"int",name:"equalizer low (db)",ref:{value:"eqLow"}},
{type:"int",name:"equalizer middel (db)",ref:{value:"eqMid"}},{type:"int",name:"equalizer high (db)",ref:{value:"eqHigh"}}]}},a=function(a,c){this.code=a;this.message=c;this.stack=Error().stack};a.prototype=Error();a.prototype.name="RaumfeldDMError";a.prototype.code=0;a.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"raumfeld",getIPDeviceType:function(){return[{sys:this.SYS,name:"Raumfeld"}]},createDevice:function(b,c,d){c=a.ERROR_CODE;b?b.type?
b.ip?b.port?d(null,b):d(new a(c.INVALID,"port is invalid")):d(new a(c.INVALID,"ip is invalid")):d(new a(c.INVALID,"type is invalid")):d(new a(c.INVALID,"info is invalid"))},updateDevice:function(b,c,d){c=a.ERROR_CODE;b?b.type?b.ip?b.port?d(null,b):d(new a(c.INVALID,"port is invalid")):d(new a(c.INVALID,"ip is invalid")):d(new a(c.INVALID,"type is invalid")):d(new a(c.INVALID,"info is invalid"))},deleteDevice:function(a,c,d){d()},applyUIFilter:function(a,c,d){var b=function(a,b){if("*"==a)return!0;
for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},e=function(a,c,d){var e=[];switch(d.catagory){case "command":a.command&&a.command.forEach(function(a){b(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){b(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))})}return e},p=function(a,b){var c=[],f=xnm.aio.raumfeld.DM.getCommandStatusMap(a,d);f&&(a=e(f,a,b),c=c.concat(a));return c};if(!a.sys)return null;var k=
JSON.parse(JSON.stringify(a)),h=null;switch(c.catagory){case "command":h=p(a,c);k.command=h;break;case "status":h=p(a,c);k.status=h;break;default:return null}return h&&0!=h.length?k:null},getCommandStatusMap:function(a,c){return a&&a.type?d[a.type]:null}}}();
xnm.aio.raumfeld.Handler=function(){var d=function(){this.discovery=new xnm.aio.raumfeld.Discovery};d.prototype.devicemanager=xnm.aio.raumfeld.DM;d.prototype.registModule=function(a){a.register(xnm.aio.raumfeld.DM.SYS,"raumfeld")};d.prototype.resolveDevice=function(a){return a?this.discovery.getPlayer(a):null};d.prototype.getDeviceCommands=function(a,b){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];b&&b(null,a)};d.prototype.getDeviceStatus=function(a,b){a=(a=
this.devicemanager.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];b&&b(null,a)};d.prototype.doCommand=function(a,b,c){var d=this.resolveDevice(a);d?d.executeCommandCreator(a,b,function(a){c&&c(a)}):c&&c(Error("device json format invalid"))};d.prototype.doStatus=function(a,b,c,d){var e=this.resolveDevice(b);e?e.getStatesCreator(null,[{id:a,device:b,status:c}],function(a,b){a?d&&d(a):d&&d(null,b[0])}):d&&d(Error("device json format invalid"))};d.prototype.discover=function(a){var b=this;
this.discovery.searchRaumfeld(function(){a&&a(null,b.discovery.getBufferedPlayers())})};d.prototype.getPlayer=function(a,b){if(a&&a.uuid&&a.type){var c=this.discovery.getDiscoveredPlayer(a.type,a.uuid);if(c)b&&b(null,c);else{var d=this;this.discovery.searchRaumfeld(function(){c=d.discovery.getDiscoveredPlayer(a.type,a.uuid);b&&b(null,c)})}}else b&&b(Error("device json invalid"))};d.prototype.getMediaServer=function(a){var b=this.discovery.getBufferedMediaServers();if(0==b.length){var c=this;this.discovery.searchRaumfeld(function(){a&&
a(null,c.discovery.getBufferedMediaServers())})}else a&&a(null,b)};return d}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.raumfeld.Handler);
