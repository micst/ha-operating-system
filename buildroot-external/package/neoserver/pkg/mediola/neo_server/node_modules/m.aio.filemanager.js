var m=m||{};m.aio=m.aio||{};m.aio.filemanager=m.aio.filemanager||{};
m.aio.filemanager.Preference={USER_PREFERENCE:".pref",_pref:{},_logger:null,init:function(b){try{this._logger=require("x.logger.js").getLogger("m.aio.filemanager.Preference")}catch(d){this._logger={log:function(){}}}var a=require("fs"),c=this._getUserPref();c?a.exists(c,function(d){d?a.stat(c,function(d,e){d?b&&b(d):e.isFile()?a.readFile(c,function(a,c){if(a)b&&b(a);else{if(0<c.length){a=c.toString("utf8");try{this._pref=JSON.parse(a)}catch(f){this._pref={}}}b&&b()}}.bind(this)):a.unlink(c,function(d){d?
b&&b(d):a.open(c,"w",function(a){b&&b(a)})})}.bind(this)):a.open(c,"w",function(a){b(a)})}.bind(this)):b&&b(Error("pref file path is null"))},save:function(b,a){this._pref[b]=a;this._saveUserPref()},read:function(b){return this._pref[b]},_getUserPref:function(){var b=require("path"),a=m.aio.filemanager.FileManager.getAppRootDataPath();return a?a+b.sep+this.USER_PREFERENCE:null},_saveUserPref:function(){var b=this._getUserPref(),a=require("fs");if(b){this._logger.log("trace","save user pref:"+b);var c=
this;a.writeFile(b,JSON.stringify(this._pref),function(a){a&&c._logger.log("trace","save user pref error:"+a.stack)})}}};
m.aio.filemanager.FileManager={_nativeFm:null,init:function(b,a){b?this._nativeFm?a&&a():(this._nativeFm=b,m.aio.filemanager.Preference.init(function(){a&&a()})):a&&a(Error("nativeFileManager is null"))},getAppRootDataPath:function(){return this._nativeFm?this._nativeFm.getAppRootDataPath():null},getAppResourcePath:function(){var b=require("path"),a=this.getAppRootDataPath();return a?a+b.sep+"resources":null},getUserRootDataPath:function(){return this._nativeFm?this._nativeFm.getUserRootDataPath():
null},getUserResourcePath:function(){var b=require("path"),a=this.getUserRootDataPath();return a?a+b.sep+"resources":null},getUserLogPath:function(){var b=require("path"),a=this.getUserRootDataPath();return a?a+b.sep+"logs":null},getTmpDir:function(){return this._nativeFm.getTmpDir()},getPref:function(){return m.aio.filemanager.Preference}};"undefined"!=typeof module&&null!=module&&(module.exports=m.aio.filemanager.FileManager,module.exports.Preference=m.aio.filemanager.Preference);
