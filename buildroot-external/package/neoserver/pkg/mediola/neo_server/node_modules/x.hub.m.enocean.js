var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(g){var b=0;return function(){return b<g.length?{done:!1,value:g[b++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,b,a){g!=Array.prototype&&g!=Object.prototype&&(g[b]=a.value)};$jscomp.getGlobal=function(g){g=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,g];for(var b=0;b<g.length;++b){var a=g[b];if(a&&a.Math==Math)return a}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(g,b){this.$jscomp$symbol$id_=g;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function g(a){if(this instanceof g)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(a||"")+"_"+b++,a)}var b=0;return g}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var g=$jscomp.global.Symbol.iterator;g||(g=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[g]&&$jscomp.defineProperty(Array.prototype,g,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var g=$jscomp.global.Symbol.asyncIterator;g||(g=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(g){$jscomp.initSymbolIterator();g={next:g};g[$jscomp.global.Symbol.iterator]=function(){return this};return g};
$jscomp.iteratorFromArray=function(g,b){$jscomp.initSymbolIterator();g instanceof String&&(g+="");var a=0,f={next:function(){if(a<g.length){var e=a++;return{value:b(e,g[e]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill=function(g,b,a,f){if(b){a=$jscomp.global;g=g.split(".");for(f=0;f<g.length-1;f++){var e=g[f];e in a||(a[e]={});a=a[e]}g=g[g.length-1];f=a[g];b=b(f);b!=f&&null!=b&&$jscomp.defineProperty(a,g,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
var util=require("util"),EventEmitter=require("events"),crypto=require("crypto"),fs_extra=require("fs-extra"),fileman=require("x.hub.fileman.js"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.enocean=x.hub.m.enocean||{};x.hub.m.enocean.SENDER_ID=null;x.hub.m.enocean.MANUFACTURE_ID=2047;
x.hub.m.enocean._CRC8Table=[0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,
149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243];
x.hub.m.enocean.CRC8=function(g){for(var b=0,a=0;a<g.length;a++)b=x.hub.m.enocean._CRC8Table[b^g[a]];return b};
x.hub.m.enocean.Serial=function(){var g=function(b){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Serial");this._port=b;this._serialPort=null};g.prototype.getPort=function(){return this._port};g.prototype.setListener=function(b){this._listener=b};g.prototype.open=function(b){if(this._serialPort)this._logger.log("warn","port:"+this._port+" already opened"),b&&b();else{var a=b;try{this._logger.log("trace","try to listen to port:"+this._port);var f=require("serialport");if(f){var e=
new f.SerialPort(this._port,{baudrate:57600}),k=this;e.on("open",function(){k._logger.log("trace","port:"+k._port+" opened");k._serialPort=e;e.flush();a&&a();a=null});e.on("error",function(e){k._logger.log("warn","enocean error:"+e.message);k._serialPort=null;if(a)a&&a(e),a=null;else if(k._listener&&k._listener.onSerialError)k._listener.onSerialError(e)});e.on("data",function(e){k._logger.log("trace","receive data "+e.toString("hex"));if(k._listener&&k._listener.onSerialData)k._listener.onSerialData(e)})}else this._logger.log("warn",
"no seiralport module"),b&&b(Error("no seiralport modul"))}catch(h){this._logger.log("warn","init enocean via "+this._port+" error:"+h.message),a&&a(h),a=null}}};g.prototype.close=function(){this._listener=null;try{this._serialPort&&this._serialPort.close()}catch(b){this._logger.log("warn","close enocean via "+this._port+" error:"+b.message)}this._serialPort=null};g.prototype.sendPacket=function(b,a){this._serialPort?this._serialPort.write(b,a):a&&a(Error("port not opened"))};return g}();
x.hub.m.enocean.ReComm=function(){var g=function(b){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ReComm");this._esp3=b};g.prototype.sendRawSysEx=function(b,a,f,e){var k=this;b=new x.hub.m.enocean.ESP3.Telegram.ADT(197,b,a,f);this._esp3.sendTelegram(b,!0,function(a,f){setTimeout(function(){a?(k._logger.log("warn","ReComm command failed with err:"+a.message),e&&e(a)):f&&0!=f.retCode?(k._logger.log("warn","ReComm command failed with retCode:"+f.retCode),a=Error("ReComm command failed:"+
f.retCode),a.code=f.retCode,e&&e(a,f)):e&&e(null,f)},50)})};return g}();
x.hub.m.enocean.SecurityHandler=function(){var g=new Buffer("3410de8f1aba3eff9f5a117172eacabd","hex"),b=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SecurityHandler");this._secInfo={};this._unsync={}};b.prototype.SECURITY_FILE="enocean_sec.json";b.prototype.init=function(a){this._logger.log("trace","init");var f=this;this._loadSec(function(e,b){e&&f._logger.log("warn","init error:"+e.message);b&&(f._secInfo=b);a&&a()})};b.prototype.getUnsyncDevice=function(){return this._unsync};
b.prototype.isSecureDevice=function(a){return this._secInfo[a]};b.prototype.secureTeachIn=function(a,f,e){this._logger.log("trace","secure teach-in:"+a);a&&(f.key&&delete f.key,this._secInfo[a]=f);this._saveSec(this._secInfo,e)};b.prototype.resolve=function(a){if(!a)return null;switch(a.rorg){case 53:return this._resolveSecureTeachIn(a);case 49:return this._resolveSecureMessage(a);default:return null}};b.prototype._resolveSecureTeachIn=function(a){var f={};a=a.userData;var e=a.readUInt8(0);f.teachInInfo=
{};f.teachInInfo.idx=e>>6&3;f.teachInInfo.cnt=e>>4&3;f.teachInInfo.psk=e>>3&1;f.teachInInfo.type=e>>2&1;f.teachInInfo.info=e&3;0==f.teachInInfo.idx?(e=a.readUInt8(1),f.slf={},f.slf.rlc_algo=e>>6&3,f.slf.rlc_tx=e>>5&1,f.slf.mac_alro=e>>3&3,f.slf.data_enc=e&7,e=0,1==f.slf.rlc_algo?e=2:2==f.slf.rlc_algo&&(e=3),e&&(f.rlc=a.slice(2,2+e)),f.key=a.slice(2+e),f.completeKey=null):f.key=a.slice(1);return f};b.prototype._resolveSecureMessage=function(a){var f=a.senderID,e=this._secInfo[f];if(!e||!e.completeKey)return null;
var b=0,h=0;1==e.slf.mac_alro?b=3:2==e.slf.mac_alro&&(b=4);1==e.slf.rlc_tx&&(1==e.slf.rlc_algo?h=2:2==e.slf.rlc_algo&&(h=3));var l=a.userData.length-b-h,p=a.userData.slice(0,l),q=null,u=null;h&&(u=a.userData.slice(l,l+h));b&&(q=a.userData.slice(l+h));b=u?u:e.rlc;h=!0;q&&(q=this.checkCmac(a.rorg,p,b,e.completeKey,q),q.rlc&&b.toString("hex")!=q.rlc.toString("hex")&&(b=q.rlc,e.rlc=q.rlc),q&&q.ok?(this._logger.log("trace","receive from "+f+" with cmac rlc:"+b.toString("hex")),delete this._unsync[f]):
(h=!1,this._logger.log("warn","receive from "+f+" with cmac out of snyc, last rlc:"+b.toString("hex")),this._unsync[f]=b.toString("hex")));f=null;h&&3==e.slf.data_enc&&(p=this.decryptVAES(b,g,e.completeKey,p),f=a.convertToPacket(p).toRadioTelegram());e.rlc=this._incRLC(b);this._logger.log("trace","senderID next rlc:"+e.rlc.toString("hex"));this._saveSec(this._secInfo);return f};b.prototype.decryptVAES=function(a,f,e,b){for(var k=b.length,l=Math.ceil(k/16),g=[],q=null,u=0;u<l;u++){var z=16*u,C=z+16;
C>k&&(C=k);z=b.slice(z,C);q=this._doVAESblock(a,f,e,q,z);g.push(q.data);q=q.enc}return Buffer.concat(g)};b.prototype._doVAESblock=function(a,f,e,b,h){a=this._xor(a,f);b&&(a=this._xor(a,b));e=this._doAES128(e,null,a);b=this._xor(e,h);b=b.slice(0,h.length);return{data:b,enc:e}};b.prototype.checkCmac=function(a,f,e,b,h){if(e){for(var k=this._bufToInt(e),g=0;128>g;g++){if(0!=g){k+=1;var q=65535;3==e.length&&(q=16777215);k>q&&(k=0)}q=this._intToBuf(k,e.length);q=this.calcCmac(a,f,q,b,h.length);if(q.toString("hex")==
h.toString("hex"))return{ok:!0,rlc:this._intToBuf(k,e.length)}}return{ok:!1,rlc:this._intToBuf(k,e.length)}}q=this.calcCmac(a,f,null,b,h.length);return q.toString("hex")==h.toString("hex")?{ok:!0}:{ok:!1}};b.prototype.calcCmac=function(a,f,e,b,h){var k=this._getCmacSubkey(b),g=new Buffer(1);g.writeUInt8(a);g=Buffer.concat([g,f]);e&&(g=Buffer.concat([g,e]));a=g.length;f=Math.ceil(a/16);e=null;for(var q=0;q<f;q++){var u=16*q;var z=u+16;z>a&&(z=a);u=g.slice(u,z);e=u=this._doCmacBlock(b,k.k1,k.k2,u,e)}return u.slice(0,
h)};b.prototype._doCmacBlock=function(a,f,e,b,h){for(var k=new Buffer(16),g=0;16>g;g++)g<b.length?k.writeUInt8(b.readUInt8(g),g):g==b.length?k.writeUInt8(128,g):k.writeUInt8(0,g);h&&(k=this._xor(k,h));k=16>b.length?this._xor(k,e):this._xor(k,f);return this._doAES128(a,null,k)};b.prototype._getCmacSubkey=function(a){var f=new Buffer("00000000000000000000000000000000","hex");var e=new Buffer("00000000000000000000000000000087","hex");f=this._doAES128(a,null,f);a=new Buffer(f.toString("hex"),"hex");this._bufShiftLeft(a,
1);f.readUInt8(0)&128&&(a=this._xor(a,e));f=new Buffer(a.toString("hex"),"hex");this._bufShiftLeft(f,1);a.readUInt8(0)&128&&(f=this._xor(f,e));return{k1:a,k2:f}};b.prototype._doAES128=function(a,f,e){f||(f=new Buffer("00000000000000000000000000000000","hex"));a=crypto.createCipheriv("aes128",a,f);a.setAutoPadding(!1);e=a.update(e);a=a.final();return Buffer.concat([e,a])};b.prototype._xor=function(a,f){for(var e=Math.max(a.length,f.length),b=new Buffer(e),h=0;h<e;h++){var g=0,p=0;h<a.length&&(g=a.readUInt8(h));
h<f.length&&(p=f.readUInt8(h));b.writeUInt8(g^p,h)}return b};b.prototype._bufShiftLeft=function(a,f){if(f!==(f|0))throw Error("shiftBits must be a 32 bit int");var e=2*((f>>4)+(0!==(f&15)));f=8*e-f;for(var b=0,h=0;h-e<a.length;h+=2)if(b<<=16,h<a.length-1?b|=a.readUInt16BE(h):h<a.length&&(b|=a[h]<<8),0<=h-e)if(h-e<a.length-1)a.writeUInt16BE(b>>>f&65535,h-e);else{if(h-e!==a.length-1)throw Error();a[h-e]=b>>>f+8}else-1===h-e&&(a[0]=b>>>f)};b.prototype._bufToInt=function(a){a=a.toString("hex");return parseInt(a,
16)};b.prototype._intToBuf=function(a,f){for(a=a.toString(16);a.length<2*f;)a="0"+a;return new Buffer(a,"hex")};b.prototype._incRLC=function(a){var f=this._bufToInt(a);f+=1;var e=65535;3==a.length&&(e=16777215);f>e&&(f=0);return this._intToBuf(f,a.length)};b.prototype._getFile=function(){var a=require("x.hub.fileman.js").fileManager,f=require("path");require("fs");a=a.getUserRootDataPath();return f.resolve(a,this.SECURITY_FILE)};b.prototype._loadSec=function(a){var f=this._getFile();fs_extra.ensureFile(f,
function(e){e?a&&a(e):fs_extra.readFile(f,"utf8",function(e,f){if(e)a&&a(e);else{try{var b=JSON.parse(f);for(var k in b)if(b.hasOwnProperty(k)){var h=b[k];h.rlc&&(h.rlc=new Buffer(h.rlc,"hex"));h.completeKey&&(h.completeKey=new Buffer(h.completeKey,"hex"))}}catch(u){}a&&a(null,b)}})})};b.prototype._saveSec=function(a,f){var e=this._getFile(),b={},h;for(h in a)b[h]={},b[h].teachInInfo=a[h].teachInInfo,b[h].slf=a[h].slf,b[h].rlc=a[h].rlc.toString("hex"),b[h].completeKey=a[h].completeKey.toString("hex");
fs_extra.writeFile(e,JSON.stringify(b,null,2),function(a){f&&f(a)})};return b}();
x.hub.m.enocean.LearnHandler=function(){var g=function(){var a=function(a){this._handler=a};a.prototype.onTelegram=function(a){var e=this;switch(a.rorg){case 176:if(this._isProfileMatch(a.getManufacturerId(),a.getProductId())){var f={address:a.senderID,data:this._getLearnProfile(),vendor:this._getLearnVendor(),senderID:x.hub.m.enocean.SENDER_ID,gpInfo:a.toJSON()};if(0==a.purpose)this._handler._controller._deviceHandler.onLearnDevice(null,f,function(f,b){f?e._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,
a.senderID,function(){e._handler._learnFinish(f,-1,b)}):e._sendTeachInResponse(1,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){e._handler._learnFinish(f,0,b)})});else if(1==a.purpose)this._handler._controller._deviceHandler.deleteDevice(f,function(f,b){f?e._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){e._handler._learnFinish(f,-1,b)}):e._sendTeachInResponse(2,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){e._handler._learnFinish(f,1,b)})});else if(2==a.purpose)this._handler._controller._deviceHandler.onLearnAddDeleteDevice(f,
function(f,b,k){f?e._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){e._handler._learnFinish(f,b,k)}):e._sendTeachInResponse(0==b?1:2,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){e._handler._learnFinish(f,b,k)})})}}};a.prototype._sendTeachInResponse=function(a,e,b,h,g){b||(b=x.hub.m.enocean.SENDER_ID);a=new x.hub.m.enocean.ESP3.Telegram.GP_TR(2047,a,e,b,0);a.setDstId(h);this._handler._controller._esp3.sendTelegram(a,!0,function(a){g&&g(a)})};a.prototype._isProfileMatch=
function(a,e){var f=this._handler._learnProfile;if(!f||"gp"==f)return!0;var b=x.hub.m.enocean.profiles[f];if(!b)return!1;b=new b;return b._data!=f?!1:b.isGPMatch?b.isGPMatch(a,e):!0};a.prototype._getLearnProfile=function(){return this._handler._learnProfile?this._handler._learnProfile:"gp"};a.prototype._getLearnVendor=function(){return this._handler._learnVendor};return a}(),b=function(a){this._controller=a;this._learning=!1;this._saParams=this._learnVendor=this._learnSenderID=this._learnAddress=
this._learnProfile=this._learnCallback=null;this._secTeachInFrames={};this._teaching=!1;this._teachingTO=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;var b=this;this._teachinTelegramCB={_onEOTelegram:function(a){b.onTeachInResponseTelegram(a)}};this._gpLearn=new g(this)};b.prototype.learn=function(a,b,e,k,h,g,p){if(this._learning)g&&g(Error("learning process running"));else if(this._teaching)g&&g(Error("teach-in process running"));else{if(!h||0>=
h)h=3E4;this._learning=!0;this._learnCallback=g;this._learnProfile=a?a.toLowerCase():null;this._learnAddress=b?b.toLowerCase():null;this._learnVendor=k?k:"general";this._learnSenderID=e?e.toLowerCase():null;this._secTeachInFrames={};this._saParams=null;!a||"bb-aa-cc"!=a.toLowerCase()&&"d2-06-10"!=a.toLowerCase()&&"d2-06-ff"!=a.toLowerCase()||(this._saParams={extended:1},p&&"undefined"!=typeof p.saLearnMode&&null!=p.saLearnMode&&(a=parseInt(p.saLearnMode),isNaN(a)&&(a=1),0>a&&(a=1),2<a&&(a=1),this._saParams.extended=
a));var f=this;this._controller._esp3.startLearn(this,h,this._saParams,function(a){if(a){var e=f._learnCallback;f._learning=!1;f._learnProfile=null;f._learnCallback=null;f._secTeachInFrames={};e&&e(a)}})}};b.prototype.onLearnTimeout=function(){this._learnFinish(Error("learn timeout"))};b.prototype.onTelegram=function(a){if(a){if(this._learnProfile){var b=x.hub.m.enocean.profiles[this._learnProfile];if(b&&(b=new b,b.handleLearnTelegram)){b.handleLearnTelegram(this,a);return}}switch(a.rorg){case 212:0==
a.cmd&&this._learnUTE(a);break;case 213:0==a.getLearnBit()&&this._learn1BS(a);break;case 165:0==a.getLearnBit()&&this._learn4BS(a);break;case 176:case 177:this._gpLearn.onTelegram(a);break;case 246:this._learnRPS(a);break;case 53:var e=this._controller._secHandler.resolve(a);a=a.senderID;b=this._secTeachInFrames[a];e&&(e.teachInInfo&&0==e.teachInInfo.idx?(b||(this._secTeachInFrames[a]=[],b=this._secTeachInFrames[a]),b.push(e)):e.teachInInfo&&0!=e.teachInInfo.idx&&b&&b.push(e));if(b&&b[0]&&(e=b[0])&&
e.teachInInfo){var k=e.teachInInfo.cnt;if(k&&b.length==k){if(1<k){k=[];for(var h=0;h<b.length;h++)k.push(b[h].key);e.completeKey=Buffer.concat(k)}else e.completeKey=e.key;this._controller._secHandler.secureTeachIn(a,e)}}}}};b.prototype.onEvent=function(a){if(a&&a instanceof x.hub.m.enocean.ESP3.Event.SA_CONFIRM_LEARN){var b=a.getEEP();if(!this._learnProfile||this._isLearningProfileEquals(b)){var e=this._learnProfile?this._learnProfile:b,k=this,h=x.hub.m.enocean.profiles[e];if(!h){var g=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,
17);this._controller._esp3.sendResponse(g,function(a){k._learnFinish(Error("eep not supported"))})}h=new h;var p=a.getPMCandidateId();p||(p=h.UNIQUE_GATEWAY_SENDERID?this._controller._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID);b={address:a.getSAClientId(),data:e,vendor:this._learnVendor,senderID:p,hopCount:a.getHopCount(),saLearnMode:this._saParams?this._saParams.extended:null,originalEEP:b};this._controller._deviceHandler.onLearnAddDeleteDevice(b,function(e,b,f){if(e)g=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,
19),k._controller._esp3.sendResponse(g,function(a){k._learnFinish(a)});else{e=0;1==b&&(e=32);var h=a.getHopCount();g=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(128*(h+1),e);k._controller._esp3.sendResponse(g,function(a){k._learnFinish(a,b,f)})}})}}};b.prototype.onTeachInResponseTelegram=function(a){if(a&&this._teaching){var b=this;if(this._teachProfile){var e=x.hub.m.enocean.profiles[this._teachProfile];if(e&&(e=new e,e.handleTeachinTelegram)){e.handleTeachinTelegram(this,a);return}}switch(a.rorg){case 165:if(0==
a.getLearnBit()&&1==a.getLearnStatus()){e=a.getFunc();var k=a.getType();this._toProfileStr(165,e,k);if(1==a.getLearnResult())this._controller._deviceHandler.onLearnDevice({address:this._teachID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},{address:a.senderID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},function(a,e){b._teachFinish(a,e)});else 0==a.getLearnResult()&&(a=this._controller._deviceHandler.getDevice(this._teachID),b._teachFinish(null,
a,1))}}}};b.prototype._learnRPS=function(a){var b=this._getRealProfile(this._learnProfile),e=this;b&&"f6"!=b.substr(0,2)||((b=this._learnProfile)||(b="f6-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:b,vendor:this._learnVendor},function(a,b){e._learnFinish(a,0,b)}))};b.prototype._learn1BS=function(a){var b=this,e=this._getRealProfile(this._learnProfile);
e&&"d5"!=e.substr(0,2)||((e=this._learnProfile)||(e="d5-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:e,vendor:this._learnVendor},function(a,e){b._learnFinish(a,0,e)}))};b.prototype._learn4BS=function(a){if(0==a.getLearnType())this._learn4BSV1(a);else{var b=a.getFunc(),e=a.getType();b=this._toProfileStr(165,b,e);(b=x.hub.m.enocean.profiles[b])&&
(3==(new b).TEACH_IN_VARIATION?this._learn4BSV3(a):this._learn4BSV2(a))}};b.prototype._learn4BSV1=function(a){var b=this._getRealProfile(this._learnProfile);if(b){if("a5"!=b.substr(0,2))return;b=x.hub.m.enocean.profiles[this._learnProfile];if(!b||1!=(new b).TEACH_IN_VARIATION)return}var e=this;(b=this._learnProfile)||(b="a5-??-??");this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,
senderID:this._learnSenderID,data:b,vendor:this._learnVendor},function(a,b){e._learnFinish(a,0,b)})};b.prototype._learn4BSV2=function(a){var b=a.getFunc(),e=a.getType();b=this._toProfileStr(165,b,e);if(!this._learnProfile||this._isLearningProfileEquals(b))if(b=this._learnProfile?this._learnProfile:b,e=x.hub.m.enocean.profiles[b])if(3==(new e).TEACH_IN_VARIATION)this._learn4BSV3(a);else{var k=this;this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,
data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:b,vendor:this._learnVendor},function(a,e){k._learnFinish(a,0,e)})}};b.prototype._learn4BSV3=function(a){var b=a.getFunc(),e=a.getType();b=this._toProfileStr(165,b,e);if(!this._learnProfile||this._isLearningProfileEquals(b)){b=this._learnProfile?this._learnProfile:b;e=x.hub.m.enocean.profiles[b];var k=this;if(e){e=new e;var h=k._learnSenderID;!h&&e.UNIQUE_GATEWAY_SENDERID&&(h=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId());
this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:h,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:h,data:b,vendor:this._learnVendor},function(e,b){e?k._send4BSResponse(null,1,0,a,function(){k._learnFinish(e,0,b)}):k._send4BSResponse(h,1,1,a,function(){k._learnFinish(null,0,b)})})}else this._send4BSResponse(null,0,0,a,function(){k._learnFinish(Error("eep not supported"))})}};b.prototype._send4BSResponse=function(a,b,e,k,h){a||(a=x.hub.m.enocean.SENDER_ID);
var f=k.getFunc(),g=k.getType();k.getManufacturerId();a=new x.hub.m.enocean.ESP3.Telegram.BS4(new Buffer([(f&63)<<2|g>>5&3,(g&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128|b<<6|e<<5|16]),a,0);a.setDstId(k.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){h&&h(a)})};b.prototype._learnUTE=function(a){var b=this._toProfileStr(a.eepRorg,a.eepFunc,a.eepType),e,k=this;if(!this._learnProfile||this._isLearningProfileEquals(b)){b=this._learnProfile?this._learnProfile:
b;var h=x.hub.m.enocean.profiles[b];if(h)switch(h=new h,(e=this._learnSenderID)||(e=h.UNIQUE_GATEWAY_SENDERID?require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID),b={address:a.senderID,data:b,vendor:this._learnVendor,senderID:e},a.subtype){case 0:this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},b,function(b,f){if(0==a.rspExpected){var h=0;b&&404==b.errorCode?
h=3:b||(h=1);k._sendUTEResponse(e,h,a,function(){k._learnFinish(b,0,f)})}else k._learnFinish(b,0,f)});break;case 1:this._controller._deviceHandler.deleteDevice(b,function(b,f){if(0==a.rspExpected){var h=0;b&&404==b.errorCode?h=3:b||(h=2);k._sendUTEResponse(e,h,a,function(){k._learnFinish(b,1,f)})}else k._learnFinish(b,1,f)});break;case 2:this._controller._deviceHandler.onLearnAddDeleteDevice(b,function(b,f,h){if(0==a.rspExpected){var g=0;b&&404==b.errorCode?g=3:b||(0==f?g=1:1==f&&(g=2));k._sendUTEResponse(e,
g,a,function(){k._learnFinish(b,f,h)})}else k._learnFinish(b,f,h)})}}};b.prototype._sendUTEResponse=function(a,b,e,k){a||(a=x.hub.m.enocean.SENDER_ID);a=new x.hub.m.enocean.ESP3.Telegram.UTE(1,e.ute,0,b,e.numChannel,e.manufactureID,e.eepType,e.eepFunc,e.eepRorg,a,0);a.setDstId(e.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){k&&k(a)})};b.prototype._learnFinish=function(a,b,e){var f=this._learnCallback;this._learning=!1;this._learnVendor=this._learnSenderID=this._learnAddress=this._learnProfile=
this._learnCallback=null;this._secTeachInFrames={};var h=this._saParams;this._saParams=null;this._controller._esp3.stopLearn(this,h,function(){});f&&f(a,b,e);!a&&0==b&&e&&e.init&&setTimeout(function(){e.init()},1E3)};b.prototype._toProfileStr=function(a,b,e){for(a=a.toString(16);2>a.length;)a="0"+a;for(b=b.toString(16);2>b.length;)b="0"+b;for(e=e.toString(16);2>e.length;)e="0"+e;return(a+"-"+b+"-"+e).toLowerCase()};b.prototype._fromProfileStr=function(a){a=a.split("-");return{rorg:parseInt(a[0],16),
func:parseInt(a[1],16),type:parseInt(a[2],16)}};b.prototype._getRealProfile=function(a){if(!a)return null;var b=x.hub.m.enocean.profiles[a];if(!b)return a;b=new b;return b._eepAlias?b._eepAlias:a};b.prototype._isLearningProfileEquals=function(a){if(!this._learnProfile)return!1;if(this._learnProfile==a||"bb-aa-cc"==this._learnProfile&&"d2-06-10"==a||"d2-06-10"==this._learnProfile&&"bb-aa-cc"==a)return!0;var b=x.hub.m.enocean.profiles[this._learnProfile];return b?(new b)._eepAlias==a:!1};b.prototype.teachin=
function(a,b,e,k,h){if(this._teaching)h&&h(Error("teach-in process running"));else if(this._learning)h&&h(Error("learning process running"));else if(a){a=a.toLowerCase();b||(b=this._controller._deviceHandler.getNextFreeAddress());var f=this;this._teachCallback=h;this._teachProfile=a;this._teachID=b;this._teachSenderID=e;this._teachVendor=k?k:"general";this._teaching=!0;this._teachingTO=setTimeout(function(){f._teachFinish(Error("teach-in timeout"))},3E4);var g;k=a;if(h=x.hub.m.enocean.profiles[k])h=
new h,h.getTeachinType&&(g=h.getTeachinType()),h.isTeachinBidirectional&&h.isTeachinBidirectional();!g&&(k=this._getRealProfile(k),h=x.hub.m.enocean.profiles[k])&&(h=new h,h.getTeachinType&&(g=h.getTeachinType()),h.isTeachinBidirectional&&h.isTeachinBidirectional());if(!g)switch(k.substr(0,2)){case "f6":g="RPS";break;case "d5":g="1BS";break;case "a5":g="4BS"}switch(g){case "RPS":this._teachinRPS(a,b,e);break;case "1BS":this._teachin1BS(a,b,e);break;case "4BS":this._teachin4BS(a,b,e);break;case "UTE":this._teachinUTE(a,
b,e);break;default:this._teachFinish(Error("profile not supported"))}}else h&&h(Error("profile is null"))};b.prototype._teachinRPS=function(a,b,e){this._teachFinish(Error("RPS teach-in should be done by execute command directly"))};b.prototype._teachin1BS=function(a,b,e){};b.prototype._teachin4BS=function(a,b,e){var f=2,h=x.hub.m.enocean.profiles[a];if(h)f=(new h).TEACH_IN_VARIATION;else if(this._getRealProfile(a),h=x.hub.m.enocean.profiles[a])f=(new h).TEACH_IN_VARIATION;switch(f){case 1:this._teachin4BSV1(a,
b,e);break;case 2:this._teachin4BSV2(a,b,e);break;case 3:this._teachin4BSV3(a,b,e);break;default:this._teachFinish(Error("no supported"))}};b.prototype._teachin4BSV1=function(a,b,e){};b.prototype._teachin4BSV2=function(a,b,e){var f=e;if(!e&&(f=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId(),!f)){this._teachFinish(Error("no more sender ID available"));return}e=a;var h=x.hub.m.enocean.profiles[e];h||(e=this._getRealProfile(e),h=x.hub.m.enocean.profiles[a]);h&&(h=new h,h._eepAlias&&
(a=h._eepAlias));h&&h.getTeachinTelegram?a=h.getTeachinTelegram(b,f,x.hub.m.enocean.MANUFACTURE_ID):(a=this._fromProfileStr(a),a=new Buffer([(a.func&63)<<2|a.type>>6&2,(a.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128]),a=new x.hub.m.enocean.ESP3.Telegram.BS4(a,f,0));var g=this;this._controller._esp3.sendTelegram(a,!0,function(a){a?g._teachFinish(a):(b||(b=f),g._controller._deviceHandler.addDevice({address:b,data:g._teachProfile,senderID:f,vendor:g._teachVendor},
function(a,e){g._teachFinish(a,e)}))})};b.prototype._teachin4BSV3=function(a,b,e){var f=e;if(!e){f=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId();if(!f){this._teachFinish(Error("no more sender ID available"));return}this._teachSenderID=f}e=a;var h=x.hub.m.enocean.profiles[e];h||(e=this._getRealProfile(e),h=x.hub.m.enocean.profiles[a]);h&&(h=new h,h._eepAlias&&(a=h._eepAlias));h&&h.getTeachinTelegram?f=h.getTeachinTelegram(b,f,x.hub.m.enocean.MANUFACTURE_ID):(a=this._fromProfileStr(a),
a=new Buffer([(a.func&63)<<2|a.type>>6&2,(a.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128]),f=new x.hub.m.enocean.ESP3.Telegram.BS4(a,f,0));var g=this;this._controller._esp3.addListener(this._teachinTelegramCB);this._controller._esp3.sendTelegram(f,!0,function(a){a&&g._teachFinish(a)})};b.prototype._teachinUTE=function(a,b,e){b=e;if(!e){b=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId();if(!b){this._teachFinish(Error("no more sender ID available"));
return}this._teachSenderID=b}e=a;var f=x.hub.m.enocean.profiles[e];f||(e=this._getRealProfile(e),f=x.hub.m.enocean.profiles[a]);f&&(f=new f,f._eepAlias&&(a=f._eepAlias));a=a.split("-");a=new x.hub.m.enocean.ESP3.Telegram.UTE(0,1,0,2,255,x.hub.m.enocean.MANUFACTURE_ID,parseInt(a[2],16),parseInt(a[1],16),parseInt(a[0],16),b,0);a.setDstId(reqTelegram.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){a&&self._teachFinish(a)})};b.prototype._teachFinish=function(a,b,e){this._controller._esp3.removeListener(this._teachinTelegramCB);
var f=this._teachCallback;this._teachingTO&&clearTimeout(this._teachingTO);this._teachingTO=null;this._teaching=!1;this._saParams=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;f&&f(a,b,e)};return b}();
x.hub.m.enocean.DeviceHandler=function(){var g=function(b){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.DeviceHandler");this._controller=b;this._devices={}};util.inherits(g,EventEmitter);g.prototype.SENSOR_FILE="enocean.json";g.prototype.UNKNOWN_PROFILE_ERR=404;g.prototype.ALREADY_EXISTS_ERR=400;g.prototype.init=function(b){this._logger.log("trace","init");var a=this;this._loadDevices(function(f,e){f&&a._logger.log("warn","init error:"+f.message);e&&(a._devices=e);a._initDevices();
b&&b()})};g.prototype._initDevices=function(){var b=Object.keys(this._devices),a=0,f=this,e=function(){a++;a<b.length&&(f._devices[b[a]]&&f._devices[b[a]].init?f._devices[b[a]].init(e):e())};this._devices[b[a]]&&this._devices[b[a]].init?this._devices[b[a]].init(e):e()};g.prototype.getDevice=function(b){if(!b)return null;var a=this._devices[b];if(a)return a;b=parseInt(b,16);for(b=(b-1).toString(16);8>b.length;)b="0"+b;return(a=this._devices[b])&&a instanceof x.hub.m.enocean.profiles.eltako_f6t?a:null};
g.prototype.getAllDevices=function(){return this._devices};g.prototype.findDevice=function(b){return b&&b.address?this._devices[b.address]:null};g.prototype.findDeviceWithData=function(b){if(!b)return null;var a=[],f;for(f in this._devices){var e=this._devices[f];e&&e.getData()==b&&a.push(e)}return a};g.prototype.addDevice=function(b,a){if(b&&b.data){b.address||(b.address=this.getNextFreeAddress());b.address=b.address.toLowerCase();b.senderID&&(b.senderID=b.senderID.toLowerCase());var f=x.hub.m.enocean.profiles.parseJson(b);
if(f){b=f._address;var e=this._devices[b];e&&e._data==f._data&&(f._states=e._states);this._devices[b]=f;this._saveDevices(this._devices,function(e){a&&a(e,f)})}else b=Error("unknow profile"),b.errorCode=this.UNKNOWN_PROFILE_ERR,a&&a(b)}else b=Error("device json invalid"),a&&a(b)};g.prototype.updateDevice=function(b,a,f){if(b)if(a&&a.data){var e=this._devices[b];a.address||(a.address=b);a.address=a.address.toLowerCase();a.senderID&&(a.senderID=a.senderID.toLowerCase());var g=x.hub.m.enocean.profiles.parseJson(a);
g?(e&&e._data==g._data&&(g._params=e._params,g._states=e._states),this._devices[a.address]=g,a.address!=b&&delete this._devices[b],this._saveDevices(this._devices,function(a){f&&f(a,g)})):(b=Error("unknow profile"),b.errorCode=this.UNKNOWN_PROFILE_ERR,f&&f(b))}else b=Error("device json invalid"),f&&f(b);else b=Error("address invalid"),f&&f(b)};g.prototype.deleteDevice=function(b,a){if(b&&b.address&&this._devices[b.address]){var f=this._devices[b.address];f&&f.finalize&&f.finalize();var e=this._devices[b.address];
delete this._devices[b.address];this.emit("deleteDevice",e);this._saveDevices(this._devices,function(e){a&&a(e,f)})}else a&&a()};g.prototype.onLearnAddDeleteDevice=function(b,a){if(b&&b.address)if(this._devices[b.address])this.deleteDevice(b,function(b,e){a&&a(b,1,e)});else this.onLearnDevice(null,b,function(b,e){a&&a(b,0,e)});else a&&a()};g.prototype.onLearnDevice=function(b,a,f){if(a&&a.address&&a.data){var e=x.hub.m.enocean.profiles.parseJson(a);if(e){var g=a.address;if(this._devices[g]){var h=
this._devices[g];g=h.toJSON();if(g.data!=a.data||g.vendor!=a.vendor)a=Error("address "+a.address+" already exists, please delete it first"),a.errorCode=this.ALREADY_EXISTS_ERR,f&&f(a);else if(g.senderID!=a.senderID){h._senderID=a.senderID;if("bb-aa-cc"==h._data||"d2-06-10"==h._data||"d2-06-ff"==h._data)h.executeCommand(null,{value:"alertOn"}),h.executeCommand(null,{value:"preAlarmOn"});else if("afriso_water_eco"==e._data)e.onLearn();this._saveDevices(this._devices,function(a){f&&f(a,h)})}else f&&
f(null,h)}else{b&&(a=b.address)&&a!=g&&this._devices[a]&&delete this._devices[a];this._devices[g]=e;if("bb-aa-cc"==e._data||"d2-06-10"==e._data||"d2-06-ff"==e._data)e.executeCommand(null,{value:"alertOn"}),e.executeCommand(null,{value:"preAlarmOn"});else if("afriso_water_eco"==e._data)e.onLearn();this._saveDevices(this._devices,function(a){f&&f(a,e)})}}else a=Error("unknow profile"),a.errorCode=this.UNKNOWN_PROFILE_ERR,f&&f(a)}else a=Error("device json invalid"),f&&f(a)};g.prototype.deviceParamsUpdated=
function(b,a){this._saveDevices(this._devices,function(b){a&&a(b)})};g.prototype.isVirtual=function(b){var a=x.hub.m.enocean.SENDER_ID;if(!a)return!1;var f=parseInt(a,16)+1;a=parseInt(a,16)+128;b=parseInt(b,16);return b>=f&&b<=a};g.prototype.getVirtualSenderID=function(){var b=x.hub.m.enocean.SENDER_ID;if(!b)return[];var a=parseInt(b,16)+1;b=parseInt(b,16)+128;var f=[],e=this._devices,g;for(g in e){var h=e[g];h&&h._senderID&&(h=parseInt(h._senderID,16),h>=a&&h<=b&&f.push(h))}return f};g.prototype.getVirtualAddress=
function(){var b=[],a=this._devices,f;for(f in a)"x"==f.charAt(0)&&(a=parseInt(f.substr(1),16),0<=a&&268435455>=a&&b.push(f));return b};g.prototype.getFreeSenderIdCount=function(){return 128-this.getVirtualSenderID().length};g.prototype.getNextFreeSenderId=function(){var b=x.hub.m.enocean.SENDER_ID;if(!b)return null;var a=parseInt(b,16)+1;b=parseInt(b,16)+128;for(var f=this.getVirtualSenderID(),e=null;a<=b;a++)if(-1==f.indexOf(a)){e=a;break}if(e)for(e=e.toString(16).toLowerCase();8>e.length;)e="0"+
e;return e};g.prototype.getNextFreeAddress=function(){for(var b=this.getVirtualAddress(),a=null,f=0;268435455>=f;f++){for(var e=f.toString(16);7>e.length;)e="0"+e;e="x"+e;if(-1==b.indexOf(e)){a=e;break}}return a};g.prototype.generateVirtual=function(b,a){if(b&&b.data){var f=b.senderID;if(!f&&(f=this.getNextFreeSenderId(),!f)){a&&a(Error("no sender id available"));return}b.senderID=f;b.address=f;b.virtual=!0;if(f=this.findDevice(b)){var e=f.toJSON();b.data!=e.data?a&&a(Error("device of another type with the same address exists")):
b.vendor&&b.vendor!=e.vendor?a&&a(Error("device of another vendor with the same address exists")):a&&a(null,f)}else(b=x.hub.m.enocean.profiles.parseJson(b))?this.addDevice(b.toJSON(),function(b,e){a&&a(b,e)}):a&&a(Error("unknow profile"))}else a&&a(Error("query is null"))};g.prototype._getFile=function(){var b=fileman.fileManager,a=require("path");b=b.getUserRootDataPath();return a.resolve(b,this.SENSOR_FILE)};g.prototype._loadDevices=function(b){var a=require("fs-extra"),f=this._getFile();a.ensureFile(f,
function(e){e?b&&b(e):a.readFile(f,"utf8",function(a,e){if(a)b&&b(a);else if(e)try{a={};var f=JSON.parse(e),g;for(g in f){var h=x.hub.m.enocean.profiles.parseDBJson(f[g]);h&&(a[g]=h)}b&&b(null,a)}catch(u){b&&b(u)}else b&&b(null,{})})})};g.prototype._saveDevices=function(b,a){var f=this._getFile(),e={},g;for(g in b)e[g]=b[g].toDBJSON();fs_extra.writeFile(f,JSON.stringify(e,null,2),function(e){a&&a(e)})};return g}();
x.hub.m.enocean.ESP3=function(){var g=function(a,e,b){this.type=a;this.data=e;this.optData=b};g.TYPE={1:"RADIO_ERP1",2:"RESPONSE",3:"RADIO_SUB_TEL",4:"EVENT",5:"COMMAND_COMMAND",6:"SMART_ACK_COMMAND",7:"REMOTE_MAN_COMMAND",9:"RADIO_MESSAGE",10:"RADIO_ERP2",16:"RADIO_802_15_4",17:"COMMAND_2_4"};g.prototype.toBuffer=function(){var a=new Buffer(6);a.writeUInt8(85,0);a.writeUInt16BE(this.data.length,1);a.writeUInt8(this.optData?this.optData.length:0,3);a.writeUInt8(this.type,4);a.writeUInt8(0,5);var e=
x.hub.m.enocean.CRC8(a.slice(1,5));a.writeUInt8(e,5);var b=this.optData?Buffer.concat([this.data,this.optData],this.data.length+this.optData.length):this.data;e=x.hub.m.enocean.CRC8(b);a=Buffer.concat([a,b],6+b.length+1);a.writeUInt8(e,a.length-1);return a};g.prototype.toJSON=function(){return{dataLen:this.data.length,optLen:this.optData?this.optData.length:0,type:this.type,typeName:g.TYPE[this.type],data:this.data.toString("hex"),optData:this.optData?this.optData.toString("hex"):null}};g.prototype.toPacket=
function(){return b.resolve(this)};var b=function(){};b.resolve=function(b){switch(b.type){case 1:return f.resolve(b);case 2:return a.resolve(b);case 4:return h.resolve(b);case 5:return k.resolve(b);case 6:return e.resolve(b);default:return null}};var a=function(a,b,e){this.retCode=a;this.resData=b;this.optData=e};a.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"};a.prototype.toJSON=function(){return{retCodeName:a.CODE[this.retCode],
retCode:this.retCode.toString(16),resData:this.resData?this.resData.toString("hex"):null,optData:this.optData?this.optData.toString("hex"):null}};a.prototype.toFrame=function(){var a=new Buffer(1);a.writeUInt8(this.retCode,0);this.resData&&(a=Buffer.concat([a,this.resData]));return new g(2,a,this.optData)};a.prototype.toResponse=function(){return t.resolve(this)};a.resolve=function(b){var e;var m=b.data.readUInt8(0);1<b.data.length&&(e=b.data.slice(1));return new a(m,e,b.optData)};var f=function(a,
b,e,f,g,h){this.data=a;if(this.hasOpt=b)this.subTelNum=e,this.dstId=f,this.dBm=g,this.securityLvl=h};f.prototype.toJSON=function(){var a={data:this.data.toString("hex")};this.hasOpt&&(a.subTelNum=this.subTelNum.toString(16),a.dstId=this.dstId,a.dBm=this.dBm.toString(16),a.securityLvl=this.securityLvl);return a};f.prototype.toFrame=function(){var a=this.data,b=null;this.hasOpt&&(b=new Buffer([this.subTelNum]),b=Buffer.concat([b,new Buffer(this.dstId,"hex")]),b=Buffer.concat([b,new Buffer([this.dBm,
this.securityLvl])]));return new g(1,a,b)};f.prototype.toRadioTelegram=function(){return l.resolve(this)};f.resolve=function(a){var b=!1;if(a.optData){b=!0;var e=a.optData.readUInt8(0);var m=a.optData.slice(1,5).toString("hex");var g=a.optData.readUInt8(5);var h=a.optData.readUInt8(6)}return new f(a.data,b,e,m,g,h)};var e=function(a){this.data=a};e.prototype.toJSON=function(){return{data:this.data.toString("hex")}};e.prototype.toFrame=function(){return new g(6,this.data,null)};e.prototype.toSACommand=
function(){return M.resolve(this)};e.resolve=function(a){return new e(a.data)};var k=function(a){this.data=a};k.prototype.toJSON=function(){return{data:this.data.toString("hex")}};k.prototype.toFrame=function(){return new g(5,this.data,null)};k.prototype.toCommandCommand=function(){return oa.resolve(this)};k.resolve=function(a){return new k(a.data)};var h=function(a){this.data=a};h.prototype.toJSON=function(){return{data:this.data.toString("hex")}};h.prototype.toFrame=function(){return new g(4,this.data,
null)};h.prototype.toEvent=function(){return n.resolve(this)};h.resolve=function(a){return new h(a.data)};var l=function(a,b){this.rorg=a;this.optData=b;this.optData||(this.optData={subTelNum:1,dstId:"FFFFFFFF",dBm:255,securityLvl:0})};l.prototype.setDstId=function(a){this.optData.dstId=a?a:"FFFFFFFF"};l.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 208:return C.resolve(a);case 246:return I.resolve(a);case 213:return J.resolve(a);case 165:return A.resolve(a);case 210:return w.resolve(a);
case 212:return U.resolve(a);case 53:return X.resolve(a);case 49:return N.resolve(a);case 64:return z.resolve(a);case 176:return p.resolve(a);case 178:return u.resolve(a);default:return null}};var p=function(){var a=function(a,b,e){8<=e&&(e=8);0>=e&&(e=1);var f=Math.floor(b/8),m=b%8;b=Math.pow(2,e)-1;if(8<m+e)return e=16-m-e,a.readUInt16BE(f)>>e&b;e=8-m-e;return a.readUInt8(f)>>e&b},b=function(a){this.type=a};b.prototype.getType=function(){return this.type};b.resolve=function(b,f){if(f+2>8*b.length)return null;
var m=a(b,f,2),k=null;switch(m){case 0:k=e.resovle(b,f);break;case 1:k={type:m,sigType:b.readUInt16BE(0)>>6&255,valueType:b.readUInt16BE(0)>>2&3,resolution:b.readUInt16BE(0)&15,engMin:b.readUInt8(2),scalingMin:b.readUInt16BE(3)>>12&15,engMax:b.readUInt16BE(3)>>4&255,scalingMax:b.readUInt16BE(3)&15};break;case 2:k=g.resovle(b,f);break;case 3:k=h.resovle(b,f)}return k};var e=function(a,b,e){this.type=0;this.sigType=a;this.dataLen=b;this.data=e};e.prototype=new b;e.prototype.constructor=e;e.prototype.getBitLength=
function(){return 2==this.sigType?50:18};e.prototype.getProductID=function(){return 2==this.sigType?this.data?this.data.readUInt32BE(0):null:null};e.resovle=function(b,f){if(f+18>8*b.legnth)return null;var m=a(b,f+2,8),g=a(b,f+10,8),h=null;if(2==m){if(f+50>8*b.legnth)return null;h=new Buffer(4);h.writeUInt8(a(b,f+18,8),0);h.writeUInt8(a(b,f+26,8),1);h.writeUInt8(a(b,f+34,8),2);h.writeUInt8(a(b,f+42,8),3)}else 1==m&&(h=null);return new e(m,g,h)};var f=function(a,b,e,f,m,g,h){this.type=1;this.sigType=
a;this.valueType=b;this.resolution=e;this.engMin=f;this.scalMin=m;this.engMax=g;this.scalMax=h};f.prototype=new b;f.prototype.constructor=f;f.prototype.getBitLength=function(){return 40};f.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType,resolution:this.resolution,engMin:this.engMin,scalMin:this.scalMin,engMax:this.engMax,scalMax:this.scalMax}};f.resovle=function(b,e){if(e+40>8*b.length)return null;var m=a(b,e+2,8),g=a(b,e+10,2),h=a(b,e+12,4),k=a(b,e+16,8),Oa=a(b,e+
24,4),l=a(b,e+28,8);b=a(b,e+36,4);return new f(m,g,h,k,Oa,l,b)};var g=function(a,b){this.type=2;this.sigType=a;this.valueType=b};g.prototype=new b;g.prototype.constructor=g;g.prototype.getBitLength=function(){return 12};g.resovle=function(b,e){if(e+12>8*b.length)return null;var f=a(b,e+2,8);b=a(b,e+10,2);return new g(f,b)};g.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType}};var h=function(a,b,e){this.type=3;this.sigType=a;this.valueType=b;this.resolution=e};h.prototype=
new b;h.prototype.constructor=h;h.prototype.getBitLength=function(){return 16};h.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType,resolution:this.resolution}};h.resovle=function(b,e){if(e+16>8*b.length)return null;var f=a(b,e+2,8),m=a(b,e+10,2);b=a(b,e+12,4);return new h(f,m,b)};var k=function(a,b,e){l.call(this,176);this.manufacturerID=a;this.dataDirection=b;this.purpose=e;this.productID=null;this.outboudChannels={};this.inboundChannels={};this.status=this.senderID=
null};k.prototype=new l;k.prototype.constructor=k;k.prototype.getManufacturerId=function(){return this.manufacturerID};k.prototype.getProductId=function(){return this.productID};k.prototype.toJSON=function(){var a={manufacturerID:this.manufacturerID,dataDirection:this.dataDirection,purpose:this.purpose,productID:this.productID,outboudChannels:{},inboundChannels:{}},b;for(b in this.outboudChannels)a.outboudChannels[b]=this.outboudChannels[b].toJSON();for(b in this.inboundChannels)a.inboundChannels[b]=
this.inboundChannels[b].toJSON();return a};k.resolve=function(a){var e=a.data;a=e.readUInt16BE(1)>>5&2047;var f=e.readUInt16BE(1)>>4&1,m=e.readUInt16BE(1)>>2&3;a=new k(a,f,m);f=e.slice(3,e.length-5);m=e.slice(e.length-5,e.length-1);e=e.readUInt8(e.length-1);a.senderID=m.toString("hex");a.status=e;for(var g=m=e=0;;){var h=b.resolve(f,m);if(!h)break;0==e?0==h.getType()?a.productID=h.getProductID():(a.outboudChannels[g]=h,g++,e=1):1==e?0==h.getType()?e=2:(a.outboudChannels[g]=h,g++,e=1):2==e&&(a.inboundChannels[g]=
h,g++);m+=h.getBitLength()}return a};return k}(),q=function(){var a=function(a,b,e,f,m){l.call(this,177);this.manufacturerID=a;this.result=b;this.chnAcknoledgement=e;this.senderID=f;this.status=m};a.prototype=new l;a.prototype.constructor=a;a.prototype.toPacket=function(){var a=new Buffer(3);a.writeUInt8(this.rorg,0);a.writeUInt16BE(this.manufacturerID<<5|this.result<<3,1);if(3==this.result){var b=[];if(this.chnAcknoledgement){for(var e=Math.ceil(this.chnAcknoledgement.length/8),m=0;m<e.length;m++)b.push(0);
for(e=0;e<this.chnAcknoledgement.length;e++)m=Math.floor(e/8),b[m]|=chnAcknoledgement[e]<<8-e%8-1}a=Buffer.concat([a,new Buffer(b)])}a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);b=1;e="FFFFFFFF";m=255;var g=0;this.optData&&(b=this.optData.subTelNum,e=this.optData.dstId,m=this.optData.dBm,g=this.optData.securityLvl);return new f(a,!0,b,e,m,g)};a.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),manufacturerID:this.manufacturerID.toString(16),
result:this.result,chnAcknoledgement:this.chnAcknoledgement,senderID:this.senderID,receiverID:this.receiverID}};return a}(),u=function(){var a=function(a,b,e){l.call(this,178);this.data=a;this.senderID=b;this.status=e};a.prototype=new l;a.prototype.constructor=a;a.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,0);this.data&&(a=Buffer.concat([a,this.data]));a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);var b=1,e="FFFFFFFF",
m=255,g=0;this.optData&&(b=this.optData.subTelNum,e=this.optData.dstId,m=this.optData.dBm,g=this.optData.securityLvl);return new f(a,!0,b,e,m,g)};a.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),data:this.data?this.data.toString("hex"):null,senderID:this.senderID,status:this.status}};a.resolve=function(b){var e=b.data;b=e.slice(1,e.length-5);var f=e.slice(e.length-5,e.length-1);e=e.readUInt8(e.length-1);return new a(b,f.toString("hex"),e)};return a}(),z=function(a,b,e,f,g,h,k,p){l.call(this,
64,p);this.seq=a;this.idx=b;this.len=e;this.crorg=f;this.data=g;this.senderID=h;this.status=k};z.prototype=new l;z.prototype.constructor=z;z.prototype.getSenderID=function(){return this.senderID};z.prototype.getSeq=function(){return this.seq};z.prototype.getIdx=function(){return this.idx};z.prototype.getLen=function(){return this.len};z.prototype.getCRORG=function(){return this.crorg};z.prototype.getData=function(){return this.data};z.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),
seq:this.seq,idx:this.idx,len:this.len,crorg:this.crorg?this.crorg.toString(16):null,data:this.data.toString("hex"),senderID:this.senderID,status:this.status}};z.resolve=function(a){var b=a.data,e=b.readUInt8(1)>>6&3,f=b.readUInt8(1)&63;if(0==f){var m=b.readUInt16BE(2);var g=b.readUInt8(4);var h=b.slice(5,b.length-5)}else g=m=null,h=b.slice(2,b.length-5);var k=b.slice(b.length-5,b.length-1).toString("hex");b=b.readUInt8(b.length-1);var l;a.hasOpt&&(l={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,
securityLvl:a.securityLvl});return new z(e,f,m,g,h,k,b,l)};var C=function(a,b,e,f){l.call(this,208,f);this.messageIndex=a;this.userData=b;this.senderID=e};C.prototype=new l;C.prototype.constructor=C;C.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),messageIndex:this.messageIndex,userData:this.userData?this.userData.toString("hex"):null,senderID:this.senderID}};C.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.messageIndex,1);this.userData&&
(a=Buffer.concat([a,this.userData]));a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);var b=1,e="FFFFFFFF",g=255,h=0;this.optData&&(b=this.optData.subTelNum,e=this.optData.dstId,g=this.optData.dBm,h=this.optData.securityLvl);return new f(a,!0,b,e,g,h)};C.resolve=function(a){var b=a.data,e=b.readUInt8(1),f=null,m=null;switch(e){case 1:f=0;m=b.slice(2,6).toString("hex");break;case 4:case 6:f=b.slice(2,3),m=b.slice(3,7).toString("hex")}var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,
securityLvl:a.securityLvl});return new C(e,f,m,g)};var I=function(a,b,e,f,g,h){l.call(this,246,h);this.userData=a?a:0;this.senderID=b;this.t21=e?e:0;this.nu=f?f:0;this.rc=g?g:0};I.prototype=new l;I.prototype.constructor=I;I.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),senderID:this.senderID,t21:this.t21,nu:this.nu,rc:this.rc}};I.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.userData,1);a=Buffer.concat([a,
new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.t21<<5|this.nu<<4||this.rc])]);var b=1,e="FFFFFFFF",g=255,h=0;this.optData&&(b=this.optData.subTelNum,e=this.optData.dstId,g=this.optData.dBm,h=this.optData.securityLvl);return new f(a,!0,b,e,g,h)};I.resolve=function(a){var b=a.data,e=b.readUInt8(1),f=b.slice(2,6).toString("hex"),g=b.readUInt8(6)>>5&1,m=b.readUInt8(6)>>4&1,h;a.hasOpt&&(h={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new I(e,f,
g,m,b&15,h)};var J=function(a,b,e,f){l.call(this,213,f);this.userData=a;this.senderID=b;this.rc=e?e:0};J.prototype=new l;J.prototype.constructor=J;J.prototype.getLearnBit=function(){return this.userData>>3&1};J.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),learn:this.getLearnBit(),senderID:this.senderID,rc:this.rc}};J.resolve=function(a){var b=a.data,e=b.readUInt8(1),f=b.slice(2,6).toString("hex");b=b.readUInt8(6)&15;var g;a.hasOpt&&(g={subTelNum:a.subTelNum,
dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new J(e,f,b,g)};var A=function(a,b,e,f){l.call(this,165,f);this.userData=a;this.senderID=b;this.rc=e?e:0};A.prototype=new l;A.prototype.constructor=A;A.prototype.getLearnType=function(){return this.userData.readUInt8(3)>>7&1};A.prototype.getLearnBit=function(){return this.userData.readUInt8(3)>>3&1};A.prototype.getLearnStatus=function(){return this.userData.readUInt8(3)>>4&1};A.prototype.getLearnResult=function(){return this.userData.readUInt8(3)>>
5&1};A.prototype.getEEPResult=function(){return this.userData.readUInt8(3)>>6&1};A.prototype.getFunc=function(){return this.userData.readUInt8(0)>>2&63};A.prototype.getType=function(){var a=this.userData.readUInt8(0)&3,b=this.userData.readUInt8(1)>>3&31;return a<<5|b};A.prototype.getManufacturerId=function(){var a=this.userData.readUInt8(1)&7,b=this.userData.readUInt8(2);return a<<8|b};A.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),learnType:this.getLearnType(),
learn:this.getLearnBit(),learnStatus:this.getLearnStatus(),learnResult:this.getLearnResult(),eepResult:this.getEEPResult(),func:this.getFunc(),type:this.getType(),manufacturerId:this.getManufacturerId(),senderID:this.senderID,rc:this.rc}};A.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,0);a=Buffer.concat([a,this.userData]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.rc&15])]);return this.optData?new f(a,!0,this.optData.subTelNum,
this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new f(a,!1)};A.resolve=function(a){var b=a.data,e=b.slice(1,5),f=b.slice(5,9).toString("hex");b=b.readUInt8(9)&15;var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new A(e,f,b,g)};var w=function(a,b,e,f){l.call(this,210,f);this.userData=a;this.senderID=b;this.status=e};w.prototype=new l;w.prototype.constructor=w;w.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),
senderID:this.senderID,status:this.status,optData:this.optData}};w.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,0);a=Buffer.concat([a,this.userData]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return this.optData?new f(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new f(a,!1)};w.resolve=function(a){var b=a.data,e=b.slice(1,b.length-5),f=b.slice(b.length-5,b.length-1).toString("hex");
b=b.readUInt8(b.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new w(e,f,b,g)};var O=function(a,b,e,f,g){l.call(this,166);this.rorg_en=a;this.data=b;this.dstID=e;this.senderID=f;this.status=g};O.prototype=new l;O.prototype.constructor=O;O.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.rorg_en,1);a=Buffer.concat([a,this.data]);a=Buffer.concat([a,new Buffer(this.dstID,"hex")]);a=Buffer.concat([a,
new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return new f(a,!1)};var U=function(a,b,e,f,g,h,k,p,q,n,t){l.call(this,212);this.cmd=a;this.ute=b;this.rspExpected=e;this.subtype=f;this.numChannel=g;this.manufactureID=h;this.eepType=k;this.eepFunc=p;this.eepRorg=q;this.senderID=n;this.status=t};U.prototype=new l;U.prototype.constructor=U;U.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),ute:this.ute,rspExpected:this.rspExpected,subtype:this.subtype,cmd:this.cmd,
numChannel:this.numChannel,manufactureID:this.manufactureID,eepType:this.eepType.toString(16),eepFunc:this.eepFunc.toString(16),eepRorg:this.eepRorg.toString(16),senderID:this.senderID,status:this.status}};U.prototype.toPacket=function(){var a=new Buffer(8);a.writeUInt8(this.rorg,0);a.writeUInt8(this.ute<<7|this.rspExpected<<6|this.subtype<<4|this.cmd,1);a.writeUInt8(this.numChannel,2);a.writeUInt16BE(parseInt(this.manufactureID,16),3);a.writeUInt8(this.eepType,5);a.writeUInt8(this.eepFunc,6);a.writeUInt8(this.eepRorg,
7);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return this.optData?new f(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new f(a,!1)};U.resolve=function(a){var b=a.data.slice(1,8),e=a.data.slice(8,12).toString("hex"),f=a.data.readUInt8(12),g=b.readUInt8(0)>>7&1,h=b.readUInt8(0)&15,k=b.readUInt8(1),m=b.slice(2,4).toString("hex"),l=b.readUInt8(4),p=b.readUInt8(5),q=b.readUInt8(6),n=b.readUInt8(0)>>6&1;
b=b.readUInt8(0)>>4&3;e=new U(h,g,n,b,k,m,l,p,q,e,f);a.hasOpt&&(e.optData={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return e};var X=function(a,b,e,f){l.call(this,53,f);this.userData=a;this.senderID=b;this.status=e};X.prototype=new l;X.prototype.constructor=X;X.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};X.resolve=function(a){var b=a.data,e=b.slice(1,
b.length-5),f=b.slice(b.length-5,b.length-1).toString("hex");b=b.readUInt8(b.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new X(e,f,b,g)};var N=function(a,b,e,f){l.call(this,49,f);this.userData=a;this.senderID=b;this.status=e};N.prototype=new l;N.prototype.constructor=N;N.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};
N.prototype.convertToPacket=function(a){a=Buffer.concat([a,new Buffer(this.senderID,"hex"),new Buffer([this.status])]);return this.optData?new f(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new f(a,!1)};N.resolve=function(a){var b=a.data,e=b.slice(1,b.length-5),f=b.slice(b.length-5,b.length-1).toString("hex");b=b.readUInt8(b.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new N(e,f,b,g)};l.SIG=
C;l.RPS=I;l.BS1=J;l.BS4=A;l.VLD=w;l.ADT=O;l.UTE=U;l.TS=X;l.SM=N;l.GP_TI=p;l.GP_TR=q;l.GP_CD=u;var t=function(a,b){this._code=a;this._rspData=b};t.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"};t.prototype.toJSON=function(){return{code:this._code,rspData:this._rspData?this._rspData.toString("hex"):null}};t.prototype.toPacket=function(){return new a(this._code,this._rspData)};t.resolve=
function(a){return new t(a.retCode,a.resData)};q=function(a,b){t.call(this,0);this._responseTime=a;this._confirmCode=b};q.prototype.toPacket=function(){var b=new Buffer(3);b.writeUInt16BE(this._responseTime,0);b.writeUInt8(this._confirmCode,2);return new a(this._code,b)};q.prototype.toJSON=function(){return{code:this._code,responseTime:this._responseTime,confirmCode:this._confirmCode}};t.Response_OK_SA_CONFIRM_LEARN=q;var n=function(a){this._code=a};n.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 1:return Y.resolve(a);
case 2:return K.resolve(a);default:return null}};var Y=function(){this._code=1};Y.prototype=new n;Y.prototype.constructor=Y;Y.prototype.toJSON=function(){return{code:this._code}};Y.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);return new h(a)};Y.resolve=function(a){return new Y};var K=function(a,b,e,f,g,h,k){this._code=2;this._priority=a;this._manufacturerId=b;this._eep=e;this._rssi=f;this._pm_candidateId=g;this._sa_clientId=h;this._hop_count=k};K.prototype=new n;K.prototype.constructor=
K;K.prototype.getEEP=function(){return this._eep?this._eep.substr(0,2)+"-"+this._eep.substr(2,2)+"-"+this._eep.substr(4,2):null};K.prototype.getPMCandidateId=function(){return this._pm_candidateId};K.prototype.getSAClientId=function(){return this._sa_clientId};K.prototype.getHopCount=function(){return this._hop_count};K.prototype.toJSON=function(){return{code:this._code,priority:this._priority,manufacturerId:this._manufacturerId,eep:this.getEEP(),rssi:this._rssi,pm_candidateId:this._pm_candidateId,
sa_clientId:this._sa_clientId,hop_count:this._hop_count}};K.prototype.toPacket=function(){var a=new Buffer(4);a.writeUInt8(this._code,0);a.writeUInt8(this._priority,1);a.writeUInt16BE(this._manufacturerId&1023,2);a=Buffer.concat([a,new Buffer(this._eep,"hex")]);a=Buffer.concat([a,new Buffer([this._rssi])]);a=Buffer.concat([a,new Buffer(this._pm_candidateId,"hex")]);a=Buffer.concat([a,new Buffer(this._sa_clientId,"hex")]);a=Buffer.concat([a,new Buffer([this._hop_count])]);return new h(a)};K.resolve=
function(a){var b=a.data;a=b.readUInt8(1);var e=b.readUInt16BE(2)&1023,f=b.slice(4,7).toString("hex"),g=b.readUInt8(7),h=b.slice(8,12).toString("hex"),k=b.slice(12,16).toString("hex");b=b.readUInt8(16);return new K(a,e,f,g,h,k,b)};n.SA_RECLAIM_NOT_SUCCESSFUL=Y;n.SA_CONFIRM_LEARN=K;var oa=function(a){this._code=a};oa.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 9:return CO_WR_REPEATER.resolve(a);default:return null}};CO_WR_REPEATER=function(a,b){this._code=9;this._enable=
a;this._level=b};CO_WR_REPEATER.prototype=new oa;CO_WR_REPEATER.prototype.constructor=CO_WR_REPEATER;CO_WR_REPEATER.prototype.toJSON=function(){return{code:this._code,enable:this._enable,level:this._level}};CO_WR_REPEATER.prototype.toPacket=function(){var a=new Buffer(3);a.writeUInt8(this._code,0);a.writeUInt8(this._enable,1);a.writeUInt8(this._level,2);return new k(a)};CO_WR_REPEATER.resolve=function(a){a=a.data.readUInt8(1);var b=CO_WR_REPEATER.readUInt8(2);return new CO_WR_REPEATER(a,b)};oa.CO_WR_REPEATER=
CO_WR_REPEATER;var M=function(a){this._code=a};M.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 1:return P.resolve(a);case 6:return Z.resolve(a);case 8:return aa.resolve(a);default:return null}};var P=function(a,b,e){this._code=1;this._enable=a;this._extended=b;this._timeout=e};P.prototype=new M;P.prototype.constructor=P;P.prototype.toJSON=function(){return{code:this._code,enable:this._enable,extended:this._extended,timeout:this._timeout}};P.prototype.toPacket=function(){var a=
new Buffer(7);a.writeUInt8(this._code,0);a.writeUInt8(this._enable,1);a.writeUInt8(this._extended,2);a.writeUInt32BE(this._timeout,3);return new e(a)};P.resolve=function(a){var b=a.data;a=b.readUInt8(1);var e=b.readUInt8(2);b=b.readUInt32BE(3);return new P(a,e,b)};var ca=function(a){this._code=5;this._saClientId=a};ca.prototype=new M;ca.prototype.constructor=ca;ca.prototype.toJSON=function(){return{code:this._code,clientId:this._saClientId}};ca.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,
0);a=Buffer.concat([a,new Buffer(this._saClientId,"hex")]);return new e(a)};ca.resolve=function(a){a=a.data.slice(1,5).toString("hex");return new ca(a)};var Z=function(){this._code=6};Z.prototype=new M;Z.prototype.constructor=Z;Z.prototype.toJSON=function(){return{code:this._code}};Z.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);return new e(a)};Z.resolve=function(a){return new Z};var aa=function(a){this._code=8;this._mailBoxCount=a};aa.prototype=new M;aa.prototype.constructor=
aa;aa.prototype.toJSON=function(){return{code:this._code,mailBoxCount:this._mailBoxCount}};aa.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this._code,0);a.writeUInt8(this._mailBoxCount,1);return new e(a)};aa.resolve=function(a){a=a.data.readUInt8(1);return new aa(a)};M.SA_WR_LEARNMODE=P;M.SA_WR_RESET=ca;M.SA_RD_LEARNEDCLIENTS=Z;M.SA_WR_POSTMASTER=aa;var Qa=function(){var a=function(a){this._esp3=a;this._buffer={}};a.prototype.receiveChainedTelegram=function(a){var b=a.getSenderID(),
e=a.getSeq(),f=a.getIdx();this._buffer[b]||(this._buffer[b]={});var g=this._buffer[b];g[e]||(g[e]=[]);g=g[e];for(var h=0;h<=f;h++)h!=f?g.length<f&&(g[h]=null):g[h]=a;this._checkChain(b,e)};a.prototype._checkChain=function(a,b){var e=this._buffer[a][b];if(e[0]){var g=e[0],h=g.getLen(),k=g.getCRORG();g=0;var l=new Buffer(1);l.writeUInt8(k);for(k=0;k<e.length;k++){var m=e[k];if(!m)return;m=m.getData();g+=m.length;l=Buffer.concat([l,m])}g>=h&&(delete this._buffer[a][b],l=Buffer.concat([l,new Buffer(a,
"hex")]),l=Buffer.concat([l,new Buffer("00","hex")]),a=new f(l,!1),this._esp3._onEORadio_ERP1(a))}};return a}(),v=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP3");this._controller=a;this._listeners=[];a&&this._listeners.push(a);this._recomm=new x.hub.m.enocean.ReComm(this);this._baseID=this._serial=null;this._rdata=new Buffer([]);this._frameBuffer=[];this._learnHandler=null;this._learning=!1;this._learnTO=null;this._cdmHandler=new Qa(this)};v.RESPONSE_TO=1500;v.prototype.attachSerial=
function(a,b){var e=this;this._serial=new x.hub.m.enocean.Serial(a);this._serial.setListener(this);this._serial.open(function(a){a?(e._serial.setListener(null),e._serial=null,b&&b(a)):e.readBaseID(function(a,f){a?(e._serial.setListener(null),e._serial.close(),e._serial=null,b&&b(a)):(x.hub.m.enocean.SENDER_ID||(x.hub.m.enocean.SENDER_ID=f,localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID",f)),e._baseID=f,b&&b())})})};v.prototype.removeSerial=function(a,b){this._serial.setListener(null);
this._serial.close();this._baseID=this._serial=null;b&&b()};v.prototype.getSerial=function(){return this._serial};v.prototype.addListener=function(a){a&&-1==this._listeners.indexOf(a)&&this._listeners.push(a)};v.prototype.removeListener=function(a){a&&(a=this._listeners.indexOf(a),-1!=a&&this._listeners.splice(a,1))};v.prototype.readBaseID=function(a){var b=this,e=new g(5,new Buffer("08","hex"));this.sendFrame(e,!0,function(e,f){e?(b._logger.log("warn","read base id error:"+e.stack),a&&a(e)):f&&f.retCode?
(e=Error("read BaseID error"),e.code=f.retCode,b._logger.log("warn","read base id error return code:"+f.retCode),a&&a(e)):(e=f.resData.toString("hex"),a&&a(null,e.toLowerCase()))},8E3)};v.prototype.startLearn=function(a,b,e,f){if(this._serial){if(!b||0>=b)b=3E4;if(this._learning)f&&f(Error("learning another type right now"));else{this._learnHandler=a;this._learning=!0;var g=this;this._learnTO=setTimeout(function(){g._learning=!1;g._learnTO=null;var a=g._learnHandler;g._learnHandler=null;if(a&&a.onLearnTimeout)a.onLearnTimeout()},
b);e?(a=new P(1,e.extended?e.extended:0,0),this.sendSACommand(a,!0,function(a){f&&f(a)})):f&&f()}}else f&&f(Error("port not opened"))};v.prototype.stopLearn=function(a,b,e){this._learnTO&&clearTimeout(this._learnTO);this._learning=!1;this._learnTO=this._learnHandler=null;if(b){e&&e();var f=this;setTimeout(function(){var a=new P(0,b.extended?b.extended:0,0);f.sendSACommand(a,!0,function(a){e&&e(a)})},2E3)}else e&&e()};v.prototype.sendTelegram=function(a,b,e){this.sendPacket(a.toPacket(),b,e)};v.prototype.sendResponse=
function(a,b){this._logger.log("trace","send RESPONSE:"+JSON.stringify(a.toJSON()));this.sendPacket(a.toPacket(),!1,b)};v.prototype.sendSACommand=function(a,b,e){this._logger.log("trace","send SA_COMMAND:"+JSON.stringify(a.toJSON()));this.sendPacket(a.toPacket(),b,e)};v.prototype.sendCommandCommand=function(a,b,e){this._logger.log("trace","send COMMAND_COMMAND:"+JSON.stringify(a.toJSON()));this.sendPacket(a.toPacket(),b,e)};v.prototype.sendPacket=function(a,b,e){this.sendFrame(a.toFrame(),b,e)};v.prototype.sendFrame=
function(a,b,e,f){var g=this._frameBuffer.length;this._frameBuffer.push({frame:a,callback:e,timeout:null,response:b,to:f});0==g&&this._sendNextFrame()};v.prototype._sendNextFrame=function(){if(0!=this._frameBuffer.length){var a=this._frameBuffer[0],b=a.frame,e=a.callback,f=a.response;if(this._serial){var g=this;b=b.toBuffer();this._logger.log("trace","send raw frame:"+b.toString("hex"));this._serial.sendPacket(b,function(b){if(b||!f){try{e&&e(b)}catch(Ga){}g._frameBuffer.splice(0,1);g._sendNextFrame()}else b=
a.to,b||(b=v.RESPONSE_TO),a.timeout=setTimeout(function(){var a=g._frameBuffer[0];if(a){a=a.callback;var b=Error("enocean response timeout");b.code=100;try{a&&a(b)}catch(db){}}g._frameBuffer.splice(0,1);g._sendNextFrame()},b)})}else e&&e(Error("port not opened")),this._frameBuffer.splice(0,1),this._sendNextFrame()}};v.prototype.onSerialData=function(a){a=this._rdata=Buffer.concat([this._rdata,a]);for(var b=0;b<a.length;)if(85!=a[b])b++;else{if(b+6>=a.length)break;var e=(a[b+1]<<8)+a[b+2],f=a[b+3],
h=a[b+5];if(a.length<b+e+f+7)break;if(x.hub.m.enocean.CRC8(a.slice(b+1,b+5))!=h)b++;else if(h=a[b+e+f+6],x.hub.m.enocean.CRC8(a.slice(b+6,b+6+e+f))!=h)b++;else{h={type:a[b+4],dataLen:e,optLen:f,radioType:a[b+6],data:a.slice(b+6,b+6+e),optData:a.slice(b+6+e,b+6+e+f),rawByte:a.slice(0,b+6+e+f+1).toString("hex")};var k=new g(h.type,h.data,h.optData);if(166==h.radioType||210==h.radioType||165==h.radioType||246==h.radioType||213==h.radioType)h.senderId=h.data.slice(e-5,e-1).toString("hex");try{this._onEOFrame(k,
h)}catch(Ga){this._logger.log("warn","process frame exception:"+Ga.stack)}b=b+6+e+f+1}}0!=b&&0<a.length&&b<=a.length&&(a=a.slice(b));this._rdata=a};v.prototype.onSerialError=function(a){this._serial.setListener(null);this._serial=null};v.prototype._onEOFrame=function(a,b){this._logger.log("trace","receive raw frame:"+b.rawByte);this._logger.log("debug","receive enocean frame:"+JSON.stringify(a.toJSON()));this._listeners.forEach(function(e){e._onEOFrame&&e._onEOFrame(a,b.rawByte)});var e=a.toPacket();
e&&this._onEOPacket(e)};v.prototype._onEOPacket=function(b){this._logger.log("debug","receive enocean packet:"+JSON.stringify(b.toJSON()));this._listeners.forEach(function(a){a._onEOPacket&&a._onEOPacket(b)});b instanceof f?this._onEORadio_ERP1(b):b instanceof a?this._onEOResponse_Packet(b):b instanceof h&&this._onEOEvent_Packet(b)};v.prototype._onEORadio_ERP1=function(a){(a=a.toRadioTelegram())&&this._onEO_ERP1_Telegram(a)};v.prototype._onEOResponse_Packet=function(a){try{var b=a.toResponse();this._onEO_Response(b)}catch(Pa){}if(0!=
this._frameBuffer.length){var e=this._frameBuffer[0];b=e.callback;(e=e.timeout)&&clearTimeout(e);try{b&&b(null,a)}catch(Pa){}this._frameBuffer.splice(0,1);this._sendNextFrame()}};v.prototype._onEOEvent_Packet=function(a){(a=a.toEvent())&&this._onEO_Event(a)};v.prototype._onEO_ERP1_Telegram=function(a){this._logger.log("debug","receive enocean telegram:"+JSON.stringify(a.toJSON()));if(64==a.rorg)this._cdmHandler.receiveChainedTelegram(a);else if(this._listeners.forEach(function(b){b._onEOTelegram&&
b._onEOTelegram(a)}),49==a.rorg&&(a=this._controller._secHandler.resolve(a))&&this._listeners.forEach(function(b){b._onEOTelegram&&b._onEOTelegram(a)}),this._learning&&this._learnHandler&&this._learnHandler.onTelegram)this._learnHandler.onTelegram(a)};v.prototype._onEO_Response=function(a){this._logger.log("debug","receive enocean response:"+JSON.stringify(a.toJSON()))};v.prototype._onEO_Event=function(a){this._logger.log("debug","receive enocean event:"+JSON.stringify(a.toJSON()));if(this._learning&&
this._learnHandler&&this._learnHandler.onEvent)this._learnHandler.onEvent(a)};v.ESP3_Frame=g;v.Telegram=l;v.RADIO_ERP1_Packet=f;v.Event=n;v.Response=t;v.COMMAND_COMMAND=oa;v.SA_COMMAND=M;return v}();
x.hub.m.enocean.profiles=function(){var g=function(c){this._address=c?c.address:null;this._senderID=c?c.senderID:null;this._data=c?c.data:null;this._params=c?c.params:null;this._vendor="general";this._virtual=!1;this._eepAlias=null;this.setDefaultParams();this._states={};this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles."+(this._data?this._data:"Profile"))};g.prototype.getAddress=function(){return this._address};g.prototype.getData=function(){return this._data};g.prototype.finalize=
function(c){c&&c()};g.prototype.evalData=function(c,d,a){(c=this.evalTelegram(d))?(c=this.checkStateChange(c),a&&a(null,c)):a&&a(Error("data format invalid"))};g.prototype.evalTelegram=function(c){return null};g.prototype.getStatesBuffer=function(){return this._states};g.prototype.getBufferedState=function(c){var d=this.getStatesBuffer();return d&&d[c]?d[c].value:null};g.prototype.getCurrentStates=function(){var c={},d=this.getStatesBuffer(),a;for(a in d)d.hasOwnProperty(a)&&d[a]&&(c[a]=d[a].value);
return c};g.prototype.getStatesLegacy=function(){var c=this.getCurrentStates();return{type:"ENOCEAN",adr:this._address,data:this._data,vendor:this._vendor,state:c}};g.prototype.checkStateChange=function(c){var d=this._states,a=[],b=(new Date).getTime(),e;for(e in c){var f={};f.key=e;f.value=c[e];f.changed=!1;var g=d[e]?d[e].value:null;g!=c[e]&&(f.oldvalue=g,f.changed=!0);this._states[e]={value:c[e],time:b};a.push(f)}return a};g.prototype.setDefaultParams=function(){};g.prototype.activeStateChange=
function(c){c=this.checkStateChange(c);0<c.length&&require("x.hub.m.enocean.js")._onEOEvents(this,c)};g.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params}};g.prototype.fromJSON=function(c){if(!c||!c.address||!c.data||c.data!=this._data)return null;this._address=c.address;this._senderID=c.senderID;this._vendor=c.vendor?c.vendor:this._vendor;this._virtual=c.virtual?!0:!1;this._params=
c.params;this.setDefaultParams();return this};g.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual}};g.prototype.fromDBJSON=function(c){if(!c||!c.id||!c.eep||c.eep!=this._data)return null;this._address=c.id;this._senderID=c.senderID;this._vendor=c.vendor?c.vendor:this._vendor;this._virtual=c.virtual?!0:!1;this._params=c.params;this.setDefaultParams();return this};var b=function(c){g.call(this,c);
this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SiegeniaWindow");this._data="d2-06-50";this._vendor="siegenia";this._desc="Window";this._states={counter00:{value:"?",time:-1},counter01:{value:"?",time:-1},counter02:{value:"?",time:-1},counter03:{value:"?",time:-1},counter04:{value:"?",time:-1},counter05:{value:"?",time:-1},counter06:{value:"?",time:-1},counter07:{value:"?",time:-1},counter08:{value:"?",time:-1},counter09:{value:"?",time:-1},counter0A:{value:"?",time:-1},aliveTimeout:{value:!1,
time:-1}};var d=this;this._params=c?c.params:null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});this._aliveTO=setTimeout(function(){d._aliveTimeout()},2E3*this._params.alive);this._lastAlarm=null};b.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"SIEGENIA-AUBI KG",vendor:"siegenia",params:{alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0}};b.prototype=new g;b.prototype.constructor=b;b.prototype.evalTelegram=function(c){var d={};if(210==c.rorg)if(c=c.userData,
1==c[0]&&8==c.length){var a=c[1]&239,b=(c[2]<<24)+(c[3]<<16)+(c[4]<<8)+c[5],e=c[6]>>7;d={type:1,TBT:!1,batteryOK:!0,battery:c[6]&127,motionSensor:c[7]>>6,accelerationSensor:(c[7]&48)>>4,magneticSensor:(c[7]&12)>>2,error:c[7]&3,count:b};e&&(d.batteryOK=!1);100<d.battery&&(d.battery=100);d.code=a;switch(a){case 0:d.state="?";d.handle="?";d.counter00=b;break;case 1:d.state="closed";d.handle="closed";d.counter01=b;break;case 2:d.state="closed";d.handle="open";d.counter02=b;break;case 3:d.state="closed";
d.handle="tilted";d.counter03=b;break;case 4:d.state="open";d.handle="closed";d.counter04=b;break;case 5:d.state="open";d.handle="open";d.TBT=!0;d.counter05=b;break;case 6:d.state="open";d.handle="tilted";d.TBT=!0;d.counter06=b;break;case 7:d.state="tilted";d.handle="closed";d.TBT=!0;d.counter07=b;break;case 8:d.state="tilted";d.handle="open";d.TBT=!0;d.counter08=b;break;case 9:d.state="tilted";d.handle="tilted";d.counter09=b;break;case 10:d.state="?",d.handle="?",d.counter0A=b}}else if(2==c[0]&&
2==c.length)switch(d.type=2,c[1]&15){case 1:d.burglary=!0;break;default:d.burglary=!1}else if(17==c[0]&&2==c.length){d.type=17;switch((c[1]&192)>>6){case 0:d.calibrationState="ok";break;case 1:d.calibrationState="error";break;case 2:d.calibrationState="invalid";break;case 3:d.calibrationState="not_supported"}c=c[1]&63;d.calibrationStep=c;switch(c){case 0:d.calibrationCasement="none";d.calibrationHandle="none";break;case 1:d.calibrationCasement="closed";d.calibrationHandle="closed";break;case 2:d.calibrationCasement=
"closed";d.calibrationHandle="open";break;case 3:d.calibrationCasement="closed";d.calibrationHandle="tilted";break;case 4:d.calibrationCasement="open";d.calibrationHandle="closed";break;case 5:d.calibrationCasement="open";d.calibrationHandle="open";break;case 6:d.calibrationCasement="open";d.calibrationHandle="tilted";break;case 7:d.calibrationCasement="tilted";d.calibrationHandle="closed";break;case 8:d.calibrationCasement="tilted";d.calibrationHandle="open";break;case 9:d.calibrationCasement="tilted",
d.calibrationHandle="tilted"}}return d};b.prototype.evalData=function(c,d,a){var b=this;b._states.aliveTimeout.value=!1;clearTimeout(this._aliveTO);this._aliveTO=setTimeout(function(){b._aliveTimeout()},2E3*this._params.alive);if(c=this.evalTelegram(d)){if(2==c.type){d=(new Date).getTime();if(this._lastAlarm&&4E3>d-this._lastAlarm){a&&a(Error("duplicated alarm"));return}this._lastAlarm=d}d=[];c.aliveMsg||(d=this.checkStateChange(c));a&&a(null,d)}else a&&a(Error("data format invalid"))};b.prototype.checkStateChange=
function(c){var d=this._states,a=[],b;for(b in c)if("aliveMsg"!=b&&"type"!=b){var e={};e.key=b;e.value=c[b];e.changed=!1;var f=d[b]?d[b].value:null;f!=c[b]&&(e.oldvalue=f,e.changed=!0);"burglary"!=b&&"calibrationState"!=b&&"calibrationCasement"!=b&&"calibrationHandle"!=b&&(this._states[b]={value:c[b],time:(new Date).getTime()});a.push(e)}return a};b.prototype._resolveStates=function(c,d){d={};if(210==c[0])if(c=c.slice(1,c.length-5),1==c[0]&&8==c.length){var a=c[1]&239,b=(c[2]<<24)+(c[3]<<16)+(c[4]<<
8)+c[5],e=c[6]>>7;d={aliveMsg:1==(c[1]&128)>>7,TBT:!1,batteryOK:!0,battery:c[6]&127,motionSensor:c[7]>>6,accelerationSensor:(c[7]&48)>>4,magneticSensor:(c[7]&12)>>2,error:c[7]&3,count:b};e&&(d.batteryOK=!1);100<d.battery&&(d.battery=100);switch(a){case 0:d.state="closed";d.handle="closed";d.counter00=b;break;case 1:d.state="closed";d.handle="open";d.counter01=b;break;case 2:d.state="open";d.handle="open";d.counter02=b;break;case 3:d.state="closed";d.handle="tilted";d.counter03=b;break;case 4:d.state=
"tilted";d.handle="tilted";d.counter04=b;break;case 5:d.state="closed";d.handle="tilted";d.TBT=!0;d.counter05=b;break;case 6:d.state="tilted";d.handle="tilted";d.TBT=!0;d.counter06=b;break;case 7:d.state="closed";d.handle="open";d.TBT=!0;d.counter07=b;break;case 8:d.state="open";d.handle="open";d.TBT=!0;d.counter08=b;break;case 9:d.state="open";d.handle="closed";d.counter09=b;break;case 10:d.state="open",d.handle="tilted",d.counter0A=b}}else if(2==c[0]&&2==c.length)switch(c[1]&15){case 1:d.burglary=
!0;break;default:d.burglary=!1}else if(17==c[0]&&2==c.length){switch((c[1]&192)>>6){case 0:d.calibrationState="ok";break;case 1:d.calibrationState="error";break;case 2:d.calibrationState="invalid";break;case 3:d.calibrationState="not_supported"}switch(c[1]&63){case 0:d.calibrationCasement="none";d.calibrationHandle="none";break;case 1:d.calibrationCasement="closed";d.calibrationHandle="closed";break;case 2:d.calibrationCasement="closed";d.calibrationHandle="open";break;case 3:d.calibrationCasement=
"closed";d.calibrationHandle="tilted";break;case 4:d.calibrationCasement="open";d.calibrationHandle="closed";break;case 5:d.calibrationCasement="open";d.calibrationHandle="open";break;case 6:d.calibrationCasement="open";d.calibrationHandle="tilted";break;case 7:d.calibrationCasement="tilted";d.calibrationHandle="closed";break;case 8:d.calibrationCasement="tilted";d.calibrationHandle="open";break;case 9:d.calibrationCasement="tilted",d.calibrationHandle="tilted"}}return d};b.prototype._aliveTimeout=
function(){this.activeStateChange({aliveTimeout:!0})};b.prototype.fromJSON=function(c){if(!g.prototype.fromJSON.call(this,c))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});return this};b.prototype.fromDBJSON=function(c){if(!g.prototype.fromDBJSON.call(this,c))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});return this};var a=function(c){g.call(this,c);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.MacoWindow");
this._data="d5-xx-xx";this._desc="Window";this._vendor="maco"};a.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"Mayer & Co Beschl\u00e4ge GmbH"};a.prototype=new g;a.prototype.constructor=a;a.prototype.evalData=function(c,d,a){(c=this._resolveStates(c,d))?(c=this.checkStateChange(c),a&&a(null,c)):a&&a(Error("data format invalid"))};a.prototype._resolveStates=function(c,d){d={};if(213==c[0]){c=c.slice(1,c.length-5);var a=(c[0]&8)>>3,b=(c[0]&6)>>1,e=c[0]&1;switch((c[0]&48)>>4){case 0:d.state=
"unused";break;case 1:d.state="tilted";break;case 2:d.state="open";break;case 3:d.state="closed"}d.learn=a;d.battery=b;d.alarm=e}return d};a.prototype.toDBJSON=function(){return{id:this._address,eep:this._data,desc:this._desc,manufacturer:"Mayer & Co Beschl\u00e4ge GmbH",vendor:this._vendor}};var f=function(c){g.call(this,c);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SodaHandle");this._data="f6-so-da"};f.TEMPALTE={id:null,eep:null};f.prototype=new g;f.prototype.constructor=
f;f.prototype.evalTelegram=function(c){var d={};if(246==c.rorg)switch(c.userData){case 240:d.state="tilted";break;case 192:d.state="open";break;case 208:d.state="closed"}return d};f.prototype.evalData=function(c,d,a){(c=this.evalTelegram(d))?(c=this.checkStateChange(c),a&&a(null,c)):a&&a(Error("data format invalid"))};f.prototype.toJSON=function(c,d){return{address:this._address,data:this._data,vendor:"soda"}};f.prototype.toDBJSON=function(){return{id:this._address,eep:this._data,desc:"Window_Handle",
manufacturer:"SODA",vendor:"soda"}};var e=function(c){g.call(this,c);this._data="f6-??-??"};e.prototype=new g;e.prototype.constructor=e;var k=function(c){e.call(this,c);this._data="f6-01-01";this._longPressThreshold=1E3};k.STATES=["button"];k.COMMANDS=["shortPress","longPress","press","release"];k.prototype=new e;k.prototype.constructor=h;k.prototype.evalTelegram=function(c){var d={};246==c.rorg&&(d.button=c.userData>>4&1?"pressed":"released");return d};k.prototype.buildData=function(c){return c<<
4};k.prototype.checkStateChange=function(c){var d=this._states,a=[],b=(new Date).getTime(),e;for(e in c){var f={};f.key=e;f.value=c[e];f.changed=!1;var g=d[e]?d[e].value:null,h=d[e]?d[e].time:null,k=c[e];g!=k&&(f.oldvalue=g,f.changed=!0);this._states[e]={value:c[e],time:b};f.changed&&a.push(f);"pressed"==g&&"released"==k&&(!h||b-h<this._longPressThreshold?(f={},f.key=e,f.value="shortPress"):(f={},f.key=e,f.value="longPress"),f.changed=!0,a.push(f))}return a};k.prototype.executeCommand=function(c,
d,a){if(this._senderID)if(d&&d.value){var b=this,e=100;switch(d.value){case "longPress":e=this._longPressThreshold;case "shortPress":var r=this.buildData(1);var f=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null);c.sendTelegram(f,!0,function(d){d?a&&a(d):(b.activeStateChange({button:"pressed"}),setTimeout(function(){r=b.buildData(0);f=new x.hub.m.enocean.ESP3.Telegram.RPS(r,b._senderID,1,1,0,null);c.sendTelegram(f,!0,function(c){b.activeStateChange({button:"released"});a&&a(c)})},
e))});break;case "press":r=this.buildData(1);f=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null);c.sendTelegram(f,!0,function(c){b.activeStateChange({button:"pressed"});a&&a(c)});break;case "release":r=this.buildData(0),f=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),c.sendTelegram(f,!0,function(c){b.activeStateChange({button:"released"});a&&a(c)})}}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var h=function(c){e.call(this,c);this._data=
"f6-02-01";this._longPressThreshold=1E3};h.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];h.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");h.prototype=new e;h.prototype.constructor=h;h.prototype.evalTelegram=function(c){var d={};if(246==c.rorg){var a=c.userData>>5&7,b=c.userData>>1&7,e=c.userData&1,f=c.t21,g=c.nu;c=c.userData>>4&1?"pressed":"released";
if(1==f&&1==g){switch(a){case 0:var h=c;break;case 1:var k=c;break;case 2:var l=c;break;case 3:var p=c}if(e)switch(b){case 0:h=c;break;case 1:k=c;break;case 2:l=c;break;case 3:p=c}}else if(1==f&&0==g)switch(a){case 0:p=l=k=h=c}h&&(d.buttonAI=h);k&&(d.buttonAO=k);l&&(d.buttonBI=l);p&&(d.buttonBO=p)}return d};h.prototype.buildData=function(c,d,a,b){return c<<5|d<<4|a<<1|b};h.prototype.checkStateChange=function(c){var d=this._states,a=[],b=(new Date).getTime(),e;for(e in c){var f={};f.key=e;f.value=
c[e];f.changed=!1;var g=d[e]?d[e].value:null,h=d[e]?d[e].time:null,k=c[e];g!=k&&(f.oldvalue=g,f.changed=!0);this._states[e]={value:c[e],time:b};f.changed&&("pressed"==k||"released"==k&&"pressed"==g)&&a.push(f);"pressed"==g&&"released"==k&&(!h||b-h<this._longPressThreshold?(f={},f.key=e,f.value="shortPress"):(f={},f.key=e,f.value="longPress"),f.changed=!0,a.push(f))}return a};h.prototype.executeCommand=function(c,d,a){if(this._senderID)if(d&&d.value){var b=this,e=100,r=d.value.substr(d.value.length-
2),f={},g=0;switch(r){case "AI":g=0;break;case "AO":g=1;break;case "BI":g=2;break;case "BO":g=3}switch(d.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":e=this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":var h=this.buildData(g,1,0,0);var k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(k,!0,function(d){d?a&&a(d):(f["button"+r]="pressed",b.activeStateChange(f),setTimeout(function(){h=
b.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,b._senderID,1,1,0,null);c.sendTelegram(k,!0,function(c){f["button"+r]="released";b.activeStateChange(f);a&&a(c)})},e))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":h=this.buildData(g,1,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(k,!0,function(c){f["button"+r]="pressed";b.activeStateChange(f);a&&a(c)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":h=
b.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(k,!0,function(c){f["button"+r]="released";b.activeStateChange(f);a&&a(c)});break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var l=function(c){h.call(this,c);this._data="f6-02-02"};h.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];l.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");
l.prototype=new h;l.prototype.constructor=l;var p=function(c){e.call(this,c);this._data="f6-02-03"};p.STATES=["state"];p.COMMANDS=["auto","manu","dimUp","dimDown"];p.prototype=new e;p.prototype.constructor=p;p.prototype.evalTelegram=function(c){var d={};if(246==c.rorg)switch(c.userData){case 48:d.state="auto";break;case 16:d.state="manu";break;case 112:d.state="dimUp";break;case 80:d.state="dimDown"}return d};p.prototype.executeCommand=function(c,d,a){if(this._senderID)if(d&&d.value){switch(d.value){case "auto":var b=
48;break;case "manu":b=16;break;case "dimUp":b=112;break;case "dimDown":b=80;break;default:a&&a(Error("unknow command"))}this.activeStateChange({state:d.value});d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,this._senderID,1,1,0,null);c.sendTelegram(d,!0,function(c){a&&a(c)})}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var q=function(c){h.call(this,c);this._data="f6-02-04";this._longPressThreshold=1E3};q.STATES=["buttonAI","buttonAO","buttonBI","buttonBO","energyBow"];q.prototype=
new h;q.prototype.constructor=q;q.prototype.evalTelegram=function(c){var d={};if(246==c.rorg){var a=c.userData>>3&1,b=c.userData>>2&1,e=c.userData>>1&1,f=c.userData&1;d.energyBow=c.userData>>7&1?"pressed":"released";d.buttonBI=a?"pressed":"released";d.buttonBO=b?"pressed":"released";d.buttonAI=e?"pressed":"released";d.buttonAO=f?"pressed":"released"}return d};var u=function(c){h.call(this,c);this._data="f6-03-01";this._longPressThreshold=1E3};u.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");
u.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");u.prototype=new h;u.prototype.constructor=u;u.prototype.evalTelegram=function(c){var d={};if(246==c.rorg){var a=c.userData>>5&7,b=c.userData>>
1&7,e=c.userData&1,f=c.t21,g=c.nu;c=c.userData>>4&1?"pressed":"released";if(0==f&&1==g){switch(a){case 0:var h=c;break;case 1:var k=c;break;case 2:var l=c;break;case 3:var p=c;break;case 4:var ha=c;break;case 5:var q=c;break;case 6:var n=c;break;case 7:var m=c}if(e)switch(b){case 0:h=c;break;case 1:k=c;break;case 2:l=c;break;case 3:p=c;break;case 4:ha=c;break;case 5:q=c;break;case 6:n=c;break;case 7:m=c}}else if(0==f&&0==g)switch(a){case 0:case 7:m=n=q=ha=p=l=k=h=c}h&&(d.buttonAI=h);k&&(d.buttonAO=
k);l&&(d.buttonBI=l);p&&(d.buttonBO=p);ha&&(d.buttonCI=ha);q&&(d.buttonCO=q);n&&(d.buttonDI=n);m&&(d.buttonDO=m)}return d};u.prototype.executeCommand=function(c,d,a){if(this._senderID)if(d&&d.value){var b=this,e=100,r=d.value.substr(d.value.length-2),f={},g=0;switch(r){case "AI":g=0;break;case "AO":g=1;break;case "BI":g=2;break;case "BO":g=3;break;case "CI":g=4;break;case "CO":g=5;break;case "DI":g=6;break;case "DO":g=7}switch(d.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":case "longPressCI":case "longPressCO":case "longPressDI":case "longPressDO":e=
this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":case "shortPressCI":case "shortPressCO":case "shortPressDI":case "shortPressDO":var h=this.buildData(g,1,0,0);var k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(k,!0,function(d){d?a&&a(d):(f["button"+r]="pressed",b.activeStateChange(f),setTimeout(function(){h=b.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,b._senderID,1,1,0,null);c.sendTelegram(k,
!0,function(c){f["button"+r]="released";b.activeStateChange(f);a&&a(c)})},e))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":case "pressCI":case "pressCO":case "pressDI":case "pressDO":h=this.buildData(g,1,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(k,!0,function(c){f["button"+r]="pressed";b.activeStateChange(f);a&&a(c)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":case "releaseCI":case "releaseCO":case "releaseDI":case "releaseDO":h=
b.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(k,!0,function(c){f["button"+r]="released";b.activeStateChange(f);a&&a(c)});break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var z=function(c){u.call(this,c);this._data="f6-03-02"};z.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");z.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");
z.prototype=new u;z.prototype.constructor=z;var C=function(c){e.call(this,c);this._data="f6-04-01"};C.STATES=["keycard"];C.prototype=new e;C.prototype.constructor=C;C.prototype.evalTelegram=function(c){var d={};if(246==c.rorg){var a=c.t21,b=c.nu;c=c.userData;1==a&&1==b&&112==c?d.keycard="inserted":1==a&&0==b&&0==c&&(d.keycard="takeout")}return d};var I=function(c){e.call(this,c);this._data="f6-04-02"};I.STATES=["keycard"];I.prototype=new e;I.prototype.constructor=I;I.prototype.evalTelegram=function(c){var d=
{};if(246==c.rorg){var a=c.userData>>7&1;c=c.userData>>2&1;1==a&&1==c?d.keycard="inserted":0==a&&0==c&&(d.keycard="takeout")}return d};var J=function(c){e.call(this,c);this._data="f6-05-00"};J.STATES=["wind","lowbat"];J.prototype=new e;J.prototype.constructor=J;J.prototype.evalTelegram=function(c){var d={};if(246==c.rorg)switch(c.userData){case 0:d.wind="ok";this._states.lowbat||(d.lowbat=!1);break;case 16:d.wind="alarm";this._states.lowbat||(d.lowbat=!1);break;case 48:d.lowbat=!0}return d};var A=
function(c){e.call(this,c);this._data="f6-05-01"};A.COMMANDS=["reset"];A.STATES=["water"];A.prototype=new e;A.prototype.constructor=A;A.prototype.evalTelegram=function(c){var d={};if(246==c.rorg){var a=c.nu,b=c.userData;1==c.t21&&1==a&&17==b&&(d.water="alarm")}return d};A.prototype.executeCommand=function(c,d,a){if(d&&d.value)switch(d.value){case "reset":this.activeStateChange({water:"ok"});a&&a();break;default:a&&a(Error("no such command"))}else a&&a(Error("command invalid"))};var w=function(c){e.call(this,
c);this._data="f6-05-02"};w.STATES=["smoke","lowbat"];w.prototype=new e;w.prototype.constructor=w;w.prototype.evalTelegram=function(c){var d={};if(246==c.rorg)switch(c.userData){case 0:d.smoke="ok";this._states.lowbat||(d.lowbat=!1);break;case 16:d.smoke="alarm";this._states.lowbat||(d.lowbat=!1);break;case 48:d.lowbat=!0}return d};var O=function(c){e.call(this,c);this._data="f6-10-00"};O.STATES=["window","handle_pos","handle_raw"];O.prototype=new e;O.prototype.constructor=O;O.prototype.evalTelegram=
function(c){var d={};246==c.rorg&&(c=c.userData,0==(c&208^192)?(d.window="open",d.handle_pos="middle"):0==(c&240^240)?(d.window="closed",d.handle_pos="down"):0==(c&240^208)&&(d.window="tilted",d.handle_pos="up"),d.handle_raw=c);return d};var U=function(c){e.call(this,c);this._data="f6-10-01"};U.STATES=["window","handle_pos","handle_raw"];U.prototype=new e;U.prototype.constructor=U;U.prototype.evalTelegram=function(c){var d={};246==c.rorg&&(c=c.userData&15,0==(c&13^12)?(d.window="open",d.handle_pos=
"middle"):0==(c&15^15)?(d.window="closed",d.handle_pos="down"):0==(c&15^13)&&(d.window="tilted",d.handle_pos="up"),d.handle_raw=c);return d};var X=function(c){g.call(this,c);this._data="d5-??-??"};X.prototype=new g;X.prototype.constructor=X;var N=function(c){X.call(this,c);this._data="d5-00-01"};N.STATES=["contact","contact_raw"];N.prototype=new X;N.prototype.constructor=N;N.prototype.evalTelegram=function(c){var d={};213==c.rorg&&(c=c.userData,1==(c>>3&1)&&(c&=1,d.contact=c?"closed":"open",d.contact_raw=
c));return d};var t=function(c){g.call(this,c);this._data="a5-??-??";this.TEACH_IN_VARIATION=2;this.UNIQUE_GATEWAY_SENDERID=!0};t.prototype=new g;t.prototype.constructor=t;t.prototype.getTeachinType=function(){return"4BS"};t.prototype.isTeachinBidirectional=function(){return!1};var n=function(c){t.call(this,c);this._data="a5-02-??";this._tmpMin=-40;this._tmpMax=0};n.STATES=["temperature","temperature_raw"];n.prototype=new t;n.prototype.constructor=n;n.prototype.evalTelegram=function(c){var d={};if(165==
c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(2);1==(a>>3&1)&&(d.temperature=parseFloat(((255-c)/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),d.temperature_raw=c)}return d};var Y=function(c){n.call(this,c);this._data="a5-02-01";this._tmpMin=-40;this._tmpMax=0};Y.STATES=["temperature","temperature_raw"];Y.prototype=new n;Y.prototype.constructor=Y;var K=function(c){n.call(this,c);this._data="a5-02-02";this._tmpMin=-30;this._tmpMax=10};K.STATES=["temperature","temperature_raw"];
K.prototype=new n;K.prototype.constructor=K;var oa=function(c){n.call(this,c);this._data="a5-02-03";this._tmpMin=-20;this._tmpMax=20};oa.STATES=["temperature","temperature_raw"];oa.prototype=new n;oa.prototype.constructor=oa;var M=function(c){n.call(this,c);this._data="a5-02-04";this._tmpMin=-10;this._tmpMax=30};M.STATES=["temperature","temperature_raw"];M.prototype=new n;M.prototype.constructor=M;var P=function(c){n.call(this,c);this._data="a5-02-05";this._tmpMin=0;this._tmpMax=40};P.STATES=["temperature",
"temperature_raw"];P.prototype=new n;P.prototype.constructor=P;var ca=function(c){n.call(this,c);this._data="a5-02-06";this._tmpMin=10;this._tmpMax=50};ca.STATES=["temperature","temperature_raw"];ca.prototype=new n;ca.prototype.constructor=ca;var Z=function(c){n.call(this,c);this._data="a5-02-07";this._tmpMin=20;this._tmpMax=60};Z.STATES=["temperature","temperature_raw"];Z.prototype=new n;Z.prototype.constructor=Z;var aa=function(c){n.call(this,c);this._data="a5-02-08";this._tmpMin=30;this._tmpMax=
70};aa.STATES=["temperature","temperature_raw"];aa.prototype=new n;aa.prototype.constructor=aa;var Qa=function(c){n.call(this,c);this._data="a5-02-09";this._tmpMin=40;this._tmpMax=80};Qa.STATES=["temperature","temperature_raw"];Qa.prototype=new n;Qa.prototype.constructor=Qa;var v=function(c){n.call(this,c);this._data="a5-02-0a";this._tmpMin=50;this._tmpMax=90};v.STATES=["temperature","temperature_raw"];v.prototype=new n;v.prototype.constructor=v;var m=function(c){n.call(this,c);this._data="a5-02-0b";
this._tmpMin=60;this._tmpMax=100};m.STATES=["temperature","temperature_raw"];m.prototype=new n;m.prototype.constructor=m;var Oa=function(c){n.call(this,c);this._data="a5-02-10";this._tmpMin=-60;this._tmpMax=20};Oa.STATES=["temperature","temperature_raw"];Oa.prototype=new n;Oa.prototype.constructor=Oa;var dc=function(c){n.call(this,c);this._data="a5-02-11";this._tmpMin=-50;this._tmpMax=30};dc.STATES=["temperature","temperature_raw"];dc.prototype=new n;dc.prototype.constructor=dc;var Pa=function(c){n.call(this,
c);this._data="a5-02-12";this._tmpMin=-40;this._tmpMax=40};Pa.STATES=["temperature","temperature_raw"];Pa.prototype=new n;Pa.prototype.constructor=Pa;var ec=function(c){n.call(this,c);this._data="a5-02-13";this._tmpMin=-30;this._tmpMax=50};ec.STATES=["temperature","temperature_raw"];ec.prototype=new n;ec.prototype.constructor=ec;var fc=function(c){n.call(this,c);this._data="a5-02-14";this._tmpMin=-20;this._tmpMax=60};fc.STATES=["temperature","temperature_raw"];fc.prototype=new n;fc.prototype.constructor=
fc;var Ga=function(c){n.call(this,c);this._data="a5-02-15";this._tmpMin=-10;this._tmpMax=70};Ga.STATES=["temperature","temperature_raw"];Ga.prototype=new n;Ga.prototype.constructor=Ga;var gc=function(c){n.call(this,c);this._data="a5-02-16";this._tmpMin=0;this._tmpMax=80};gc.STATES=["temperature","temperature_raw"];gc.prototype=new n;gc.prototype.constructor=gc;var db=function(c){n.call(this,c);this._data="a5-02-17";this._tmpMin=10;this._tmpMax=90};db.STATES=["temperature","temperature_raw"];db.prototype=
new n;db.prototype.constructor=db;var hc=function(c){n.call(this,c);this._data="a5-02-18";this._tmpMin=20;this._tmpMax=100};hc.STATES=["temperature","temperature_raw"];hc.prototype=new n;hc.prototype.constructor=hc;var ic=function(c){n.call(this,c);this._data="a5-02-19";this._tmpMin=30;this._tmpMax=110};ic.STATES=["temperature","temperature_raw"];ic.prototype=new n;ic.prototype.constructor=ic;var jc=function(c){n.call(this,c);this._data="a5-02-1a";this._tmpMin=40;this._tmpMax=120};jc.STATES=["temperature",
"temperature_raw"];jc.prototype=new n;jc.prototype.constructor=jc;var kc=function(c){n.call(this,c);this._data="a5-02-1b";this._tmpMin=50;this._tmpMax=130};kc.STATES=["temperature","temperature_raw"];kc.prototype=new n;kc.prototype.constructor=kc;var Fa=function(c){t.call(this,c);this._data="a5-02-20";this._tmpMin=-10;this._tmpMax=41.2};Fa.STATES=["temperature","temperature_raw"];Fa.prototype=new t;Fa.prototype.constructor=Fa;Fa.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);
c=c.userData.readUInt16BE(1);1==(a>>3&1)&&(a=c&1023,d.temperature=parseFloat(((1023-a)/1023*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),d.temperature_raw=a)}return d};var lc=function(c){Fa.call(this,c);this._data="a5-02-30";this._tmpMin=-40;this._tmpMax=62.3};lc.STATES=["temperature","temperature_raw"];lc.prototype=new Fa;lc.prototype.constructor=lc;var ia=function(c){t.call(this,c);this._data="a5-04-??";this._humMin=0;this._humMax=100;this._tempMin=0;this._tempMax=40};ia.STATES=["humidity",
"humidity_raw","temperature","temperature_raw","available"];ia.prototype=new t;ia.prototype.constructor=ia;ia.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt8(1);1==(a>>3&1)&&(d.humidity=parseFloat((c/250*(this._humMax-this._humMin)+this._humMin).toFixed(1)),d.humidity_raw=c,d.temperature=parseFloat((b/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),d.temperature_raw=b,d.available=a>>1&1?!0:!1)}return d};
var mc=function(c){ia.call(this,c);this._data="a5-04-01"};mc.STATES=ia.STATES;mc.prototype=new ia;mc.prototype.constructor=mc;var Ra=function(c){ia.call(this,c);this._data="a5-04-02";this._tempMin=-20;this._tempMax=60};Ra.STATES=ia.STATES;Ra.prototype=new ia;Ra.prototype.constructor=Ra;var eb=function(c){ia.call(this,c);this._data="a5-04-03";this._tempMin=-20;this._tempMax=60};eb.STATES=["humidity","humidity_raw","temperature","temperature_raw","type"];eb.prototype=new ia;eb.prototype.constructor=
eb;eb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(d.humidity=parseFloat((c/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),d.humidity_raw=c,b&=1023,d.temperature=parseFloat((b/1023*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),d.temperature_raw=b,d.type=a&1?"event":"heartbeat")}return d};var L=function(c){t.call(this,c);this._data="a5-06-??";this._svcMin=0;this._svcMax=
5.1;this._ill2Min=300;this._ill2Max=3E4;this._ill1Min=600;this._ill1Max=6E4};L.STATES="voltage voltage_raw illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw range range_raw".split(" ");L.prototype=new t;L.prototype.constructor=L;L.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=parseFloat((c/255*(this._svcMax-
this._svcMin)+this._svcMin).toFixed(1));d.voltage_raw=c;d.illumination2=parseFloat((e/255*(this._ill2Max-this._ill2Min)+this._ill2Min).toFixed(1));d.illumination2_raw=e;d.illumination1=parseFloat((b/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1));d.illumination1_raw=b;a&=1;switch(a){case 0:d.range="db1";d.illumination=d.illumination1;d.illumination_raw=b;break;case 1:d.range="db2",d.illumination=d.illumination2,d.illumination_raw=b}d.range_raw=a}}return d};var Sa=function(c){L.call(this,
c);this._data="a5-06-01"};Sa.STATES=L.STATES;Sa.prototype=new L;Sa.prototype.constructor=Sa;var Ha=function(c){L.call(this,c);this._data="a5-06-02";this._ill2Min=0;this._ill2Max=510;this._ill1Min=0;this._ill1Max=1020};Ha.STATES=L.STATES;Ha.prototype=new L;Ha.prototype.constructor=Ha;var fb=function(c){L.call(this,c);this._data="a5-06-03";this._svcMin=0;this._svcMax=5.1};fb.STATES=["voltage","voltage_raw","illumination","illumination_raw"];fb.prototype=new L;fb.prototype.constructor=fb;fb.prototype.evalTelegram=
function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(d.voltage=parseFloat((c/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),d.voltage_raw=c,a=b>>6&1023,d.illumination=a,d.illumination_raw=a)}return d};var gb=function(c){L.call(this,c);this._data="a5-06-04";this._tmpMin=-20;this._tmpMax=60};gb.STATES="temperature temperature_raw illumination illumination_raw energy energy_raw temperature_avail energy_avail".split(" ");
gb.prototype=new L;gb.prototype.constructor=gb;gb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(d.temperature=parseFloat((c/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),d.temperature_raw=c,d.illumination=b,d.illumination_raw=b,b=a>>4&15,d.energy=parseFloat((b/15*100).toFixed(1)),d.energy_raw=b,d.temperature_avail=a>>1&1?!0:!1,d.temperature_avail||delete d.temperature,d.energy_avail=
a&1?!0:!1,d.energy_avail||delete d.energy)}return d};var nc=function(c){L.call(this,c);this._data="a5-06-05";this._ill2Min=0;this._ill2Max=5100;this._ill1Min=0;this._ill1Max=10200};nc.STATES=L.STATES;nc.prototype=new L;nc.prototype.constructor=nc;var V=function(c){t.call(this,c);this._data="a5-07-??";this._params||(this._params={reset_timeout:30});this._resetTO=null};V.COMMANDS=["reset"];V.prototype=new t;V.prototype.constructor=V;V.prototype._startPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),
this._resetTO=null);if(this._params.reset_timeout&&!(0>this._params.reset_timeout)){var c=this;this._resetTO=setTimeout(function(){c._resetTO=null;c._reset()},1E3*this._params.reset_timeout)}};V.prototype._stopPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null)};V.prototype._reset=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null);var c={key:"state",value:"off",changed:!1},d=this._states.state?this._states.state.value:null;"off"!=d&&(c.oldvalue=
d,c.changed=!0);this._states.state={value:"off",time:(new Date).getTime()};require("x.hub.m.enocean.js")._onEOEvents(this,[c])};V.prototype.executeCommand=function(c,d,a){if(d&&d.value)switch(d.value){case "reset":this._reset();a&&a();break;default:a&&a(Error("no such command"))}else a&&a(Error("command invalid"))};V.prototype.fromJSON=function(c){if(!g.prototype.fromJSON.call(this,c))return null;this._params||(this._params={reset_timeout:30});return this};V.prototype.fromDBJSON=function(c){if(!g.prototype.fromDBJSON.call(this,
c))return null;this._params||(this._params={reset_timeout:30});return this};var da=function(c){V.call(this,c);this._data="a5-07-01"};da.COMMANDS=["reset"];da.STATES=["voltage","voltage_raw","state","state_raw","voltage_avail"];da.prototype=new V;da.prototype.constructor=da;da.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt8(0);1==(a>>3&1)&&(d.voltage=parseFloat((c/250*5).toFixed(1)),d.voltage_raw=c,d.state=128<=
b?"on":"off",d.state_raw=b,d.voltage_avail=a&1?!0:!1,d.voltage_avail||delete d.voltage)}"on"==d.state?this._startPIROffTO():"off"==d.state&&this._stopPIROffTO();return d};var Ta=function(c){V.call(this,c);this._data="a5-07-02"};Ta.COMMANDS=["reset"];Ta.STATES=["voltage","voltage_raw","state","state_raw"];Ta.prototype=new V;Ta.prototype.constructor=Ta;Ta.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);1==(a>>3&1)&&(d.voltage=parseFloat((c/
250*5).toFixed(1)),d.voltage_raw=c,a=a>>7&1,d.state=a?"on":"off",d.state_raw=a)}"on"==d.state?this._startPIROffTO():"off"==d.state&&this._stopPIROffTO();return d};var Ua=function(c){V.call(this,c);this._data="a5-07-03"};Ua.COMMANDS=["reset"];Ua.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");Ua.prototype=new V;Ua.prototype.constructor=Ua;Ua.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=
c.userData.readUInt8(0);1==(a>>3&1)&&(d.voltage=parseFloat((c/250*5).toFixed(1)),d.voltage_raw=c,b=b>>6&1023,d.illumination=b,d.illumination_raw=b,a=a>>7&1,d.state=a?"on":"off",d.state_raw=a)}"on"==d.state?this._startPIROffTO():"off"==d.state&&this._stopPIROffTO();return d};var ya=function(c){t.call(this,c);this._data="a5-08-??";this._svcMin=0;this._svcMax=5.1;this._illMin=0;this._illMax=510;this._tmpMin=0;this._tmpMax=51};ya.prototype=new t;ya.prototype.constructor=ya;ya.prototype.evalTelegram=function(c){var d=
{};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=parseFloat((c/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));d.voltage_raw=c;d.illumination=parseFloat((e/255*(this._illMax-this._illMin)+this._illMin).toFixed(1));d.illumination_raw=e;d.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1));d.temperature_raw=b;b=a>>1&1;switch(b){case 0:d.state="on";break;case 1:d.state=
"off"}d.state_raw=b;a&=1;switch(a){case 0:d.button="pressed";break;case 1:d.button="released"}d.button_raw=a}}return d};var Va=function(c){ya.call(this,c);this._data="a5-08-01"};Va.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");Va.prototype=new ya;Va.prototype.constructor=Va;var oc=function(c){ya.call(this,c);this._data="a5-08-02";this._illMax=1020};oc.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");
oc.prototype=new ya;oc.prototype.constructor=oc;var pc=function(c){ya.call(this,c);this._data="a5-08-03";this._illMax=1530;this._tmpMin=-30;this._tmpMax=50};pc.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");pc.prototype=new ya;pc.prototype.constructor=pc;var D=function(c){t.call(this,c);this._data="a5-09-??"};D.prototype=new t;D.prototype.constructor=D;var hb=function(c){D.call(this,c);this._data="a5-09-02";this._svcMin=
0;this._svcMax=5.1;this._gasMin=0;this._gasMax=1020;this._tmpMin=0;this._tmpMax=51};hb.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available".split(" ");hb.prototype=new D;hb.prototype.constructor=hb;hb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(d.voltage=parseFloat((c/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),
d.voltage_raw=c,d.gas=parseFloat((e/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),d.gas_raw=e,d.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),d.temperature_raw=b,a=a>>1&1,d.temperature_available=a?!0:!1,a||delete d.temperature)}return d};var ib=function(c){D.call(this,c);this._data="a5-09-04";this._humMin=0;this._humMax=100;this._gasMin=0;this._gasMax=2550;this._tmpMin=0;this._tmpMax=51};ib.STATES="humidity humidity_raw gas gas_raw temperature temperature_raw temperature_available humidity_available".split(" ");
ib.prototype=new D;ib.prototype.constructor=ib;ib.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(d.humidity=parseFloat((c/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),d.humidity_raw=c,d.gas=parseFloat((e/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),d.gas_raw=e,d.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),
d.temperature_raw=b,b=a>>2&1,d.humidity_available=b?!0:!1,b||delete d.humidity,a=a>>1&1,d.temperature_available=a?!0:!1,a||delete d.temperature)}return d};var jb=function(c){D.call(this,c);this._data="a5-09-05"};jb.STATES=["voc","voc_raw","voc_id","voc_id_raw","scale"];jb.prototype=new D;jb.prototype.constructor=jb;jb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt16BE(0);if(1==(a>>3&1)){a&=3;var e=1;switch(a){case 0:e=
.01;break;case 1:e=.1;break;case 2:e=1;break;case 3:e=10}d.scale=e;d.voc=c*e;d.voc_raw=c;switch(a){case 0:d.voc_id="VOCT";break;case 1:d.voc_id="Formaldehyde";break;case 2:d.voc_id="Benzene";break;case 3:d.voc_id="Styrene";break;case 4:d.voc_id="Toluene";break;case 5:d.voc_id="Tetrachloroethylene";break;case 6:d.voc_id="Xylene";break;case 7:d.voc_id="n-Hexane";break;case 8:d.voc_id="n-Octane";break;case 9:d.voc_id="Cyclopentane";break;case 10:d.voc_id="Methanol";break;case 11:d.voc_id="Ethanol";break;
case 12:d.voc_id="1-Pentanol";break;case 13:d.voc_id="Acetone";break;case 14:d.voc_id="ethylene Oxide";break;case 15:d.voc_id="Acetaldehyde ue";break;case 16:d.voc_id="Acetic Acid";break;case 17:d.voc_id="Propionice Acid";break;case 18:d.voc_id="Valeric Acid";break;case 19:d.voc_id="Butyric Acid";break;case 20:d.voc_id="Ammoniac";break;case 22:d.voc_id="Hydrogen Sulfide";break;case 23:d.voc_id="Dimethylsulfide";break;case 24:d.voc_id="2-Butanol";break;case 25:d.voc_id="2-Methylpropanol";break;case 26:d.voc_id=
"Diethyl ether";break;case 255:d.voc_id="ozone"}d.voc_id_raw=b}}return d};var kb=function(c){D.call(this,c);this._data="a5-09-06"};kb.STATES=["radon"];kb.prototype=new D;kb.prototype.constructor=kb;kb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt16BE(0);1==(a>>3&1)&&(d.radon=c>>6&1023)}return d};var lb=function(c){D.call(this,c);this._data="a5-09-07"};lb.STATES="pm10 pm25 pm1 pm10_active pm25_active pm25_active".split(" ");lb.prototype=
new D;lb.prototype.constructor=lb;lb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(2),e=c.userData.readUInt16BE(1);c=c.userData.readUInt16BE(0);1==(a>>3&1)&&(d.pm10=c>>7&511,d.pm25=e>>6&511,d.pm1=b>>5&511,b=a>>2&1,d.pm10_active=b?!0:!1,b||delete d.pm10,b=a>>1&1,d.pm25_active=b?!0:!1,b||delete d.pm25,a&=1,d.pm1_active=a?!0:!1,a||delete d.pm1)}return d};var mb=function(c){D.call(this,c);this._data="a5-09-08"};mb.STATES=["co2","co2_raw"];
mb.prototype=new D;mb.prototype.constructor=mb;mb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(2);1==(a>>3&1)&&(d.co2=parseFloat((c/255*2E3).toFixed(1)),d.co2_raw=c)}return d};var nb=function(c){D.call(this,c);this._data="a5-09-09"};nb.STATES=["co2","co2_raw","power_failure_detected"];nb.prototype=new D;nb.prototype.constructor=nb;nb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(2);
1==(a>>3&1)&&(d.co2=parseFloat((c/255*2E3).toFixed(1)),d.co2_raw=c,d.power_failure_detected=a>>2&1?!0:!1)}return d};var ob=function(c){D.call(this,c);this._data="a5-09-0a";this._svcMin=2;this._svcMax=5;this._tmpMin=-20;this._tmpMax=60};ob.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available voltage_available".split(" ");ob.prototype=new D;ob.prototype.constructor=ob;ob.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=
c.userData.readUInt8(2);c=c.userData.readUInt16BE(0);1==(a>>3&1)&&(d.gas=c,d.gas_raw=c,d.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),d.temperature_raw=b,b=a>>4&15,d.voltage=parseFloat((b/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),d.voltage_raw=b,b=a>>1&1,d.temperature_available=b?!0:!1,b||delete d.temperature,a&=1,d.voltage_available=a?!0:!1,a||delete d.voltage)}return d};var pb=function(c){D.call(this,c);this._data="a5-09-0b";this._svcMin=2;this._svcMax=
5};pb.STATES="voltage voltage_raw radio radio_raw scale unit unit_raw voltage_available".split(" ");pb.prototype=new D;pb.prototype.constructor=pb;pb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(2);c=c.userData.readUInt8(0);if(1==(a>>3&1)){c=c>>4&15;d.voltage=parseFloat((c/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));d.voltage_raw=c;c=1;switch(a>>4&15){case 0:c=.001;break;case 1:c=.01;break;case 2:c=.1;break;case 3:c=
1;break;case 4:c=10;break;case 5:c=100;break;case 6:c=1E3;break;case 7:c=1E4;break;case 8:c=1E5}d.scale=c;d.radio=b/10*c;d.radio_raw=b;b=a>>1&3;switch(b){case 0:d.unit="\u03bcSv/h";break;case 1:d.unit="cpm";break;case 2:d.unit="Bq/L";break;case 3:d.unit="Bq/kg"}d.unit_raw=b;a&=1;d.voltage_available=a?!0:!1;a||delete d.voltage}}return d};var qb=function(c){D.call(this,c);this._data="a5-09-0c"};qb.STATES="voc voc_raw voc_id voc_id_raw unit unit_raw scale".split(" ");qb.prototype=new D;qb.prototype.constructor=
qb;qb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt16BE(0);if(1==(a>>3&1)){var e=a&3,f=1;switch(e){case 0:f=.01;break;case 1:f=.1;break;case 2:f=1;break;case 3:f=10}d.scale=f;a=a>>1&1;switch(a){case 0:d.unit="ppb";break;case 1:d.unit="\u03bcSv/m3"}d.unit_raw=a;d.voc=c*f;d.voc_raw=c;switch(e){case 0:d.voc_id="VOCT";break;case 1:d.voc_id="Formaldehyde";break;case 2:d.voc_id="Benzene";break;case 3:d.voc_id="Styrene";
break;case 4:d.voc_id="Toluene";break;case 5:d.voc_id="Tetrachloroethylene";break;case 6:d.voc_id="Xylene";break;case 7:d.voc_id="n-Hexane";break;case 8:d.voc_id="n-Octane";break;case 9:d.voc_id="Cyclopentane";break;case 10:d.voc_id="Methanol";break;case 11:d.voc_id="Ethanol";break;case 12:d.voc_id="1-Pentanol";break;case 13:d.voc_id="Acetone";break;case 14:d.voc_id="ethylene Oxide";break;case 15:d.voc_id="Acetaldehyde ue";break;case 16:d.voc_id="Acetic Acid";break;case 17:d.voc_id="Propionice Acid";
break;case 18:d.voc_id="Valeric Acid";break;case 19:d.voc_id="Butyric Acid";break;case 20:d.voc_id="Ammoniac";break;case 22:d.voc_id="Hydrogen Sulfide";break;case 23:d.voc_id="Dimethylsulfide";break;case 24:d.voc_id="2-Butanol";break;case 25:d.voc_id="2-Methylpropanol";break;case 26:d.voc_id="Diethyl ether";break;case 27:d.voc_id="Naphthalene";break;case 28:d.voc_id="4-Phenylcyclohexene";break;case 29:d.voc_id="Limonene";break;case 30:d.voc_id="Trichloroethylene";break;case 31:d.voc_id="Isovaleric acid";
break;case 32:d.voc_id="Indole";break;case 33:d.voc_id="Cadaverine";break;case 34:d.voc_id="Putrescine";break;case 35:d.voc_id="Caproic acid";break;case 255:d.voc_id="ozone"}d.voc_id_raw=b}}return d};var Wa=function(c){t.call(this,c);this._data="a5-10-??"};Wa.prototype=new t;Wa.prototype.constructor=Wa;var B=function(c){Wa.call(this,c);this._data="a5-10-01";this._params||(this._params={minSP:18,maxSP:26})};B.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");
B.prototype=new Wa;B.prototype.constructor=B;B.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){d.fan_speed=144>=c?"3":164>=c?"2":189>=c?"1":209>=c?"0":"auto";d.fan_speed_raw=c;d.setpoint=parseFloat((e/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));d.setpoint_raw=e;d.temperature=parseFloat(((255-b)/255*40).toFixed(1));d.temperature_raw=
b;a&=1;switch(a){case 0:d.button="pressed";break;case 1:d.button="released"}d.button_raw=a}}return d};B.prototype.fromJSON=function(c){if(!g.prototype.fromJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};B.prototype.fromDBJSON=function(c){if(!g.prototype.fromDBJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var la=function(c){B.call(this,c);this._data="a5-10-02"};la.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
la.prototype=new B;la.prototype.constructor=la;la.prototype.evalTelegram=function(c){var d=B.prototype.evalTelegram.call(this,c);if(0==Object.keys(d).length)return d;delete d.button;delete d.button_raw;c=c.userData.readUInt8(3)&1;d.slider=c?"day":"night";d.slider_raw=c;return d};var Ia=function(c){B.call(this,c);this._data="a5-10-03";this.TEACH_IN_VARIATION=1};Ia.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];Ia.prototype=new B;Ia.prototype.constructor=Ia;Ia.prototype.evalTelegram=
function(c){c=B.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;delete c.button;delete c.button_raw;return c};var rb=function(c){B.call(this,c);this._data="a5-10-04"};rb.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw".split(" ");rb.prototype=new B;rb.prototype.constructor=rb;rb.prototype.evalTelegram=function(c){c=B.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.button;
delete c.button_raw;return c};var sb=function(c){B.call(this,c);this._data="a5-10-05"};sb.STATES="setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");sb.prototype=new B;sb.prototype.constructor=sb;sb.prototype.evalTelegram=function(c){c=B.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var Ba=function(c){la.call(this,c);this._data="a5-10-06"};Ba.STATES="setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
Ba.prototype=new la;Ba.prototype.constructor=Ba;Ba.prototype.evalTelegram=function(c){c=la.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var tb=function(c){B.call(this,c);this._data="a5-10-07"};tb.STATES=["fan_speed","fan_speed_raw","temperature","temperature_raw"];tb.prototype=new B;tb.prototype.constructor=tb;tb.prototype.evalTelegram=function(c){c=B.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;
delete c.setpoint;delete c.setpoint_raw;delete c.button;delete c.button_raw;return c};var pa=function(c){B.call(this,c);this._data="a5-10-08";this._params=null};pa.STATES="fan_speed fan_speed_raw temperature temperature_raw button button_raw".split(" ");pa.prototype=new B;pa.prototype.constructor=pa;pa.prototype.evalTelegram=function(c){c=B.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};pa.prototype.fromJSON=function(c){return g.prototype.fromJSON.call(this,
c)};pa.prototype.fromDBJSON=function(c){return g.prototype.fromDBJSON.call(this,c)};var qa=function(c){la.call(this,c);this._data="a5-10-09";this._params=null};qa.STATES="fan_speed fan_speed_raw temperature temperature_raw slider slider_raw".split(" ");qa.prototype=new la;qa.prototype.constructor=qa;qa.prototype.evalTelegram=function(c){c=la.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};qa.prototype.fromJSON=function(c){return g.prototype.fromJSON.call(this,
c)};qa.prototype.fromDBJSON=function(c){return g.prototype.fromDBJSON.call(this,c)};var Ca=function(c){B.call(this,c);this._data="a5-10-0a"};Ca.STATES="setpoint setpoint_raw temperature temperature_raw contact contact_raw".split(" ");Ca.prototype=new B;Ca.prototype.constructor=Ca;Ca.prototype.evalTelegram=function(c){var d=B.prototype.evalTelegram.call(this,c);if(0==Object.keys(d).length)return d;delete d.fan_speed;delete d.fan_speed_raw;delete d.button;delete d.button_raw;c=c.userData.readUInt8(3)&
1;d.contact=c?"open":"closed";d.contact_raw=c;return d};var Ja=function(c){Ca.call(this,c);this._data="a5-10-0b";this._params=null};Ja.STATES=["temperature","temperature_raw","contact","contact_raw"];Ja.prototype=new Ca;Ja.prototype.constructor=Ja;Ja.prototype.evalTelegram=function(c){c=Ca.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};Ja.prototype.fromJSON=function(c){return g.prototype.fromJSON.call(this,c)};Ja.prototype.fromDBJSON=
function(c){return g.prototype.fromDBJSON.call(this,c)};var ub=function(c){pa.call(this,c);this._data="a5-10-0c"};ub.STATES=["temperature","temperature_raw","button","button_raw"];ub.prototype=new pa;ub.prototype.constructor=ub;ub.prototype.evalTelegram=function(c){c=pa.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var vb=function(c){qa.call(this,c);this._data="a5-10-0d"};vb.STATES=["temperature","temperature_raw","slider",
"slider_raw"];vb.prototype=new qa;vb.prototype.constructor=vb;vb.prototype.evalTelegram=function(c){c=qa.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var Q=function(c){Wa.call(this,c);this._data="a5-10-10";this._params||(this._params={minSP:18,maxSP:26})};Q.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw button button_raw".split(" ");Q.prototype=new Wa;Q.prototype.constructor=Q;Q.prototype.evalTelegram=
function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){d.setpoint=parseFloat((c/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));d.setpoint_raw=c;d.humidity=parseFloat((e/250*100).toFixed(1));d.humidity_raw=e;d.temperature=parseFloat((b/250*40).toFixed(1));d.temperature_raw=b;a&=1;switch(a){case 0:d.button="pressed";break;case 1:d.button="released"}d.button_raw=a}}return d};
Q.prototype.fromJSON=function(c){if(!g.prototype.fromJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};Q.prototype.fromDBJSON=function(c){if(!g.prototype.fromDBJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var Da=function(c){Q.call(this,c);this._data="a5-10-11"};Da.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");Da.prototype=new Q;Da.prototype.constructor=
Da;Da.prototype.evalTelegram=function(c){var d=Q.prototype.evalTelegram.call(this,c);if(0==Object.keys(d).length)return d;delete d.button;delete d.button_raw;c=c.userData.readUInt8(3)&1;d.slider=c?"day":"night";d.slider_raw=c;return d};var wb=function(c){Q.call(this,c);this._data="a5-10-12"};wb.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw".split(" ");wb.prototype=new Q;wb.prototype.constructor=wb;wb.prototype.evalTelegram=function(c){c=Q.prototype.evalTelegram.call(this,
c);if(0==Object.keys(c).length)return c;delete c.button;delete c.button_raw;return c};var xb=function(c){Q.call(this,c);this._data="a5-10-13"};xb.STATES="humidity humidity_raw temperature temperature_raw button button_raw".split(" ");xb.prototype=new Q;xb.prototype.constructor=xb;xb.prototype.evalTelegram=function(c){c=Q.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};var yb=function(c){Da.call(this,c);this._data="a5-10-14"};
yb.STATES="humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");yb.prototype=new Da;yb.prototype.constructor=yb;yb.prototype.evalTelegram=function(c){c=Da.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};var Xa=function(c){t.call(this,c);this._data="a5-11-??"};Xa.prototype=new t;Xa.prototype.constructor=Xa;var zb=function(c){Xa.call(this,c);this._data="a5-11-03"};zb.STATES="position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw".split(" ");
zb.prototype=new Xa;zb.prototype.constructor=zb;zb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){d.position=c;c=e&127;d.angle=2*(e>>7&1?0-c:c);e=b>>7&1;d.position_flag=e?!0:!1;d.position_flag_raw=e;e=b>>6&1;d.angle_flag=e?!0:!1;d.angle_flag_raw=e;e=b>>4&3;d.error_raw=e;switch(e){case 0:d.error="no_error";break;case 1:d.error="no_end_position";break;case 2:d.error=
"intern_failure"}e=b>>2&3;d.end_position_raw=e;switch(e){case 0:d.end_position="no_end_position";break;case 1:d.end_position="end_position_not_reach";break;case 2:d.end_position="fully_open";break;case 3:d.end_position="fully_closed"}b&=3;d.state_raw=b;switch(b){case 0:d.state="no_status";break;case 1:d.state="stopped";break;case 2:d.state="opens";break;case 3:d.state="closes"}d.service_mode=a>>7&1;d.position_mode=a>>6&1}}return d};var Ya=function(c){Xa.call(this,c);this._data="a5-11-04"};Ya.STATES=
"state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");Ya.prototype=new Xa;Ya.prototype.constructor=Ya;Ya.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){d.service_mode=a>>7&1;var f=a>>6&1;d.op_hour_flag=
f?!0:!1;d.op_hour_flag_raw=f;f=a>>4&3;d.error_raw=f;switch(f){case 0:d.error="no_error";break;case 1:d.error="lamp_failure";break;case 2:d.error="intern_failure";break;case 3:d.error="extern_failure"}f=a&1;d.state=f?"on":"off";d.state_raw=f;a=a>>1&3;d.mode_raw=a;switch(a){case 0:d.level=c;d.op_hour=e<<8|b;break;case 1:a=c.toString(16);2>a.length&&(a="0"+a);e=e.toString(16);2>e.length&&(e="0"+e);b=b.toString(16);2>b.length&&(b="0"+b);d.rgb=a.toUpperCase()+e.toUpperCase()+b.toUpperCase();break;case 2:d.power_raw=
c<<8|e,d.power_unit_raw=b,e="mW W kW MW Wh kWh MWh GWh mA 1/10A mV 1/10V".split(" "),3>=b?(d.power=d.power_raw,d.power_unit=e[b]):7>=b?(d.energy=d.power_raw,d.energy_unit=e[b]):9>=b?(d.current=d.power_raw,d.current_unit=e[b]):11>=b&&(d.voltage=d.power_raw,d.voltage_unit=e[b])}}}return d};var ea=function(c){t.call(this,c);this._data="a5-12-??"};ea.STATES="meter_raw channel_raw type_raw scale_raw scale meter current cumulative".split(" ");ea.prototype=new t;ea.prototype.constructor=ea;ea.prototype.evalTelegram=
function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt32BE(0);if(1==(a>>3&1)){c=c>>8&16777215;d.meter_raw=c;d.channel_raw=a>>4&15;var b=a>>2&1;d.type_raw=b;a&=3;d.scale_raw=a;switch(a){case 0:d.scale=1;d.meter=c;break;case 1:d.scale=.1;d.meter=.1*c;break;case 2:d.scale=.01;d.meter=.01*c;break;case 3:d.scale=.001,d.meter=.001*c}b?d.current=d.meter:d.cumulative=d.meter}}return d};var Ab=function(c){ea.call(this,c);this._data="a5-12-00"};Ab.STATES=["current","counter",
"channel"];Ab.prototype=new ea;Ab.prototype.constructor=Ab;Ab.prototype.evalTelegram=function(c){c=ea.prototype.evalTelegram.call(this,c);c.counter=c.cumulative;c.channel=c.channel_raw;return c};var ma=function(c){ea.call(this,c);this._data="a5-12-01"};ma.STATES=["power","energy","tariff"];ma.prototype=new ea;ma.prototype.constructor=ma;ma.prototype.evalTelegram=function(c){c=ea.prototype.evalTelegram.call(this,c);c.energy=c.cumulative;c.power=c.current;c.tariff=c.channel_raw;return c};var Ka=function(c){ea.call(this,
c);this._data="a5-12-02"};Ka.STATES=["volume","flow","tariff"];Ka.prototype=new ea;Ka.prototype.constructor=Ka;Ka.prototype.evalTelegram=function(c){c=ea.prototype.evalTelegram.call(this,c);c.volume=c.cumulative;c.flow=c.current;c.tariff=c.channel_raw;return c};var qc=function(c){Ka.call(this,c);this._data="a5-12-03"};qc.STATES=["volume","flow","tariff"];qc.prototype=new Ka;qc.prototype.constructor=qc;var R=function(c){t.call(this,c);this._data="a5-13-??"};R.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
R.prototype=new t;R.prototype.constructor=R;R.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),e=c.userData.readUInt8(1),f=c.userData.readUInt8(0);if(1==(a>>3&1))switch(a>>4&15){case 1:d.lux=parseFloat((f/255*1E3).toFixed(1));d.lux_raw=f;var g=e;d.temperature=parseFloat((g/255*120-40).toFixed(1));d.temperature_raw=g;d.wind=parseFloat((b/255*70).toFixed(1));d.wind_raw=b;d.day_night=a>>2&1?"night":"day";d.rain=a>>1&1?"true":"false";
break;case 2:d.sun_west=parseFloat((f/255*150).toFixed(1));d.sun_west_raw=f;d.sun_south=parseFloat((e/255*150).toFixed(1));d.sun_south_raw=g;d.sun_east=parseFloat((b/255*150).toFixed(1));d.sun_east_raw=b;d.hemisphere=a>>2&1?"south":"north";break;case 3:d.day=f&15;d.month=e&7;d.year=(b&127)+2E3;d.date_src=a&1?"gps":"rtc";break;case 4:d.weekday=f>>5&7;d.hour=f&31;d.min=e&63;d.sec=b&63;d.time_format=a>>2&1?"12":"24";d.am_pm=a>>1&1?"pm":"am";d.time_src=a&1?"gps":"rtc";break;case 5:d.elv=f-90;d.elv_raw=
f;b=c.userData.readUInt16BE(1)&511;d.azm=b;d.azm_raw=b;break;case 6:c=(f>>4&15)<<8|e,b|=(f&15)<<8,d.latitude=parseFloat((c/4095*180-90).toFixed(1)),d.latitude_raw=c,d.longitude=parseFloat((b/4095*360-180).toFixed(1)),d.longitude_raw=b}}return d};var rc=function(c){R.call(this,c);this._data="a5-13-01"};rc.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
rc.prototype=new R;rc.prototype.constructor=rc;var sc=function(c){R.call(this,c);this._data="a5-13-02"};sc.STATES="sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere".split(" ");sc.prototype=new R;sc.prototype.constructor=sc;var tc=function(c){R.call(this,c);this._data="a5-13-03"};tc.STATES=["day","month","year","date_src"];tc.prototype=new R;tc.prototype.constructor=tc;var uc=function(c){R.call(this,c);this._data="a5-13-04"};uc.STATES="weekday hour min sec time_format am_pm time_src".split(" ");
uc.prototype=new R;uc.prototype.constructor=uc;var vc=function(c){R.call(this,c);this._data="a5-13-05"};vc.STATES=["elv","azm"];vc.prototype=new R;vc.prototype.constructor=vc;var wc=function(c){R.call(this,c);this._data="a5-13-06"};wc.STATES=["latitude","longitude"];wc.prototype=new R;wc.prototype.constructor=wc;var Bb=function(c){g.call(this,c);this._data="a5-14-01"};Bb.STATES=["voltage","voltage_raw","state"];Bb.prototype=new g;Bb.prototype.constructor=Bb;Bb.prototype.evalTelegram=function(c){var d=
{};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=c/250*5;d.voltage_raw=c;a&=1;switch(a){case 0:d.state="closed";break;case 1:d.state="open"}d.state_raw=a}}return d};var Cb=function(c){g.call(this,c);this._data="a5-14-02"};Cb.STATES=["voltage","voltage_raw","illumination","illumination_raw","state"];Cb.prototype=new g;Cb.prototype.constructor=Cb;Cb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(1);
c=c.userData.readUInt8(0);if(1==(a>>3&1))switch(d.voltage=c/250*5,d.voltage_raw=c,d.illumination=b/250*1E3,d.illumination_raw=b,a&=1,d.state_raw=a,a){case 0:d.state="closed";break;case 1:d.state="open"}}return d};var Db=function(c){g.call(this,c);this._data="a5-14-03"};Db.STATES=["voltage","voltage_raw","state","viberation"];Db.prototype=new g;Db.prototype.constructor=Db;Db.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>
3&1)){d.voltage=c/250*5;d.voltage_raw=c;switch(a&1){case 0:d.state="closed";break;case 1:d.state="open"}switch(a>>1&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}}return d};var Eb=function(c){g.call(this,c);this._data="a5-14-04"};Eb.STATES="voltage voltage_raw illumination illumination_raw state viberation".split(" ");Eb.prototype=new g;Eb.prototype.constructor=Eb;Eb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(1);c=c.userData.readUInt8(0);
if(1==(a>>3&1)){d.voltage=c/250*5;d.voltage_raw=c;d.illumination=b/250*1E3;d.illumination_raw=b;switch(a&1){case 0:d.state="closed";break;case 1:d.state="open"}switch(a>>1&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}}return d};var Fb=function(c){g.call(this,c);this._data="a5-14-05"};Fb.STATES=["voltage","voltage_raw","viberation"];Fb.prototype=new g;Fb.prototype.constructor=Fb;Fb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);
if(1==(a>>3&1))switch(d.voltage=c/250*5,d.voltage_raw=c,a>>1&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}return d};var Gb=function(c){g.call(this,c);this._data="a5-14-06"};Gb.STATES=["voltage","voltage_raw","illumination","illumination_raw","viberation"];Gb.prototype=new g;Gb.prototype.constructor=Gb;Gb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1))switch(d.voltage=c/250*5,d.voltage_raw=
c,d.illumination=b/250*1E3,d.illumination_raw=b,a>>1&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}return d};var Hb=function(c){g.call(this,c);this._data="a5-14-07"};Hb.STATES=["voltage","voltage_raw","state","lock"];Hb.prototype=new g;Hb.prototype.constructor=Hb;Hb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=c/250*5;d.voltage_raw=c;switch(a>>2&1){case 0:d.state="closed";break;case 1:d.state=
"open"}switch(a>>1&1){case 0:d.lock="locked";break;case 1:d.lock="unlocked"}}}return d};var Ib=function(c){g.call(this,c);this._data="a5-14-08"};Ib.STATES=["voltage","voltage_raw","state","lock","viberation"];Ib.prototype=new g;Ib.prototype.constructor=Ib;Ib.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=c/250*5;d.voltage_raw=c;switch(a>>2&1){case 0:d.state="closed";break;case 1:d.state="open"}switch(a>>
1&1){case 0:d.lock="locked";break;case 1:d.lock="unlocked"}switch(a&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}}return d};var Jb=function(c){g.call(this,c);this._data="a5-14-09"};Jb.STATES=["voltage","voltage_raw","state"];Jb.prototype=new g;Jb.prototype.constructor=Jb;Jb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1))switch(d.voltage=c/250*5,d.voltage_raw=c,a>>1&3){case 0:d.state="closed";break;case 1:d.state=
"tilted";break;case 2:d.state="reserved";break;case 3:d.state="open"}}return d};var Kb=function(c){g.call(this,c);this._data="a5-14-0a"};Kb.STATES=["voltage","voltage_raw","state","viberation"];Kb.prototype=new g;Kb.prototype.constructor=Kb;Kb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=c/250*5;d.voltage_raw=c;switch(a>>1&3){case 0:d.state="closed";break;case 1:d.state="tilted";break;case 2:d.state="reserved";
break;case 3:d.state="open"}switch(a&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}}return d};var ja=function(c){t.call(this,c);this._data="a5-20-04";this.TEACH_IN_VARIATION=3;this._defaultSetpoint=15;this._defaultWakeupCycle=3;this._defaultDisplay=0;this._states={pending:{value:!1,time:(new Date).getTime()}};this._service_command_new=this._button_lock_new=this._display_new=this._wakeup_cycle_new=this._measurement_new=this._setpoint_new=this._valve_new=null};ja.COMMANDS="setValve setTo up down measureOn measureOff setWakeup setDisplay buttonLock buttonUnlock openValve closeValve init".split(" ");
ja.STATES="valve measurement button_lock temperature_selection feed_temperature setpoint error temperature wakeup_cycle display pending".split(" ");ja.prototype=new t;ja.prototype.constructor=ja;ja.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.wakeup_cycle||null==this._params.wakeup_cycle)this._params.wakeup_cycle=this._defaultWakeupCycle;if("undefined"==typeof this._params.display||null==this._params.display)this._params.display=this._defaultDisplay};
ja.prototype.getStatesBuffer=function(){var c=JSON.parse(JSON.stringify(this._states));c.wakeup_cycle={value:this._params.wakeup_cycle,time:-1};c.display={value:this._params.display,time:-1};"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(c.wakeup_cycle={value:this._wakeup_cycle_new,time:-1});"undefined"!=typeof this._display_new&&null!=this._display_new&&(c.display={value:this._display_new,time:-1});"undefined"!=typeof this._valve_new&&null!=this._valve_new&&(c.valve={value:this._valve_new,
time:-1});"undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new&&(c.setpoint={value:this._setpoint_new,time:-1});"undefined"!=typeof this._measurement_new&&null!=this._measurement_new&&(c.measurement={value:this._measurement_new,time:-1});"undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new&&(c.button_lock={value:this._button_lock_new,time:-1});return c};ja.prototype.getCurrentStates=function(){var c={},d=this.getStatesBuffer(),a;for(a in d)d.hasOwnProperty(a)&&d[a]&&
(c[a]=d[a].value);return c};ja.prototype.executeCommand=function(c,d,a){var b=(new Date).getTime();if(d&&d.value){"setValve"==d.value.substr(0,8)&&8<d.value.length?(c=d.value.substr(8),d={value:"setValve",ext:c}):"setTo"==d.value.substr(0,5)&&5<d.value.length?(c=d.value.substr(5),d={value:"setTo",ext:c}):"tempTo"==d.value.substr(0,6)&&6<d.value.length?(c=d.value.substr(6),d={value:"setTo",ext:c}):"up"==d.value.substr(0,2)&&2<d.value.length?(c=d.value.substr(2),d={value:"up",ext:c}):"down"==d.value.substr(0,
4)&&4<d.value.length?(c=d.value.substr(4),d={value:"down",ext:c}):"setWakeup"==d.value.substr(0,9)&&9<d.value.length?(c=d.value.substr(9),d={value:"setWakeup",ext:c}):"setDisplay"==d.value.substr(0,10)&&10<d.value.length&&(c=d.value.substr(10),d={value:"setDisplay",ext:c});var e=[];switch(d.value){case "setValve":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set valve value invalid"));return}c=parseInt(d.ext);0>c&&(c=0);100<c&&(c=100);this._valve_new=c;this._states.pending={value:!0,time:b};
d={key:"valve",value:c,changed:!1};b=this._states.valve?this._states.valve.value:null;b!=c&&(d.oldvalue=b,d.changed=!0);e.push(d);break;case "setTo":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set valve value invalid"));return}c=parseFloat(d.ext);10>c&&(c=10);30<c&&(c=30);this._setpoint_new=c;this._states.pending={value:!0,time:b};d={key:"setpoint",value:this._setpoint_new,changed:!1};b=this._states.setpoint?this._states.setpoint.value:null;b!=this._setpoint_new&&(d.oldvalue=b,d.changed=
!0);e.push(d);break;case "up":(c=d.ext)||(c=.5);c=parseFloat(c);if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new)this._setpoint_new+=c;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value+c;else{a&&a(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_new=10);30<this._setpoint_new&&(this._setpoint_new=30);this._states.pending={value:!0,
time:b};d={key:"setpoint",value:this._setpoint_new,changed:!1};b=this._states.setpoint?this._states.setpoint.value:null;b!=this._setpoint_new&&(d.oldvalue=b,d.changed=!0);e.push(d);break;case "down":(c=d.ext)||(c=.5);c=parseFloat(c);if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new)this._setpoint_new-=c;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value-c;else{a&&
a(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_ne=10);30<this._setpoint_new&&(this._setpoint_new=30);this._states.pending={value:!0,time:b};d={key:"setpoint",value:this._setpoint_new,changed:!1};b=this._states.setpoint?this._states.setpoint.value:null;b!=this._setpoint_new&&(d.oldvalue=b,d.changed=!0);e.push(d);break;case "measureOn":this._measurement_new="active";this._states.pending={value:!0,time:b};d={key:"measurement",value:this._measurement_new,changed:!1};
b=this._states.measurement?this._states.measurement.value:null;b!=this._measurement_new&&(d.oldvalue=b,d.changed=!0);e.push(d);break;case "measureOff":this._measurement_new="inactive";this._states.pending={value:!0,time:b};d={key:"measurement",value:this._measurement_new,changed:!1};b=this._states.measurement?this._states.measurement.value:null;b!=this._measurement_new&&(d.oldvalue=b,d.changed=!0);e.push(d);break;case "setWakeup":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set wakup cycle value invalid"));
return}this._wakeup_cycle_new=c=parseInt(d.ext);this._states.pending={value:!0,time:b};d={key:"wakeup_cycle",value:this._wakeup_cycle_new,changed:!1};b=this._params.wakeup_cycle;b!=this._wakeup_cycle_new&&(d.oldvalue=b,d.changed=!0);e.push(d);break;case "setDisplay":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set display orientation value invalid"));return}this._display_new=c=parseInt(d.ext);this._states.pending={value:!0,time:b};d={key:"display",value:this._display_new,changed:!1};b=this._params.display;
b!=this._display_new&&(d.oldvalue=b,d.changed=!0);e.push(d);break;case "buttonLock":this._button_lock_new="locked";this._states.pending={value:!0,time:b};d={key:"button_lock",value:this._button_lock_new,changed:!1};b=this._states.button_lock?this._states.button_lock.value:null;b!=this._button_lock_new&&(d.oldvalue=b,d.changed=!0);e.push(d);break;case "buttonUnlock":this._button_lock_new="unlocked";this._states.pending={value:!0,time:b};d={key:"button_lock",value:this._button_lock_new,changed:!1};
b=this._states.button_lock?this._states.button_lock.value:null;b!=this._button_lock_new&&(d.oldvalue=b,d.changed=!0);e.push(d);break;case "openValve":this._service_command_new=1;this._states.pending={value:!0,time:b};break;case "closeValve":this._service_command_new=3;this._states.pending={value:!0,time:b};break;case "init":this._service_command_new=2,this._states.pending={value:!0,time:b}}0<e.length&&require("x.hub.m.enocean.js")._onEOEvents(this,e);a&&a()}else a&&a(Error("command invalid"))};ja.prototype.evalData=
function(c,d,a){if(d=this.evalTelegram(d)){var b=this;this._sendResponse(c,d,function(c,d){c=b.checkStateChange(d);a&&a(null,c)})}else a&&a(Error("data format invalid"))};ja.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){d.valve=c;d.measurement=a>>7&1?"inactive":"active";d.button_lock=a>>2&1?"locked":"unlocked";c=a>>1&1;a&=1;d.temperature_selection=c?"setpoint":
"feed_temperature";switch(c){case 0:d.feed_temperature=parseFloat((e/255*60+20).toFixed(1));break;case 1:d.setpoint=parseFloat((e/255*20+10).toFixed(1))}if(0==a)d.error="no_error",d.temperature=parseFloat((b/255*20+10).toFixed(1));else switch(b){case 17:d.error="measurement_error";break;case 18:d.error="battery_empty";break;case 20:d.error="frost_protection";break;case 33:d.error="blocked_valve";break;case 36:d.error="end_point_detection_error";break;case 40:d.error="no_valve";break;case 49:d.error=
"not_taught_in";break;case 53:d.error="no_response_from_controller";break;case 54:d.error="teach_in_error";break;default:d.error="unknow_error"}}}return d};ja.prototype._sendResponse=function(c,d,a){var b=(new Date).getTime(),e=JSON.parse(JSON.stringify(d));this._states.pending={value:!1,time:b};var f=!1;if("undefined"!=typeof this._valve_new&&null!=this._valve_new){var r=this._valve_new;this._states.valve={value:this._valve_new,time:b};this._valve_new=null;delete e.valve}else r="undefined"!=typeof d.valve&&
null!=d.valve?d.valve:this._states.valve?this._states.valve.value:null;if("undefined"==typeof r||null==r)r=0,e.valve=0;if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new){var g=Math.round((this._setpoint_new-10)/20*255);this._states.setpoint={value:this._setpoint_new,time:b};this._setpoint_new=null;delete e.setpoint}else"undefined"!=typeof d.setpoint&&null!=d.setpoint?g=Math.round((d.setpoint-10)/20*255):this._states.setpoint&&"undefined"!=this._states.setpoint.value&&null!=this._states.setpoint.value&&
(g=Math.round((this._states.setpoint.value-10)/20*255));if("undefined"==typeof g||null==g)g=this._defaultSetpoint,g=Math.round((g-10)/20*255),e.setpoint=this._defaultSetpoint;if("undefined"!=typeof this._measurement_new&&null!=this._measurement_new){var h="active"==this._measurement_new?0:1;this._states.measurement={value:this._measurement_new,time:b};this._measurement_new=null;delete e.measurement}else"undefined"!=typeof d.measurement&&null!=d.measurement?h="active"==d.measurement?0:1:this._states.measurement&&
"undefined"!=this._states.measurement.value&&null!=this._states.measurement.value&&(h="active"==this._states.measurement.value?0:1);if("undefined"==typeof h||null==h)h=0,e.measurement="active";var k=this._params.wakeup_cycle;"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(k=this._wakeup_cycle_new,this._params.wakeup_cycle=this._wakeup_cycle_new,f=!0,this._wakeup_cycle_new=null);if("undefined"==typeof k||null==k)k=this._defaultWakeupCycle,this._params.wakeup_cycle=k;var l=
this._params.display;"undefined"!=typeof this._display_new&&null!=this._display_new&&(l=this._display_new,this._params.display=this._display_new,f=!0,this._display_new=null);if("undefined"==typeof l||null==l)l=this._defaultDisplay,this._params.display=l;if("undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new){var ha="locked"==this._button_lock_new?1:0;this._states.button_lock={value:this._button_lock_new,time:b};this._button_lock_new=null;delete e.button_lock}else"undefined"!=typeof d.button_lock&&
null!=d.button_lock?ha="locked"==d.button_lock?1:0:this._states.button_lock&&this._states.button_lock.value&&(ha="locked"==this._states.button_lock.value?1:0);if("undefined"==typeof ha||null==ha)ha=0,e.button_lock="unlocked";d=0;"undefined"!=typeof this._service_command_new&&null!=this._service_command_new&&(d=this._service_command_new,this._service_command_new=null);r=new Buffer([r,g,(h&1)<<6|k&63,(l&3)<<4|8|(ha&1)<<2|d&3]);f&&require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated();f=
this._senderID;f||(f=x.hub.m.enocean.SENDER_ID);f=new x.hub.m.enocean.ESP3.Telegram.ADT(165,r,this._address,f,0);c.sendTelegram(f,!0,function(c){a&&a(c,e)})};var Za=function(c){t.call(this,c);this._data="a5-30-??"};Za.prototype=new t;Za.prototype.constructor=Za;var La=function(c){g.call(this,c);this._data="a5-30-01"};La.STATES=["battery_low","battery_raw","state","state_raw"];La.prototype=new Za;La.prototype.constructor=La;La.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),
b=c.userData.readUInt8(2);c=c.userData.readUInt8(1);1==(a>>3&1)&&(d.battery_low=120>=c?!0:!1,d.battery_raw=c,d.state=195>=b?"closed":"open",d.state_raw=b)}return d};var Lb=function(c){g.call(this,c);this._data="a5-30-01\u00b4"};Lb.STATES=["state"];Lb.prototype=new Za;Lb.prototype.constructor=Lb;Lb.prototype.evalTelegram=function(c){var d={};165==c.rorg&&(c=c.userData.readUInt8(3),1==(c>>3&1)&&(d.state=c&1?"open":"closed"));return d};var W=function(c){g.call(this,c);this._data="a5-30-03"};W.STATES=
"temperature temperature_raw wake input3 input2 input1 input0".split(" ");W.prototype=new Za;W.prototype.constructor=W;W.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt8(1);1==(a>>3&1)&&(d.temperature=(255-c)/255*40,d.temperature_raw=c,d.wake=b>>4&1,d.input3=b>>3&1,d.input2=b>>2&1,d.input1=b>>1&1,d.input0=b&1)}return d};var Mb=function(c){g.call(this,c);this._data="a5-30-04"};Mb.STATES=["analog_input","input2",
"input1","input0"];Mb.prototype=new Za;Mb.prototype.constructor=Mb;Mb.prototype.evalTelegram=function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(2);1==(a>>3&1)&&(d.analog_input=c,d.input2=a>>2&1,d.input1=a>>1&1,d.input0=a&1)}return d};var xc=function(c){t.call(this,c);this._data="a5-38-??"};xc.prototype=new t;xc.prototype.constructor=xc;var H=function(c){xc.call(this,c);this._data="a5-38-08"};H.prototype=new xc;H.prototype.constructor=H;H.prototype.evalTelegram=
function(c){var d={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1))switch(c){case 2:d.level=Math.round(e/255*100),d.ramp=b,d.dim_range=a>>2&1?"relative":"absolute",d.store_final_value=a>>1&1,d.state=a&1?"on":"off"}}return d};H.prototype.switching=function(c,d,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);d=new Buffer([1,d.TIM>>8&255,d.TIM&255,8|(d.LCK&1)<<2|(d.DEL&1)<<1|d.SW&1]);b=
new x.hub.m.enocean.ESP3.Telegram.BS4(d,b,0);b.setDstId(this._address);c.sendTelegram(b,!0,function(c){a&&a(c)})};H.prototype.dimming=function(c,d,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);d=new Buffer([2,d.EDIM,d.RMP,8|(d.EDIMR&1)<<2|(d.STR&1)<<1|d.SW&1]);b=new x.hub.m.enocean.ESP3.Telegram.BS4(d,b,0);b.setDstId(this._address);c.sendTelegram(b,!0,function(c){a&&a(c)})};H.prototype.blind=function(c,d,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);
b?(d=new Buffer([7,d.P1,d.P2,(d.FUNC&15)<<4|8|(d.SSF&1)<<2|(d.PAF&1)<<1|d.SMF&1]),b=new x.hub.m.enocean.ESP3.Telegram.BS4(d,b,0),b.setDstId(this._address),c.sendTelegram(b,!0,function(c){a&&a(c)})):a&&a(Error("no senderID"))};var yc=function(c){t.call(this,c);this._data="a5-3F-7F"};yc.prototype=new t;yc.prototype.constructor=yc;var fa=function(c){g.call(this,c);this._data="d2-??-??";this.UNIQUE_GATEWAY_SENDERID=!0};fa.prototype=new g;fa.prototype.constructor=fa;var E=function(c){fa.call(this,c);this._data=
"d2-01-??";this._lastQuery={};this._initCount=0};E.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");E.prototype=new fa;E.prototype.constructor=E;E.prototype.init=function(c){var d=this.getIOs();if(0<d.length){var a=require("x.hub.m.enocean.js")._esp3,b=0,e=this,f=function(){b++;b<d.length?e.statusQuery(a,{IO:d[b]},f):c&&c()};this.statusQuery(a,{IO:d[b]},f)}else c&&c()};E.prototype.getStatesBuffer=function(){0==
Object.keys(this._states).length?(100>=this._initCount&&0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):this._initCount=0;return this._states};E.prototype.getIOs=function(){return[]};E.prototype.setOutput=function(c,d,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);d=new Buffer([1,(d.DV&7)<<5|d.IO&31,d.OV&127]);b=new x.hub.m.enocean.ESP3.Telegram.VLD(d,b,0);this._senderID!=this._address&&
b.setDstId(this._address);c.sendTelegram(b,!0,function(c){a&&a(c)})};E.prototype.setLocal=function(c,d,a){d=new Buffer([(d.DE&1)<<7|2,(d.OC&1)<<7|(d.RO&1)<<6|(d.LC&1)<<5|d.IO&31,(d.DT2&15)<<4|d.DT3&15,(d.DN&1)<<7|(d.PF&1)<<6|(d.DS&3)<<4|d.DT1&15]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(d,x.hub.m.enocean.SENDER_ID,0);d.setDstId(this._address);c.sendTelegram(d,!0,function(c){a&&a(c)})};E.prototype.statusQuery=function(c,d,a){this._senderID?(this._lastQuery[d.IO]=(new Date).getTime(),d=new Buffer([3,
d.IO&31]),d=new x.hub.m.enocean.ESP3.Telegram.VLD(d,this._senderID,0),d.setDstId(this._address),c.sendTelegram(d,!0,function(c){a&&a(c)})):a&&a(Error("no senderID"))};E.prototype.measurementQuery=function(c,d,a){d=new Buffer([6,(d.QU&1)<<5|d.IO&31]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(d,this._senderID,0);d.setDstId(this._address);c.sendTelegram(d,!0,function(c){a&&a(c)})};E.prototype.evalTelegram=function(c){var d={};if(210==c.rorg){var a=c.userData.readUInt8(0);switch(a&15){case 4:if(3==c.userData.length){var b=
a>>7&1,e=a>>6&1;a=c.userData.readUInt8(1);var f=a>>7&1,g=a>>5&3,h=a&31;a=c.userData.readUInt8(2);c=a&127;d.power_failure_detection=b?!0:!1;d.power_failure=e?!0:!1;d.over_current_switch_off=f;d.error_level=g;d.io_channel=h;d.local_control=a>>7&1?!0:!1;d.output_value=c;d.output_state=c?"on":"off"}break;case 7:if(6==c.userData.length){a=c.userData.readUInt8(1);b=a>>5&7;h=a&31;a=c.userData.readUInt32BE(2);switch(b){case 0:d.unit="Ws";break;case 1:d.unit="Wh";break;case 2:d.unit="KWh";break;case 3:d.unit=
"W";break;case 4:d.unit="KW"}d.io_channel=h;d.value=a}}}return d};var na=function(c){E.call(this,c);this._data="d2-01-00"};na.COMMANDS=["on","off","toggle"];na.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");na.prototype=new E;na.prototype.constructor=na;na.prototype.getIOs=function(){return[0]};na.prototype.executeCommand=function(c,d,a){if(d&&d.value){var b=this;switch(d.value){case "on":this.activeStateChange({output_value:100,
output_state:"on"});this.setOutput(c,{DV:0,IO:0,OV:100},a);break;case "off":this.activeStateChange({output_value:0,output_state:"off"});this.setOutput(c,{DV:0,IO:0,OV:0},a);break;case "toggle":this._states.output_state?this.executeCommand(c,{value:"on"==this._states.output_state.value?"off":"on"},a):this.init(function(){setTimeout(function(){b._states.output_state?b.executeCommand(c,d,a):a&&a(Error("unkown current status"))},200)})}}else a&&a(Error("command invalid"))};var Nb=function(c){na.call(this,
c);this._data="d2-01-01"};Nb.COMMANDS=["on","off","toggle"];Nb.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");Nb.prototype=new na;Nb.prototype.constructor=Nb;var Ob=function(c){na.call(this,c);this._data="d2-01-03";this._lastOnLevel=-1};Ob.prototype=new na;Ob.prototype.constructor=Ob;Ob.prototype.evalData=function(c,d,a){(c=this.evalTelegram(d))?((0==c.output_value||"off"==c.output_state)&&this._states.output_value&&
this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value),c=this.checkStateChange(c),a&&a(null,c)):a&&a(Error("data format invalid"))};Ob.prototype.executeCommand=function(c,d,a){if(d&&d.value){if("dimTo"==d.value.substr(0,5)&&5<d.value.length){var b=d.value.substr(5);d={value:"dimTo",ext:b}}else"toggleTo"==d.value.substr(0,8)&&8<d.value.length&&(b=d.value.substr(8),d={value:"toggleTo",ext:b});(new Date).getTime();var e=this;switch(d.value){case "on":b=this._lastOnLevel;
if(-1==b||0==b)b=100;this.setOutput(c,{DV:0,IO:0,OV:b},function(c){c||e.activeStateChange({output_value:b,output_state:"on"});a&&a(c)});break;case "off":this._states.output_value&&this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value);this.setOutput(c,{DV:0,IO:0,OV:0},function(c){c||e.activeStateChange({output_value:0,output_state:"off"});a&&a(c)});break;case "toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?e.executeCommand(c,
d,a):a&&a(Error("unkown current status"))},200)});break}this.executeCommand(c,{value:"on"==this._states.output_state.value?"off":"on"},a);break;case "toggleTo":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?e.executeCommand(c,d,a):a&&a(Error("unkown current status"))},200)});break}"on"==this._states.output_state.value?this.executeCommand(c,{value:"off"},a):this.executeCommand(c,{value:"dimTo",ext:d.ext},a);break;case "dimTo":if("undefined"==typeof d.ext||
null==d.ext){a&&a(Error("dim to value invalid"));break}b=parseFloat(d.ext);0>b&&(b=0);100<b&&(b=100);this.setOutput(c,{DV:0,IO:0,OV:b},function(c){c||e.activeStateChange({output_value:b,output_state:0==b?"off":"on"});a&&a(c)});break;case "dimUp":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?e.executeCommand(c,d,a):a&&a(Error("unkown current status"))},200)});break}b=parseInt(this._states.output_value.value);b+=5;100<b&&(b=100);this.executeCommand(c,
{value:"dimTo",ext:b},a);break;case "dimDown":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?e.executeCommand(c,d,a):a&&a(Error("unkown current status"))},200)});break}b=parseInt(this._states.output_value.value);b-=5;0>b&&(b=0);this.executeCommand(c,{value:"dimTo",ext:b},a);break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"))};var Ea=function(c){E.call(this,c);this._data="d2-01-11"};Ea.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle".split(" ");
Ea.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state".split(" ");Ea.prototype=new E;Ea.prototype.constructor=Ea;Ea.prototype.getIOs=function(){return[0,1]};Ea.prototype.evalTelegram=function(c){if(c=E.prototype.evalTelegram.call(this,c))switch(c.io_channel){case 0:c.ch1_output_value=c.output_value;c.ch1_output_state=c.output_state;break;case 1:c.ch2_output_value=
c.output_value,c.ch2_output_state=c.output_state}return c};Ea.prototype.executeCommand=function(c,d,a){if(d&&d.value){var b=this;switch(d.value){case "ch1On":this.activeStateChange({ch1_output_value:100,ch1_output_state:"on"});this.setOutput(c,{DV:0,IO:0,OV:100},a);break;case "ch1Off":this.activeStateChange({ch1_output_value:0,ch1_output_state:"off"});this.setOutput(c,{DV:0,IO:0,OV:0},a);break;case "ch1Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){b._states.output_state?
b.executeCommand(c,d,a):a&&a(Error("unkown current status"))},200)});break}var e="on"==this._states.ch1_output_state.value?"off":"on";this.activeStateChange({ch1_output_value:"on"==e?100:0,ch1_output_state:e});this.executeCommand(c,{value:"on"==e?"ch1On":"ch1Off"},a);break;case "ch2On":this.activeStateChange({ch2_output_value:100,ch2_output_state:"on"});this.setOutput(c,{DV:0,IO:1,OV:100},a);break;case "ch2Off":this.activeStateChange({ch2_output_value:0,ch2_output_state:"off"});this.setOutput(c,{DV:0,
IO:1,OV:0},a);break;case "ch2Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){b._states.output_state?b.executeCommand(c,d,a):a&&a(Error("unkown current status"))},200)});break}e="on"==this._states.ch2_output_state.value?"off":"on";this.activeStateChange({ch2_output_value:"on"==e?100:0,ch2_output_state:e});this.executeCommand(c,{value:"on"==e?"ch2On":"ch2Off"},a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var ra=function(c){E.call(this,
c);this._data="d2-01-13";this._queryInterval=3E4};ra.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle".split(" ");ra.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state".split(" ");ra.prototype=new E;ra.prototype.constructor=ra;ra.prototype.getStatesBuffer=
function(){var c=[];this._states.ch1_output_state||(!this._lastQuery[0]||now-this._lastQuery[0]>this._queryInterval)&&c.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||now-this._lastQuery[1]>this._queryInterval)&&c.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||now-this._lastQuery[2]>this._queryInterval)&&c.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||now-this._lastQuery[3]>this._queryInterval)&&c.push(3);0<c.length&&this._queryStates(c);return this._states};
ra.prototype._queryStates=function(c,d){var a=require("x.hub.m.enocean.js")._esp3,b=0,e=this,f=function(){b++;b<c.length?e.statusQuery(a,{IO:c[b]},f):d&&d()};this.statusQuery(a,{IO:c[b]},f)};ra.prototype.getIOs=function(){return[0,1,2,3]};ra.prototype.evalTelegram=function(c){if(c=E.prototype.evalTelegram.call(this,c))switch(c.io_channel){case 0:c.ch1_output_value=c.output_value;c.ch1_output_state=c.output_state;break;case 1:c.ch2_output_value=c.output_value;c.ch2_output_state=c.output_state;break;
case 2:c.ch3_output_value=c.output_value;c.ch3_output_state=c.output_state;break;case 3:c.ch4_output_value=c.output_value,c.ch4_output_state=c.output_state}return c};ra.prototype.executeCommand=function(c,d,a){if(d&&d.value){var b=this;switch(d.value?d.value.substr(0,3):null){case "ch1":var e=0;var f="ch1_output_value";var r="ch1_output_state";break;case "ch2":e=1;f="ch2_output_value";r="ch2_output_state";break;case "ch3":e=2;f="ch3_output_value";r="ch3_output_state";break;case "ch4":e=3,f="ch4_output_value",
r="ch4_output_state"}switch(d.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":var g={};g[f]=100;g[r]="on";var h={DV:0,IO:e,OV:100};this.activeStateChange(g);this.setOutput(c,h,a);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":g={};g[f]=0;g[r]="off";h={DV:0,IO:e,OV:0};this.activeStateChange(g);this.setOutput(c,h,a);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){b._states.output_state?
b.executeCommand(c,d,a):a&&a(Error("unkown current status"))},200)});break}if(!this._states[r]){a&&a(Error("state unknown"));break}h="on"==this._states[r].value?"off":"on";g={};g[f]="on"==h?100:0;g[r]=h;h={DV:0,IO:e,OV:"on"==h?100:0};this.activeStateChange(g);this.setOutput(c,h,a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var sa=function(c){E.call(this,c);this._data="d2-01-14";this._queryInterval=3E4};sa.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle ch5On ch5Off ch5Toggle ch6On ch6Off ch6Toggle ch7On ch7Off ch7Toggle ch8On ch8Off ch8Toggle".split(" ");
sa.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state ch5_output_value ch5_output_state ch6_output_value ch6_output_state ch7_output_value ch7_output_state ch8_output_value ch8_output_state".split(" ");sa.prototype=new E;sa.prototype.constructor=sa;sa.prototype._queryStates=function(c,
d){var a=require("x.hub.m.enocean.js")._esp3,b=0,e=this,f=function(){b++;b<c.length?e.statusQuery(a,{IO:c[b]},f):d&&d()};this.statusQuery(a,{IO:c[b]},f)};sa.prototype.getStatesBuffer=function(){var c=(new Date).getTime(),d=[];this._states.ch1_output_state||(!this._lastQuery[0]||c-this._lastQuery[0]>this._queryInterval)&&d.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||c-this._lastQuery[1]>this._queryInterval)&&d.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||c-this._lastQuery[2]>
this._queryInterval)&&d.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||c-this._lastQuery[3]>this._queryInterval)&&d.push(3);this._states.ch5_output_state||(!this._lastQuery[4]||c-this._lastQuery[4]>this._queryInterval)&&d.push(4);this._states.ch6_output_state||(!this._lastQuery[5]||c-this._lastQuery[5]>this._queryInterval)&&d.push(5);this._states.ch7_output_state||(!this._lastQuery[6]||c-this._lastQuery[6]>this._queryInterval)&&d.push(6);this._states.ch8_output_state||(!this._lastQuery[7]||
c-this._lastQuery[7]>this._queryInterval)&&d.push(7);0<d.length&&this._queryStates(d);return this._states};sa.prototype.getIOs=function(){return[0,1,2,3,4,5,6,7]};sa.prototype.evalTelegram=function(c){if(c=E.prototype.evalTelegram.call(this,c))switch(c.io_channel){case 0:c.ch1_output_value=c.output_value;c.ch1_output_state=c.output_state;break;case 1:c.ch2_output_value=c.output_value;c.ch2_output_state=c.output_state;break;case 2:c.ch3_output_value=c.output_value;c.ch3_output_state=c.output_state;
break;case 3:c.ch4_output_value=c.output_value;c.ch4_output_state=c.output_state;break;case 4:c.ch5_output_value=c.output_value;c.ch5_output_state=c.output_state;break;case 5:c.ch6_output_value=c.output_value;c.ch6_output_state=c.output_state;break;case 6:c.ch7_output_value=c.output_value;c.ch7_output_state=c.output_state;break;case 7:c.ch8_output_value=c.output_value,c.ch8_output_state=c.output_state}return c};sa.prototype.executeCommand=function(c,d,a){if(d&&d.value){var b=this;switch(d.value?d.value.substr(0,
3):null){case "ch1":var e=0;var f="ch1_output_value";var r="ch1_output_state";break;case "ch2":e=1;f="ch2_output_value";r="ch2_output_state";break;case "ch3":e=2;f="ch3_output_value";r="ch3_output_state";break;case "ch4":e=3;f="ch4_output_value";r="ch4_output_state";break;case "ch5":e=4;f="ch5_output_value";r="ch5_output_state";break;case "ch6":e=5;f="ch6_output_value";r="ch6_output_state";break;case "ch7":e=6;f="ch7_output_value";r="ch7_output_state";break;case "ch8":e=7,f="ch8_output_value",r="ch8_output_state"}switch(d.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":case "ch5On":case "ch6On":case "ch7On":case "ch8On":var g=
{};g[f]=100;g[r]="on";var h={DV:0,IO:e,OV:100};this.activeStateChange(g);this.setOutput(c,h,a);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":case "ch5Off":case "ch6Off":case "ch7Off":case "ch8Off":g={};g[f]=0;g[r]="off";h={DV:0,IO:e,OV:0};this.activeStateChange(g);this.setOutput(c,h,a);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":case "ch5Toggle":case "ch6Toggle":case "ch7Toggle":case "ch8Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){b._states.output_state?
b.executeCommand(c,d,a):a&&a(Error("unkown current status"))},200)});break}if(!this._states[r]){a&&a(Error("state unknown"));break}h="on"==this._states[r].value?"off":"on";g={};g[f]="on"==h?100:0;g[r]=h;h={DV:0,IO:e,OV:"on"==h?100:0};this.activeStateChange(g);this.setOutput(c,h,a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var zc=function(c){fa.call(this,c);this._data="d2-05-??"};zc.prototype=new fa;zc.prototype.constructor=zc;var S=function(c){zc.call(this,
c);this._data="d2-05-00"};S.COMMANDS="moveUp moveDown moveTo stepUp stepDown lamellaUp lamellaDown lamellaTo stop setRunTime setRotationTime setParams[15.2s]:[10,20,30ms]:[0-3]".split(" ");S.STATES=["state","angle","lock","channel"];S.prototype=new zc;S.prototype.constructor=S;S.prototype.init=function(c){var d=require("x.hub.m.enocean.js")._esp3;this.query(d,{CHN:0},c)};S.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length&&this.init();return this._states};S.prototype.goToPositionAngle=
function(c,d,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);d=new Buffer([d.POS&127,d.ANG&127,(d.REPO&7)<<4|d.LOCK&7,(d.CHN&15)<<4|1]);b=new x.hub.m.enocean.ESP3.Telegram.VLD(d,b,0);b.setDstId(this._address);c.sendTelegram(b,!0,function(c){a&&a(c)})};S.prototype.stop=function(c,d,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);d=new Buffer([(d.CHN&15)<<4|2]);b=new x.hub.m.enocean.ESP3.Telegram.VLD(d,b,0);b.setDstId(this._address);c.sendTelegram(b,!0,function(c){a&&
a(c)})};S.prototype.query=function(c,d,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);d=new Buffer([(d.CHN&15)<<4|3]);b=new x.hub.m.enocean.ESP3.Telegram.VLD(d,b,0);b.setDstId(this._address);c.sendTelegram(b,!0,function(c){a&&a(c)})};S.prototype.setParameters=function(c,d,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);d=new Buffer([d.VERT>>8&127,d.VERT&255,d.ROT&255,d.AA&7,(d.CHN&15)<<4|5]);b=new x.hub.m.enocean.ESP3.Telegram.VLD(d,b,0);b.setDstId(this._address);
c.sendTelegram(b,!0,function(c){a&&a(c)})};S.prototype.evalTelegram=function(c){var d={};if(210==c.rorg)switch(c.userData.readUInt8(c.userData.length-1)&15){case 4:if(4==c.userData.length){var a=c.userData.readUInt8(0);d.state=a&127;a=c.userData.readUInt8(1);d.angle=a&127;a=c.userData.readUInt8(2);switch(a&7){case 0:d.lock="normal";break;case 1:d.lock="blockage_mode";break;case 2:d.lock="alarm_mode"}a=c.userData.readUInt8(3);d.channel=a>>4&15}}return d};S.prototype.executeCommand=function(c,d,a){if(d&&
d.value){if("moveTo"==d.value.substr(0,6)&&6<d.value.length){var b=d.value.substr(6);d={value:"moveTo",ext:b}}else"lamellaTo"==d.value.substr(0,9)&&9<d.value.length?(b=d.value.substr(9),d={value:"lamellaTo",ext:b}):"setRunTime"==d.value.substr(0,10)&&10<d.value.length?(b=d.value.substr(10),d={value:"setRunTime",ext:b}):"setRotationTime"==d.value.substr(0,15)&&15<d.value.length?(b=d.value.substr(15),d={value:"setRotationTime",ext:b}):"setParams"==d.value.substr(0,9)&&9<d.value.length&&(b=d.value.substr(9),
d={value:"setParams",ext:b});var e=(new Date).getTime(),f=this;switch(d.value){case "moveUp":this.goToPositionAngle(c,{POS:0,ANG:0,REPO:0,LOCK:0,CHN:0},a);break;case "moveDown":this.goToPositionAngle(c,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:0},a);break;case "moveTo":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("move to value invalid"));break}b=parseFloat(d.ext);0>b&&(b=0);100<b&&(b=100);this._states.state={value:b,time:e};this.goToPositionAngle(c,{POS:b,ANG:255,REPO:0,LOCK:0,CHN:0},a);break;
case "stepUp":if(!this._states.state){this.init(function(){setTimeout(function(){f._states.state?f.executeCommand(c,d,a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){a&&a(Error("device status unknonw"));break}0!=this._states.angle.value?(b=this._states.angle.value-10,0>b&&(b=0),this._states.angle={value:b,time:e},this.goToPositionAngle(c,{POS:255,ANG:b,REPO:0,LOCK:0,CHN:0},a)):(b=this._states.state.value-5,0>b&&(b=0),this._states.state=
{value:b,time:e},this.goToPositionAngle(c,{POS:b,ANG:0,REPO:0,LOCK:0,CHN:0},a));break;case "stepDown":if(!this._states.state){this.init(function(){setTimeout(function(){f._states.state?f.executeCommand(c,d,a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){a&&a(Error("device status unknonw"));break}100!=this._states.angle.value?(b=this._states.angle.value+10,100<b&&(b=100),this._states.angle={value:b,time:e},this.goToPositionAngle(c,
{POS:255,ANG:b,REPO:0,LOCK:0,CHN:0},a)):(b=this._states.state.value+5,100<b&&(b=100),this._states.state={value:b,time:e},this.goToPositionAngle(c,{POS:b,ANG:100,REPO:0,LOCK:0,CHN:0},a));break;case "lamellaUp":this.goToPositionAngle(c,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:0},a);break;case "lamellaDown":this.goToPositionAngle(c,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:0},a);break;case "lamellaTo":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("lamella to value invalid"));break}b=parseFloat(d.ext);0>b&&
(b=0);100<b&&(b=100);this._states.angle={value:b,time:e};this.goToPositionAngle(c,{POS:255,ANG:b,REPO:0,LOCK:0,CHN:0},a);break;case "stop":this.stop(c,{CHN:0},a);break;case "setRunTime":if(!d.ext){a&&a(Error("parameters is null"));break}b=100*parseFloat(d.ext);499>=b&&(b=500);this.setParameters(c,{VERT:b,ROT:255,AA:7,CHN:0},a);break;case "setRotationTime":if(!d.ext){a&&a(Error("parameters is null"));break}b=32767;e=parseInt(d.ext)/10;this.setParameters(c,{VERT:b,ROT:e,AA:7,CHN:0},a);break;case "setParams":if(!d.ext){a&&
a(Error("parameters is null"));break}var g=d.ext.split(":");if(3!=g.length){a&&a(Error("parameters format invalid"));break}b=g[0]?100*parseFloat(g[0]):32767;499>=b&&(b=32767);e=g[1]?parseInt(g[1])/10:255;g=g[2]?parseInt(g[2]):7;this.setParameters(c,{VERT:b,ROT:e,AA:g,CHN:0},a);break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"))};var ta=function(c){S.call(this,c);this._data="d2-05-01";this._ch1QueryCount=0;this._ch1QueryTO=null;this._ch1QueryTimestamp=0};ta.COMMANDS="ch1moveUp ch1moveDown ch1moveTo ch1stepUp ch1stepDown ch1lamellaUp ch1lamellaDown ch1lamellaTo ch1stop ch2moveUp ch2moveDown ch2moveTo ch2stepUp ch2stepDown ch2lamellaUp ch2lamellaDown ch2lamellaTo ch2stop ch3moveUp ch3moveDown ch3moveTo ch3stepUp ch3stepDown ch3lamellaUp ch3lamellaDown ch3lamellaTo ch3stop ch4moveUp ch4moveDown ch4moveTo ch4stepUp ch4stepDown ch4lamellaUp ch4lamellaDown ch4lamellaTo ch4stop ch1setRunTime ch2setRunTime ch3setRunTime ch4setRunTime ch1setRotationTime ch2setRotationTime ch3setRotationTime ch4setRotationTime ch1setParams[15.2s]:[10,20,30ms]:[0-3] ch2setParams ch3setParams ch4setParams".split(" ");
ta.STATES="ch1state ch1angle ch1lock ch2state ch2angle ch2lock ch3state ch3angle ch3lock ch4state ch4angle ch4lock channel".split(" ");ta.prototype=new S;ta.prototype.constructor=ta;ta.prototype.init=function(c){this._queryStates([0,1,2,3],c)};ta.prototype.getStatesBuffer=function(){var c=[];this._states.ch1state||c.push(0);this._states.ch2state||c.push(1);this._states.ch3state||c.push(2);this._states.ch4state||c.push(3);0<c.length&&this._queryStates(c);return this._states};ta.prototype._queryStates=
function(c,d){var a=require("x.hub.m.enocean.js")._esp3,b=0,e=this,f=function(){b++;b<c.length?e.query(a,{CHN:c[b]},f):d&&d()};this.query(a,{CHN:c[b]},f)};ta.prototype.evalTelegram=function(c){if(c=S.prototype.evalTelegram.call(this,c))switch(c.channel){case 0:c.ch1state=c.state;c.ch1angle=c.angle;c.ch1lock=c.lock;break;case 1:c.ch2state=c.state;c.ch2angle=c.angle;c.ch2lock=c.lock;break;case 2:c.ch3state=c.state;c.ch3angle=c.angle;c.ch3lock=c.lock;break;case 3:c.ch4state=c.state,c.ch4angle=c.angle,
c.ch4lock=c.lock}return c};ta.prototype.executeCommand=function(c,d,a){if(d&&d.value){d=JSON.parse(JSON.stringify(d));var b=null;switch(d.value.substr(0,3)){case "ch1":b=0;var e="ch1state";var f="ch1angle";break;case "ch2":b=1;e="ch2state";f="ch2angle";break;case "ch3":b=2;e="ch3state";f="ch3angle";break;case "ch4":b=3;e="ch4state";f="ch4angle";break;default:a&&a(Error("unknown command"))}d.value=d.value.substr(3);if("moveTo"==d.value.substr(0,6)&&6<d.value.length){var g=d.value.substr(6);d={value:"moveTo",
ext:g}}else"lamellaTo"==d.value.substr(0,9)&&9<d.value.length?(g=d.value.substr(9),d={value:"lamellaTo",ext:g}):"setRunTime"==d.value.substr(0,10)&&10<d.value.length?(g=d.value.substr(10),d={value:"setRunTime",ext:g}):"setRotationTime"==d.value.substr(0,15)&&15<d.value.length?(g=d.value.substr(15),d={value:"setRotationTime",ext:g}):"setParams"==d.value.substr(0,9)&&9<d.value.length&&(g=d.value.substr(9),d={value:"setParams",ext:g});(new Date).getTime();var h=this;switch(d.value){case "moveUp":this.goToPositionAngle(c,
{POS:0,ANG:0,REPO:0,LOCK:0,CHN:b},a);break;case "moveDown":this.goToPositionAngle(c,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:b},a);break;case "moveTo":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("move to value invalid"));break}g=parseFloat(d.ext);0>g&&(g=0);100<g&&(g=100);var r={};r[e]=g;this.activeStateChange(r);this.goToPositionAngle(c,{POS:g,ANG:255,REPO:0,LOCK:0,CHN:b},a);break;case "stepUp":if(!this._states[e]){this.init(function(){setTimeout(function(){h._states[e]?h.executeCommand(c,d,
a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states[e].value||255==this._states[f].value){a&&a(Error("device status unknonw"));break}0!=this._states[f].value?(g=this._states[f].value-10,0>g&&(g=0),r={},r[f]=g,this.activeStateChange(r),this.goToPositionAngle(c,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:b},a)):(g=this._states[e].value-5,0>g&&(g=0),r={},r[e]=g,this.activeStateChange(r),this.goToPositionAngle(c,{POS:g,ANG:0,REPO:0,LOCK:0,CHN:b},a));break;case "stepDown":if(!this._states[e]){this.init(function(){setTimeout(function(){h._states[e]?
h.executeCommand(c,d,a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states[e].value||255==this._states[f].value){a&&a(Error("device status unknonw"));break}100!=this._states[f].value?(g=this._states[f].value+10,100<g&&(g=100),r={},r[f]=g,this.activeStateChange(r),this.goToPositionAngle(c,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:b},a)):(g=this._states[e].value+5,100<g&&(g=100),r={},r[e]=g,this.activeStateChange(r),this.goToPositionAngle(c,{POS:g,ANG:100,REPO:0,LOCK:0,CHN:b},a));break;
case "lamellaUp":this.goToPositionAngle(c,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:b},a);break;case "lamellaDown":this.goToPositionAngle(c,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:b},a);break;case "lamellaTo":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("lamella to value invalid"));break}g=parseFloat(d.ext);0>g&&(g=0);100<g&&(g=100);r={};r[f]=g;this.goToPositionAngle(c,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:b},a);break;case "stop":this.stop(c,{CHN:b},a);break;case "setRunTime":if(!d.ext){a&&a(Error("parameters is null"));
break}f=100*parseFloat(d.ext);499>=f&&(f=500);this.setParameters(c,{VERT:f,ROT:255,AA:7,CHN:b},a);break;case "setRotationTime":if(!d.ext){a&&a(Error("parameters is null"));break}f=32767;r=parseInt(d.ext)/10;this.setParameters(c,{VERT:f,ROT:r,AA:7,CHN:b},a);break;case "setParams":if(!d.ext){a&&a(Error("parameters is null"));break}g=d.ext.split(":");if(3!=g.length){a&&a(Error("parameters format invalid"));break}f=g[0]?100*parseFloat(g[0]):32767;499>=f&&(f=32767);r=g[1]?parseInt(g[1])/10:255;g=g[2]?
parseInt(g[2]):7;this.setParameters(c,{VERT:f,ROT:r,AA:g,CHN:b},a);break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"))};var Ac=function(c){fa.call(this,c);this._data="d2-06-??"};Ac.prototype=new fa;Ac.prototype.constructor=Ac;var za=function(c){fa.call(this,c);this._data="d2-06-01";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbir_new=this._suir_new=this._blcr_new=this._hccr_new=this._vacation_new=null};za.COMMANDS="vacationOn vacationOff handleClosedClickOn handleClosedClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
za.STATES="bal ppal state handle window br bl motion vacation temperature humidity illumination battery hccr blcr suir vbir".split(" ");za.prototype=new Ac;za.prototype.constructor=za;za.prototype.executeCommand=function(c,d,a){c=(new Date).getTime();if(d&&d.value){"setSensorUpdateInterval"==d.value.substr(0,23)&&23<d.value.length?(d=d.value.substr(23),d={value:"setSensorUpdateInterval",ext:d}):"setVacationBlinkInterval"==d.value.substr(0,24)&&24<d.value.length&&(d=d.value.substr(24),d={value:"setVacationBlinkInterval",
ext:d});switch(d.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({vacation:"off"});break;case "handleClosedClickOn":this._hccr_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({hccr:"on"});break;case "handleClosedClickOff":this._hccr_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcr_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcr_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set sensor update interval value invalid"));return}d=parseInt(d.ext);5>d&&(d=5);65535<d&&(d=65535);this._suir_new=d;this._states.pending={value:!0,time:c};
this.activeStateChange({suir:d});break;case "setVacationBlinkInterval":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set vacation blink interval value invalid"));return}d=parseInt(d.ext);3>d&&(d=3);255<d&&(d=255);this._vbir_new=d;this._states.pending={value:!0,time:c};this.activeStateChange({vbir:d})}a&&a()}else a&&a(Error("command invalid"))};za.prototype.evalData=function(c,d,a){var b=this.evalTelegram(d);this._vacation_new&&delete b.vacation;this._hccr_new&&delete b.hccr;this._blcr_new&&
delete b.blcr;this._suir_new&&delete b.suir;this._vbir_new&&delete b.vbir;210==d.rorg&&0==d.userData.readUInt8(0)&&this._sendResponse(c);b?(c=this.checkStateChange(b),a&&a(null,c)):a&&a(Error("data format invalid"))};za.prototype.evalTelegram=function(c){var d={};if(210==c.rorg)switch(c.userData.readUInt8(0)){case 0:var a=c.userData.readUInt8(1);var b=c.userData.readUInt8(2);var e=c.userData.readUInt8(3);var f=c.userData.readUInt8(4);var g=c.userData.readUInt8(5);var h=c.userData.readUInt8(6);var k=
c.userData.readUInt16BE(7);c=c.userData.readUInt8(9);c=c>>3&31;switch(a>>4&15){case 0:d.bal="ok";break;case 1:d.bal="alarm";break;case 14:d.bal="invalid";break;case 15:d.bal="unsupported"}switch(a&15){case 0:d.ppal="ok";break;case 1:d.ppal="alarm";break;case 14:d.ppal="invalid";break;case 15:d.ppal="unsupported"}switch(b>>4&15){case 0:d.handle="undefined";break;case 1:d.handle="up";break;case 2:d.handle="down";break;case 3:d.handle="left";break;case 4:d.handle="right";break;case 14:d.handle="invalid";
break;case 15:d.handle="unsupported"}switch(b&15){case 0:d.window="undefined";break;case 1:d.window="not_tilted";break;case 2:d.window="tilted";break;case 14:d.window="invalid";break;case 15:d.window="unsupported"}switch(e>>4&15){case 0:d.br="unchanged";break;case 1:d.br="pressed";break;case 2:d.br="releaseed";break;case 14:d.br="invalid";break;case 15:d.br="unsupported"}switch(e&15){case 0:d.bl="unchanged";break;case 1:d.bl="pressed";break;case 2:d.bl="releaseed";break;case 14:d.bl="invalid";break;
case 15:d.bl="unsupported"}switch(f>>4&15){case 0:d.motion="ok";break;case 1:d.motion="alarm";break;case 14:d.motion="invalid";break;case 15:d.motion="unsupported"}switch(f&15){case 0:d.vacation="unchanged";break;case 1:d.vacation="on";break;case 2:d.vacation="off";break;case 14:d.vacation="invalid";break;case 15:d.vacation="unsupported"}254==g?d.temperature="invalid":255==g?d.temperature="unsupported":250>=g&&(d.temperature=parseFloat((g/250*80-20).toFixed(2)));254==h?d.humidity="invalid":255==h?
d.humidity="unsupported":200>=h&&(d.humidity=parseFloat((h/2).toFixed(1)));65534==k?d.illumination="invalid":65535==k?d.illumination="unsupported":60001==k?d.illumination="over_range":6E4>=k&&(d.illumination=k);20>=c&&(d.battery=5*c);if("undefined"==d.window||"invalid"==d.window||"unsupported"==d.window||"not_tilted"==d.window)switch(d.handle){case "undefined":d.state="undefined";break;case "up":d.state="tilted";break;case "down":d.state="closed";break;case "left":d.state="open";break;case "right":d.state=
"open";break;case "invalid":d.state="invalid";break;case "unsupported":d.state="undefined"}else"tilted"==d.window&&(d.state="tilted");break;case 16:h=c.userData.readUInt8(1),k=c.userData.readUInt16BE(2),c=c.userData.readUInt8(4),a=k,b=c,d.vacation=h>>7&1?"on":"off",d.hccr=h>>6&1?"on":"off",d.blcr=h>>5&1?"on":"off",5<=a&&(d.suir=a),3<=b&&(d.vbir=b)}return d};za.prototype._sendResponse=function(c,d){var a=0;this._vacation_new&&"on"==this._vacation_new&&(a=1);var b=0;this._hccr_new&&"off"==this._hccr_new?
b=1:this._hccr_new&&"on"==this._hccr_new&&(b=2);var e=0;this._blcr_new&&"off"==this._blcr_new?e=1:this._blcr_new&&"on"==this._blcr_new&&(e=2);var f=0;this._suir_new&&(f=this._suir_new);var g=0;this._vbir_new&&(g=this._vbir_new);var h=new Buffer([128,128|(a&1)<<5|(b&3)<<3|(e&3)<<1,f>>8&255,f&255,g]),k=this._senderID;k||(k=x.hub.m.enocean.SENDER_ID);h=new x.hub.m.enocean.ESP3.Telegram.VLD(h,k,0);var l=this;c.sendTelegram(h,!0,function(c){l._vacation_new=null;l._hccr_new=null;l._blcr_new=null;l._suir_new=
null;l._vbir_new=null;var h={pending:!1};h.vacation=a?"on":"off";b&&(h.hccr=1==b?"off":"on");e&&(h.blcr=1==e?"off":"on");f&&(h.suir=f);g&&(h.vbir=g);l.activeStateChange(h);d&&d(c)})};var Aa=function(c){fa.call(this,c);this._data="d2-06-02";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbis_new=this._suis_new=this._blcs_new=this._lacs_new=this._vacation_new=null};Aa.COMMANDS="vacationOn vacationOff lockActiveClickOn lockActiveClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
Aa.STATES="operation_mode handle window state temperature humidity battery vacation hccr blcr suir vbir".split(" ");Aa.prototype=new Ac;Aa.prototype.constructor=Aa;Aa.prototype.executeCommand=function(c,d,a){c=(new Date).getTime();if(d&&d.value){"setSensorUpdateInterval"==d.value.substr(0,23)&&23<d.value.length?(d=d.value.substr(23),d={value:"setSensorUpdateInterval",ext:d}):"setVacationBlinkInterval"==d.value.substr(0,24)&&24<d.value.length&&(d=d.value.substr(24),d={value:"setVacationBlinkInterval",
ext:d});switch(d.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({vacation:"off"});break;case "lockActiveClickOn":this._lacs_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({hccr:"on"});break;case "lockActiveClickOff":this._lacs_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcs_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcs_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set sensor update interval value invalid"));return}d=parseInt(d.ext);5>d&&(d=5);65535<d&&(d=65535);this._suis_new=d;this._states.pending={value:!0,time:c};
this.activeStateChange({suir:d});break;case "setVacationBlinkInterval":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set vacation blink interval value invalid"));return}d=parseInt(d.ext);3>d&&(d=3);255<d&&(d=255);this._vbis_new=d;this._states.pending={value:!0,time:c};this.activeStateChange({vbir:d})}a&&a()}else a&&a(Error("command invalid"))};Aa.prototype.evalData=function(c,d,a){var b=this.evalTelegram(d);this._vacation_new&&delete b.vacation;this._lacs_new&&delete b.hccr;this._blcs_new&&
delete b.blcr;this._suis_new&&delete b.suir;this._vbis_new&&delete b.vbir;210==d.rorg&&0==d.userData.readUInt8(0)&&this._sendResponse(c);b?(c=this.checkStateChange(b),a&&a(null,c)):a&&a(Error("data format invalid"))};Aa.prototype.evalTelegram=function(c){var d={};if(210==c.rorg)switch(c.userData.readUInt8(0)){case 0:var a=c.userData.readUInt8(1);var b=c.userData.readUInt8(2);var e=c.userData.readUInt8(3);c=c.userData.readUInt8(4);c=c>>3&31;switch(a>>6&3){case 0:d.operation_mode="standard";break;case 1:d.operation_mode=
"hst"}switch(a>>4&3){case 0:d.lock="unlocked";break;case 1:d.lock="locked"}switch(a>>2&3){case 0:d.window="not_tilted";break;case 1:d.window="tilted"}switch(a&3){case 0:d.alarm="ok";break;case 1:d.alarm="burglary_alarm";break;case 2:d.alarm="unlock_alarm"}254==b?d.temperature="invalid":255==b?d.temperature="unsupported":250>=b&&(d.temperature=parseFloat((b/250*80-20).toFixed(2)));254==e?d.humidity="invalid":255==e?d.humidity="unsupported":200>=e&&(d.humidity=parseFloat((e/2).toFixed(1)));20>=c&&(d.battery=
5*c);if("tilted"==d.window)d.state="tilted";else switch(d.lock){case "unlocked":d.state="open";break;case "locked":d.state="closed"}break;case 16:a=c.userData.readUInt8(1),b=c.userData.readUInt16BE(2),e=c=c.userData.readUInt8(4),d.vacation=a>>7&1?"on":"off",d.hccr=a>>6&1?"on":"off",d.blcr=a>>5&1?"on":"off",5<=b&&(d.suir=b),3<=e&&(d.vbir=e)}return d};Aa.prototype._sendResponse=function(c,a){var d=0;this._vacation_new&&"on"==this._vacation_new?d=1:this._vacation_new&&"off"==this._vacation_new&&(d=2);
var b=0;this._lacs_new&&"off"==this._lacs_new?b=1:this._lacs_new&&"on"==this._lacs_new&&(b=2);var e=0;this._blcs_new&&"off"==this._blcs_new?e=1:this._blcs_new&&"on"==this._blcs_new&&(e=2);var f=0;this._suis_new&&(f=this._suis_new);var g=0;this._vbis_new&&(g=this._vbis_new);var h=new Buffer([128,128|(d&3)<<4|(b&3)<<2|e&3,f>>8&255,f&255,g]),k=this._senderID;k||(k=x.hub.m.enocean.SENDER_ID);h=new x.hub.m.enocean.ESP3.Telegram.VLD(h,k,0);var l=this;c.sendTelegram(h,!0,function(c){l._vacation_new=null;
l._lacs_new=null;l._blcs_new=null;l._suis_new=null;l._vbis_new=null;var h={pending:!1};h.vacation=d?"on":"off";b&&(h.hccr=1==b?"off":"on");e&&(h.blcr=1==e?"off":"on");f&&(h.suir=f);g&&(h.vbir=g);l.activeStateChange(h);a&&a(c)})};var Bc=function(c){fa.call(this,c);this._data="d2-20-??"};Bc.prototype=new fa;Bc.prototype.constructor=Bc;var ba=function(c){Bc.call(this,c);this._data="d2-20-00";this._poller=null;this._pollInterval=6E4};ba.COMMANDS="setFanLevel fanLevelUp fanLevelDown requestStatus setHumLevel setCo2Level".split(" ");
ba.STATES="filter_remaining_time operating_time temperature message_code anti_freeze current_fan_level set_fan_level".split(" ");ba.prototype=new Bc;ba.prototype.constructor=ba;ba.prototype.init=function(c){var a=this;setTimeout(function(){var d=require("x.hub.m.enocean.js")._esp3;a.executeCommand(d,{value:"requestStatus"},c);a._restartPoller(d)},Math.floor(6E3*Math.random())+1E3)};ba.prototype.finalize=function(c){this._poller&&clearInterval(this._poller);c&&c()};ba.prototype._restartPoller=function(c){this._poller&&
clearInterval(this._poller);var a=this;this._poller=setInterval(function(){a.executeCommand(c,{value:"requestStatus"})},this._pollInterval)};ba.prototype.executeCommand=function(c,a,b){(new Date).getTime();if(a&&a.value){if("setFanLevel"==a.value.substr(0,11)&&11<a.value.length)a=a.value.substr(11),a={value:"setFanLevel",ext:a};else if("fanLevelUp"==a.value){var d=this.getBufferedState("set_fan_level");if("undefined"==typeof d||null==d){b&&b(Error("fanLevelUp unknown current fan level"));return}if(6==
d){b&&b();return}a={value:"setFanLevel",ext:d+1}}else if("fanLevelDown"==a.value){d=this.getBufferedState("set_fan_level");if("undefined"==typeof d||null==d){b&&b(Error("fanLevelUp unknown current fan level"));return}if(0==d){b&&b();return}a={value:"setFanLevel",ext:d-1}}else if("setHumLevel"==a.value.substr(0,11)&&11<a.value.length){d=this.getBufferedState("set_fan_level");if(5!=d){b&&b(Error("humidity regulation not active"));return}a=a.value.substr(11);a={value:"setHumLevel",ext:a}}else if("setCo2Level"==
a.value.substr(0,11)&&11<a.value.length){d=this.getBufferedState("set_fan_level");if(6!=d){b&&b(Error("co2 regulation not active"));return}a=a.value.substr(11);a={value:"setCo2Level",ext:a}}var e=this;switch(a.value){case "setFanLevel":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("setFanLevel value invalid"));break}var f=parseInt(a.ext);if(0>f||6<f){b&&b(Error("setFanLevel value invalid"));break}if(5==f||6==f){this.activeStateChange({set_fan_level:f});this._activateSensorRegulation(f);b&&
b();break}this._deactivateSensorRegulation();this._sendResponse(c,{LS:f,RS:1},function(a){a||e.activeStateChange({set_fan_level:f});e._restartPoller(c);b&&b(a)});break;case "setHumLevel":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("setHumLevel value invalid"));break}f=parseInt(a.ext);if(0>f||4<f){b&&b(Error("setHumLevel value invalid"));break}this._sendResponse(c,{LS:f,RS:1},function(a){e._restartPoller(c);b&&b(a)});break;case "setCo2Level":if("undefined"==typeof a.ext||null==a.ext){b&&
b(Error("setCo2Level value invalid"));break}f=parseInt(a.ext);if(0>f||4<f){b&&b(Error("setCo2Level value invalid"));break}this._sendResponse(c,{LS:f,RS:1},function(a){e._restartPoller(c);b&&b(a)});break;case "requestStatus":this._sendResponse(c,{LS:5,RS:1},function(c){b&&b(c)});break;default:b&&b(Error("unknown command"))}}else b&&b(Error("command invalid"))};ba.prototype.evalData=function(c,a,b){c=this.evalTelegram(a);this._states&&this._states.set_fan_level||(c.set_fan_level=c.current_fan_level);
this._states&&this._states.set_fan_level&&5!=this._states.set_fan_level.value&&6!=this._states.set_fan_level.value&&(c.set_fan_level=c.current_fan_level);c=this.checkStateChange(c);b&&b(null,c)};ba.prototype.evalTelegram=function(c){var a={};if(210==c.rorg)if(1==c.userData.length){var b=c.userData.readUInt8(0)&7;a.current_fan_level=b}else{b=c.userData.readUInt8(0);var e=c.userData.readUInt8(1),f=c.userData.readUInt16LE(2),g=c.userData.readUInt8(4),h=c.userData.readUInt8(5),k=c.userData.readUInt8(6),
l=c.userData.readUInt16LE(7),p=c.userData.readUInt8(9),q=c.userData.readUInt8(10),ha=c.userData.readInt16BE(11);c=c.userData.readUInt8(13);a.filter_remaining_time=g+":"+f+":"+e+":"+b;a.operating_time=p+":"+l+":"+k+":"+h;a.temperature=ha/10;a.message_code=q;a.anti_freeze=c>>4&1?"on":"off";a.current_fan_level=c&7}return a};ba.prototype._sendResponse=function(c,a,b){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);a=new Buffer([a.LS,a.RS]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(a,
d,0);this._senderID!=this._address&&d.setDstId(this._address);c.sendTelegram(d,!0,function(c){b&&b(c)})};ba.prototype._activateSensorRegulation=function(c){var a=require("x.hub.m.enocean.js").getRehauHandler();a&&a.activateSensorRegulation(this.getAddress(),c)};ba.prototype._deactivateSensorRegulation=function(){var c=require("x.hub.m.enocean.js").getRehauHandler();c&&c.deactivateSensorRegulation(this.getAddress())};var Pb=function(c){O.call(this,c);this._data="eltako_contact";this._vendor="eltako";
this._eepAlias="f6-10-00"};Pb.STATES=["contact","contact_raw"];Pb.prototype=new O;Pb.prototype.constructor=Pb;Pb.prototype.evalTelegram=function(c){var a={};246==c.rorg&&(c=c.userData,240==c?a.contact="closed":224==c&&(a.contact="open"),a.contact_raw=c);return a};var Ma=function(c){Va.call(this,c);this._data="eltako_motion";this._vendor="eltako";this._eepAlias="a5-08-01"};Ma.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");Ma.prototype=new Va;Ma.prototype.constructor=
Ma;Ma.prototype.evalTelegram=function(c){var a={};if(165==c.rorg){var b=c.userData.readUInt8(3);c.userData.readUInt8(2);var e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(b>>3&1)){a.voltage=parseFloat((c/255*5.1).toFixed(1));a.voltage_raw=c;a.illumination=parseFloat((e/255*2048).toFixed(1));a.illumination_raw=e;b=b>>1&1;switch(b){case 0:a.state="on";break;case 1:a.state="off"}a.state_raw=b}}return a};var ka=function(c){H.call(this,c);this._data="eltako_switch";this._vendor="eltako";this._eepAlias=
"f6-02-01"};ka.COMMANDS=["on","off","toggle"];ka.STATES=["state"];ka.prototype=new H;ka.prototype.constructor=ka;ka.prototype.getTeachinType=function(){return"4BS"};ka.prototype.handleLearnTelegram=function(c,a){if(a&&246==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:c._learnAddress,senderID:c._learnSenderID,data:c._learnProfile,vendor:c._learnVendor},{address:a.senderID,senderID:c._learnSenderID,data:this._data,vendor:this._vendor},function(a,d){c._learnFinish(a,0,d)})};
ka.prototype.getTeachinTelegram=function(c,a,b){c=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(c,a,0)};ka.prototype.evalTelegram=function(c){var a={};if(246==c.rorg)switch(c.userData){case 112:a.state="on";break;case 80:a.state="off"}return a};ka.prototype.executeCommand=function(c,a,b){if(a&&a.value)switch((new Date).getTime(),a.value){case "on":this.switching(c,{TIM:0,LCK:0,DEL:0,SW:1},function(c){b&&b(c)});break;case "off":this.switching(c,{TIM:0,LCK:0,DEL:0,SW:0},function(c){b&&
b(c)});break;case "toggle":if(!this._states.state){b&&b(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(c,{value:"off"},b):this.executeCommand(c,{value:"on"},b);break;default:b&&b(Error("unknow command"))}else b&&b(Error("command invalid"))};var Oc=function(){var c=function(c){ka.call(this,c);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_switch"};c.prototype=new ka;c.prototype.constructor=c;c.prototype.handleTeachinTelegram=function(c,a){if(a&&165==
a.rorg&&a.userData){var d=a.userData.toString("hex"),b=c._teachSenderID;if(d&&b&&b.substr(2)==d.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:c._teachID,senderID:c._teachSenderID,data:c._teachProfile,vendor:c._teachVendor},{address:a.senderID,senderID:c._teachSenderID,data:c._teachProfile,vendor:c._teachVendor},function(a,d){c._teachFinish(a,d)})}};return c}(),G=function(c){H.call(this,c);this._data="eltako_dimmer";this._vendor="eltako";this._eepAlias="a5-38-08";
this._lastOnLevel=-1};G.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");G.STATES=["state","level","ramp_time"];G.prototype=new H;G.prototype.constructor=G;G.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.ramp_time||null==this._params.ramp_time)this._params.ramp_time=0};G.prototype.handleLearnTelegram=function(c,a){if(a&&165==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:c._learnAddress,
senderID:c._learnSenderID,data:c._learnProfile,vendor:c._learnVendor},{address:a.senderID,senderID:c._learnSenderID,data:this._data,vendor:this._vendor},function(a,d){c._learnFinish(a,0,d)})};G.prototype.getTeachinTelegram=function(c,a,b){c=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(c,a,0)};G.prototype.getStatesBuffer=function(){var c=JSON.parse(JSON.stringify(this._states));c.ramp_time={value:this._params.ramp_time,time:-1};return c};G.prototype.getCurrentStates=function(){var c=
{},a=this.getStatesBuffer();a.level&&0==a.level.value&&a.state&&(a.state.value="off");a.state&&"off"==a.state.value&&a.level&&(a.level.value=0);for(var b in a)a.hasOwnProperty(b)&&a[b]&&(c[b]=a[b].value);return c};G.prototype.evalData=function(c,a,b){(c=this.evalTelegram(a))?(0==c.level&&(c.state="off"),"off"==c.state&&(c.level=0),(0==c.level||"off"==c.state)&&this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value),c=this.checkStateChange(c),b&&b(null,c)):b&&b(Error("data format invalid"))};
G.prototype.evalTelegram=function(c){var a={};if(165==c.rorg){var b=c.userData.readUInt8(3),e=c.userData.readUInt8(2),f=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(b>>3&1))switch(c){case 2:a.level=f,a.ramp=e,a.dim_range=b>>2&1?"relative":"absolute",a.store_final_value=b>>1&1,a.state=b&1?"on":"off"}}return a};G.prototype.executeCommand=function(c,a,b){if(a&&a.value){if("dimTo"==a.value.substr(0,5)&&5<a.value.length){var d=a.value.substr(5);a={value:"dimTo",ext:d}}else"toggleTo"==a.value.substr(0,
8)&&8<a.value.length?(d=a.value.substr(8),a={value:"toggleTo",ext:d}):"setRampTime"==a.value.substr(0,11)&&11<a.value.length&&(d=a.value.substr(11),a={value:"setRampTime",ext:d});(new Date).getTime();var e=this;switch(a.value){case "on":d=this._lastOnLevel;if(-1==d||0==d)d=100;this.dimming(c,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(c){c||e.activeStateChange({level:d,state:"on"});b&&b(c)});break;case "off":this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value);
this.dimming(c,{EDIM:0,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:0},function(c){c||e.activeStateChange({level:0,state:"off"});b&&b(c)});break;case "toggle":if(!this._states.state){b&&b(Error("unknow previous dimmer state"));break}"on"==this._states.state.value?this.executeCommand(c,{value:"off"},b):this.executeCommand(c,{value:"on"},b);break;case "toggleTo":if(!this._states.state){b&&b(Error("unknow previous dimmer state"));break}"on"==this._states.state.value?this.executeCommand(c,{value:"off"},
b):this.executeCommand(c,{value:"dimTo",ext:a.ext},b);break;case "dimTo":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("dim to value invalid"));break}d=parseFloat(a.ext);0>d&&(d=0);100<d&&(d=100);if(0==d){this.executeCommand(c,{value:"off"},b);break}this.dimming(c,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(c){c||e.activeStateChange({level:d,state:"on"});b&&b(c)});break;case "dimUp":if(!this._states.level){b&&b(Error("unknow previous dimmer level"));break}d=parseInt(this._states.level.value);
d+=5;100<d&&(d=100);this.dimming(c,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(c){c||e.activeStateChange({level:d,state:"on"});b&&b(c)});break;case "dimDown":if(!this._states.level){b&&b(Error("unknow previous dimmer level"));break}d=parseInt(this._states.level.value);d-=5;0>d&&(d=0);if(0==d){this.executeCommand(c,{value:"off"},b);break}this.dimming(c,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(c){c||e.activeStateChange({level:d,state:"on"});b&&b(c)});break;
case "setRampTime":if(!a.ext){b&&b(Error("parameters is null"));break}d=parseInt(d);255<d&&(d=255);0>d&&(d=0);this._params.ramp_time=d;require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated(this,function(c){b&&b(c)});break;default:b&&b(Error("unknow command"))}}else b&&b(Error("command invalid"))};var Qc=function(){var c=function(c){G.call(this,c);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_dimmer"};c.prototype=new G;c.prototype.constructor=c;c.prototype.handleTeachinTelegram=function(c,
a){if(a&&165==a.rorg&&a.userData){var d=a.userData.toString("hex"),b=c._teachSenderID;if(d&&b&&b.substr(2)==d.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:c._teachID,senderID:c._teachSenderID,data:c._teachProfile,vendor:c._teachVendor},{address:a.senderID,senderID:c._teachSenderID,data:c._teachProfile,vendor:c._teachVendor},function(a,d){c._teachFinish(a,d)})}};return c}(),$a=function(c){G.call(this,c);this._data="eltako_dimmer2";this._vendor="eltako";this._eepAlias=
"f6-02-01"};$a.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");$a.STATES=["state","ramp_time"];$a.prototype=new G;$a.prototype.constructor=G;$a.prototype.handleLearnTelegram=function(c,a){if(a&&246==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:c._learnAddress,senderID:c._learnSenderID,data:c._learnProfile,vendor:c._learnVendor},{address:a.senderID,senderID:c._learnSenderID,data:this._data,vendor:this._vendor},function(a,d){c._learnFinish(a,
0,d)})};$a.prototype.evalTelegram=function(c){var a={};if(246==c.rorg)switch(c.userData){case 112:a.state="on";break;case 80:a.state="off"}return a};var Qb=function(c){G.call(this,c);this._data="eltako_fsud"};Qb.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");Qb.STATES=["state","ramp_time"];Qb.prototype=new G;Qb.prototype.constructor=G;Qb.prototype.getTeachinTelegram=function(c,a,b){c=new Buffer([2,0,0,0]);return new x.hub.m.enocean.ESP3.Telegram.BS4(c,a,0)};var T=function(c){yc.call(this,
c);this._data="eltako_blind";this._vendor="eltako";this._eepAlias="f6-02-01";this._syncRunning=!1;this._syncCB=this._syncTO=null};T.COMMANDS="up down stop stepUp stepDown setRV setRunTime moveTo sync".split(" ");T.STATES=["pos","sync"];T.prototype=new yc;T.prototype.constructor=T;T.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.rv||null==this._params.rv)this._params.rv=200;if("undefined"==typeof this._params.rt||null==this._params.rt)this._params.rt=
200};T.prototype.handleLearnTelegram=function(c,a){if(a&&246==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:c._learnAddress,senderID:c._learnSenderID,data:c._learnProfile,vendor:c._learnVendor},{address:a.senderID,senderID:c._learnSenderID,data:this._data,vendor:this._vendor},function(a,d){c._learnFinish(a,0,d)})};T.prototype.getTeachinTelegram=function(c,a,b){c=new Buffer([255,248,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(c,a,0)};T.prototype.getStatesBuffer=
function(){var c=JSON.parse(JSON.stringify(this._states));c.sync||(c.sync={value:!1,time:-1});c.rv={value:this._params.rv,time:-1};c.rt={value:this._params.rt,time:-1};return c};T.prototype.evalData=function(c,a,b){(c=this.evalTelegram(a))?(a=this.checkStateChange(c),c.sync&&this._syncRunning&&(this._syncRunning=!1,this._syncTO&&(clearTimeout(this._syncTO),this._syncTO=null),this._syncCB&&(this._syncCB(),this._syncCB=null)),b&&b(null,a)):b&&b(Error("data format invalid"))};T.prototype.evalTelegram=
function(c){var a={};if(246==c.rorg)switch(c.userData){case 112:a.sync=!0;a.pos=0;break;case 80:a.sync=!0,a.pos=100}else if(165==c.rorg){var b=c.userData.readUInt16BE(0);c=c.userData.readUInt8(2);var e=this._params.rt;e||(e=200);var f=this._states.pos?this._states.pos.value:null;f||(f=0);if("undefined"!=typeof f&&null!=f)switch(b=10*b/e,c){case 1:a.pos=Math.max(0,Math.round(f-b));break;case 2:a.pos=Math.min(100,Math.round(f+b))}}return a};T.prototype.executeCommand=function(c,a,b){if(a&&a.value){if("stepUp"==
a.value.substr(0,6)&&6<a.value.length){var d=a.value.substr(6);a={value:"stepUp",ext:d}}else"stepDown"==a.value.substr(0,8)&&8<a.value.length?(d=a.value.substr(8),a={value:"stepDown",ext:d}):"setRV"==a.value.substr(0,5)&&5<a.value.length?(d=a.value.substr(5),a={value:"setRV",ext:d}):"setRunTime"==a.value.substr(0,10)&&10<a.value.length?(d=a.value.substr(10),a={value:"setRunTime",ext:d}):"moveTo"==a.value.substr(0,6)&&6<a.value.length&&(d=a.value.substr(6),a={value:"moveTo",ext:d});(new Date).getTime();
var e=this._params.rv;e||(e=200);var f=this._params.rt;f||(f=200);switch(a.value){case "up":this.doReq(c,{TIME:e,CMD:1,LCK:0,TYPE:0},function(c){b&&b(c)});break;case "down":this.doReq(c,{TIME:e,CMD:2,LCK:0,TYPE:0},function(c){b&&b(c)});break;case "stop":this.doReq(c,{TIME:0,CMD:0,LCK:0,TYPE:0},function(c){b&&b(c)});break;case "stepUp":f="undefined"==typeof a.ext||null==a.ext?f/100:parseFloat(a.ext)/100*f;1>f&&(f=1);this.doReq(c,{TIME:f,CMD:1,LCK:0,TYPE:0},function(c){b&&b(c)});break;case "stepDown":f=
"undefined"==typeof a.ext||null==a.ext?f/100:parseFloat(a.ext)/100*f;1>f&&(f=1);this.doReq(c,{TIME:f,CMD:2,LCK:0,TYPE:0},function(c){b&&b(c)});break;case "moveTo":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("value invalid"));break}a=parseInt(a.ext);d=0;this._states&&this._states.pos&&"undefined"!=typeof this._states.pos.value&&null!=this._states.pos.value&&(d=this._states.pos.value);f*=(a-d)/100;if(0<f)var g=2;else if(0>f)f=0-f,g=1;else if(0==f){b&&b();break}this.doReq(c,{TIME:f,CMD:g,LCK:0,
TYPE:1},function(c){b&&b(c)});break;case "sync":this.snyc(c,function(c){b&&b(c)});break;case "setRV":if(!a.ext){b&&b(Error("parameters is null"));break}d=parseInt(d);200<d&&(d=200);0>d&&(d=0);this._params.rv=d;c=require("x.hub.m.enocean.js")._deviceHandler;c.deviceParamsUpdated(this,function(c){b&&b(c)});break;case "setRunTime":if(!a.ext){b&&b(Error("parameters is null"));break}d=parseInt(d);200<d&&(d=200);0>d&&(d=0);this._params.rt=d;c=require("x.hub.m.enocean.js")._deviceHandler;c.deviceParamsUpdated(this,
function(c){b&&b(c)});break;default:b&&b(Error("unknow command"))}}else b&&b(Error("command invalid"))};T.prototype.snyc=function(c,a){if(this._syncRunning)a&&a(Error("sync running"));else{var d=this,b=this._params.rv;b||(b=200);this._syncRunning=!0;this._syncTO=setTimeout(function(){d._syncRunning=!1;d._syncTO=null;d._states.pos={value:0,time:(new Date).getTime()}},1E3*(b+2));this.doReq(c,{TIME:b,CMD:1,LCK:0,TYPE:0},function(c){a&&a(c)})}};T.prototype.doReq=function(c,a,b){var d=this._senderID;this._senderID||
(d=x.hub.m.enocean.SENDER_ID);if(a.TYPE){var e=Math.round(10*a.TIME)>>8&255;var f=Math.round(10*a.TIME)&255}else e=0,f=Math.round(a.TIME)&255;a=new Buffer([e,f,a.CMD,8|(a.LCK&1)<<2|(a.TYPE&1)<<1]);d=new x.hub.m.enocean.ESP3.Telegram.BS4(a,d,0);d.setDstId(this._address);c.sendTelegram(d,!0,function(c){b&&b(c)})};var Rc=function(){var c=function(c){T.call(this,c);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_blind"};c.prototype=new T;c.prototype.constructor=c;c.prototype.handleTeachinTelegram=function(c,
a){if(a&&165==a.rorg&&a.userData){var d=a.userData.toString("hex"),b=c._teachSenderID;if(d&&b&&b.substr(2)==d.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:c._teachID,senderID:c._teachSenderID,data:c._teachProfile,vendor:c._teachVendor},{address:a.senderID,senderID:c._teachSenderID,data:c._teachProfile,vendor:c._teachVendor},function(a,d){c._teachFinish(a,d)})}};return c}(),Rb=function(c){Ra.call(this,c);this._data="eltako_weather";this._vendor="eltako";this._eepAlias=
"a5-04-02";this._engMax=7.2;this._engMin=0};Rb.STATES="energy energy_raw humidity humidity_raw temperature temperature_raw available".split(" ");Rb.prototype=new Ra;Rb.prototype.constructor=Rb;Rb.prototype.evalTelegram=function(c){var a={};if(165==c.rorg){var b=c.userData.readUInt8(3),e=c.userData.readUInt8(2),f=c.userData.readUInt8(1);c=c.userData.readUInt8(0);1==(b>>3&1)&&(a.energy=parseFloat((c/250*(this._engMax-this._engMin)+this._engMin).toFixed(1)),a.energy_raw=c,a.humidity=parseFloat((f/250*
(this._humMax-this._humMin)+this._humMin).toFixed(1)),a.humidity_raw=f,a.temperature=parseFloat((e/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),a.temperature_raw=e,a.available=b>>1&1?!0:!1)}return a};var Na=function(c){Sa.call(this,c);this._data="eltako_lux";this._vendor="eltako";this._eepAlias="a5-06-01";this._ill1Max=3E4;this._ill1Min=300};Na.STATES="illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw".split(" ");Na.prototype=new Sa;Na.prototype.constructor=
Na;Na.prototype.evalTelegram=function(c){var a={};if(165==c.rorg){var b=c.userData.readUInt8(3);c.userData.readUInt8(2);var e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);1==(b>>3&1)&&(a.illumination2=c,a.illumination2_raw=c,a.illumination1=parseFloat((e/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1)),a.illumination1_raw=e,a.illumination=e?a.illumination1:a.illumination2,a.illumination_raw=e?a.illumination1_raw:a.illumination2_raw)}return a};var Cc=function(c){Ha.call(this,c);this._data=
"eltako_lux2";this._vendor="eltako";this._eepAlias="a5-06-02";this._ill2Min=0;this._ill2Max=1024};Cc.STATES=Ha.STATES;Cc.prototype=new Ha;Cc.prototype.constructor=Cc;var F=function(c){e.call(this,c);this._data="eltako_buttons";this._vendor="eltako";this._eepAlias="f6-02-01";this._longPressThreshold=1E3;this.BUTTONS=["button1","button2","button3","button4"]};F.STATES=["button1","button2","button3","button4"];F.EVENTS=["shortPress","longPress","press","release"];F.prototype=new e;F.prototype.constructor=
F;F.prototype.evalTelegram=function(c){var a={};if(246==c.rorg)switch(c.userData){case 112:this.BUTTONS[0]&&(a[this.BUTTONS[0]]="pressed");break;case 80:this.BUTTONS[1]&&(a[this.BUTTONS[1]]="pressed");break;case 48:this.BUTTONS[2]&&(a[this.BUTTONS[2]]="pressed");break;case 16:this.BUTTONS[3]&&(a[this.BUTTONS[3]]="pressed");break;case 0:for(c=0;c<this.BUTTONS.length;c++)this.BUTTONS[c]&&(a[this.BUTTONS[c]]="released")}return a};F.prototype.checkStateChange=function(a){var c=this._states,b=[],e=(new Date).getTime(),
f;for(f in a){var g={};g.key=f;g.value=a[f];g.changed=!1;var h=c[f]?c[f].value:null,k=c[f]?c[f].time:null,l=a[f];if(h!=l||"pressed"==l)g.oldvalue=h,g.changed=!0;this._states[f]={value:a[f],time:e};g.changed&&("pressed"==l||"released"==l&&"pressed"==h)&&b.push(g);"pressed"==h&&"released"==l&&(!k||e-k<this._longPressThreshold?(g={},g.key=f,g.value="shortPress"):(g={},g.key=f,g.value="longPress"),g.changed=!0,b.push(g))}return b};var Dc=function(a){F.call(this,a);this._data="eltako_button1";this.BUTTONS=
[null,null,null,"button"]};Dc.STATES=["button"];Dc.prototype=new F;Dc.prototype.constructor=Dc;var Ec=function(a){F.call(this,a);this._data="eltako_sender2";this.BUTTONS=["A1","A3"]};Ec.STATES=["A1","A3"];Ec.prototype=new F;Ec.prototype.constructor=Ec;var Fc=function(a){F.call(this,a);this._data="eltako_sender4";this.BUTTONS=["E1","E2","E3","E4"]};Fc.STATES=["E1","E2","E3","E4"];Fc.prototype=new F;Fc.prototype.constructor=Fc;var Gc=function(a){F.call(this,a);this._data="eltako_button2";this.BUTTONS=
["buttonO","buttonI"]};Gc.STATES=["buttonO","buttonI"];Gc.prototype=new F;Gc.prototype.constructor=Gc;var Hc=function(a){F.call(this,a);this._data="eltako_button4";this.BUTTONS=["BO","BI","AO","AI"]};Hc.STATES=["BO","BI","AO","AI"];Hc.prototype=new F;Hc.prototype.constructor=Hc;var Sb=function(a){F.call(this,a);this._data="eltako_fsm60b"};Sb.STATES=["button"];Sb.prototype=new F;Sb.prototype.constructor=Sb;Sb.prototype.evalTelegram=function(a){var c={};if(246==a.rorg)switch(a.userData){case 112:case 80:case 16:c.button=
"pressed";break;case 0:c.button="released"}return c};var Tb=function(a){e.call(this,a);this._data="eltako_fkf";this._vendor="eltako";this._eepAlias="f6-04-01"};Tb.STATES=["keycard"];Tb.prototype=new e;Tb.prototype.constructor=Tb;Tb.prototype.evalTelegram=function(a){var c={};if(246==a.rorg)switch(a.userData){case 16:c.keycard="inserted";case 0:c.keycard="takeout"}return c};var Ub=function(a){e.call(this,a);this._data="eltako_fkc";this._vendor="eltako";this._eepAlias="f6-04-01"};Ub.STATES=["keycard"];
Ub.prototype=new e;Ub.prototype.constructor=Ub;Ub.prototype.evalTelegram=function(a){var c={};if(246==a.rorg)switch(a.userData){case 48:c.keycard="guest_card";case 32:c.keycard="service_card";case 16:c.keycard="inserted";case 0:c.keycard="takeout"}return c};var ua=function(a){Ba.call(this,a);this._data="eltako_thermo";this._vendor="eltako";this._eepAlias="a5-10-06"};ua.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");ua.prototype=new Ba;ua.prototype.constructor=
ua;ua.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3),e=a.userData.readUInt8(2),f=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(b>>3&1)&&(c.night_reduce=6>=a?0:12>=a?1:19>=a?2:25>=a?3:31>=a?4:5,c.night_reduce_raw=a,c.setpoint=parseFloat((f/255*40).toFixed(1)),c.setpoint_raw=f,c.temperature=parseFloat(((255-e)/255*40).toFixed(1)),c.temperature_raw=e)}return c};var Vb=function(a){ua.call(this,a);this._data="eltako_ftr65hb";this._vendor="eltako";this._eepAlias=
"a5-10-06"};Vb.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];Vb.prototype=new ua;Vb.prototype.constructor=Vb;Vb.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3),e=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(b>>3&1)&&(c.setpoint=parseFloat((a/255*40).toFixed(1)),c.setpoint_raw=a,c.temperature=parseFloat(((255-e)/255*40).toFixed(1)),c.temperature_raw=e)}return c};var Ic=function(a){ua.call(this,a);this._data="eltako_futh65d";this._vendor=
"eltako";this._eepAlias="a5-10-12"};Ic.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");Ic.prototype=new ua;Ic.prototype.constructor=Ic;var Wb=function(a){Ia.call(this,a);this._data="eltako_ftr78s";this._vendor="eltako";this._eepAlias="a5-10-03"};Wb.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];Wb.prototype=new Ia;Wb.prototype.constructor=Wb;Wb.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3),
e=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(b>>3&1)&&(c.setpoint=parseFloat((a/255*22+8).toFixed(1)),c.setpoint_raw=a,c.temperature=parseFloat(((255-e)/255*40).toFixed(1)),c.temperature_raw=e)}return c};var ab=function(a){ma.call(this,a);this._data="eltako_powermeter";this._vendor="eltako";this._eepAlias="a5-12-01"};ab.STATES=["power","energy","tariff"];ab.prototype=new ma;ab.prototype.constructor=ab;ab.prototype.evalTelegram=function(a){var c=ma.prototype.evalTelegram.call(this,a);165==
a.rorg&&143==a.userData.readUInt8(3)&&(c={});return c};var Jc=function(a){ma.call(this,a);this._data="eltako_powermeter2";this._vendor="eltako";this._eepAlias="a5-12-01"};Jc.STATES=["power","tariff"];Jc.prototype=new ma;Jc.prototype.constructor=ab;Jc.prototype.evalTelegram=function(a){a=ma.prototype.evalTelegram.call(this,a);delete a.energy;delete a.tariff;return a};var bb=function(a){F.call(this,a);this._data="eltako_fzs"};bb.STATES=["button"];bb.prototype=new F;bb.prototype.constructor=bb;bb.prototype.evalTelegram=
function(a){var c={};if(246==a.rorg)switch(a.userData){case 48:c.button="pressed";break;case 0:c.button="released"}return c};bb.prototype.checkStateChange=function(a){var c=this._states,b=[],e=(new Date).getTime(),f;for(f in a){var g={};g.key=f;g.value=a[f];g.changed=!1;var h=c[f]?c[f].value:null,k=c[f]?c[f].time:null,l=a[f];h!=l&&(g.oldvalue=h,g.changed=!0);this._states[f]={value:a[f],time:e};g.changed&&b.push(g);"pressed"==h&&"released"==l&&(!k||e-k<this._longPressThreshold?(g={},g.key=f,g.value=
"shortPress"):(g={},g.key=f,g.value="longPress"),g.changed=!0,b.push(g))}return b};var Xb=function(a){h.call(this,a);this._data="eltako_relay2";this._vendor="eltako";this._eepAlias="f6-02-01"};Xb.STATES=["ch1","ch2"];Xb.prototype=new h;Xb.prototype.constructor=Xb;Xb.prototype.evalTelegram=function(a){var c={};if(246==a.rorg)switch(a.userData){case 112:c.ch1="on";break;case 80:c.ch1="off";break;case 48:c.ch2="on";break;case 16:c.ch2="off"}return c};var Yb=function(a){h.call(this,a);this._data="eltako_relay";
this._vendor="eltako";this._eepAlias="f6-02-01"};Yb.STATES=["state"];Yb.prototype=new h;Yb.prototype.constructor=Yb;Yb.prototype.evalTelegram=function(a){var c={};if(246==a.rorg)switch(a.userData){case 112:c.state="on";break;case 80:c.state="off"}return c};var Zb=function(a){W.call(this,a);this._data="eltako_heat";this._vendor="eltako";this._eepAlias="a5-30-03"};Zb.STATES=["temperature","temperature_raw","alarm","alarm_raw"];Zb.prototype=new W;Zb.prototype.constructor=Zb;Zb.prototype.evalTelegram=
function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3),e=a.userData.readUInt8(2),f=a.userData.readUInt8(1);a.userData.readUInt8(0);1==(b>>3&1)&&(c.temperature=parseFloat(((255-f)/255*40).toFixed(1)),c.temperature_raw=f,c.alarm=15==e?"alarm":"ok",c.alarm_raw=e)}return c};var $b=function(a){W.call(this,a);this._data="eltako_water_m3";this._vendor="eltako";this._eepAlias="a5-30-03"};$b.STATES=["water","water_raw"];$b.prototype=new W;$b.prototype.constructor=$b;$b.prototype.evalTelegram=function(a){var c=
{};if(165==a.rorg){var b=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(b>>3&1)&&(c.water=15==a,c.water_raw=a)}return c};var ac=function(a){La.call(this,a);this._data="eltako_water_m4";this._vendor="eltako";this._eepAlias="a5-30-01"};ac.STATES=["water","water_raw"];ac.prototype=new La;ac.prototype.constructor=ac;ac.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(b>>3&1)&&(c.water=0==a,c.water_raw=a)}return c};var va=function(a){H.call(this,
a);this.TEACH_IN_VARIATION=3;this._data="peha_powerswitch";this._vendor="peha";this._eepAlias="a5-38-08"};va.COMMANDS=["on","off","toggle"];va.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");va.prototype=new H;va.prototype.constructor=va;va.prototype.getTeachinType=function(){return"4BS"};va.prototype.evalTelegram=function(a){return Ya.prototype.evalTelegram.call(this,
a)};va.prototype.executeCommand=function(a,b,e){if(b&&b.value){(new Date).getTime();var c=this;switch(b.value){case "on":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:1},function(a){a||c.activeStateChange({state:"on"});e&&e(a)});break;case "off":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:0},function(a){a||c.activeStateChange({state:"off"});e&&e(a)});break;case "toggle":if(!this._states.state){e&&e(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},
e):this.executeCommand(a,{value:"on"},e);break;default:e&&e(Error("unknow command"))}}else e&&e(Error("command invalid"))};var cb=function(a){va.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_switch";this._vendor="peha";this._eepAlias="a5-38-08"};cb.COMMANDS=["on","off","toggle"];cb.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");
cb.prototype=new va;cb.prototype.constructor=cb;cb.prototype.evalTelegram=function(a){a=Ya.prototype.evalTelegram.call(this,a);delete a.power;delete a.energy;delete a.current;delete a.voltage;delete a.power_unit;delete a.energy_unit;delete a.current_unit;delete a.voltage_unit;return a};var wa=function(a){H.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_blind";this._vendor="peha";this._eepAlias="a5-38-08";this._initCount=0};wa.COMMANDS="up down stop stepUp stepDown moveTo lamellaUp lamellaDown lamellaStepUp lamellaStepDown lamellaTo setRunTime setLamellaRuntime".split(" ");
wa.STATES="position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode".split(" ");wa.prototype=new H;wa.prototype.constructor=wa;wa.prototype.init=function(a){var c=require("x.hub.m.enocean.js")._esp3;this.blind(c,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0},function(c){a&&a()})};wa.prototype.getTeachinType=function(){return"4BS"};wa.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length?
(100>=this._initCount&&0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):this._initCount=0;return this._states};wa.prototype.evalTelegram=function(a){return zb.prototype.evalTelegram.call(this,a)};wa.prototype.executeCommand=function(a,b,e){if(b&&b.value){(new Date).getTime();var c=this;if("stepUp"==b.value.substr(0,6)&&6<b.value.length){var d=b.value.substr(6);b={value:"stepUp",ext:d}}else"stepDown"==
b.value.substr(0,8)&&8<b.value.length?(d=b.value.substr(8),b={value:"stepDown",ext:d}):"setRunTime"==b.value.substr(0,10)&&10<b.value.length?(d=b.value.substr(10),b={value:"setRunTime",ext:d}):"moveTo"==b.value.substr(0,6)&&6<b.value.length&&(d=b.value.substr(6),b={value:"moveTo",ext:d});switch(b.value){case "up":this.blind(a,{P1:0,P2:0,FUNC:2,SSF:0,PAF:0,SMF:0},function(a){e&&e(a)});break;case "down":this.blind(a,{P1:0,P2:0,FUNC:3,SSF:0,PAF:0,SMF:0},function(a){e&&e(a)});break;case "stop":this.blind(a,
{P1:0,P2:0,FUNC:1,SSF:0,PAF:0,SMF:0},function(a){e&&e(a)});break;case "stepUp":d="undefined"==typeof b.ext||null==b.ext?5:parseInt(b.ext);var f=this._states.position?this._states.position.value:null;if("undefined"==typeof f||null==f){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});e&&e(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(d=f+d,100<d&&(d=100)):(d=f-d,0>d&&(d=0));this.blind(a,{P1:d,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||c.activeStateChange({position:d});
e&&e(a)});break;case "stepDown":d="undefined"==typeof b.ext||null==b.ext?5:parseInt(b.ext);f=this._states.position?this._states.position.value:null;if("undefined"==typeof f||null==f){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});e&&e(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(d=f-d,0>d&&(d=0)):(d=f+d,100<d&&(d=100));this.blind(a,{P1:d,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||c.activeStateChange({position:d});e&&e(a)});break;case "moveTo":if("undefined"==
typeof b.ext||null==b.ext){e&&e(Error("value invalid"));break}f=parseInt(b.ext);this.blind(a,{P1:f,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||c.activeStateChange({position:f});e&&e(a)});break;case "setRunTime":if(!b.ext||-1==b.ext.indexOf(":")){e&&e(Error("value invalid"));break}var g=b.ext.split(":");b=g[0];g=g[1];if(!b&&g)b=g;else if(b&&!g)g=b;else if(!b&&!g){e&&e(Error("value invalid"));break}b=parseInt(b);g=parseInt(g);this.blind(a,{P1:b,P2:g,FUNC:7,SSF:0,PAF:0,SMF:0},function(a){a||c.activeStateChange({position:d});
e&&e(a)});break;default:e&&e(Error("unknow command"))}}else e&&e(Error("command invalid"))};var y=function(a){g.call(this,a);this._data="bb-aa-cc";this._vendor="rehau";this._eepAlias="d2-06-10";this._hopCount=0;this._saLearnMode=1;this._originalEEP="bb-aa-cc";this._reset_pre_alarm_new=this._reset_alarm_new=null;this._deviceTO=this._startTimeoutTimer();this._prealarmTO=this._alarmTO=null};y.COMMANDS="alertOn alertOff alertToggle resetAlarm resetPreAlarm preAlarmOn preAlarmOff preAlarmToggle".split(" ");
y.STATES="battery pre_alarm alarm window pre_alarm_enabled error pending alarm_enabled pre_alarm_enabled_device timeout".split(" ");y.prototype=new g;y.prototype.constructor=y;y.prototype.setDefaultParams=function(){var a=require("x.hub.m.enocean.js")._rehauHandler;if(a){var b=a.getSmartguardSetting(this._address),e=!0,f=!0;b&&(e=b.isAlarmActive(),f=b.isPreAlarmActive());this.activeStateChange({pending:!1,alarm_enabled:e,pre_alarm_enabled:f,timeout:!1,alarm_task_active:a.getAlarm(),pre_alarm_task_active:a.getAlarm()})}};
y.prototype.getStatesBuffer=function(){return this._states};y.prototype.evalData=function(a,b,e){var c=this.evalTelegram(b);if(c){c.timeout=!1;this._deviceTO&&(clearTimeout(this._deviceTO),this._deviceTO=this._startTimeoutTimer());if(208==b.rorg)b=this.checkStateChange(c);else{var d=!1;210==b.rorg&&2==b.userData.length&&(d=!0);b=this.getBufferedState("alarm_task_active");var f=this.getBufferedState("pre_alarm_task_active"),g=this.getBufferedState("alarm_enabled"),h=this.getBufferedState("pre_alarm_enabled");
c.pre_alarm?f?h?this._startPreAlarmTimer():c.pre_alarm=!1:c.pre_alarm=!1:this._clearPreAlarmTimer();c.alarm?b?g?this._startAlarmTimer():c.alarm=!1:c.alarm=!1:this._clearAlarmTimer();b=this.checkStateChange(c);var k=this;this._executePendingCommand(a,function(){k._reportStates(c)},d)}e&&e(null,b)}else e&&e(Error("data format invalid"))};y.prototype.evalTelegram=function(a){var c={},b=!1;if(210==a.rorg){if(1==a.userData.length)b=a.userData.readUInt8(0);else{var e=a.userData.readUInt8(0);b=a.userData.readUInt8(1)}2==
a.userData.length&&(c.battery=e);c.pre_alarm=b>>7&1?!0:!1;c.alarm=b>>6&1?!0:!1;c.window=b>>5&1?"closed":"open";c.pre_alarm_enabled_device=b>>4&1?!0:!1;c.error=b&15;b=!0}else 208==a.rorg&&(b=a.userData.readUInt8(0),c.battery=Math.round(b/100*255),c.battery_raw=b,b=!0);return b?c:null};y.prototype.executeCommand=function(a,b,e){if(b&&b.value){switch(b.value){case "alertOn":this._setAlarm(!0);break;case "alertOff":this._setAlarm(!1);break;case "alertToggle":this._states&&this._states.alarm_enabled?this._setAlarm(!this._states.alarm_enabled.value):
this._setAlarm(!0);break;case "resetAlarm":this._reset_alarm_new="on";this.activeStateChange({pending:!0});break;case "resetPreAlarm":this._reset_pre_alarm_new="on";this.activeStateChange({pending:!0});break;case "preAlarmOn":this._setPreAlarm(!0);break;case "preAlarmOff":this._setPreAlarm(!1);break;case "preAlarmToggle":this._states&&this._states.pre_alarm_enabled?this._setPreAlarm(!this._states.pre_alarm_enabled.value):this.pre_alarm_enabled(!0);break;case "alarmTaskOn":this._setAlarmTask(!0);break;
case "alarmTaskOff":this._setAlarmTask(!1);break;case "preAlarmTaskOn":this._setPreAlarmTask(!0);break;case "preAlarmTaskOff":this._setPreAlarmTask(!1);break;default:e&&e(Error("unknow command"));return}e&&e()}else e&&e(Error("command invalid"))};y.prototype._executePendingCommand=function(a,b,e){var c={AL:1,RSA:0,RSP:0,PAE:1},d=this._isAlarmActive();c.AL=d?1:0;d=this._isPreAlarmActive();c.PAE=d?1:0;this._reset_alarm_new&&(c.RSA="on"==this._reset_alarm_new?1:0);this._reset_pre_alarm_new&&(c.RSP="on"==
this._reset_pre_alarm_new?1:0);var f={pending:!1};1==c.RSP&&(f.pre_alarm=!1);1==c.RSA&&(f.alarm=!1);this._reset_pre_alarm_new=this._reset_alarm_new=null;var g=this;this._sendVLD(a,c,function(a){g.activeStateChange(f);b&&b(a)},e)};y.prototype._sendVLD=function(a,b,e,f){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);b=(b.AL&1)<<7|(b.RSA&1)<<6|(b.RSP&1)<<5|(b.PAE&1)<<4;f=f?new Buffer([0,b]):new Buffer([b]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(f,c,0);c.setDstId(this._address);a.sendTelegram(c,
!0,function(a){e&&e(a)})};y.prototype._reportStates=function(a){if(a&&0<Object.keys(a).length){var c=require("x.hub.m.enocean.js").getRehauHandler();c&&(a.alarm_enabled=this.getBufferedState("alarm_enabled"),a.pre_alarm_enabled=this.getBufferedState("pre_alarm_enabled"),c.onReceiveWindowSensorStates(this,a))}};y.prototype._setAlarm=function(a){this.activeStateChange({alarm_enabled:a});require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardAlarm(this._address,a)};y.prototype._setPreAlarm=function(a){this.activeStateChange({pre_alarm_enabled:a});
require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardPreAlarm(this._address,a)};y.prototype._setAlarmTask=function(a){this.activeStateChange({alarm_task_active:a})};y.prototype._setPreAlarmTask=function(a){this.activeStateChange({pre_alarm_task_active:a})};y.prototype._isAlarmActive=function(){var a=!0,b=!0;this._states&&this._states.alarm_enabled&&(b=this._states.alarm_enabled.value,"undefined"==typeof b||null==b)&&(b=!0);if(!b)return!1;this._states&&this._states.alarm_task_active&&(a=this._states.alarm_task_active.value,
"undefined"==typeof a||null==a)&&(a=!1);return a};y.prototype._isPreAlarmActive=function(){var a=!0,b=!0;this._states&&this._states.pre_alarm_enabled&&(b=this._states.pre_alarm_enabled.value,"undefined"==typeof b||null==b)&&(b=!0);if(!b)return!1;this._states&&this._states.pre_alarm_task_active&&(a=this._states.pre_alarm_task_active.value,"undefined"==typeof a||null==a)&&(a=!1);return a};y.prototype._startTimeoutTimer=function(){var a=this;return setTimeout(function(){a.activeStateChange({timeout:!0})},
36E5)};y.prototype._startPreAlarmTimer=function(){this._prealarmTO&&clearTimeout(this._prealarmTO);var a=this;this._prealarmTO=setTimeout(function(){a.activeStateChange({pre_alarm:!1});var c=a.getCurrentStates();a._reportStates(c)},1E4)};y.prototype._clearPreAlarmTimer=function(){this._prealarmTO&&(clearTimeout(this._prealarmTO),this._prealarmTO=null)};y.prototype._startAlarmTimer=function(){this._alarmTO&&clearTimeout(this._alarmTO);var a=this;this._alarmTO=setTimeout(function(){a.activeStateChange({alarm:!1});
var c=a.getCurrentStates();a._reportStates(c)},12E4)};y.prototype._clearAlarmTimer=function(){this._alarmTO&&(clearTimeout(this._alarmTO),this._alarmTO=null)};y.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params,hopCount:this._hopCount,saLearnMode:this._saLearnMode,originalEEP:this._originalEEP}};y.prototype.fromJSON=function(a){if(!a||!a.address||!a.data||a.data!=this._data)return null;
this._address=a.address;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=a.params;this._hopCount=a.hopCount;this._saLearnMode=a.saLearnMode;a.originalEEP&&(this._originalEEP=a.originalEEP);this.setDefaultParams();return this};y.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual,hopCount:this._hopCount,saLearnMode:this._saLearnMode,
originalEEP:this._originalEEP}};y.prototype.fromDBJSON=function(a){if(!a||!a.id||!a.eep||a.eep!=this._data)return null;this._address=a.id;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=a.params;this._hopCount=a.hopCount;this._saLearnMode=a.saLearnMode;a.originalEEP&&(this._originalEEP=a.originalEEP);this.setDefaultParams();return this};var Nc=function(a){y.call(this,a);this._data="d2-06-10"};Nc.prototype=new y;Nc.prototype.constructor=
Nc;var Kc=function(a){y.call(this,a);this._data="d2-06-ff"};Kc.prototype=new y;Kc.prototype.constructor=Kc;Kc.prototype.evalTelegram=function(a){var c={},b=!1;if(210==a.rorg){if(1==a.userData.length)b=a.userData.readUInt8(0);else{var e=a.userData.readUInt8(0);b=a.userData.readUInt8(1)}2==a.userData.length&&(c.battery=e);a=b>>2&3;c.pre_alarm=b>>7&1?!0:!1;c.alarm=b>>6&1?!0:!1;c.window=a?"closed":"open";c.pre_alarm_enabled_device=b>>4&1?!0:!1;0==a?c.window="closed":1==a?c.window="tilted":3==a&&(c.window=
"open");b=!0}else 208==a.rorg&&(b=a.userData.readUInt8(0),c.battery=b,b=!0);return b?c:null};var Lc=function(a){W.call(this,a);this._data="afriso_water_con";this._vendor="afriso";this._eepAlias="a5-30-03"};Lc.prototype=new W;Lc.prototype.constructor=Lc;Lc.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3),e=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(b>>3&1)&&(c.temperature=(255-a)/255*40,c.temperature_raw=a,c.water=0==(e>>4&1)?!0:!1)}return c};var bc=
function(a){A.call(this,a);this._data="afriso_water_eco";this._vendor="afriso";this._eepAlias="f6-05-01"};bc.prototype=new A;bc.prototype.constructor=bc;bc.prototype.evalTelegram=function(a){var c={};246==a.rorg&&(a=a.nu,1==a?c.water="true":0==a&&(c.water="false"));return c};bc.prototype.onLearn=function(){this._states.water={value:!1,time:(new Date).getTime()}};var Mc=function(a){W.call(this,a);this._data="afriso_asd_10";this._vendor="afriso";this._eepAlias="a5-30-03"};Mc.prototype=new W;Mc.prototype.constructor=
Mc;Mc.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3),e=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(b>>3&1)&&(c.temperature=(255-a)/255*40,c.temperature_raw=a,c.smoke=0==(e>>4&1)?!0:!1)}return c};var cc=function(a){O.call(this,a);this._data="hoppe_door";this._vendor="hoppe";this._eepAlias="f6-10-00"};cc.STATES=["door"];cc.prototype=new O;cc.prototype.constructor=cc;cc.prototype.evalTelegram=function(a){var c={};246==a.rorg&&(a=a.userData,0==(a&208^
192)?c.door="open":0==(a&240^240)&&(c.door="closed"),c.handle_raw=a);return c};var Pc=function(){var a=function(a){g.call(this,a);this._data="gp";this._gpInfo=null};a.prototype=new g;a.prototype.constructor=a;a.prototype.toJSON=function(){var a=g.prototype.toJSON.call(this);a.gpInfo=this._gpInfo;return a};a.prototype.fromJSON=function(a){if(!g.prototype.fromJSON.call(this,a))return null;a&&a.gpInfo&&(this._gpInfo=a.gpInfo);return this};a.prototype.toDBJSON=function(){var a=g.prototype.toDBJSON.call(this);
a.gpInfo=this._gpInfo;return a};a.prototype.fromDBJSON=function(a){if(!g.prototype.fromDBJSON.call(this,a))return null;a&&a.gpInfo&&(this._gpInfo=a.gpInfo);return this};return a}(),Sc=function(){var a=function(a){Pc.call(this,a);this._data="afriso_ais_10";this._vendor="afriso";this._eepAlias="gp"};a.prototype=new Pc;a.prototype.constructor=a;a.prototype.isGPMatch=function(a,c){return 45!=a?!1:8==c};a.prototype.evalTelegram=function(a){var c={};if(178==a.rorg){var b=a.data.readUInt8(0)>>7&1,d=a.data.readUInt8(0)>>
6&1;a=a.data.readUInt8(0)>>5&1;c.alarm=1==b?"on":"off";c.active=1==d?"on":"off";c.powerAlarm=1==a?"alarm":"no_change"}return c};a.prototype.executeCommand=function(a,c,b){if(c&&c.value){switch(c.value){case "arming":this._setActive(a,!0,b);break;case "disarming":this._setActive(a,!1,b);break;case "toggleArming":this._states&&this._states.active?this._setActive(a,"off"==this._states.active.value,b):this._setActive(a,!0,b);break;case "alarmOn":this._setAlarm(a,!0,b);break;case "alarmOff":this._setAlarm(a,
!1,b);break;case "toggleAlarm":this._states&&this._states.alarm?this._setAlarm(a,"off"==this._states.alarm.value,b):this._setAlarm(a,!1,b);break;default:b&&b(Error("unknow command"));return}b&&b()}else b&&b(Error("command invalid"))};a.prototype._setActive=function(a,c,b){var d=!1;this._states&&this._states.alarm&&"on"==this._states.alarm.value&&(d=!0);this._sendGPCD(a,d,c,b)};a.prototype._setAlarm=function(a,c,b){var d=!0;this._states&&this._states.active&&"off"==this._states.active.value&&(d=!1);
this._sendGPCD(a,c,d,b)};a.prototype._sendGPCD=function(a,c,b,e){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);var f=0;c&&(f|=128);b&&(f|=64);c=new Buffer(1);c.writeUInt8(f,0);d=new x.hub.m.enocean.ESP3.Telegram.GP_CD(c,d,0);d.setDstId(this._address);a.sendTelegram(d,!0,function(a){e&&e(a)})};return a}(),xa=function(){var a=function(a){da.call(this,a);this._data="eltako_tf_ttb";this._vendor="eltako";this._eepAlias="a5-07-01";this._params={reset_timeout:300}};a.prototype=new da;
a.prototype.constructor=a;a.prototype.evalTelegram=function(a){return 246==a.rorg?k.prototype.evalTelegram.call(this,a):165==a.rorg?da.prototype.evalTelegram.call(this,a):{}};a.prototype.checkStateChange=function(a){return a.button?k.prototype.checkStateChange.call(this,a):da.prototype.checkStateChange.call(this,a)};a.prototype.fromJSON=function(a){da.prototype.fromJSON.call(this,a);this._params={reset_timeout:300};return this};var b=function(a){W.call(this,a);this._data="eltako_tf_smoke";this._vendor=
"eltako";this._eepAlias="a5-30-03"};b.STATES=["temperature","temperature_raw","smoke","smoke_raw"];b.prototype=new W;b.prototype.constructor=b;b.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3),d=a.userData.readUInt8(2),e=a.userData.readUInt8(1);a.userData.readUInt8(0);1==(b>>3&1)&&(c.temperature=parseFloat(((255-e)/255*40).toFixed(1)),c.temperature_raw=e,c.smoke=15==d?!0:!1,c.smoke_raw=d)}return c};var e=function(a){O.call(this,a);this._data="eltako_tf_contact";
this._vendor="eltako";this._eepAlias="d5-00-01"};e.STATES=["contact","contact_raw","voltage","voltage_raw"];e.prototype=new N;e.prototype.constructor=e;e.prototype.evalTelegram=function(a){var c={};if(213==a.rorg){var b=a.userData;1==(b>>3&1)&&(b&=1,c.contact=b?"closed":"open",c.contact_raw=b)}else if(165==a.rorg){b=a.userData.readUInt8(3);a.userData.readUInt8(2);var d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(b>>3&1)&&(c.voltage=parseFloat(d/255*5).toFixed(1),c.voltage_raw=d,c.energy=
parseFloat(a/255*5).toFixed(1),c.energy_raw=a)}return c};var f=function(a){Ma.call(this,a);this._data="eltako_motion2";this._vendor="eltako";this._eepAlias="a5-08-01"};f.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");f.prototype=new Ma;f.prototype.constructor=f;f.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3);a.userData.readUInt8(2);var d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(b>>3&1)){c.voltage=parseFloat((a/
255*5.1).toFixed(1));c.voltage_raw=a;c.illumination=parseFloat((d/255*510).toFixed(1));c.illumination_raw=d;switch(b){case 13:c.state="on";break;case 15:c.state="off"}c.motion_raw=b}}return c};var g=function(a){da.call(this,a);this._data="eltako_tf_motion";this._vendor="eltako";this._eepAlias="a5-07-01"};g.STATES=["motion","motion_raw"];g.prototype=new da;g.prototype.constructor=g;g.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3);a=a.userData.readUInt8(2);
1==(b>>3&1)&&(c.motion=200==a||255==a?!0:!1,c.motion_raw=a)}return c};var h=function(a){H.call(this,a);this._data="eltako_tf_input";this._vendor="eltako";this._eepAlias="a5-38-08"};h.STATES=["state","state_raw"];h.prototype=new H;h.prototype.constructor=h;h.prototype.evalTelegram=function(a){var c={};165==a.rorg&&(a=a.userData.readUInt8(3),1==(a>>3&1)&&(c.input=8==a?!1:!0,c.input_raw=a));return c};var l=function(a){Ba.call(this,a);this._data="eltako_tf_thermo";this._vendor="eltako";this._eepAlias=
"a5-10-06"};l.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");l.prototype=new ua;l.prototype.constructor=l;l.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3),d=a.userData.readUInt8(2),e=a.userData.readUInt8(1);a.userData.readUInt8(0);1==(b>>3&1)&&(c.setpoint=parseFloat((e/255*40).toFixed(1)),c.setpoint_raw=e,c.temperature=parseFloat(((255-d)/255*40).toFixed(1)),c.temperature_raw=d)}return c};var p=function(a){Na.call(this,
a);this._data="eltako_tf_lux"};p.prototype=new Na;p.prototype.constructor=p;var q=function(a){H.call(this,a);this._data="eltako_dimmer_knob";this._vendor="eltako";this._eepAlias="a5-38-08"};q.STATES=["state","dimmerLevel"];q.prototype=new H;q.prototype.constructor=q;q.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3),d=a.userData.readUInt8(2),e=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(b>>3&1))switch(a){case 2:c.dimmerLevel=e,c.ramp=d,c.dim_range=
b>>2&1?"relative":"absolute",c.store_final_value=b>>1&1,c.state=b&1?"on":"off"}}return c};var n=function(a){Oc.call(this,a);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_alarm"};n.prototype=new Oc;n.prototype.constructor=n;n.prototype.evalTelegram=function(a){var c={};if(246==a.rorg)switch(a.userData){case 48:c.active=!0;break;case 16:c.active=!1}else 165==a.rorg&&(a=a.userData.readUInt8(3),8==a?c.alarm="ok":9==a&&(c.alarm="alarm"));return c};n.prototype.executeCommand=function(a,c,b){if(c&&c.value){var d=
null;switch(c.value){case "triggerAlarm":d=new Buffer([1,0,0,9]);break;case "deactivate":d=new Buffer([1,0,0,12]);break;case "activate":d=new Buffer([1,0,0,8]);break;default:b&&b(Error("unknow command"))}c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);d=new x.hub.m.enocean.ESP3.Telegram.BS4(d,c,0);d.setDstId(this._address);a.sendTelegram(d,!0,function(a){b&&b(a)})}else b&&b(Error("command invalid"))};var m=function(a){F.call(this,a);this._data="eltako_f6t";this._vendor="eltako";this.BUTTONS=
"buttonCO buttonCI buttonBO buttonBI buttonAO buttonAI".split(" ")};m.STATES="buttonCO buttonCI buttonBO buttonBI buttonAO buttonAI".split(" ");m.prototype=new F;m.prototype.constructor=m;m.prototype.evalTelegram=function(a){var c={};if(246==a.rorg){var b=parseInt(this._address,16),d=a.senderID?parseInt(a.senderID,16):null;if(d&&d==b+1)switch(a.userData){case 112:c.buttonCI="pressed";break;case 80:c.buttonCO="pressed";break;case 0:for(a=0;a<this.BUTTONS.length;a++)this.BUTTONS[a]&&(c[this.BUTTONS[a]]=
"released")}else switch(a.userData){case 112:c.buttonAI="pressed";break;case 80:c.buttonAO="pressed";break;case 48:c.buttonBI="pressed";break;case 16:c.buttonBO="pressed";break;case 0:for(a=0;a<this.BUTTONS.length;a++)this.BUTTONS[a]&&(c[this.BUTTONS[a]]="released")}}return c};return{TF_TTB:a,TF_RWB:b,TF_FKB:e,TF_BHSB:g,TF_BHSB_FBH:f,TF_Input:h,TF_Thermo:l,TF_Lux:p,Dimmer_Knob:q,TF_Alarm:n,Eltako_F6T:m}}();return{"f6-??-??":e,"f6-01-01":k,"f6-02-01":h,"f6-02-02":l,"f6-02-03":p,"f6-02-04":q,"f6-03-01":u,
"f6-03-02":z,"f6-04-01":C,"f6-04-02":I,"f6-05-00":J,"f6-05-01":A,"f6-05-02":w,"f6-10-00":O,"f6-10-01":U,"d5-xx-xx":a,"d5-??-??":X,"d5-00-01":N,"f6-so-da":f,"a5-??-??":t,"a5-02-01":Y,"a5-02-02":K,"a5-02-03":oa,"a5-02-04":M,"a5-02-05":P,"a5-02-06":ca,"a5-02-07":Z,"a5-02-08":aa,"a5-02-09":Qa,"a5-02-0a":v,"a5-02-0b":m,"a5-02-10":Oa,"a5-02-11":dc,"a5-02-12":Pa,"a5-02-13":ec,"a5-02-14":fc,"a5-02-15":Ga,"a5-02-16":gc,"a5-02-17":db,"a5-02-18":hc,"a5-02-19":ic,"a5-02-1a":jc,"a5-02-1b":kc,"a5-02-20":Fa,"a5-02-30":lc,
"a5-04-01":mc,"a5-04-02":Ra,"a5-04-03":eb,"a5-06-01":Sa,"a5-06-02":Ha,"a5-06-03":fb,"a5-06-04":gb,"a5-06-05":nc,"a5-07-01":da,"a5-07-02":Ta,"a5-07-03":Ua,"a5-08-01":Va,"a5-08-02":oc,"a5-08-03":pc,"a5-09-02":hb,"a5-09-04":ib,"a5-09-05":jb,"a5-09-06":kb,"a5-09-07":lb,"a5-09-08":mb,"a5-09-09":nb,"a5-09-0a":ob,"a5-09-0b":pb,"a5-09-0c":qb,"a5-10-01":B,"a5-10-02":la,"a5-10-03":Ia,"a5-10-04":rb,"a5-10-05":sb,"a5-10-06":Ba,"a5-10-07":tb,"a5-10-08":pa,"a5-10-09":qa,"a5-10-0a":Ca,"a5-10-0b":Ja,"a5-10-0c":ub,
"a5-10-0d":vb,"a5-10-10":Q,"a5-10-11":Da,"a5-10-12":wb,"a5-10-13":xb,"a5-10-14":yb,"a5-12-00":Ab,"a5-12-01":ma,"a5-12-02":Ka,"a5-12-03":qc,"a5-13-01":rc,"a5-13-02":sc,"a5-13-03":tc,"a5-13-04":uc,"a5-13-05":vc,"a5-13-06":wc,"a5-14-01":Bb,"a5-14-02":Cb,"a5-14-03":Db,"a5-14-04":Eb,"a5-14-05":Fb,"a5-14-06":Gb,"a5-14-07":Hb,"a5-14-08":Ib,"a5-14-09":Jb,"a5-14-0a":Kb,"a5-20-04":ja,"a5-30-01":La,"a5-30-02":Lb,"a5-30-03":W,"a5-30-04":Mb,"a5-38-08":H,"d2-??-??":fa,"d2-01-00":na,"d2-01-01":Nb,"d2-01-03":Ob,
"d2-01-11":Ea,"d2-01-13":ra,"d2-01-14":sa,"d2-05-00":S,"d2-05-01":ta,"d2-06-01":za,"d2-06-02":Aa,"d2-06-10":Nc,"d2-06-ff":Kc,"d2-06-50":b,"d2-20-00":ba,eltako_dimmer:G,eltako_dimmer2:$a,eltako_fsud:Qb,eltako_motion:Ma,eltako_contact:Pb,eltako_weather:Rb,eltako_lux:Na,eltako_lux2:Cc,eltako_sender2:Ec,eltako_sender4:Fc,eltako_button1:Dc,eltako_button2:Gc,eltako_button4:Hc,eltako_blind:T,eltako_fsm60b:Sb,eltako_fkf:Tb,eltako_fkc:Ub,eltako_thermo:ua,eltako_ftr65hb:Vb,eltako_futh65d:Ic,eltako_ftr78s:Wb,
eltako_powermeter:ab,eltako_powermeter2:Jc,eltako_fzs:bb,eltako_switch:ka,eltako_relay:Yb,eltako_relay2:Xb,eltako_heat:Zb,eltako_water_m3:$b,eltako_water_m4:ac,eltako_tf_switch:Oc,eltako_tf_dimmer:Qc,eltako_tf_blind:Rc,peha_switch:cb,peha_powerswitch:va,peha_blind:wa,"bb-aa-cc":y,afriso_water_con:Lc,afriso_water_eco:bc,afriso_asd_10:Mc,hoppe_door:cc,gp:Pc,afriso_ais_10:Sc,eltako_tf_ttb:xa.TF_TTB,eltako_tf_smoke:xa.TF_RWB,eltako_tf_contact:xa.TF_FKB,eltako_tf_motion:xa.TF_BHSB,eltako_motion2:xa.TF_BHSB_FBH,
eltako_tf_thermo:xa.TF_Thermo,eltako_tf_input:xa.TF_Input,eltako_tf_lux:xa.TF_Lux,eltako_dimmer_knob:xa.Dimmer_Knob,eltako_tf_alarm:xa.TF_Alarm,eltako_f6t:xa.Eltako_F6T,parseDBJson:function(a){if(!a||!a.eep)return null;var c=this[a.eep];if(!c)return null;c=new c;return c=c.fromDBJSON(a)},parseJson:function(a){if(!a||!a.data)return null;var c=this[a.data];if(!c)return null;c=new c;return c=c.fromJSON(a)}}}();
x.hub.m.enocean.SiegeniaHandler=function(){var g=function(b){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SiegeniaHandler");this._esp3=b;this._calibateListener=this._window=this._windowID=this._esp3Listener=null};g.prototype.startCalibateWindow=function(b,a){if(this._calibateListener)a&&a(Error("configuraion of window running"));else{this._calibateListener=a;this._windowID=b;this._window=new x.hub.m.enocean.profiles["d2-06-50"];var f=this;this._esp3Listener={_onEOTelegram:function(a){var b=
!1;f._windowID&&f._windowID==a.senderID?b=!0:f._windowID||210!=a.rorg||(b=!0);b&&f._calibateListener&&(b=f._window.evalTelegram(a))&&17==b.type&&f._calibateListener(null,a.senderID,b)}};this._esp3.addListener(this._esp3Listener)}};g.prototype.stopCalibateWindow=function(){this._esp3Listener&&this._esp3.removeListener(this._esp3Listener);this._window=this._windowID=this._calibateListener=this._esp3Listener=null};g.prototype.configWindow=function(b,a,f,e){a="FFFFFFFF";e||(e=x.hub.m.enocean.SENDER_ID);
this._logger.log("info","config siegenia window:"+JSON.stringify(b));this._logger.log("info","window id:"+a+" sender id:"+e);var g=parseInt(b.alive),h=parseInt(b.sync),l=parseInt(b.eep),p=parseInt(b.type),q=parseInt(b.alarm);b=parseInt(b.alarm_sens);var u=[128,2,127,240,1,140,57,45,245],z=[192,13,127,242,49,0,0,2,g>>8&255],C=[193,g&255,0,1,2,h>>8&255,h&255,0,2],I=[194,1,l,0,3,1,p,0,4],J=[195,1,q,0,5,1,b,0,0],A=[128,2,127,240,2,140,57,45,245],w=this;this._logger.log("info","send config siegenia window (data1):"+
(new Buffer(u)).toString("hex"));this._esp3._recomm.sendRawSysEx(new Buffer(u),a,e,function(b){if(b&&(w._logger.log("warn","config siegenia window error (data1):"+b.message+" ["+b.code+"]"),100!=b.code)){f&&f(b);return}w._logger.log("info","send config siegenia window (data2):"+(new Buffer(z)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(z),a,e,function(b){if(b&&(w._logger.log("warn","config siegenia window error (data2):"+b.message+" ["+b.code+"]"),100!=b.code)){f&&f(b);return}w._logger.log("info",
"send config siegenia window (data3):"+(new Buffer(C)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(C),a,e,function(b){if(b&&(w._logger.log("warn","config siegenia window error (data3):"+b.message+" ["+b.code+"]"),100!=b.code)){f&&f(b);return}w._logger.log("info","send config siegenia window (data4):"+(new Buffer(I)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(I),a,e,function(b){if(b&&(w._logger.log("warn","config siegenia window error (data4):"+b.message+" ["+b.code+"]"),
100!=b.code)){f&&f(b);return}w._logger.log("info","send config siegenia window (data5):"+(new Buffer(J)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(J),a,e,function(b){if(b&&(w._logger.log("warn","config siegenia window error (data5):"+b.message+" ["+b.code+"]"),100!=b.code)){f&&f(b);return}w._logger.log("info","send config siegenia window (data6):"+(new Buffer(A)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(A),a,e,function(a){a&&w._logger.log("warn","config siegenia window error (data5):"+
a.message+" ["+a.code+"]");a&&100!=a.code?f&&f(a):f&&f()})})})})})})};return g}();
x.hub.m.enocean.RehauHandler=function(){var g=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.InoventAccessory");this._inoventID=a;this._co2SensorID=this._humiditySensorID=null;this._co2RegulationActive=this._humRegulationActive=!1;this._humidityState=null;this._humidityLevel=0;this._co2State=null;this._co2Level=0};g.prototype.getHumiditySensorID=function(){return this._humiditySensorID};g.prototype.setHumiditySensorID=function(a){this._humiditySensorID=a};
g.prototype.getCo2SensorID=function(){return this._co2SensorID};g.prototype.setCo2SensorID=function(a){this._co2SensorID=a};g.prototype.activateSensorRegulation=function(a){if(5==a)this._humRegulationActive=!0,this._co2RegulationActive=!1;else if(6==a)this._humRegulationActive=!1,this._co2RegulationActive=!0;else{this._co2RegulationActive=this._humRegulationActive=!1;return}this._co2Level=this._humidityLevel=0;this._humRegulationActive&&this._humiditySensorID&&null!=this._humidityState&&this.executeHumidityRegulation(this._humidityState);
this._co2RegulationActive&&this._co2SensorID&&null!=this._co2State&&this.executeCo2Regulation(this._co2State)};g.prototype.deactivateSensorRegulation=function(){this._co2RegulationActive=this._humRegulationActive=!1;this._co2Level=this._humidityLevel=0};g.prototype.executeHumidityRegulation=function(a){this._humidityState=a;this._logger.log("trace","["+this._inoventID+"] receive hum:"+a);if(this._humRegulationActive){var b=this._calculateHumidityLevel(a);this._logger.log("trace","["+this._inoventID+
"] target level:"+b);(!this._humidityLevel||b!=this._humidityLevel&&this._exceedHumidityHysteresis(this._humidityLevel,a))&&this._changeHumLevel(b)}};g.prototype._calculateHumidityLevel=function(a){return 50>=a?1:60>=a?2:70>=a?3:4};g.prototype._exceedHumidityHysteresis=function(a,b){switch(a){case 1:return 55<=b;case 2:return 45>=b||65<=b;case 3:return 55>=b||75<=b;case 4:return 65>=b}};g.prototype._changeHumLevel=function(a){var b=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},
{value:"setHumLevel"+a},function(e){e&&e.error||(b._humidityLevel=a)})};g.prototype.executeCo2Regulation=function(a){this._co2State=a;this._logger.log("trace","["+this._inoventID+"] receive co2:"+a);if(this._co2RegulationActive){var b=this._calculateCo2Level(a);this._logger.log("trace","["+this._inoventID+"] target level:"+b);(!this._co2Level||b!=this._co2Level&&this._exceedCo2Hysteresis(this._co2Level,a))&&this._changeCo2Level(b)}};g.prototype._calculateCo2Level=function(a){return 600>=a?1:1E3>=
a?2:1500>=a?3:4};g.prototype._exceedCo2Hysteresis=function(a,b){switch(a){case 1:return 700<=b;case 2:return 500>=b||1100<=b;case 3:return 900>=b||1600<=b;case 4:return 1400>=b}};g.prototype._changeCo2Level=function(a){var b=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},{value:"setCo2Level"+a},function(e){e&&e.error||(b._co2Level=a)})};g.prototype.toJSON=function(){return{humidity:this._humiditySensorID,co2:this._co2SensorID}};g.prototype.fromJSON=function(a){a&&(this._humiditySensorID=
a.humidity,this._co2SensorID=a.co2)};var b=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.WindowAlarm");this._handler=a;this._active=!1;this._sensors={}};b.prototype.setAlarm=function(a){this._logger.log("trace","set alarm active:"+a);this._active=a};b.prototype.getAlarm=function(){return this._active};b.prototype.onReceiveWindowSensorStates=function(a,b){this._logger.log("trace","receive window:"+a.getAddress()+" states:"+JSON.stringify(b));if(this._active){var e=
a.getAddress(),f=this._sensors[e];f||(this._sensors[e]={lastEvent:"IDLE"},f=this._sensors[e]);this._logger.log("trace","last event for window:"+a.getAddress()+" is:"+f.lastEvent);b&&(b.pre_alarm&&"PRE_ALARM"!=f.lastEvent?(f.lastEvent="PRE_ALARM",this._logger.log("trace","window:"+a.getAddress()+" pre_alarm triggered"),this.triggerAlarm(!0)):b.alarm&&"ALARM"!=f.lastEvent?(f.lastEvent="ALARM",this._logger.log("trace","window:"+a.getAddress()+" alarm triggered"),this.triggerAlarm()):b.alarm||b.pre_alarm||
(this._logger.log("trace","new event for window:"+a.getAddress()+" is:IDLE and stop timer"),f.lastEvent="IDLE"))}};b.prototype.triggerAlarm=function(a){require("x.hub.taskman.js").getRehauAlarmTaskManager().onWindowSensorAlarmTriggered(a)};var a=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.SmartguardSetting");this._smartguardID=a;this._prealarmActive=this._alarmActive=!0};a.prototype.isAlarmActive=function(){return this._alarmActive?!0:!1};a.prototype.isPreAlarmActive=
function(){return this._prealarmActive?!0:!1};a.prototype.setAlarm=function(a){this._alarmActive=a?!0:!1};a.prototype.setPreAlarm=function(a){this._prealarmActive=a?!0:!1};a.prototype.toJSON=function(){return{alarm:this._alarmActive,pre_alarm:this._prealarmActive}};a.prototype.fromJSON=function(a){a&&(this._alarmActive=a.alarm,this._prealarmActive=a.pre_alarm)};var f=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler");this._mainHandler=null;this._windowAlarm=new b(this);
this._inoventAccessories={};this._smartguardSettings={}};f.prototype.REHAU_FILE="enocean_rehau.json";f.prototype.init=function(a,b){this._logger.log("trace","init");var e=this;if(this._mainHandler=a)if(a=a.getDeviceHandler())a.on("deleteDevice",function(a){e.onDeleteDevice(a)});this._loadInoventAccessories(function(a,f,g){a&&e._logger.log("warn","init error:"+a.message);f&&(e._inoventAccessories=f);g&&(e._smartguardSettings=g);b&&b()})};f.prototype.getInoventAccessory=function(a){return a?this._inoventAccessories[a]:
null};f.prototype.deleteInoventAccessory=function(a,b){a&&this._inoventAccessories[a]?(delete this._inoventAccessories[a],this._saveData(b)):b&&b()};f.prototype.getSmartguardSetting=function(a){return a?this._smartguardSettings[a]:null};f.prototype.deleteSmartguardSetting=function(a,b){a&&this._smartguardSettings[a]?(delete this._smartguardSettings[a],this._saveData(b)):b&&b()};f.prototype.setHumidityAccessory=function(a,b,f){if(a){var e=this.getInoventAccessory(a);e||(e=new g(a),this._inoventAccessories[a]=
e);if(b&&"string"==typeof b&&"{"==b.charAt(0))try{b=JSON.parse(b)}catch(p){f&&f(Error("invalid humiditySensorID json: "+p.message));return}e.setHumiditySensorID(b);this._saveData(f)}else f&&f(Error("inoventID is null"))};f.prototype.setCo2Accessory=function(a,b,f){if(a){var e=this.getInoventAccessory(a);e||(e=new g(a),this._inoventAccessories[a]=e);e.setCo2SensorID(b);this._saveData(f)}else f&&f(Error("inoventID is null"))};f.prototype.activateSensorRegulation=function(a,b){(a=this.getInoventAccessory(a))&&
a.activateSensorRegulation(b)};f.prototype.deactivateSensorRegulation=function(a){(a=this.getInoventAccessory(a))&&a.deactivateSensorRegulation()};f.prototype.isWindowOpen=function(){var a=this._mainHandler.getDeviceHandler(),b=a.findDeviceWithData("bb-aa-cc"),f=a.findDeviceWithData("d2-06-10");a=a.findDeviceWithData("d2-06-ff");f&&(b=b.concat(f));a&&(b=b.concat(a));f=!1;for(a=0;a<b.length;a++){var g=b[a];if(g&&"open"==g.getBufferedState("window")){f=!0;break}}return f};f.prototype.setAlarm=function(a,
b){this._windowAlarm.setAlarm(a);var e=this._mainHandler.getDeviceHandler(),f=e.findDeviceWithData("bb-aa-cc"),g=e.findDeviceWithData("d2-06-10");e=e.findDeviceWithData("d2-06-ff");g&&(f=f.concat(g));e&&(f=f.concat(e));g=this._mainHandler.getESP3();for(e=0;e<f.length;e++){var k=f[e];k&&(k.executeCommand(g,{value:a?"alarmTaskOn":"alarmTaskOff"}),k.executeCommand(g,{value:a?"preAlarmTaskOn":"preAlarmTaskOff"}))}b&&b()};f.prototype.getAlarm=function(){return this._windowAlarm.getAlarm()};f.prototype.setSmartGuardAlarm=
function(b,f,g){if(b){var e=this._smartguardSettings[b];e||(e=new a(b),this._smartguardSettings[b]=e);e.setAlarm(f);this._saveData(g)}else g&&g(Error("smartguardID invalid"))};f.prototype.setSmartGuardPreAlarm=function(b,f,g){if(b){var e=this._smartguardSettings[b];e||(e=new a(b),this._smartguardSettings[b]=e);e.setPreAlarm(f);this._saveData(g)}else g&&g(Error("smartguardID invalid"))};f.prototype.onReceiveWindowSensorStates=function(a,b){this._windowAlarm.onReceiveWindowSensorStates(a,b)};f.prototype.onDeleteDevice=
function(a){if(a&&(a=a.getAddress()))if(this.getInoventAccessory(a))this.deleteInoventAccessory(a);else if(this.getSmartguardSetting(a))this.deleteSmartguardSetting(a);else{var b=!1,e;for(e in this._inoventAccessories){var f=this._inoventAccessories[e];f&&(f.getHumiditySensorID()==a&&(f.setHumiditySensorID(null),b=!0),f.getCo2SensorID()==a&&(f.setCo2SensorID(null),b=!0))}b&&this._saveData()}};f.prototype.onDeviceEvent=function(a,b){var e=function(a){for(var b=null,e=0;e<a.length;e++){var f=a[e];if(f&&
"humidity"==f.key){b=f.value;break}}return b},f=function(a){for(var b=null,e=0;e<a.length;e++){var f=a[e];if(f&&"co2"==f.key){b=f.value;break}}return b};if(a){var g="ENOCEAN";a.getType&&(g=a.getType());g||(g="ENOCEAN");var k=a.getAddress();if(k)if("HM"==g){if(b){this._logger.log("trace","process homematic device ("+k+") events:"+JSON.stringify(b));for(var u in this._inoventAccessories)if(a=this._inoventAccessories[u])(e=a.getHumiditySensorID())&&e.key&&e.address==k&&(g=b[e.key],void 0!=g&&null!=g&&
a.executeHumidityRegulation(g)),(e=a.getHumiditySensorID())&&e.key&&e.address==k&&(g=b[e.key],void 0!=g&&null!=g&&a.executeCo2Regulation(g))}}else if("ENOCEAN"==g&&a.getData){this._logger.log("trace","process enocean device ("+k+") events:"+JSON.stringify(b));g=null;switch(a.getData()){case "a5-04-01":case "a5-04-03":case "a5-10-12":g=e(b);break;case "a5-09-08":case "a5-09-09":g=f(b);break;default:return}if(void 0!=g&&null!=g)for(u in this._inoventAccessories)if(a=this._inoventAccessories[u])a.getHumiditySensorID()==
k&&a.executeHumidityRegulation(g),a.getCo2SensorID()==k&&a.executeCo2Regulation(g)}}};f.prototype._loadInoventAccessories=function(a){var b=this;this._loadFile(function(e,f){e?a&&a(e):(e=b._jsonToAccessoriesMap(f),f=b._jsonToSmartGuardSettingsMap(f),a&&a(null,e,f))})};f.prototype._jsonToAccessoriesMap=function(a){if(!a||!a.inovent)return{};var b={},e;for(e in a.inovent){var f=a.inovent[e];if(f){var p=new g(e);p.fromJSON(f);b[e]=p}}return b};f.prototype._jsonToSmartGuardSettingsMap=function(b){if(!b||
!b.smartguard)return{};var e={},f;for(f in b.smartguard){var g=b.smartguard[f];if(g){var p=new a(f);p.fromJSON(g);e[f]=p}}return e};f.prototype._loadFile=function(a){var b=this._getFilePath();fs_extra.ensureFile(b,function(e){e?a&&a(e):fs_extra.readFile(b,"utf8",function(b,e){if(b)a&&a(b);else if(e)try{var f=JSON.parse(e);a&&a(null,f)}catch(u){a&&a(u)}else a&&a(null,{})})})};f.prototype._getFilePath=function(){var a=require("x.hub.fileman.js").fileManager,b=require("path");require("fs");a=a.getUserRootDataPath();
return b.resolve(a,this.REHAU_FILE)};f.prototype._saveData=function(a){var b=this._accessoriesMapToJson(this._inoventAccessories),e=this._settingsMapToJson(this._smartguardSettings);this._saveFile({inovent:b?b:{},smartguard:e?e:{}},function(b){a&&a(b)})};f.prototype._accessoriesMapToJson=function(a){if(!a)return{};var b={},e;for(e in a){var f=a[e];f&&(f=f.toJSON(),b[e]=f)}return b};f.prototype._settingsMapToJson=function(a){if(!a)return{};var b={},e;for(e in a){var f=a[e];f&&(f=f.toJSON(),b[e]=f)}return b};
f.prototype._saveFile=function(a,b){var e=this._getFilePath();fs_extra.writeFile(e,JSON.stringify(a,null,2),function(a){b&&b(a)})};return f}();
x.hub.m.enocean.SDK=function(){var g=function(b){this._handler=b};g.prototype.send_SA_RD_LEARNEDCLIENTS=function(b,a){b=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_RD_LEARNEDCLIENTS;this._handler._esp3.sendSACommand(b,!0,function(b,e){a&&a(b,e)})};g.prototype.send_SA_WR_RESET=function(b,a){b&&b.saClientId?(b=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_RESET(b.saClientId),this._handler._esp3.sendSACommand(b,!0,function(b,e){a&&a(b,e)})):a&&a(Error("params invalid"))};g.prototype.send_SA_WR_POSTMASTER=function(b,
a){b?(b.mailboxCount||(b.mailboxCount=0),b=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_POSTMASTER(b.mailboxCount),this._handler._esp3.sendSACommand(b,!0,a)):a&&a(Error("params invalid"))};g.prototype.send_CO_WR_REPEATER=function(b,a){b?(b.enable||(b.enable=0),b.level||(b.level=0),b=new x.hub.m.enocean.ESP3.COMMAND_COMMAND.CO_WR_REPEATER(b.enable,b.level),this._handler._esp3.sendCommandCommand(b,!0,a)):a&&a(Error("params invalid"))};return g}();
x.hub.m.enocean.USBHandler=function(){var g=function(b){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.USBHandler");this._handler=b;this._usbDevices=[];this._connectedDevice=null};g.prototype.attachSerial=function(b){this._logger.log("debug","attach usb port:"+b);var a=this._usbDevices.length;this._usbDevices.push({port:b});0==a&&this._attachNextDevice()};g.prototype.removeSerial=function(b){this._logger.log("debug","remove usb port:"+b);var a=this._handler._esp3.getSerial();a&&a.getPort()==
b&&this._handler._esp3.removeSerial(b);this._connectedDevice&&this._connectedDevice.port==b&&(this._connectedDevice=null)};g.prototype._attachNextDevice=function(){if(0!=this._usbDevices.length){var b=this._usbDevices[0],a=this;this._logger.log("debug","connect usb port:"+b.port);this._handler._esp3.attachSerial(b.port,function(f){f?(a._logger.log("debug",b.port+" is not a enocean usb device, error:"+f.message),a._usbDevices.splice(0,1),a._attachNextDevice()):(a._logger.log("debug","success to connect to enocean usb device on port:"+
b.port),a._connectedDevice=b,a._usbDevices=[])})}};return g}();
x.hub.m.enocean.Handler=function(){var g=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Handler");this._secHandler=new this.SecurityHandler(this);this._deviceHandler=new this.DeviceHandler(this);this._esp3=new x.hub.m.enocean.ESP3(this);this._learnHandler=new this.LearnHandler(this);this._siegeniaHandler=new x.hub.m.enocean.SiegeniaHandler(this._esp3);this._rehauHandler=new x.hub.m.enocean.RehauHandler;this._trackers=[];this._sdk=new x.hub.m.enocean.SDK(this);this._usb=
new x.hub.m.enocean.USBHandler(this)};util.inherits(g,EventEmitter);g.prototype.SENSOR_FILE="enocean.json";g.prototype.SECURITY_FILE="enocean_sec.json";g.prototype.profiles=x.hub.m.enocean.profiles;g.prototype.ESP3=x.hub.m.enocean.ESP3;g.prototype.SecurityHandler=x.hub.m.enocean.SecurityHandler;g.prototype.LearnHandler=x.hub.m.enocean.LearnHandler;g.prototype.DeviceHandler=x.hub.m.enocean.DeviceHandler;g.prototype.getDeviceHandler=function(){return this._deviceHandler};g.prototype.getRehauHandler=
function(){return this._rehauHandler};g.prototype.getESP3=function(){return this._esp3};g.prototype.init=function(b){localStorage&&localStorage.getItem("x.hub.m.enocean.SENDER_ID")&&(x.hub.m.enocean.SENDER_ID=localStorage.getItem("x.hub.m.enocean.SENDER_ID"));var a=this,f=require("x.hub.eventbus.js");f.on("x.hub.peripheralman.ADD_ENOCEAN",function(b){console.log("ADD_ENOCEAN",b);a._usb.attachSerial(b.port)});f.on("x.hub.peripheralman.REMOVE_ENOCEAN",function(b){console.log("REMOVE_ENOCEAN",b);a._usb.removeSerial(b.port)});
f.on("x.hub.peripheralman.ADD_SEIRAL",function(b){console.log("ADD_SEIRAL",b);b.type||a._usb.attachSerial(b.port)});f.on("x.hub.peripheralman.REMOVE_SEIRAL",function(b){console.log("REMOVE_SEIRAL",b);b.type||a._usb.removeSerial(b.port)});global.ENOCEAN_PORT&&"A20"!=global.PLATFORM&&"PI2"!=global.PLATFORM&&a._usb.attachSerial(global.ENOCEAN_PORT);f.on("gatewayevent",function(b,f,g){if(b&&f&&"ENOCEAN"!=f.address&&"STA"==g)a._rehauHandler.onDeviceEvent({_type:b.type,_adr:b.adr,getType:function(){return this._type},
getAddress:function(){return this._adr}},b.state)});this._secHandler.init(function(){a._rehauHandler.init(a,function(){a._deviceHandler.init(function(){b&&b({})})})})};g.prototype.getSystems=function(){return["enocean"]};g.prototype.addStateDevice=function(b,a){a&&a({})};g.prototype.getAllStates=function(){var b=[],a=this._deviceHandler.getAllDevices(),f;for(f in a)if(a.hasOwnProperty(f)){var e=a[f];e&&b.push({device:e.toJSON(),states:e.getStatesBuffer()})}return b};g.prototype.getStates=function(b){if(!b||
!b.address)return null;var a=null;(b=this._deviceHandler.getDevice(b.address.toLowerCase()))&&(a=b.getStatesBuffer());return a};g.prototype.getState=function(b,a,f){var e=this.getStates(b),g=null;e&&"undefined"!=typeof e[a]&&null!=e[a]?(g=e[a],f&&f({data:g})):f&&this.updateStates(b,function(b){b.error?f&&f(b):(b.data&&(g=e[a]),f({data:g}))});return g};g.prototype.executeCommand=function(b,a,f){this._esp3._baseID?this._esp3._baseID.toLowerCase()!=x.hub.m.enocean.SENDER_ID.toLowerCase()?f&&f({error:Error("enocean stick has a different baseID")}):
b&&b.address?((b=b.address)&&(b=b.toLowerCase()),(b=this._deviceHandler.getDevice(b))?b.executeCommand?b.executeCommand(this._esp3,a,function(a){f&&f({error:a})}):f&&f({error:Error("device dese not support command")}):f&&f({error:Error("no such device")})):f&&f({error:Error("device invalid")}):f&&f({error:Error("enocean stick not found")})};g.prototype.checkDeviceMatch=function(b,a){if(!(a&&a.device&&b&&b.device))return!1;(b=b.device.address)&&(b=b.toLowerCase());(a=a.device.address)&&(a=a.toLowerCase());
return b==a};g.prototype.updateStates=function(b,a){a&&a({error:Error("not supported yet")})};g.prototype.executeCommandLegacy=function(b,a,f,e){b?e&&e({error:Error("not supported yet")}):this._esp3?a?this.executeCommand({address:a},{value:f},function(a){e&&e({error:a?a.error:null})}):e&&e({error:Error("address invalid")}):e&&e({error:Error("not inited")})};g.prototype.getAllStatesLegacy=function(b,a){var f=[],e=this.getAllStates(),g=this._secHandler.getUnsyncDevice(),h=this;e.forEach(function(b){if(b&&
b.device&&b.states){var e=b.device.address,k={type:"ENOCEAN",adr:e,data:b.device.data,vendor:b.device.vendor,state:{}},l;for(l in b.states)k.state[l]=b.states[l].value;h._secHandler.isSecureDevice(e)?(k.deviceProtocol="secure",k.state.security_state=g[e]?"nok":"ok"):k.deviceProtocol="normal";a&&"1"==a.config&&(k.senderID=b.device.senderID,k.virtual=b.device.virtual,k.params=b.device.params,e&&g[e]&&(k.rlc_unsync=!0));f.push(k)}});b&&b({data:f})};g.prototype.getEnoceanInfo=function(){return{baseID:x.hub.m.enocean.SENDER_ID,
usb_connected:null!=this._esp3._serial,usb_baseID:this._esp3._baseID,num_free_senderID:this._deviceHandler.getFreeSenderIdCount()}};g.prototype.learnDevice=function(b,a){var f=b?b.senderID:null,e=b?b.data:null,g=b?b.vendor:null,h=b?b.address:null;if(h){e=this._deviceHandler.findDevice(b);if(!e){a&&a({error:Error("device not found")});return}var l=e.toJSON();e=l.data;g=l.vendor;f||(sednerID=l.senderID)}l={};l.saLearnMode=b?b.saLearnMode:null;this._learnHandler.learn(e,h,f,g,null,function(b,e,f){b?
a&&a({error:b}):(b={},1==e?b.op=1:(b=f.toJSON(),b.op=0),a&&a({data:b}))},l)};g.prototype.learnSoda=function(b){if(this._esp3._serial){var a=this,f=setTimeout(function(){a._esp3.removeListener(e);b&&b({error:Error("learn timeout")})},2E4),e={_onEOTelegram:function(g){if(246==g.rorg&&(192==g.userData||208==g.userData||240==g.userData)){clearTimeout(f);a._esp3.removeListener(e);var h={address:g.senderID,data:"f6-so-da",vendor:"soda"};a.addSensor(g.senderID,"f6-so-da","soda",null,function(a){a.error?
b&&b(a):b&&b({data:h})})}}};this._esp3.addListener(e)}else b&&b({error:Error("port not opened")})};g.prototype.teachinDevice=function(b,a){if(b)if(b.data){b.adr&&!b.address&&(b.address=b.adr);var f=this._deviceHandler.findDevice(b);f=f?f.toJSON():b;b.data!=f.data?a&&a({error:Error("device of another type with the same address exists")}):b.vendor&&b.vendor!=f.vendor?a&&a({error:Error("device of another vendor with the same address exists")}):this._learnHandler.teachin(f.data,f.address,f.senderID,f.vendor,
function(b,f,g){b?a&&a({error:b}):(b={},f&&(b=f.toJSON()),g&&(b.op=g),a&&a({data:b}))})}else a&&a({error:Error("data is null")});else a&&a({error:Error("query is null")})};g.prototype.generateVirtualDevice=function(b,a){this._deviceHandler.generateVirtual(b,function(b,e){a&&a({error:b,data:e?e.toJSON():null})})};g.prototype._onEOFrame=function(b,a){this._trackers.forEach(function(f){f.onFrame(b,a)})};g.prototype._onEOTelegram=function(b){this._trackers.forEach(function(a){a.onTelegram(b)});var a=
this._deviceHandler.getDevice(b.senderID);if(a){var f=this;a.evalData(this._esp3,b,function(b,g){b||0==g.length||f._onEOEvents(a,g)})}};g.prototype._onEOEvents=function(b,a){var f=require("x.hub.eventbus.js");this._trackers.forEach(function(e){e.onResolveEvents(b._address,a)});this._rehauHandler.onDeviceEvent(b,a);var e=b.toJSON();e.sys="aio";e.type="ENOCEAN";for(var g=0,h=0;h<a.length;h++){var l=a[h];if(l)if("shortPress"==l.value||"longPress"==l.value||"pressed"==l.value||"released"==l.value){g++;
var p={type:"ENOCEAN",adr:e.address,data:e.data,vendor:e.vendor,state:{}};p.state[l.key]=l.value;f.emit("gatewayevent",p,{address:"ENOCEAN"},"BTN")}else if("d2-06-50"==e.data&&"burglary"==l.key){p={type:"ENOCEAN",adr:e.address,data:e.data,vendor:e.vendor,state:{}};p.state[l.key]=l.value;f.emit("gatewayevent",p,{address:"ENOCEAN"},"STA");return}}if(g==a.length)(e=b.getStatesLegacy())&&f.emit("udpevent",e,"STA");else if(e=b.getStatesLegacy())f.emit("gatewayevent",e,{address:"ENOCEAN"},"STA"),f.emit("udpevent",
e,"STA")};g.prototype._saveEnoceanEvents=function(b,a){var f=require("x.hub.datastore.js").dataStore;f&&f.openDB(function(e,f){if(!e){e=b._address;for(var g=[],k=(new Date).toISOString(),p=0;p<a.length;p++){var q=a[p];if(q&&q.changed){q=q.key+":"+q.value;var u=null;u=0==g.length?"SELECT '"+e+"' AS 'window', '"+q+"' AS 'state', '"+k+"' AS 'time'":"UNION ALL SELECT '"+e+"', '"+q+"', '"+k+"'";g.push(u)}}0<g.length&&(e=g.join(" "),f.run("INSERT INTO windowstate(window, state, time) "+e+";",function(a){f.close()}))}})};
g.prototype.addSensor=function(b,a){b?b.data?"siegenia"!=b.vendor||b.params?this._deviceHandler.addDevice(b,function(b,e){a&&a({error:b,data:e?e.toJSON():null})}):a&&a({error:Error("siegenia windows params is null")}):a&&a({error:Error("enocean profile is null")}):a&&a({error:Error("enocean device is null")})};g.prototype.updateSensor=function(b,a,f){b?a?this._deviceHandler.updateDevice(b,a,function(a,b){f&&f({error:a,data:b?b.toJSON():null})}):f&&f({error:Error("device info is null")}):f&&f({error:Error("device address is null")})};
g.prototype.delSensor=function(b,a){b?this._deviceHandler.deleteDevice({address:b},function(b){a&&a({error:b})}):a&&a({error:Error("enocean id is null")})};g.prototype.resetDefaultSenderID=function(b){x.hub.m.enocean.SENDER_ID=null;localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID","");b&&b({})};g.prototype.setRehauAlarm=function(b,a){this._rehauHandler.setAlarm(b,a)};g.prototype.isRehauWindowOpen=function(){return this._rehauHandler.isWindowOpen()};g.prototype.setInoventHumidityAccessory=
function(b,a,f){this._rehauHandler.setHumidityAccessory(b,a,function(a){f&&f({error:a})})};g.prototype.setInoventCo2Accessory=function(b,a,f){this._rehauHandler.setCo2Accessory(b,a,function(a){f&&f({error:a})})};g.prototype.getInoventAccessories=function(b,a){b=this._rehauHandler.getInoventAccessory(b);a&&a({data:b?b.toJSON():{}})};g.prototype.__addTelegramTracker=function(b){b&&b.onTelegram&&b.onResolveEvents&&-1==this._trackers.indexOf(b)&&this._trackers.push(b)};g.prototype.__removeTelegramTracker=
function(b){b&&(b=this._trackers.indexOf(b),-1!=b&&this._trackers.splice(b,1))};g.prototype.__sendEspFrame=function(b,a,f,e,g){a=a?new Buffer(a,"hex"):null;f=f?new Buffer(f,"hex"):null;e=e?!0:!1;b=new x.hub.m.enocean.ESP3.ESP3_Frame(b,a,f);this._esp3.sendFrame(b,e,function(a,b){g&&g({error:a,data:b?b.toJSON():null})})};g.prototype.__simulateRawEnoceanPacket=function(b,a){this._esp3.onSerialData(new Buffer(b,"hex"));a&&a()};g.prototype._doSDK=function(b,a){if(b&&b.method){var f="send_"+b.method;if(this._sdk[f])this._sdk[f](b.params,
function(b){a&&a({error:b})});else a&&a({error:Error("no such method")})}else a&&a({error:Error("data invalid")})};return g}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.enocean.Handler);
