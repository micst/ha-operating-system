var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.nanoleaf=xnm.aio.nanoleaf||{};
xnm.aio.nanoleaf={API_BASE_V1:"/api/v1",PORT_DEFAULT:16021,_logger:{log:function(){}},_buildRequestOptions:function(a,b,c,d){var e=xnm.aio.nanoleaf.API_BASE_V1;a.token&&"new"!==c.path&&(e+="/"+a.token);e+="/"+c.path;a={host:a.ip,port:a.port,path:e,method:b,headers:{"Content-Type":'application/json; charset="utf-8"',Connection:"close"}};"string"===typeof d&&(a.headers["Content-Length"]=d.length);return a},_handleResponse:function(a,b,c,d){if(200===c.statusCode){var e="";c.on("data",function(a){e+=
String(a)});c.on("end",function(){if("json"===b.dataType)try{e=JSON.parse(e)}catch(h){xnm.aio.nanoleaf._logger.log("error","[_handleResponse] Failed to parse result as JSON: "+h.message)}d&&d(null,{statusCode:c.statusCode,response:e});d=null})}else 204===c.statusCode?d&&d(null,{statusCode:c.statusCode,response:null}):(a=Error(a+' request for "'+b.path+'" failed with status code '+c.statusCode),xnm.aio.nanoleaf._logger.log("error","[_handleResponse] "+a.message),d&&d(a,{statusCode:c.statusCode,response:null}))},
doRequest:function(a,b,c,d){var e=null;if("undefined"!==typeof c.data&&null!==c.data)try{e=JSON.stringify(c.data)}catch(g){xnm.aio.nanoleaf._logger.log("error","[doRequest] Failed to parse body. Error: "+g.message);d&&d(g,null);return}var h=require("http");a=xnm.aio.nanoleaf._buildRequestOptions(a,b,c,e);h=h.request(a,function(a){xnm.aio.nanoleaf._handleResponse(b,c,a,d)});"function"===typeof h.setEncoding&&h.setEncoding("utf8");if("function"===typeof h.on)h.on("error",function(a){a&&xnm.aio.nanoleaf._logger.log("error",
"[doRequest] Error: "+a.message);d&&d(a);d=null});"number"!==typeof c.timeout||isNaN(c.timeout)||"function"!==typeof h.setTimeout||h.setTimeout(c.timeout);e&&h.write(e);h.end()},parseJSON:function(a){!a.type&&a.model&&("NL22"===a.model?a.type="panel":"NL29"===a.model&&(a.type="canvas"));if(!a||!a.ip||!a.type)return xnm.aio.nanoleaf._logger.log("warn","[parseJSON] Missing IP and/or type."),null;if("panel"===a.type)return new xnm.aio.nanoleaf.Panel(a.ip,a);if("canvas"===a.type)return new xnm.aio.nanoleaf.Canvas(a.ip,
a);xnm.aio.nanoleaf._logger.log("warn","[parseJSON] Unknown type: "+a.type);return null},rgb2hsv:function(a){a=a.replace("#","");var b=0,c=0;var d=0;if(6===a.length){d=a.substring(0,2);var e=a.substring(2,4);a=a.substring(4,6)}else if(3===a.length)d=a[0],d+=d,e=a[1],e+=e,a=a[2],a+=a;else return[b,c,d];d=parseInt(d,16)/255;e=parseInt(e,16)/255;a=parseInt(a,16)/255;var h=Math.max(Math.max(d,e),a),g=h-Math.min(Math.min(d,e),a);b=-1;c=0;0!==h&&(b=0,c=g/h,0!==g&&(b=60*(d===h?(e-a)/g:e===h?2+(a-d)/g:4+
(d-e)/g),0>b&&(b+=360)));b=Math.round(b);c=Math.round(100*c);d=Math.round(100*h);return[b,c,d]}};
xnm.aio.nanoleaf.DM={MAP:{device:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}},{type:"int",name:"brightness",ref:{value:"brightness",ext:"%d",extMeta:"0-100"}},{type:"int",name:"brightness relative change",ref:{value:"brightnessInc",ext:"%d",extMeta:"-100-100"}},{type:"rgb",name:"color",ref:{value:"color",ext:"%rgb"}},{type:"int",name:"color temperature",ref:{value:"ct",ext:"%d",extMeta:"1200-6500"}},
{type:"enum",name:"identify",ref:{value:"identify"}},{type:"dynamic",name:"set scene",ref:{value:"scene",ext:"%dynamic"}},{type:"enum",name:"select next scene",ref:{value:"sceneNext"}},{type:"enum",name:"select previous scene",ref:{value:"scenePrev"}},{type:"enum",name:"select random scene",ref:{value:"sceneRandom"}}],status:[{type:"enum",name:"state",ref:{value:"on",value_t:"state",options:["on","off"]}},{type:"int",name:"brightness",ref:{value:"brightness",extMeta:"0-100"}},{type:"enum",name:"color mode",
ref:{value:"colorMode",options:["ct","effect","hs"]}},{type:"int",name:"color temperature",ref:{value:"ct",extMeta:"1200-6500"}},{type:"int",name:"hue",ref:{value:"hue",extMeta:"0-360"}},{type:"int",name:"saturation",ref:{value:"sat",extMeta:"0-100"}},{type:"dynamic",name:"scene name",ref:{value:"effectSelected",ext:"%dynamic"}},{type:"int",name:"scene index",ref:{value:"effectIndex"}},{type:"string",name:"device name",ref:{value:"name",value_t:"deviceName"}},{type:"string",name:"model",ref:{value:"model"}},
{type:"string",name:"serial number",ref:{value:"serialNo"}},{type:"string",name:"firmware version",ref:{value:"firmwareVersion"}},{type:"int",name:"number of panels",ref:{value:"numPanels"}}],ipevt:[{type:"enum",name:"state",ref:{value:"on",options:["on","off"]}},{type:"int",name:"brightness",ref:{value:"brightness",extMeta:"0-100"}},{type:"enum",name:"color mode",ref:{value:"colorMode",options:["ct","effect","hs"]}},{type:"int",name:"color temperature",ref:{value:"ct",extMeta:"1200-6500"}},{type:"int",
name:"hue",ref:{value:"hue",extMeta:"0-360"}},{type:"int",name:"saturation",ref:{value:"sat",extMeta:"0-100"}},{type:"dynamic",name:"scene name",ref:{value:"effectSelected",ext:"%dynamic"}}]}},SYS:"nanoleaf",applyIPEventFilter:function(a,b){return a&&a.type?(a=xnm.aio.nanoleaf.DM.getIPevtMap(a))?{ipevt:a}:null:null},applyUIFilter:function(a,b,c){if(!a.sys)return null;var d=function(a,b){if("*"===a||"*"===a[0])return!0;for(var c=0;c<a.length;c++)if(a[c]==b)return!0;return!1},e=function(a,b,c){var e=
[];switch(c.catagory){case "command":a.command&&a.command.forEach(function(a){d(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){d(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))})}return e},h=function(a,b){var d=[],h=xnm.aio.nanoleaf.DM.getCommandStatusMap(a,c);h&&(a=e(h,a,b),d=d.concat(a));return d},g=JSON.parse(JSON.stringify(a)),f=null;switch(b.catagory){case "command":f=h(a,b);g.command=f;break;case "status":f=
h(a,b);g.status=f;break;default:return null}return f&&0!=f.length?g:null},createDevice:function(a,b,c){b=xnm.aio.nanoleaf.DM;a?a.type?a.ip?c(null,a):c(new b.Error(b.Error.ERROR_CODE.INVALID,"IP is missing")):c(new b.Error(b.Error.ERROR_CODE.INVALID,"type is missing")):c(new b.Error(b.Error.ERROR_CODE.INVALID,"info is missing"))},deleteDevice:function(a,b,c){a.ip&&a.token?(a=xnm.aio.nanoleaf.parseJSON(a))?a.deleteUser(function(a){c()}):c():c()},getCommandStatusMap:function(a,b){return a.type?xnm.aio.nanoleaf.DM.MAP[a.type]:
null},getIPDeviceType:function(){return[{sys:xnm.aio.nanoleaf.DM.SYS,name:"Nanoleaf"}]},getIPevtMap:function(a){return a.type?xnm.aio.nanoleaf.DM.MAP[a.type].ipevt||null:null},toGeneralDevice:function(a){return{type:"dimmer",commands:{brightness:{value:{type:"INT",min:0,max:100}},color:{value:{type:"RGB"}},colorTemperature:{value:{type:"INT",min:1200,max:6500}},down:{value:{type:"INT",min:-100,max:100}},off:{},on:{},toggle:{},up:{value:{type:"INT",min:-100,max:100}},white:{}},states:{brightness:{type:"INT",
min:0,max:100,unit:"%"},colorTemperature:{type:"INT",min:1200,max:6500},state:{values:["on","off"]}},details:{commands:{brightness:{value:"brightness",ext:"%d",extMeta:"0-100"},color:{value:"color"},colorTemperature:{value:"ct",ext:"%d",extMeta:"1200-6500"},down:{value:"brightnessInc",ext:"-10"},off:{value:"off"},on:{value:"on"},toggle:{value:"toggle"},up:{value:"brightnessInc",ext:"10"},white:{value:"color",ext:"#FFFFFF"}},states:{brightness:{value:"brightness"},colorTemperature:{value:"ct"},state:{value:"on"}}}}},
updateDevice:function(a,b,c){b=xnm.aio.nanoleaf.DM;a?a.type?a.ip?c(null,a):c(new b.Error(b.Error.ERROR_CODE.INVALID,"IP is missing")):c(new b.Error(b.Error.ERROR_CODE.INVALID,"type is missing")):c(new b.Error(b.Error.ERROR_CODE.INVALID,"info is missing"))}};xnm.aio.nanoleaf.DM.MAP.canvas={command:xnm.aio.nanoleaf.DM.MAP.device.command.slice(0),status:xnm.aio.nanoleaf.DM.MAP.device.status.slice(0),ipevt:xnm.aio.nanoleaf.DM.MAP.device.ipevt.slice(0)};
xnm.aio.nanoleaf.DM.MAP.canvas.ipevt.push({type:"enum",name:"gesture: tap",ref:{value:"gestureTap",options:["single tap","double tap"]}},{type:"dynamic",name:"gesture: single tap on panel of ID",ref:{value:"gestureSingleTapPanel",ext:"%dynamic"}},{type:"dynamic",name:"gesture: double tap on panel of ID",ref:{value:"gestureDoubleTapPanel",ext:"%dynamic"}},{type:"enum",name:"gesture: swipe",ref:{value:"gestureSwipe",options:["swipe up","swipe down","swipe left","swipe right"]}});
xnm.aio.nanoleaf.DM.MAP.panel={command:xnm.aio.nanoleaf.DM.MAP.device.command.slice(0),status:xnm.aio.nanoleaf.DM.MAP.device.status.slice(0),ipevt:xnm.aio.nanoleaf.DM.MAP.device.ipevt.slice(0)};xnm.aio.nanoleaf.DM.MAP.panel.command.push({type:"enum",name:"Rhythm: select source",ref:{value:"rhythmMode",ext:"%e",extMeta:["aux","microphone"]}});
xnm.aio.nanoleaf.DM.MAP.panel.status.push({type:"enum",name:"Rhythm: connected",ref:{value:"rhythmConnected",options:["true","false"]}},{type:"enum",name:"Rhythm: state",ref:{value:"rhythmActive",options:["on","off"]}},{type:"enum",name:"Rhythm: source",ref:{value:"rhythmMode",options:["microphone","aux"]}},{type:"enum",name:"Rhythm: aux connected",ref:{value:"auxAvailable",options:["true","false"]}});xnm.aio.nanoleaf.DM.Error=function(a,b){this.code=a;this.message=b;this.stack=Error().stack};
xnm.aio.nanoleaf.DM.Error.prototype=Error();xnm.aio.nanoleaf.DM.Error.prototype.name="NanoleafDMError";xnm.aio.nanoleaf.DM.Error.prototype.code=0;xnm.aio.nanoleaf.DM.Error.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOWN:4,NOT_FOUND:5,IP_EXISTS:6};
xnm.aio.nanoleaf.Device=function(a,b){this.ip=a;this.port=xnm.aio.nanoleaf.PORT_DEFAULT;this.type=this.token=null;b&&(this.firmware=b.firmware||null,this.id=b.id||null,this.model=b.model||null,this.port=b.port||this.port,this.token=b.token||null)};
xnm.aio.nanoleaf.Device.prototype={authorize:function(a){xnm.aio.nanoleaf._logger.log("debug","[Device.authorize] Sending request.");xnm.aio.nanoleaf.doRequest(this,"POST",{dataType:"json",path:"new",timeout:3E4},function(b,c){b?a&&a(b,null):c.response?(b=c.response.auth_token)&&"string"===typeof b?(xnm.aio.nanoleaf._logger.log("debug","[Device.authorize] Received auth token."),a&&a(null,b)):(b=Error("Authorization response did not contain a token."),xnm.aio.nanoleaf._logger.log("error","[Device.authorize] "+
b.message),a&&a(b,null)):(b=Error("Authorization request did return neither error nor response. Status code: "+c.statusCode),xnm.aio.nanoleaf._logger.log("error","[Device.authorize] "+b.message),a&&a(b,null))})},cmdIdentify:function(a){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdIdentify] Sending request.");xnm.aio.nanoleaf.doRequest(this,"PUT",{path:"identify"},function(b,c){a&&a(b,null)})},cmdIncrementBrightness:function(a,b){"number"!==typeof a||isNaN(a)||-100>a||100<a?(a=Error("Invalid value for brightness: "+
a),xnm.aio.nanoleaf._logger.log("error","[Device.cmdIncrementBrightness] "+a.message),b&&b(a,null)):(a={data:{brightness:{increment:a}},path:"state"},xnm.aio.nanoleaf._logger.log("trace","[Device.cmdIncrementBrightness] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",a,function(a,d){b&&b(a,null)}))},cmdNextScene:function(a){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdNextScene] Requesting effectsList to find next scene.");var b=this;xnm.aio.nanoleaf.doRequest(this,"GET",{dataType:"json",
path:"effects"},function(c,d){c?a&&a(c,null):(c=d.response.effectsList,Array.isArray(c)&&0!==c.length?(d=c.indexOf(d.response.select)+1,d>=c.length&&(d=0),b.cmdSetScene(c[d],a)):(c=Error("effectsList is not an array or empty."),xnm.aio.nanoleaf._logger.log("error","[Device.cmdNextScene] "+c.message),a&&a(c,null)))})},cmdOff:function(a){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdOff] Sending request.");xnm.aio.nanoleaf.doRequest(this,"PUT",{data:{on:{value:!1}},path:"state"},function(b,c){a&&
a(b,null)})},cmdOn:function(a){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdOn] Sending request.");xnm.aio.nanoleaf.doRequest(this,"PUT",{data:{on:{value:!0}},path:"state"},function(b,c){a&&a(b,null)})},cmdPrevScene:function(a){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdPrevScene] Requesting effectsList to find next scene.");var b=this;xnm.aio.nanoleaf.doRequest(this,"GET",{dataType:"json",path:"effects"},function(c,d){c?a&&a(c,null):(c=d.response.effectsList,Array.isArray(c)&&0!==c.length?
(d=c.indexOf(d.response.select)-1,-1===d?d=c.length-1:-1>d&&(d=0),b.cmdSetScene(c[d],a)):(c=Error("effectsList is not an array or empty."),xnm.aio.nanoleaf._logger.log("error","[Device.cmdPrevScene] "+c.message),a&&a(c,null)))})},cmdRandomScene:function(a){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdRandomScene] Requesting effectsList.");var b=this;xnm.aio.nanoleaf.doRequest(this,"GET",{dataType:"json",path:"effects"},function(c,d){c?a&&a(c,null):(c=d.response.effectsList,Array.isArray(c)&&0!==
c.length?(d=c.indexOf(d.response.select),0<=d&&c.splice(d,1),b.cmdSetScene(c[Math.floor(Math.random()*c.length)],a)):(c=Error("effectsList is not an array or empty."),xnm.aio.nanoleaf._logger.log("error","[Device.cmdRandomScene] "+c.message),a&&a(c,null)))})},cmdSetBrightness:function(a,b){"number"!==typeof a||isNaN(a)||0>a||100<a?(a=Error("Invalid value for brightness: "+a),xnm.aio.nanoleaf._logger.log("error","[Device.cmdSetBrightness] "+a.message),b&&b(a,null)):(a={data:{brightness:{value:a}},
path:"state"},xnm.aio.nanoleaf._logger.log("trace","[Device.cmdSetBrightness] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",a,function(a,d){b&&b(a,null)}))},cmdSetColor:function(a,b){a=xnm.aio.nanoleaf.rgb2hsv(a);a={data:{hue:{value:a[0]},sat:{value:a[1]},brightness:{value:a[2]}},path:"state"};xnm.aio.nanoleaf._logger.log("trace","[Device.cmdSetColor] Sending request.");xnm.aio.nanoleaf.doRequest(this,"PUT",a,function(a,d){b&&b(a,null)})},cmdSetColorTemperature:function(a,b){"number"!==
typeof a||isNaN(a)||1200>a||6500<a?(a=Error("Invalid value for color temperature: "+a),xnm.aio.nanoleaf._logger.log("error","[Device.cmdSetColorTemperature] "+a.message),b&&b(a,null)):(a={data:{ct:{value:a}},path:"state"},xnm.aio.nanoleaf._logger.log("trace","[Device.cmdSetColorTemperature] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",a,function(a,d){b&&b(a,null)}))},cmdSetScene:function(a,b){a={data:{select:a},path:"effects"};xnm.aio.nanoleaf._logger.log("trace","[Device.cmdSetScene] Sending request.");
xnm.aio.nanoleaf.doRequest(this,"PUT",a,function(a,d){b&&b(a,null)})},cmdToggle:function(a){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdToggle] Requesting state first, before deciding command.");var b=this;xnm.aio.nanoleaf.doRequest(this,"GET",{dataType:"json",path:"state/on"},function(c,d){c?a&&a(c,null):d.response.value?b.cmdOff(a):b.cmdOn(a)})},deleteUser:function(a){xnm.aio.nanoleaf._logger.log("debug","[Device.deleteUser] Sending request.");xnm.aio.nanoleaf.doRequest(this,"DELETE",{path:""},
function(b,c){a(b)})},equalsTo:function(a){return a&&a instanceof xnm.aio.nanoleaf.Device?this.ip===a.ip&&this.type===a.type&&this.token===a.token:!1},executeCommand:function(a,b,c){if(this.token)if(a=xnm.aio.nanoleaf.parseJSON(a))switch(b.value){case "brightness":a.cmdSetBrightness(b.ext,c);break;case "brightnessInc":a.cmdIncrementBrightness(b.ext,c);break;case "color":a.cmdSetColor(b.ext,c);break;case "ct":a.cmdSetColorTemperature(b.ext,c);break;case "identify":a.cmdIdentify(c);break;case "off":a.cmdOff(c);
break;case "on":a.cmdOn(c);break;case "rhythmMode":a.cmdSetRhythmMode(b.ext,c);break;case "scene":a.cmdSetScene(b.ext,c);break;case "sceneNext":a.cmdNextScene(c);break;case "scenePrev":a.cmdPrevScene(c);break;case "sceneRandom":a.cmdRandomScene(c);break;case "toggle":a.cmdToggle(c);break;default:b=Error("Unknown command: "+b.value),xnm.aio.nanoleaf._logger.log("warn","[Device.executeCommand] "+b.message),c(b,null)}else b=Error("Could not create device from data."),c&&c(b,null);else b=Error("Request not possible without a token."),
c&&c(b,null)},executeCommandCreator:function(a,b,c){b&&b.value?this.executeCommand(a,b,function(a){c&&c(a)}):c&&c(Error("Command value is empty."))},getState:function(a){if(this.token)xnm.aio.nanoleaf._logger.log("trace","[Device.getState] Sending request."),xnm.aio.nanoleaf.doRequest(this,"GET",{dataType:"json",path:""},function(b,d){b?a&&a(b,null):a&&a(null,d.response)});else{var b=Error("Request not possible without a token.");a&&a(b,null)}},getStatesCreator:function(a,b,c){this.getState(function(a,
e){if(e){a=e.effects;for(var d=e.panelLayout,g=e.rhythm,f=e.state,l=[],n=0;n<b.length;n++){var k=b[n];if(k&&k.id&&k.status)switch(k.status.value){case "brightness":f.brightness&&l.push({id:k.id,status:f.brightness.value});break;case "colorMode":f.colorMode&&l.push({id:k.id,status:f.colorMode});break;case "ct":f.ct&&l.push({id:k.id,status:f.ct.value});break;case "hue":f.hue&&l.push({id:k.id,status:f.hue.value});break;case "on":f.on&&l.push({id:k.id,status:f.on.value?"on":"off"});break;case "sat":f.sat&&
l.push({id:k.id,status:f.sat.value});break;case "effectSelected":"string"===typeof a.select&&l.push({id:k.id,status:a.select});break;case "effectIndex":if("string"===typeof a.select&&Array.isArray(a.effectsList)){var m=a.effectsList.indexOf(a.select);l.push({id:k.id,status:m})}break;case "name":"string"===typeof e.name&&l.push({id:k.id,status:e.name});break;case "serialNo":"string"===typeof e.serialNo&&l.push({id:k.id,status:e.serialNo});break;case "model":"string"===typeof e.model&&l.push({id:k.id,
status:e.model});break;case "firmwareVersion":"string"===typeof e.firmwareVersion&&l.push({id:k.id,status:e.firmwareVersion});break;case "numPanels":d&&d.layout&&"number"===typeof d.layout.numPanels&&l.push({id:k.id,status:d.layout.numPanels});break;case "rhythmActive":g&&"boolean"===typeof g.rhythmActive&&l.push({id:k.id,status:g.rhythmActive?"on":"off"});break;case "rhythmConnected":g&&"boolean"===typeof g.rhythmConnected&&l.push({id:k.id,status:g.rhythmConnected?"true":"false"});break;case "rhythmMode":g&&
"number"===typeof g.rhythmMode&&(m="unknown",0===g.rhythmMode?m="microphone":1===g.rhythmMode&&(m="aux"),l.push({id:k.id,status:m}));break;case "auxAvailable":g&&"boolean"===typeof g.auxAvailable&&l.push({id:k.id,status:g.auxAvailable?"true":"false"})}}c&&c(null,l)}else c&&c(Error("Failed to get states."))})},toJSON:function(){return{sys:xnm.aio.nanoleaf.DM.SYS,type:this.type,ip:this.ip,id:this.id,firmware:this.firmware,model:this.model,token:this.token}}};
xnm.aio.nanoleaf.Canvas=function(a,b){xnm.aio.nanoleaf.Device.call(this,a,b);this.type="canvas"};xnm.aio.nanoleaf.Canvas.prototype=Object.create(xnm.aio.nanoleaf.Device.prototype);xnm.aio.nanoleaf.Canvas.constructor=xnm.aio.nanoleaf.Canvas;xnm.aio.nanoleaf.Panel=function(a,b){xnm.aio.nanoleaf.Device.call(this,a,b);this.type="panel"};xnm.aio.nanoleaf.Panel.prototype=Object.create(xnm.aio.nanoleaf.Device.prototype);xnm.aio.nanoleaf.Panel.constructor=xnm.aio.nanoleaf.Panel;
xnm.aio.nanoleaf.Panel.prototype.cmdSetRhythmMode=function(a,b){"aux"===a?a=1:"microphone"===a&&(a=0);"number"!==typeof a||isNaN(a)||0>a||1<a?(a=Error("Invalid value for Rhythm mode: "+a),xnm.aio.nanoleaf._logger.log("error","[Panel.cmdSetRhythmMode] "+a.message),b&&b(a,null)):(a={data:{rhythmMode:a},path:"rhythm/rhythmMode"},xnm.aio.nanoleaf._logger.log("trace","[Panel.cmdSetRhythmMode] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",a,function(a,d){b&&b(a,null)}))};
xnm.aio.nanoleaf.Handler=function(){var a=require("x.logger.js");a&&(xnm.aio.nanoleaf._logger=a.getLogger("xnm.aio.nanoleaf"))};
xnm.aio.nanoleaf.Handler.prototype={devicemanager:xnm.aio.nanoleaf.DM,discoverWithTimeout:function(a,b){var c=require("x.mdns.js");c.clearRecordBuffer();if("number"!==typeof a||isNaN(a))a=1E4;c.discoverServiceWithTimeout("_nanoleafapi._tcp.local",a,function(a,c){if(a)b&&b(a,null);else{for(var d=[],e=0;e<c.length;e++){var f=c[e];f.ip&&0<f.ip.length&&f.info&&d.push({firmware:f.info.srcvers,id:f.info.id,ip:f.ip[0],model:f.info.md,sys:xnm.aio.nanoleaf.DM.SYS})}b&&b(a,d)}})},doCommand:function(a,b,c){var d=
this.resolveDevice(a);d?d.executeCommandCreator(a,b,function(a){c&&c(a)}):c&&c(Error("device format invalid"))},doStatus:function(a,b,c,d){(b=this.resolveDevice(b))?b.getStatesCreator(null,[{id:a,status:c}],function(a,b){a?d&&d(a):d&&d(null,b[0])}):d&&d(Error("device format invalid"))},getDeviceCommands:function(a,b){a=(a=xnm.aio.nanoleaf.DM.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];b&&b(null,a)},getDeviceStatus:function(a,b){a=(a=xnm.aio.nanoleaf.DM.applyUIFilter(a,{catagory:"status",
elems:"*"}))?a.status:[];b&&b(null,a)},registModule:function(a){a.register(xnm.aio.nanoleaf.DM.SYS,"nanoleaf")},resolveDevice:function(a){return a?xnm.aio.nanoleaf.parseJSON(a):null}};"undefined"!==typeof exports&&"undefined"!==typeof module&&module.exports&&(exports=module.exports=new xnm.aio.nanoleaf.Handler);
