var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.devicegroup=xnm.aio.devicegroup||{};
xnm.aio.devicegroup.Group=function(){var a=function(c){this.info=c};a.prototype.executeCommandCreator=function(c,d,b,a){if(this.info&&this.info.devices)if(d&&d.value)if(a)if(0==this.info.devices.length)b&&b();else{var e=this,q=0,k=function(c){q++;q==e.info.devices.length?b&&b():e._executeCommand(a,e.info.devices[q],d,k)};this._executeCommand(a,this.info.devices[q],d,k)}else b&&b(Error("commandhandler invlaid"));else b&&b(Error("command value is empty"));else b&&b(Error("info devices is invalid"))};
a.prototype._executeCommand=function(c,a,b,e){c._executeCommand({device:{room:a.room,name:a.device},cmd:b},function(c){e&&e(c)})};return a}();
xnm.aio.devicegroup.DM=function(){var a=function(c,a){this.code=c;this.message=a;this.stack=Error().stack};a.prototype=Error();a.prototype.name="DeviceGroupDMError";a.prototype.code=0;a.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"devicegroup",createDevice:function(c,d,b){d=a.ERROR_CODE;c?c.devices?b(null,c):b(new a(d.INVALID,"devices is invalid")):b(new a(d.INVALID,"info is invalid"))},updateDevice:function(c,d,b){d=a.ERROR_CODE;c?c.devices?
b(null,c):b(new a(d.INVALID,"devices is invalid")):b(new a(d.INVALID,"info is invalid"))},deleteDevice:function(c,a,b){b()},applyUIFilter:function(a,d,b,e){var c=function(a,c){if("*"==a)return!0;for(var b=!1,d=0;d<a.length;d++)if(a[d]==c){b=!0;break}return b},q=function(a,b,d){var e=[];switch(d.catagory){case "command":a.command&&a.command.forEach(function(a){c(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){c(d.elems,a.type)&&
(a=JSON.parse(JSON.stringify(a)),e.push(a))})}return e};b=function(a,b){var c=[];if(a&&e&&e.findDevice&&e.dm&&a.devices&&0!=a.devices.length){var h={command:[],status:[]};for(var k=0;k<a.devices.length;k++)if(a.devices[k]){var g=e.findDevice(a.devices[k].room,a.devices[k].device);if(g&&g.info&&g.info.sys){var f=e.dm.getModule(g.info.sys);if(f&&f.devicemanager&&f.devicemanager.applyUIFilter&&(g=f.devicemanager.applyUIFilter(g.info,d,e.deviceinfo,e))){if(g.command){f=h;var r=g.command;if(f.command){for(var m=
[],n=0;n<r.length;n++){var t=!1,l=r[n];if(l&&l.ref&&l.ref.value){for(var p=0;p<f.command.length;p++){var u=f.command[n];if(u&&u.ref&&u.ref.value&&l.ref.value==u.ref.value){t=!0;break}}t||m.push(l)}}f.command=f.command.concat(m)}else f.command=r}if(g.status)if(f=h,g=g.status,f.status){r=[];for(m=0;m<g.length;m++)if(n=!1,(t=g[m])&&t.ref&&t.ref.value){for(l=0;l<f.status.length;l++)if((p=f.status[m])&&p.ref&&p.ref.value&&p.ref.value==p.ref.value){n=!0;break}n||r.push(t)}f.status=f.status.concat(r)}else f.status=
g}}}}else h=null;h&&(a=q(h,a,b),c=c.concat(a));return c};if(!a.sys)return null;var k=JSON.parse(JSON.stringify(a)),h=null;switch(d.catagory){case "command":h=b(a,d);k.command=h;break;case "status":h=b(a,d);k.status=h;break;default:return null}return h&&0!=h.length?k:null}}}();
xnm.aio.devicegroup.Handler=function(){var a=function(){};a.prototype.devicemanager=xnm.aio.devicegroup.DM;a.prototype.registModule=function(a){a.register(this.devicemanager.SYS,"devicegroup")};a.prototype.resolveDevice=function(a){return a&&a.devices?new xnm.aio.devicegroup.Group(a):null};return a}();"undefined"!=typeof module&&module&&module.exports&&(module.exports=new xnm.aio.devicegroup.Handler);
