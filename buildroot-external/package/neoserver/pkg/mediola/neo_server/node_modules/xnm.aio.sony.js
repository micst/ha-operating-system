var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.sony=xnm.aio.sony||{};
xnm.aio.sony.IRCC=function(){var a=function(a,c,d,e,b){this._logger=require("x.logger.js").getLogger("xnm.aio.sony.IRCC");this.ip=a;this.port=c;this.path=d;this.username=e;this.password=b};a.SOAP_PREFIX='<?xml version="1.0"?><s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/" s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><s:Body><u:X_SendIRCC xmlns:u="urn:schemas-sony-com:service:IRCC:1"><IRCCCode>';a.SOAP_SUFFIX="</IRCCCode></u:X_SendIRCC></s:Body></s:Envelope>";a.prototype._executeCommand=
function(a,c){var d=this;a=this._buildSoapReq(a);this._doRequest(a,function(a){a&&a._code&&d._logger.log("warn","sony access forbidden");c&&c(a)})};a.prototype._register=function(a){var c=this,d="http://"+this.ip+":50002/?action=register&name=aioRemote&registrationType=initial&deviceId=aioRemote%3A00-00-00-00-00-00";this._logger.log("trace","register:"+d);$.ajax({url:d,method:"GET",timeout:3E3,cache:!1,headers:{"Content-Type":"text/xml; charset=UTF-8","X-CERS-DEVICE-ID":"aioRemote:00-00-00-00-00-00"},
username:this.username,password:this.password,success:function(){c._logger.log("trace","http request success");a&&a()},error:function(d,b){c._logger.log("trace","http request error:"+b);a&&a(Error(b?b:"http error"))}})};a.prototype._doRequest=function(a,c){var d=this,e="http://"+this.ip+":"+this.port+this.path,b=c;this._logger.log("trace","send data:"+a+" to:"+e);$.ajax({url:e,type:"POST",timeout:3E3,data:a,cache:!1,headers:{SOAPAction:'"urn:schemas-sony-com:service:IRCC:1#X_SendIRCC"',"Content-Type":"text/xml; charset=UTF-8",
"Content-Length":a.length,"X-CERS-DEVICE-ID":"aioRemote:00-00-00-00-00-00"},username:this.username,password:this.password,statusCode:{401:function(){if(b){var a=Error("http response 401");a._errSource="xnm.aio.sony.IRCC";a._code=401;a._device=d;b(a);b=null}},403:function(){if(b){var a=Error("http response 403");a._errSource="xnm.aio.sony.IRCC";a._code=403;a._device=d;b(a);b=null}}},success:function(){d._logger.log("trace","http request success");b&&(b(),b=null)},error:function(a,c){d._logger.log("trace",
"http request error:"+c);a&&401==a.status?(a=Error("http response 401"),a._errSource="xnm.aio.sony.IRCC",a._code=401,a._device=d,b(a),b=null):a&&403==a.status?(a=Error("http response 403"),a._errSource="xnm.aio.sony.IRCC",a._code=403,a._device=d,b(a),b=null):b&&(b(Error(c?c:"http error")),b=null)}})};a.prototype._buildSoapReq=function(f){return a.SOAP_PREFIX+f+a.SOAP_SUFFIX};return a}();
xnm.aio.sony.BDP=function(){var a=function(a,c,d,e,b){if(!c||0>c)c=50001;d||(d="/upnp/control/IRCC");xnm.aio.sony.IRCC.call(this,a,c,d,e,b)};a.prototype=Object.create(xnm.aio.sony.IRCC.prototype);return a.prototype.constructor=a}();xnm.aio.sony.TV=function(){var a=function(a,c,d,e,b){if(!c||0>c)c=80;d||(d="/IRCC");xnm.aio.sony.IRCC.call(this,a,c,d,e,b)};a.prototype=Object.create(xnm.aio.sony.IRCC.prototype);return a.prototype.constructor=a}();
xnm.aio.sony.Handler=function(){var a=function(){};a.prototype.IRCC=xnm.aio.sony.IRCC;a.prototype.BDP=xnm.aio.sony.BDP;return a}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.sony.Handler);
