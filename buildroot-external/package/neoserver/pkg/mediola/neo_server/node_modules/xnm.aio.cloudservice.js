var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(e){var a=0;return function(){return a<e.length?{done:!1,value:e[a++]}:{done:!0}}};$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,a,b){e!=Array.prototype&&e!=Object.prototype&&(e[a]=b.value)};$jscomp.getGlobal=function(e){e=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,e];for(var a=0;a<e.length;++a){var b=e[a];if(b&&b.Math==Math)return b}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(e,a){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:a})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function e(b){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(b||"")+"_"+a++,b)}var a=0;return e}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};
$jscomp.iteratorFromArray=function(e,a){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var b=0,d={next:function(){if(b<e.length){var c=b++;return{value:a(c,e[c]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(e,a,b,d){if(a){b=$jscomp.global;e=e.split(".");for(d=0;d<e.length-1;d++){var c=e[d];c in b||(b[c]={});b=b[c]}e=e[e.length-1];d=b[e];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(b,e,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(a,b){return b})}},"es8","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.cloudservice=xnm.aio.cloudservice||{};
xnm.aio.cloudservice.Ivideon=function(){var e=function(a,b,d,c){this._connectionID=a;this._camID=b;this._cloudService=d;this._format=c;this._jpegCam=null};e.prototype.getBaseURL=function(){return"/devices/"+this._connectionID+"/"+this._camID};e.prototype.getLivePreview=function(a){var b=this.getBaseURL()+"/live_preview";this._cloudService.doEAPIRequest("ivideon","GET",b,null,null,function(b,c){a&&a(b,c)})};e.prototype.getLiveStream=function(a,b){var d=this.getBaseURL()+"/live_stream";a||(a={});a.format||
(a.format="hls");"string"!==typeof a.q&&"number"!==typeof a.q&&(a.q=1);this._cloudService.doEAPIRequest("ivideon","GET",d,a,null,function(c,a){b&&b(c,a)})};e.prototype.getArchiveStream=function(a,b){var d=this.getBaseURL()+"/record_stream";a||(a={});a.format||(a.format="hls");"string"!==typeof a.q&&"number"!==typeof a.q&&(a.q=1);this._cloudService.doEAPIRequest("ivideon","GET",d,a,null,function(c,a){if(c)b(c,a);else{var f=null;a&&"object"===typeof a&&(f=a.url);if("string"!==typeof f||0===f.length)c=
Error("Result did not contain an URL or it was an empty string: "+f);b(c,f)}})};e.prototype.getEvents=function(a,b){var d=this.getBaseURL()+"/events";a||(a={});a.limit||(a.limit=20);this._cloudService.doEAPIRequest("ivideon","POST",d,null,a,function(c,a){b&&b(c,a)})};e.prototype.getRecords=function(a,b){var d=this.getBaseURL()+"/records";this._cloudService.doEAPIRequest("ivideon","GET",d,a,null,function(c,a){b&&b(c,a)})};e.prototype.loadImage=function(a,b){var d=this;this._jpegCam?this._jpegCam.loadImage(function(c,
f){c?a&&a(c):c||!f||401!=f.statusCode||b?a&&a():(d._jpegCam=null,d.loadImage(a,!0))}):this.getLivePreview(function(c,b){!c&&b&&b.url&&b.token?(c="https://"+b.host+"/cameras/"+d._camID+"/live_preview",d._jpegCam=require("xnm.aio.cams.js").createJPEGCam(c,{headers:{Authorization:"Bearer "+b.token}}),d.loadImage(a,!0)):a&&a()})};e.parseJSON=function(a,b){return a&&a.connection&&a.id?new e(a.connection,a.id,b,a.format):null};return e}();
xnm.aio.cloudservice.Ring=function(){var e=function(a,b,d){this._connectionID=a;this._deviceID=b;this._cloudService=d;this._last_file_path=this._last_timestap=null};e.prototype.getBaseURL=function(){return"/devices/"+this._connectionID+"/"+this._deviceID};e.prototype.getLastSnapshot=function(a){var b=this.getBaseURL()+"/last_snapshot";this._cloudService.doEAPIRequest("ring","GET",b,null,null,function(b,c){a&&a(b,c)})};e.prototype.getEvents=function(a,b){var d=this.getBaseURL()+"/history";a||(a={});
a.limit||(a.limit=20);this._cloudService.doEAPIRequest("ring","GET",d,a,null,function(c,a){b&&b(c,a)})};e.prototype.getRecordStream=function(a,b){var d=this.getBaseURL()+"/record_stream";a||(a={});a.eventID?this._cloudService.doEAPIRequest("ring","GET",d,a,null,function(c,a){if(c)b(c,a);else{var f=null;a&&"object"===typeof a&&(f=a.url);if("string"!==typeof f||0===f.length)c=Error("Result did not contain an URL or it was an empty string: "+f);b(c,f)}}):b(Error("no eventID"))};e.prototype.loadImage=
function(a,b){var d=this;b=new Date;!this._last_timestap||6E4<=b-this._last_timestap?(this._last_file_path=this._last_timestap=null,this.getLastSnapshot(function(c,b){!c&&b&&b.url&&b.timestamp&&b.access_token?(d._last_timestap=b.timestamp,require("xnm.aio.cams.js").createJPEGCam(b.url,{headers:{Authorization:"Bearer "+b.access_token}}).loadImage(function(c,f){c?(d._last_file_path=c,a&&a(c,b.timestamp)):(d._last_timestap=null,a&&a())})):a&&a()})):a&&a(this._last_file_path,this._last_timestap)};return{parseJSON:function(a,
b){return a&&a.type&&a.connection&&a.id?"doorbell"==a.type?new e(a.connection,a.id,b,a.format):null:null}}}();
xnm.aio.cloudservice.Bosch=function(){var e=function(a,b,d,c){this._connectionID=a;this._camID=b;this._cloudService=d;this._format=c;this._jpegCam=null};e.prototype.getBaseURL=function(){return"/devices/"+this._connectionID+"/"+this._camID};e.prototype.getStates=function(a){this._cloudService.doEAPIRequest("bosch","GET","/states/"+this._connectionID+"/"+this._camID,null,null,function(b,d){a&&a(b,d)})};e.prototype.getLivePreview=function(a,b){var d=this.getBaseURL()+"/live_preview";this._cloudService.doEAPIRequest("bosch",
"GET",d,a,null,function(c,a){b&&b(c,a)})};e.prototype.getLiveStream=function(a,b){var d=this.getBaseURL()+"/live_stream";a||(a={});a.endpoint||(a.endpoint="cloud");a.profile||(a.profile="hd");this._cloudService.doEAPIRequest("bosch","GET",d,a,null,function(c,a){b&&b(c,a)})};e.prototype.getEvents=function(a,b){var d=this.getBaseURL()+"/events";a||(a={});if("undefined"==typeof a.page||null==a.page)a.page=0;if("undefined"==typeof a.pageSize||null==a.pageSize)a.pageSize=10;var c={filter:{},paging:{page:a.page,
pageSize:a.pageSize}};a.eventType&&(c.filter.eventType=a.eventType);this._cloudService.doEAPIRequest("bosch","POST",d,null,c,function(a,c,d,e){b&&b(a,c,e?e["x-token"]:null)})};e.prototype.getWifiInfo=function(a){var b=this.getBaseURL()+"/wifi";this._cloudService.doEAPIRequest("bosch","GET",b,null,null,function(b,c){a&&a(b,c)})};e.prototype.loadImage=function(a,b){var d=this;this._jpegCam?this.getStates(function(c,f){!c&&f&&f.states?"on"!=f.states.state?(d._jpegCam=null,a&&a()):d._jpegCam.loadImage(function(c,
f){c?a&&a(c):c||!f||401!=f.statusCode||b?a&&a():(d._jpegCam=null,d.loadImage(a,!0))}):a&&a()}):this.getLivePreview({endpoint:"cloud"},function(c,b){if(!c&&b&&b.mediaUri){c=b.mediaUri;var f={headers:{}};b.accessCredentials&&b.accessCredentials.credentials&&(b=b.accessCredentials.credentials.split(":"),f.user=b[0],f.password=b[1]);d._jpegCam=require("xnm.aio.cams.js").createJPEGCam(c,f);d.loadImage(a,!0)}else a&&a()})};e.parseJSON=function(a,b){return a&&a.connection&&a.id?new e(a.connection,a.id,b,
a.format):null};return e}();
xnm.aio.cloudservice.CloudService=function(){var e=function(c){this._cloudservice=c};e.prototype.getRules=function(c){this._cloudservice._doJsonRequest("GET","/rules",null,null,c)};e.prototype.addRule=function(c,a){c?this._cloudservice._doJsonRequest("POST","/rules",null,c,a):a&&a(Error("rule is null"))};e.prototype.updateRule=function(a,b,d){a?b?this._cloudservice._doJsonRequest("POST","/rules/"+a,null,b,d):d&&d(Error("rule is null")):d&&d(Error("rule id is null"))};e.prototype.deleteRule=function(a,
b){a?this._cloudservice._doJsonRequest("POST","/rules/"+a,null,{},b):b&&b(Error("rule id is null"))};e.prototype.deleteRules=function(a,b){this._cloudservice._doJsonRequest("DELETE","/rules",a,null,b)};var a=function(a){this._cloudservice=a;this._version="v1"};a.prototype.disconenct=function(a,b,d){a?b?this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+a+"/disconnect",{id:b},null,function(a,c){d&&d(a,c)}):d&&d(Error("invalid connection id")):d&&d(Error("invalid module"))};a.prototype.getModuleConnectionInfo=
function(a,b,d){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+a+"/info/"+b,null,null,function(a,c){d(a,c)})};a.prototype.getModuleInfo=function(a,b){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+a+"/info",null,null,function(a,c){b(a,c)})};a.prototype.getModuleDevices=function(a,b){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+a+"/devices",null,null,function(a,c){b(a,c)})};a.prototype.getModuleStates=function(a,b){this._cloudservice._doJsonRequest("GET",
"/eapi/"+this._version+"/"+a+"/states",null,null,function(a,c){b(a,c)})};a.prototype.executeModuleCommand=function(a,b,d){this._cloudservice._doJsonRequest("POST","/eapi/"+this._version+"/"+a+"/command",null,b,function(a,c){d(a,c)})};a.prototype.doRequest=function(a,b,d,e,k,l){this._cloudservice._doJsonRequest(b,"/eapi/"+this._version+"/"+a+d,e,k,function(a,c,b,d){l(a,c,b,d)})};var b=function(a){this._cloudservice=a;this._version="v1"};b.prototype.getUserInfo=function(a){this._cloudservice._doJsonRequest("GET",
"/service/userInfo",null,null,function(c,b){a(c,b)})};b.prototype.getModulesInfo=function(a){this._cloudservice._doJsonRequest("GET","/service/moduleInfo",null,null,function(c,b){a(c,b)})};b.prototype.toCloudDevice=function(a,b){this._cloudservice._doJsonRequest("POST","/service/toCloudDevice",null,a,function(a,c){b(a,c)})};var d=function(c,d,g,h,k){this._logger=require("x.logger.js").getLogger("xnm.aio.cloudservice.CloudService");this._ip=c;this._ip||(this._ip="cloud.mediola.com");this._port=d;this._port||
(this._port=443);this._username=g;this._password=h;this._moduleInfo=k;this._protocol="https";this._eapi=new a(this);this._ruleEngine=new e(this);this._service=new b(this)};d.prototype.getIP=function(){return this._ip};d.prototype.getPort=function(){return this._port};d.prototype.getUsername=function(){return this._password};d.prototype.getUserInfo=function(a){this._service.getUserInfo(a)};d.prototype.getModulesInfo=function(a){this._service.getModulesInfo(a)};d.prototype.toCloudDevice=function(a,
b){this._service.toCloudDevice(a,b)};d.prototype.doEAPIRequest=function(a,b,d,e,k,l){this._eapi.doRequest(a,b,d,e,k,l)};d.prototype.disconenct=function(a,b,d){this._eapi.disconenct(a,b,d)};d.prototype.getModuleConnectionInfo=function(a,b,d){this._eapi.getModuleConnectionInfo(a,b,d)};d.prototype.getModuleInfo=function(a,b){this._eapi.getModuleInfo(a,b)};d.prototype.getModuleDevices=function(a,b){this._eapi.getModuleDevices(a,b)};d.prototype.getModuleStates=function(a,b){this._eapi.getModuleStates(a,
b)};d.prototype.executeModuleCommand=function(a,b,d){this._eapi.executeModuleCommand(a,b,d)};d.prototype.getRules=function(a){this._ruleEngine.getRules(a)};d.prototype.addRule=function(a,b){this._ruleEngine.addRule(a,b)};d.prototype.updateRule=function(a,b,d){this._ruleEngine.updateRule(a,b,d)};d.prototype.deleteRule=function(a,b){this._ruleEngine.deleteRule(a,b)};d.prototype.deleteRules=function(a,b){this._ruleEngine.deleteRules(a,b)};d.prototype.getAccessToken=function(a,b,d){a={sid:a};b&&(a.force=
1);this._doJsonRequest("GET","/getAccessToken",a,null,function(a,b){a?d&&d(a):b?d&&d(null,b.at):d&&d(Error("invalid response"))})};d.prototype.executeCommandCreator=function(a,b,d){if(a&&a.module&&a.connection&&a.id)if(b&&b.value){var c={connection:a.connection,device:a.id,command:b.value};if("undefined"!=typeof b.ext&&null!=b.ext)if(Array.isArray(b.ext)){var e={};b.ext.forEach(function(a){a&&a.value&&(e[a.value]=a.ext)});c.value=e}else c.value=b.ext;this.executeModuleCommand(a.module,c,function(a){d&&
d(a)})}else d&&d(Error("command json invalid"));else d&&d(Error("device json invalid"))};d.prototype.getStatesCreator=function(a,b,d){var c=this;a=function(a,b){c.getModuleStates(a,function(c,d){b(c,d,a)})};var e=[],l;for(l=0;l<b.length;l++){var m=b[l];m&&m.device&&m.device.module&&-1==e.indexOf(m.device.module)&&e.push(m.device.module)}if(0==e.length)d&&d(null,[]);else{var f=0,g=[];for(l=0;l<e.length;l++)a(e[l],function(a,c,m){f++;var l=[];if(!a&&c)for(var k=0;k<b.length;k++){var h=b[k];if(h&&h.id&&
h.device&&h.device.module==m){var p=null;if(h.device&&h.device.connection&&h.device.id&&h.status&&h.status.value){var q=c[h.device.connection];q&&q[h.device.id]&&(q=q[h.device.id].states)&&(p=q[h.status.value])}if("undefined"==typeof p||null==p)p="?";g.push({id:h.id,status:p});l.push({id:h.id,status:p})}}"undefined"!=typeof commandhandler&&null!=commandhandler&&"undefined"!=typeof commandhandler.reportStates&&null!=commandhandler.reportStates&&!a&&l&&0<l.length&&commandhandler.reportStates(null,l);
f==e.length&&d&&d(null,g)})}};d.prototype.getDeviceList=function(a,b){this.getModuleDevices(a,function(c,d){if(c)b(c);else{c=[];if(d)for(var e in d){var l=d[e],m;for(m in l){var f=l[m];f&&(f.sys="cloudservice",f.module=a,f.connection=e,f.id=m,c.push(f))}}b(null,c)}})};d.prototype._doJsonRequest=function(a,b,d,e,k){var c=null;e&&(c=JSON.stringify(e));this._doRequest(a,b,d,c,function(a,b,c,d){a?k&&k(a):b?b.XC_ERR?(a=Error("error response:"+b.XC_ERR.msg),a.code=b.XC_ERR.code,k&&k(a)):b.XC_SUC?k&&k(null,
b.XC_SUC,c,d):k&&k(Error("unknown response")):k&&k(Error("invalid response"))})};d.prototype._resolveServerIP=function(a){if("/eapi/"==a.substr(0,6)&&(a=a.split("/")[3])&&this._moduleInfo&&this._moduleInfo[a]&&this._moduleInfo[a].domain){a=this._moduleInfo[a].domain;var b=a.indexOf(":");return-1!=b?a.substr(0,b):a}return this._ip};d.prototype._resolveServerPort=function(a){if("/eapi/"==a.substr(0,6)&&(a=a.split("/")[3])&&this._moduleInfo&&this._moduleInfo[a]&&this._moduleInfo[a].domain){a=this._moduleInfo[a].domain;
var b=a.indexOf(":");return-1!=b?parseInt(a.substr(b+1)):443}return this._port};d.prototype._doRequest=function(a,b,d,e,k){var c=b;c||(c="/");var m={};d&&(m=JSON.parse(JSON.stringify(d)));d="";for(var f in m)m.hasOwnProperty(f)&&(d&&(d+="&"),d+=f+"="+encodeURIComponent(m[f]));d&&(c+="?"+d);a={host:this._resolveServerIP(b),port:this._resolveServerPort(b),path:c,method:a,headers:{Connection:"close","Content-Type":"application/json; charset=UTF-8"}};if(this._username||this._password)a.auth=(this._username?
this._username:"")+":"+(this._password?this._password:""),a.headers.Authorization="Basic "+(new Buffer((this._username?this._username:"")+":"+(this._password?this._password:""))).toString("base64");b=require(this._protocol);"https"==this._protocol&&"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0");c=JSON.parse(JSON.stringify(a));c.headers&&(c.headers.auth&&(c.headers.auth="*********"),c.headers.Authorization&&(c.headers.Authorization="*********"));
c.auth&&(c.auth="********");this._logger.log("trace","do request:"+JSON.stringify(c));var g=this,h=k,n=b.request(a,function(a){a.setEncoding("utf-8");var b="";a.on("data",function(a){b+=a});a.on("end",function(){g._logger.log("trace","receive code:"+a.statusCode+" headers:"+JSON.stringify(a.headers)+" response:"+b);if(200==a.statusCode)try{var c=b?JSON.parse(b):null}catch(r){var d=r}else d=Error("http reponse:"+a.statusCode);h&&(h(d,c,a.statusCode,a.headers),h=null)})});if(n.on)n.on("error",function(a){g._logger.log("trace",
"do request error:"+a.message);h&&(h(a),h=null)});n.setTimeout&&n.setTimeout(2E4,function(){g._logger.log("trace","do request timeout");n.abort();h&&(h(Error("timeout")),h=null)});e&&(this._logger.log("trace","do request send body:"+e),n.write(e));n.end()};d.prototype.toJSON=function(){return{sys:"cloudservice",username:this._username,password:this._password,ip:this._ip,port:this._port}};d.prototype.equalsTo=function(a){return a&&a instanceof d?this._ip==a._ip&&this._port==a._port&&this._username==
a._username&&this._password==a._password:!1};d.parseJSON=function(a){return a&&a.username&&a.password?new d(a.ip,a.port,a.username,a.password,a.moduleInfo):null};return d}();
xnm.aio.cloudservice.DM=function(){var e=function(a,b){this.code=a;this.message=b;this.stack=Error().stack};e.prototype=Error();e.prototype.name="cloudserviceDMError";e.prototype.code=0;e.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"cloudservice",getGatewayType:function(){return[{sys:this.SYS,name:"Cloud Service"}]},createGateway:function(a,b,d){b=e.ERROR_CODE;a?a.username?a.password?d(null,a):d(new e(b.INVALID,"password is invalid")):d(new e(b.INVALID,
"username is invalid")):d(new e(b.INVALID,"info is invalid"))},updateGateway:function(a,b,d,c){a=e.ERROR_CODE;b?b.username?b.password?c(null,b):c(new e(a.INVALID,"password is invalid")):c(new e(a.INVALID,"username is invalid")):c(new e(a.INVALID,"update is invalid"))},deleteGateway:function(a,b,d){d()},createDevice:function(a,b,d){var c=e.ERROR_CODE;if(a)if(a.connection)if(a.id)if(a.gateway){b=b.data.gateways;var f;for(f=0;f<b.length;f++)if(b[f].index===a.gateway){var g=b[f];break}g?d&&d(null,a):
d(new e(c.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else d(new e(c.INVALID,"gateway is invalid"));else d(new e(c.INVALID,"id is invalid"));else d(new e(c.INVALID,"connection is invalid"));else d(new e(c.INVALID,"info is invalid"))},updateDevice:function(a,b,d){var c=e.ERROR_CODE;if(a)if(a.connection)if(a.id)if(a.gateway){b=b.data.gateways;var f;for(f=0;f<b.length;f++)if(b[f].index===a.gateway){var g=b[f];break}g?d(null,a):d(new e(c.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else d(new e(c.INVALID,
"gateway is invalid"));else d(new e(c.INVALID,"id is invalid"));else d(new e(c.INVALID,"connection is invalid"));else d(new e(c.INVALID,"info is invalid"))},deleteDevice:function(a,b,d){d()},applyUIFilter:function(a,b,d){var c=this,e=function(a,b){if("*"==a)return!0;for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},g=function(a,b,c){var d=[];"command"==c.catagory?a.command&&a.command.forEach(function(a){e(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))}):"status"==c.catagory?
a.status&&a.status.forEach(function(a){e(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))}):"ipevt"==c.catagory&&a.ipevt&&a.ipevt.forEach(function(a){e(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))});return d},h=function(a,b){var e=[],m=c.getCommandStatusMap(a,d);m&&(a=g(m,a,b),e=e.concat(a));return e};if(!a.sys)return null;var k=JSON.parse(JSON.stringify(a)),l=null;if("command"==b.catagory)l=h(a,b),k.command=l;else if("status"==b.catagory)l=h(a,b),k.status=l;else if("ipevt"==
b.catagory)l=h(a,b),k.ipevt=l;else return null;return l&&0!=l.length?k:null},applyIPEventFilter:function(a){return a?this.applyUIFilter(a,{catagory:"ipevt",elems:"*"}):null},getCommandStatusMap:function(a,b){var d=function(a,b){var c=null;if(b.values)if(Array.isArray(b.values))c={type:"enum",name:a,ref:{value:a,ext:"%e",extMeta:b.values}};else{if(0<Object.keys(b.values).length){c={type:"multi",name:a,ref:{value:a,ext:"%multi",extMeta:[]}};for(var e in b.values)(a=d(e,b.values[e]))&&c.ref.extMeta.push(a)}}else if(b.value){switch(b.value.type){case "FLOAT":c=
{type:"float",name:a,ref:{value:a,ext:"%f"}};break;case "RGB":c={type:"rgb",name:a,ref:{value:a,ext:"%rgb"}};break;case "RGBW":c={type:"rgbw",name:a,ref:{value:a,ext:"%rgbw"}};break;case "TIME":c={type:"time",name:a,ref:{value:a,ext:"%time"}};break;default:c={type:"int",name:a,ref:{value:a,ext:"%d"}}}void 0!=b.value.min&&null!=b.value.min&&void 0!=b.value.max&&null!=b.value.max&&c&&(c.ref.extMeta=b.value.min+"-"+b.value.max);void 0!=b.value.step&&null!=b.value.step&&c&&(c.ref.scale=b.value.step)}else c=
{type:"enum",name:a,ref:{value:a}};return c};if(!a)return null;b={command:[],status:[]};var c,e;if(a.commands)for(c in b.command=[],a.commands){var g=a.commands[c];"homematic"==a.module&&"eco"==c?(g=JSON.parse(JSON.stringify(g)),delete g.values.duration):"bosch"==a.module&&"off"==c&&(g=JSON.parse(JSON.stringify(g)),g.value&&(g.value.type="INT",g.value.min=0));(e=d(c,g))&&b.command.push(e)}if(a.states)for(c in b.status=[],b.ipevt=[],a.states)if(g=a.states[c],g.values)0!=g.state&&b.status.push({type:"enum",
name:c,ref:{value:c,options:g.values}}),0!=g.event&&b.ipevt.push({type:"enum",name:c,ref:{value:c,options:g.values}});else{e=null;switch(g.type){case "BOOL":e={type:"enum",name:c,ref:{value:c,options:["true","false"]}};break;case "FLOAT":e={type:"float",name:c,ref:{value:c}};break;case "RGB":e={type:"rgb",name:c,ref:{value:c}};break;case "RGBW":e={type:"rgbw",name:c,ref:{value:c}};break;case "STRING":e={type:"string",name:c,ref:{value:c}};break;case "TIME":e={type:"int",name:c,ref:{value:c}};break;
default:e={type:"int",name:c,ref:{value:c}}}void 0!=g.min&&null!=g.min&&void 0!=g.max&&null!=g.max&&e&&(e.ref.extMeta=g.min+"-"+g.max);void 0!=g.step&&null!=g.step&&e&&(e.ref.scale=g.step);e&&(0!=g.state&&b.status.push(e),0!=g.event&&b.ipevt.push(e))}return b},toGeneralDevice:function(a,b,d){if(!a||!a.module)return null;b=null;switch(a.module){case "hue":case "lightify":b={type:"dimmer",commands:{},states:{},details:{commands:{},states:{}}};var c;if(a.commands)for(c in a.commands)switch(c){case "on":case "off":case "toggle":case "up":case "down":b.commands[c]=
{};b.details.commands[c]={value:c};break;case "brightness":case "colorTemperature":b.commands[c]={value:{type:"INT"}};b.details.commands[c]={value:c,ext:"%d"};a.commands[c]&&a.commands[c].value&&(d=a.commands[c].value,isNaN(d.min)||isNaN(d.max)||(b.commands[c].value.min=d.min,b.commands[c].value.max=d.max,b.details.commands[c].extMeta=d.min+"-"+d.max));break;case "color":b.commands[c]={value:{type:"RGB"}},b.details.commands[c]={value:c,ext:"%rgb"},b.commands.white={},b.details.commands.white={value:"color",
ext:"FFFFFF"},a.commands[c]&&a.commands[c].value&&(d=a.commands[c].value,"RGBW"==d.type&&(b.commands[c].value.type="RGBW",b.details.commands[c].ext="%rgbw",b.details.commands.white={value:"color",ext:"FFFFFFFF"}))}if(a.states)for(c in a.states)switch(c){case "state":b.states.state={values:["on","off"]};b.details.states.state={value:"state"};break;case "brightness":b.states.brightness={value:{type:"INT",min:0,max:100}};b.details.states.brightness={value:"brightness",ext:"%d",extMeta:"0-100"};break;
case "colorTemperature":b.states.colorTemperature={value:{type:"INT",min:154,max:500}};b.details.states.colorTemperature={value:"colorTemperature",ext:"%d",extMeta:"154-500"};break;case "color":b.states.color={type:"RGB"},b.details.states.color={value:"color",ext:"%rgb"},a.states[c]&&a.states[c].value&&(d=a.states[c].value,"RGBW"==d.type&&(b.states.color.type="RGBW",b.details.states.color.ext="%rgbw"))}break;case "somfy":b={type:"blind",commands:{},states:{},details:{commands:{},states:{}}};if(a.commands)for(c in a.commands)switch(c){case "open":case "close":b=
null;break;case "stop":case "up":case "down":b.commands[c]={};b.details.commands[c]={value:c};break;case "position":case "rotation":b.commands[c]={value:{type:"INT",min:0,max:100}},b.details.commands[c]={value:c,ext:"%d"}}if(a.states)for(c in a.states)switch(c){case "position":case "rotation":b.states[c]={value:{type:"INT",min:0,max:100}},b.details.states[c]={value:c,ext:"%d",extMeta:"0-100"}}break;case "homematic":switch(a.type){case "switch":b=JSON.parse(JSON.stringify(a));b.details={commands:{on:{value:"on"},
off:{value:"off"},toggle:{value:"toggle"}},states:{state:{value:"state"}}};b.states.power&&(b.details.states.power={value:"power"});b.states.consumption&&(b.details.states.consumption={value:"consumption"});break;case "dimmer":b=JSON.parse(JSON.stringify(a));b.details={commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"},up:{value:"up"},down:{value:"down"},brightness:{value:"brightness"}},states:{state:{value:"state"},brightness:{value:"brightness"}}};break;case "blind":b=JSON.parse(JSON.stringify(a));
b.details={commands:{up:{value:"up"},down:{value:"down"},stop:{value:"stop"},stepUp:{value:"stepUp"},stepDown:{value:"stepDown"},position:{value:"position"}},states:{position:{value:"position"}}};b.commands.rotation&&(b.details.commands.rotation={value:"rotation"});b.states.rotation&&(b.details.states.rotation={value:"rotation"});break;case "heater":b=JSON.parse(JSON.stringify(a));b.details={};if(!b.commands)return null;b.commands&&(b.details.commands={up:{value:"up"},down:{value:"down"},temperature:{value:"temperature"},
mode:{value:"mode"},auto:{value:"mode",ext:"auto"},manu:{value:"mode",ext:"manu"},boost:{value:"mode",ext:"boost"}});b.states&&(b.details.states={state:{value:"state"},mode:{value:"mode"},temperature:{value:"temperature"},humidity:{value:"humidity"}});break;case "temperature":b=JSON.parse(JSON.stringify(a));b.states&&(b.details={states:{}},b.states.temperature&&(b.details.states.temperature={value:"temperature"}),b.states.humidity&&(b.details.states.humidity={value:"humidity"}));break;case "motion":b=
JSON.parse(JSON.stringify(a));b.states&&(b.details={states:{}},b.states.motion&&(b.details.states.motion={value:"motion"}));break;case "contact":b=JSON.parse(JSON.stringify(a));b.states&&(b.details={states:{}},b.states.contact&&(b.details.states.state={value:"contact"}));break;case "window":b=JSON.parse(JSON.stringify(a)),b.states&&(b.details={states:{}},b.states.window&&(b.details.states.state={value:"window"}))}}return b},supportSmartWidget:function(a,b){if(!a||!a.module)return!1;switch(a.module){case "netatmo":case "openweathermap":case "nuki":case "uhoo":return!0;
case "ring":return"doorbell"==a.type;case "homematic":switch(a.type){case "home":return!0;case "room":return!0;case "enviroment":return!0;case "security":return!0;case "presence":return!0;case "smoke":return!0;case "water":return!0;case "weather":return!0;default:return!1}default:return!1}},applySmartWidgetFilter:function(a,b,d,c,e){if(!b||!b.module)return null;var f=d=null,h=null,k=null;d=function(a,b){switch(a.module){case "netatmo":switch(a.type){case "NAMain":b.push("netatmo_basestation");break;
case "NAModule1":case "NAModule4":b.push("climate");b.push("notification");break;case "NAModule2":b.push("netatmo_wind");b.push("notification");break;case "NAModule3":b.push("netatmo_rain"),b.push("notification")}break;case "openweathermap":b.push("openweathermap");break;case "nuki":b.push("nuki");break;case "ring":switch(a.type){case "doorbell":b.push("motion")}break;case "uhoo":b.push("uhoo");break;case "homematic":switch((a.states.battery||a.states.timeout||a.states.sabotage)&&b.push("notification"),
a.type){case "home":b.push("weather_station");b.push("climate");b.push("home");break;case "enviroment":(a.states.temperature||a.states.humidity)&&b.push("climate");a.states.rain&&b.push("rain");break;case "security":a.states.motion&&b.push("motion");(a.states.moisture||a.states.water)&&b.push("sensor_water");a.states.presence&&b.push("motion");a.states.window&&(b.push("window"),b.push("contact"));a.states.smoke&&b.push("smoke");break;case "presence":a.states.presence&&b.push("motion");break;case "smoke":a.states.smoke&&
b.push("smoke");break;case "water":a.states.water&&b.push("sensor_water");break;case "weather":b.push("weather_station"),b.push("climate")}}return b}(b,d?d:[]);f=function(a,b){switch(a.module){case "nuki":b["%unlock%"]={value:"unlock"};b["%lock%"]={value:"lock"};b["%open%"]={value:"lock_n_go"};break;case "homematic":if(a.commands)switch(a.type){case "home":a.commands.alarm_mode&&(b["%alarmModeDisarm%"]={value:"alarm_mode",ext:"disarmed"},b["%alarmModeProtectExternal%"]={value:"alarm_mode",ext:"external_protection"},
b["%alarmModeProtectFull%"]={value:"alarm_mode",ext:"full_protection"}),a.commands.auto&&(b["%thermoAuto%"]={value:"auto"}),a.commands.eco&&(b["%thermoEco%"]={value:"eco",extMeta:[{type:"time",name:"start",ref:{value:"start",ext:"%time"}},{type:"time",name:"end",ref:{value:"end",ext:"%time"}}]}),a.commands.vacation&&(b["%thermoVacation%"]={value:"vacation",extMeta:[{type:"float",name:"temperature",ref:{value:"temperature",ext:"%f",extMeta:"5-30",scale:.5}},{type:"time",name:"end",ref:{value:"end",
ext:"%time"}}]})}}return b}(b,f?f:{});h=function(a,b){switch(a.module){case "netatmo":switch(a.type){case "NAMain":b["%tempState%"]={value:"temperature"};b["%humState%"]={value:"humidity"};b["%co2State%"]={value:"co2"};b["%noiseState%"]={value:"noise"};b["%pressureState%"]={value:"pressure"};break;case "NAModule1":case "NAModule4":b["%tempState%"]={value:"temperature"};b["%humState%"]={value:"humidity"};b["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}};break;case "NAModule2":b["%windspeedState%"]=
{value:"wind_speed"};b["%windDirection%"]={value:"wind_direction"};b["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}};break;case "NAModule3":b["%rain%"]={value:"rain"},b["%rain_last_hour%"]={value:"rain_last_hour"},b["%rain_last_day%"]={value:"rain_last_day"},b["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}}}break;case "openweathermap":b["%tempState%"]={value:"temperature"};b["%humState%"]={value:"humidity"};b["%windspeedState%"]={value:"wind_speed"};b["%windDirection%"]=
{value:"wind_direction"};break;case "nuki":b["%lockStatus%"]={value:"state",conv_s:{locked:"locked",unlocked:"open"}};break;case "ring":switch(a.type){case "doorbell":b["%motionState%"]={value:"state",conv_s:{locked:"locked",unlocked:"open"}}}break;case "uhoo":b["%onlineState%"]={value:"online"};b["%tempState%"]={value:"temperature",extMeta:"-40-85"};b["%tempUnit%"]={value:"temperature_unit"};b["%humState%"]={value:"humidity",extMeta:"0-100"};b["%dustState%"]={value:"dust",extMeta:"0-200"};b["%vocState%"]=
{value:"voc",extMeta:"0-1200"};b["%co2State%"]={value:"co2",extMeta:"400-10000"};b["%coState%"]={value:"co",extMeta:"0-1000"};b["%pressureState%"]={value:"pressure",extMeta:"300-1100"};b["%no2State%"]={value:"no2",extMeta:"0-1000"};b["%ozoneState%"]={value:"ozone",extMeta:"0-1000"};b["%measured%"]={value:"measured"};break;case "homematic":switch(a.states.battery&&(b["%lowbat%"]={value:"battery",conv_i:{"0|30":"true","31|100":"false"}}),a.states.timeout&&(b["%timeout%"]={value:"timeout"}),a.states.sabotage&&
(b["%sabotage%"]={value:"sabotage"}),a.type){case "home":a.states.temperature&&(b["%tempState%"]={value:"temperature"});a.states.humidity&&(b["%humState%"]={value:"humidity"});a.states.wind_speed&&(b["%windspeedState%"]={value:"wind_speed"});a.states.wind_direction&&(b["%windDirection%"]={value:"wind_direction"},b["%windDirection%"].conv_i={"0|22":"N","23|67":"NO","68|112":"O","113|157":"SO","158|202":"S","203|247":"SW","248|292":"W","293|337":"NW","338|360":"N"});a.states.alarm_mode&&(b["%alarmMode%"]=
{value:"alarm_mode"});a.states.mode&&(b["%thermoMode%"]={value:"mode"});break;case "enviroment":a.states.temperature&&(b["%tempState%"]={value:"temperature"});a.states.humidity&&(b["%humState%"]={value:"humidity"});a.states.rain&&(b["%rainState%"]={value:"rain"});break;case "security":a.states.motion&&(b["%motionState%"]={value:"motion"});if(a.states.moisture||a.states.water)b["%waterState%"]={value:"water",conv_s:{"true":"water","false":"dry"}};a.states.presence&&(b["%motionState%"]||(b["%motionState%"]=
{value:"presence"}));a.states.window&&(b["%windowState%"]={value:"window"},b["%contactState%"]={value:"window"});a.states.smoke&&(b["%smokeState%"]={value:"smoke"});break;case "presence":a.states.presence&&(b["%motionState%"]={value:"presence"});a.states.illumination&&(b["%motionBrightness%"]={value:"illumination"});break;case "smoke":a.states.smoke&&(b["%smokeState%"]={value:"smoke"});break;case "water":a.states.water&&(b["%waterState%"]={value:"water",conv_s:{"true":"water","false":"dry"}});break;
case "weather":a.states.temperature&&(b["%tempState%"]={value:"temperature"}),a.states.humidity&&(b["%humState%"]={value:"humidity"}),a.states.illumination&&(b["%brightnessState%"]={value:"illumination"}),a.states.wind_speed&&(b["%windspeedState%"]={value:"wind_speed"}),a.states.wind_direction&&(b["%windDirection%"]={value:"wind_direction"},b["%windDirection%"].conv_i={"0|22":"N","23|67":"NO","68|112":"O","113|157":"SO","158|202":"S","203|247":"SW","248|292":"W","293|337":"NW","338|360":"N"}),a.states.rain&&
(b["%rainingState%"]={value:"rain"}),a.states.rain_total&&(b["%rainingCounterState%"]={value:"rain_total"}),a.states.sunshine_total&&(b["%sunshineState%"]={value:"sunshine_total"})}}return b}(b,h?h:{});k=function(a,b){return b}(b,k?k:{});return a._injectToSmartWidgetTemplate(c,d,e,f,h,k)}}}();
xnm.aio.cloudservice.Handler=function(){var e=function(){};e.prototype.devicemanager=xnm.aio.cloudservice.DM;e.prototype.CloudService=xnm.aio.cloudservice.CloudService;e.prototype.Ivideon=xnm.aio.cloudservice.Ivideon;e.prototype.Ring=xnm.aio.cloudservice.Ring;e.prototype.Bosch=xnm.aio.cloudservice.Bosch;e.prototype.registModule=function(a){a.register("cloudservice","cloudservice")};e.prototype.resolveGateway=function(a){return a?this.CloudService.parseJSON(a):null};e.prototype.getDeviceCommands=function(a,
b){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];b&&b(null,a)};e.prototype.getDeviceStatus=function(a,b){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];b&&b(null,a)};e.prototype.doCommand=function(a,b,d,c){(a=this.resolveGateway(a))?a.executeCommandCreator(b,d,function(a){c&&c(a)}):c&&c(Error("gateway json format invalid"))};e.prototype.doStatus=function(a,b,d,c,e){(b=this.resolveGateway(b))?b.getStatesCreator(null,[{id:a,
device:d,status:c}],function(a,b){a?e&&e(a):e&&e(null,b[0])}):e&&e(Error("gateway json format invalid"))};e.prototype.getUserInfo=function(a,b){(a=this.resolveGateway(a))?a.getUserInfo(function(a,c){b&&b(a,c)}):b&&b(Error("gateway json format invalid"))};e.prototype.getModulesInfo=function(a,b){(a=this.resolveGateway(a))?a.getModulesInfo(function(a,c){b&&b(a,c)}):b&&b(Error("gateway json format invalid"))};e.prototype.getDeviceList=function(a,b,d){b?(a=this.resolveGateway(a))?a.getDeviceList(b,function(a,
b){d&&d(a,b)}):d&&d(Error("gateway json format invalid")):d&&d(Error("module name invalid"))};e.prototype.getConnectionState=function(a,b,d,c){b?d?(a=this.resolveGateway(a))?a.getModuleConnectionInfo(b,d,function(a,b){c&&c(a,b)}):c&&c(Error("gateway json format invalid")):c&&c(Error("connection id invalid")):c&&c(Error("module name invalid"))};e.prototype.disconnect=function(a,b,d,c){b?d?(a=this.resolveGateway(a))?a.disconenct(b,d,function(a){c&&c(a)}):c&&c(Error("gateway json format invalid")):c&&
c(Error("connection id invalid")):c&&c(Error("module name invalid"))};return e}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.cloudservice.Handler);
