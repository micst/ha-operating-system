var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,a,b){e instanceof String&&(e=String(e));for(var c=e.length,d=0;d<c;d++){var h=e[d];if(a.call(b,h,d,e))return{i:d,v:h}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,a,b){e!=Array.prototype&&e!=Object.prototype&&(e[a]=b.value)};$jscomp.getGlobal=function(e){e=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,e];for(var a=0;a<e.length;++a){var b=e[a];if(b&&b.Math==Math)return b}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(e,a,b,c){if(a){b=$jscomp.global;e=e.split(".");for(c=0;c<e.length-1;c++){var d=e[c];d in b||(b[d]={});b=b[d]}e=e[e.length-1];c=b[e];a=a(c);a!=c&&null!=a&&$jscomp.defineProperty(b,e,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.wemo=xnm.aio.wemo||{};
xnm.aio.wemo.Switch=function(){var e=function(a,b,c,d){this.ip=a;this.port=b;this.uuid=c;this.type="switch";d&&(this.type=d);this.CommandHandler=null};e.prototype.switchTo=function(a,b){var c=new (require("x.upnp.js").Device),d=this;c.init(this.ip,this.port,this.uuid);c._doSOAPRequest(c.getURL("/upnp/control/basicevent1"),"urn:Belkin:service:basicevent:1","SetBinaryState",{BinaryState:a},function(a){a?b&&b(a):(a=0,"insight"==d.type&&(a=1E3),b&&setTimeout(b,a))})};e.prototype._getBinaryState=function(a){var b=
new (require("x.upnp.js").Device);b.init(this.ip,this.port,this.uuid);b._doSOAPRequest(b.getURL("/upnp/control/basicevent1"),"urn:Belkin:service:basicevent:1","GetBinaryState",{BinaryState:1},function(b,d){b=null;d&&(d=d.find("BinaryState"),0<d.length&&(b=parseInt($(d[0]).text()),0==b?b="off":null!=b&&(b="on")));a&&a(b)})};e.prototype._getInsightState=function(a){var b=new (require("x.upnp.js").Device);b.init(this.ip,this.port,this.uuid);b._doSOAPRequest(b.getURL("/upnp/control/insight1"),"urn:Belkin:service:insight:1",
"GetInsightParams",null,function(b,d){b=null;d&&(d=d.find("InsightParams"),0<d.length&&(d=$(d[0]).text().split("|"),11==d.length&&(b=(parseInt(d[7])/1E3).toFixed(1))));a&&a(b)})};e.prototype.getState=function(a){var b=null,c=this;this._getBinaryState(function(d){d&&d?(b={state:d},"insight"==c.type?c._getInsightState(function(d){d&&(b.current=d);a&&a(b)}):a&&a(b)):a&&a(null)})};e.prototype.executeCommand=function(a,b,c){if("on"==b)this.switchTo(1,c);else if("off"==b)this.switchTo(0,c);else if("toggle"==
b){var d=this;this._getBinaryState(function(a){"off"==a?d.switchTo(1,c):d.switchTo(0,c)})}else c&&c()};e.prototype.getStates=function(a,b,c){var d=this;this.CommandHandler=a;this.getState(function(a){a&&b&&d.CommandHandler.setState?(d.CommandHandler.setState(b.id,a.state),a&&a.current&&d.CommandHandler.setState(b.id+":current",a.current)):a&&d.CommandHandler.receivedState&&d.CommandHandler.receivedState("wemo",d.ip+":"+d.port,a);c&&c(a)})};e.prototype.getStateValues=function(a,b){return b};e.prototype.executeCommandCreator=
function(a,b,c){b&&b.value?this.executeCommand(a,b.value,function(a){c&&c(a)}):c&&c(Error("command value is empty"))};e.prototype.getStatesCreator=function(a,b,c){this.getState(function(a){if(a){for(var d=[],e=0;e<b.length;e++){var f=b[e];if(f&&f.id&&f.status)switch(f.status.value){case "switchState":a.state&&d.push({id:f.id,status:a.state});break;case "powerState":a.current&&d.push({id:f.id,status:parseFloat(a.current)})}}c&&c(null,d)}else c&&c(Error("get state error"))})};e.prototype.toJSON=function(){return{sys:xnm.aio.wemo.DM.SYS,
type:this.type,ip:this.ip,port:this.port,uuid:this.uuid}};e.prototype.equalsTo=function(a){return a&&a instanceof e?this.ip==a.ip&&this.port==a.port:!1};e.parseJSON=function(a){return a.ip&&a.port?new e(a.ip,a.port,a.uuid,a.type):null};return e}();
xnm.aio.wemo.DM=function(){var e={"switch":{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"switch status",ref:{value:"switchState",options:["off","on"]}}]},insight:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"switch status",ref:{value:"switchState",options:["off",
"on"]}},{type:"float",name:"power status",ref:{value:"powerState",scale:"0.1"}}]}},a=function(a,c){this.code=a;this.message=c;this.stack=Error().stack};a.prototype=Error();a.prototype.name="WemoDMError";a.prototype.code=0;a.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"wemo",getIPDeviceType:function(){return[{sys:this.SYS,name:"Belkin WeMo"}]},createDevice:function(b,c,d){c=a.ERROR_CODE;b?b.type?b.ip?d(null,b):d(new a(c.INVALID,"ip is invalid")):
d(new a(c.INVALID,"type is invalid")):d(new a(c.INVALID,"info is invalid"))},updateDevice:function(b,c,d){c=a.ERROR_CODE;b?b.type?b.ip?d(null,b):d(new a(c.INVALID,"ip is invalid")):d(new a(c.INVALID,"type is invalid")):d(new a(c.INVALID,"info is invalid"))},deleteDevice:function(a,c,d){d()},applyUIFilter:function(a,c,d){var b=function(a,b){if("*"==a)return!0;for(var d=!1,c=0;c<a.length;c++)if(a[c]==b){d=!0;break}return d},e=function(a,d,c){var e=[];switch(c.catagory){case "command":a.command&&a.command.forEach(function(a){b(c.elems,
a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){b(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))})}return e},f=function(a,b){var c=[],h=xnm.aio.wemo.DM.getCommandStatusMap(a,d);h&&(a=e(h,a,b),c=c.concat(a));return c};if(!a.sys)return null;var k=JSON.parse(JSON.stringify(a)),g=null;switch(c.catagory){case "command":g=f(a,c);k.command=g;break;case "status":g=f(a,c);k.status=g;break;default:return null}return g&&0!=g.length?
k:null},getCommandStatusMap:function(a,c){return a.type?e[a.type]:null}}}();
xnm.aio.wemo.Handler=function(){var e=function(){this.detectedDevices={}};e.prototype.discoverDevices=function(a){var b=require("x.upnp.js");if(b){var c=this;b.discoverDevices(function(b){if("wemo"==b.type){var d=new xnm.aio.wemo.Switch(b.ip,b.port,b.uuid);b.subtype&&(d.type=b.subtype);c.detectedDevices[b.uuid]=d;a(d)}})}};e.prototype.getStateValues=function(a,b){return(new xnm.aio.wemo.Switch).getStateValues(a,b)};e.prototype.getDeviceCommandList=function(a,b){a=[];a.push({id:window.XC_Text.on,cmd:"on"});
a.push({id:window.XC_Text.off,cmd:"off"});return a};e.prototype.getDevice=function(a){return new xnm.aio.wemo.Switch(a.address,a.port,null,a.data)};e.prototype.devicemanager=xnm.aio.wemo.DM;e.prototype.registModule=function(a){a.register(xnm.aio.wemo.DM.SYS,"wemo")};e.prototype.resolveDevice=function(a){if(!a)return null;switch(a.type){case "switch":case "insight":return xnm.aio.wemo.Switch.parseJSON(a);default:return null}};e.prototype.getDeviceCommands=function(a,b){a=(a=xnm.aio.wemo.DM.applyUIFilter(a,
{catagory:"command",elems:"*"}))?a.command:[];b&&b(null,a)};e.prototype.getDeviceStatus=function(a,b){a=(a=xnm.aio.wemo.DM.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];b&&b(null,a)};e.prototype.doCommand=function(a,b,c){var d=this.resolveDevice(a);d?d.executeCommandCreator(a,b,function(a){c&&c(a)}):c&&c(Error("device json format invalid"))};e.prototype.doStatus=function(a,b,c,d){var e=this.resolveDevice(b);e?e.getStatesCreator(null,[{id:a,device:b,status:c}],function(a,b){a?d&&d(a):
d&&d(null,b[0])}):d&&d(Error("device json format invalid"))};e.prototype.discoverWithTimeout=function(a,b){var c={};this.discoverDevices(function(a){a&&a.uuid&&!c[a.uuid]&&(c[a.uuid]=a)});setTimeout(function(){var a=[],e;for(e in c)c.hasOwnProperty(e)&&a.push(c[e]);b&&b(null,a)},a)};return e}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.wemo.Handler);
