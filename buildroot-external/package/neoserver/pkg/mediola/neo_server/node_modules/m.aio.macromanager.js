var m=m||{};m.aio=m.aio||{};m.aio.macromanager=m.aio.macromanager||{};m.aio.macromanager.Path=function(){this._fifo=[]};m.aio.macromanager.Path.prototype={pop:function(){if(0==this._fifo.length)throw Error("path is empty");return this._fifo.splice(0,1)[0]},push:function(a){a&&this._fifo.push(a)},length:function(){return this._fifo.length}};
m.aio.macromanager.Path.build=function(a){if(!a)return new m.aio.macromanager.Path;for(;0<a.length&&"/"==a.charAt(0);)a=1==a.length?"":a.substr(1);if(!a)return new m.aio.macromanager.Path;for(;0<a.length&&"/"==a.charAt(a.length-1);)a=1==a.length?"":a.substr(0,a.length-1);if(!a)return new m.aio.macromanager.Path;var b=new m.aio.macromanager.Path;a=a.split("/");for(var d=0;d<a.length;d++)b.push(a[d]);return b};m.aio.macromanager.Macros=function(){this.groups=[]};
m.aio.macromanager.Macros.parse=function(a){var b=new m.aio.macromanager.Macros;a&&a.groups&&(a=m.aio.macromanager.Macros._parseGroups(b,a.groups))&&(b.groups=a);return b};m.aio.macromanager.Macros._parseGroups=function(a,b){var d=null;b&&Array.isArray(b)&&(d=[],b.forEach(function(b){if(b=m.aio.macromanager.Group.parse(b))b._parent=a,d.push(b)}));return d};
m.aio.macromanager.Macros.prototype={toJSON:function(){var a=[];this.groups&&this.groups.forEach(function(b){b.toJSON&&(b=b.toJSON())&&a.push(b)});return{groups:a}},findMacro:function(a,b,d){for(var c=null,e=0;e<this.groups.length;e++)if(this.groups[e].name==a){c=this.groups[e];break}c?c.findMacro(b,d):d&&d(Error("no such group"))},findMacroIdx:function(a,b,d){for(var c=null,e=0;e<this.groups.length;e++)if(this.groups[e].index==a){c=this.groups[e];break}c?c.findMacroIdx(b,d):d&&d(Error("no such group"))},
_create:function(a,b,d,c){var e=this._resolvePath(a);if(e)if(e==this)c&&c(Error("do not support create opreation"));else if(Array.isArray(e))if(a=m.aio.macromanager.Group.parse(d)){for(b=0;b<this.groups.length;b++){if(this.groups[b].index==a.index){c&&c(Error("group index exits"));return}if(this.groups[b].name==a.name){c&&c(Error("group name exits"));return}}if(!a.index||0>a.index)a.index=0==this.groups.length?1:this.groups[this.groups.length-1].index+1;a._parent=this;this.groups.push(a);this._sortGroup();
c&&c(null,a)}else c&&c(Error("invalid group format"));else e._create(a,b,d,c);else c&&c(Error("path invalid"))},_read:function(a,b,d,c){var e=this._resolvePath(a);e?e==this?c&&c(null,this):Array.isArray(e)?c&&c(null,e):e._read(a,b,d,c):c&&c(Error("path invalid"))},_update:function(a,b,d,c){var e=this._resolvePath(a);e?e==this?(a=m.aio.macromanager.Macros.parse(d))?(this.groups=a.groups,this._sortGroup(),c&&c(null,this)):c&&c(Error("data invalid")):Array.isArray(e)?(a=m.aio.macromanager.Macros._parseGroups(this,
d))?(this.groups=a,this._sortGroup(),c&&c(null,this.groups)):c&&c(Error("groups array invalid")):e._update(a,b,d,c):c&&c(Error("path invalid"))},_delete:function(a,b,d,c){var e=this._resolvePath(a);e?e==this?(this._clearGroups(),c&&c(null,this)):Array.isArray(e)?(this._clearGroups(),c&&c(null,this)):e._delete(a,b,d,c):c&&c(Error("path invalid"))},_resolvePath:function(a){if(!a||0==a.length())return this;if("groups"!=a.pop())return null;if(0==a.length())return this.groups;a=a.pop();return(a=this._getGroup(a))?
a:null},_clearGroups:function(){this.groups&&this.groups.forEach(function(a){a&&(a._parent=null)});this.groups=[]},_getGroup:function(a){for(var b=0;b<this.groups.length;b++)if(this.groups[b].index==a)return this.groups[b];return null},_sortGroup:function(){var a=this.groups.length-1;do for(var b=!1,d=0;d<a;++d)this.groups[d].index>this.groups[d+1].index&&(b=this.groups[d],this.groups[d]=this.groups[d+1],this.groups[d+1]=b,b=!0);while(1==b)}};
m.aio.macromanager.Group=function(){this._parent=null;this.classid=m.aio.macromanager.Group.CLASS_ID;this.index=-1;this.name=null;this.macros=[]};m.aio.macromanager.Group.CLASS_ID="group";m.aio.macromanager.Group.parse=function(a){if(!a||!a.classid||a.classid!=m.aio.macromanager.Group.CLASS_ID||!a.name)return null;var b=new m.aio.macromanager.Group;b.index=a.index;b.name=a.name;a.macros&&(a=m.aio.macromanager.Group._parseMacros(b,a.macros))&&(b.macros=a);return b};
m.aio.macromanager.Group._parseMacros=function(a,b){var d=null;b&&Array.isArray(b)&&(d=[],b.forEach(function(b){if(b=m.aio.macromanager.Macro.parse(b))b._parent=a,d.push(b)}));return d};
m.aio.macromanager.Group.prototype={toJSON:function(){var a=[];this.macros&&this.macros.forEach(function(b){b.toJSON&&(b=b.toJSON())&&a.push(b)});return{classid:m.aio.macromanager.Group.CLASS_ID,index:this.index,name:this.name,macros:a}},findMacro:function(a,b){for(var d=null,c=0;c<this.macros.length;c++)if(this.macros[c].name==a){d=this.macros[c];break}d?b&&b(null,d):b&&b(Error("no such macro"))},findMacroIdx:function(a,b){for(var d=null,c=0;c<this.macros.length;c++)if(this.macros[c].index==a){d=
this.macros[c];break}d?b&&b(null,d):b&&b(Error("no such macro"))},_create:function(a,b,d,c){var e=this._resolvePath(a);if(e)if(e==this)c&&c(Error("do not support create opreation"));else if(Array.isArray(e))if(a=m.aio.macromanager.Macro.parse(d)){for(b=0;b<this.macros.length;b++){if(this.macros[b].index==a.index){c&&c(Error("macro index exits"));return}if(this.macros[b].name==a.name){c&&c(Error("macro name exits"));return}}if(!a.index||0>a.index)a.index=0==this.macros.length?1:this.macros[this.macros.length-
1].index+1;a._parent=this;this.macros.push(a);this._sortMacro();c&&c(null,a)}else c&&c(Error("invalid macro format"));else e._create(a,b,d,c);else c&&c(Error("path invalid"))},_read:function(a,b,d,c){var e=this._resolvePath(a);e?e==this?c&&c(null,this):Array.isArray(e)?c&&c(null,e):e._read(a,b,d,c):c&&c(Error("path invalid"))},_update:function(a,b,d,c){var e=this._resolvePath(a);if(e)if(e==this)if(a=m.aio.macromanager.Group.parse(d))if(this._parent&&this._parent.groups){for(b=0;b<this._parent.groups.length;b++){if(this._parent.groups[b].index==
a.index&&this._parent.groups[b].index!=this.index){c&&c(Error("group index exits"));return}if(this._parent.groups[b].name==a.name&&this._parent.groups[b].name!=this.name){c&&c(Error("group name exits"));return}}d=-1;for(b=0;b<this._parent.groups.length;b++)if(this._parent.groups[b]===this){d=b;break}0<=d&&this._parent.groups.splice(d,1);if(!a.index||0>a.index)a.index=this.index;this._parent.groups.push(a);a._parent=this._parent;this._parent=null;a._parent._sortGroup();c&&c(null,a)}else c&&c(Error("group is isolated"));
else c&&c(Error("data invalid"));else Array.isArray(e)?(a=m.aio.macromanager.Group._parseMacros(this,d))?(this.macros=a,this._sortMacro(),c&&c(null,this.macros)):c&&c(Error("macros array invalid")):e._update(a,b,d,c);else c&&c(Error("path invalid"))},_delete:function(a,b,d,c){var e=this._resolvePath(a);if(e)if(e==this){if(this._parent){if(this._parent.groups){a=-1;for(b=0;b<this._parent.groups.length;b++)if(this._parent.groups[b]===this){a=b;break}-1!=a&&this._parent.groups.splice(a,1)}this._parent=
null}c&&c(null,this)}else Array.isArray(e)?(this._clearMacros(),c&&c(null,this)):e._delete(a,b,d,c);else c&&c(Error("path invalid"))},_resolvePath:function(a){if(!a||0==a.length())return this;if("macros"!=a.pop())return null;if(0==a.length())return this.macros;a=a.pop();return(a=this._getMacro(a))?a:null},_clearMacros:function(){this.macros&&this.macros.forEach(function(a){a&&(a._parent=null)});this.macros=[]},_getMacro:function(a){for(var b=0;b<this.macros.length;b++)if(this.macros[b].index==a)return this.macros[b];
return null},_sortMacro:function(){var a=this.macros.length-1;do for(var b=!1,d=0;d<a;++d)this.macros[d].index>this.macros[d+1].index&&(b=this.macros[d],this.macros[d]=this.macros[d+1],this.macros[d+1]=b,b=!0);while(1==b)}};m.aio.macromanager.Macro=function(){this._parent=null;this.classid=m.aio.macromanager.Macro.CLASS_ID;this.index=-1;this.pause=this.name=null;this.inWidget=!0;this.cloud=null;this.commands=[]};m.aio.macromanager.Macro.CLASS_ID="macro";
m.aio.macromanager.Macro.parse=function(a){if(!a||!a.classid||a.classid!=m.aio.macromanager.Macro.CLASS_ID||!a.name)return null;var b=new m.aio.macromanager.Macro;b.index=a.index;b.name=a.name;b.pause=a.pause;b.inWidget=a.inWidget;b.cloud=a.cloud;a.commands&&(a=m.aio.macromanager.Macro._parseMacroCommands(b,a.commands))&&(b.commands=a);return b};
m.aio.macromanager.Macro._parseMacroCommands=function(a,b){var d=null;b&&Array.isArray(b)&&(d=[],b.forEach(function(b){if(b=m.aio.macromanager.MacroCommand.parse(b))b._parent=a,d.push(b)}));return d};
m.aio.macromanager.Macro.prototype={toJSON:function(){var a=[];this.commands&&this.commands.forEach(function(b){b.toJSON&&(b=b.toJSON())&&a.push(b)});return{classid:m.aio.macromanager.Macro.CLASS_ID,index:this.index,name:this.name,pause:this.pause,inWidget:this.inWidget,cloud:this.cloud,commands:a}},_create:function(a,b,d,c){var e=this._resolvePath(a);if(e)if(e==this)c&&c(Error("do not support create opreation"));else if(Array.isArray(e))if(a=m.aio.macromanager.MacroCommand.parse(d)){for(b=0;b<this.commands.length;b++)if(this.commands[b].index==
a.index){c&&c(Error("macro index exits"));return}if(!a.index||0>a.index)a.index=0==this.commands.length?1:this.commands[this.commands.length-1].index+1;a._parent=this;this.commands.push(a);this._sortCommand();c&&c(null,a)}else c&&c(Error("invalid macro command format"));else e._create(a,b,d,c);else c&&c(Error("path invalid"))},_read:function(a,b,d,c){var e=this._resolvePath(a);e?e==this?c&&c(null,this):Array.isArray(e)?c&&c(null,e):e._read(a,b,d,c):c&&c(Error("path invalid"))},_update:function(a,
b,d,c){var e=this._resolvePath(a);if(e)if(e==this)if(a=m.aio.macromanager.Macro.parse(d))if(this._parent&&this._parent.macros){for(b=0;b<this._parent.macros.length;b++){if(this._parent.macros[b].index==a.index&&this._parent.macros[b].index!=this.index){c&&c(Error("macro index exits"));return}if(this._parent.macros[b].name==a.name&&this._parent.macros[b].name!=this.name){c&&c(Error("macro name exits"));return}}d=-1;for(b=0;b<this._parent.macros.length;b++)if(this._parent.macros[b]===this){d=b;break}0<=
d&&this._parent.macros.splice(d,1);if(!a.index||0>a.index)a.index=this.index;this._parent.macros.push(a);a._parent=this._parent;this._parent=null;a._parent._sortMacro();c&&c(null,a)}else c&&c(Error("macro is isolated"));else c&&c(Error("data invalid"));else Array.isArray(e)?(a=m.aio.macromanager.Macro._parseMacroCommands(this,d))?(this.commands=a,this._sortCommand(),c&&c(null,this.commands)):c&&c(Error("commands array invalid")):e._update(a,b,d,c);else c&&c(Error("path invalid"))},_delete:function(a,
b,d,c){var e=this._resolvePath(a);if(e)if(e==this){if(this._parent){if(this._parent.macros){a=-1;for(b=0;b<this._parent.macros.length;b++)if(this._parent.macros[b]===this){a=b;break}-1!=a&&this._parent.macros.splice(a,1)}this._parent=null}c&&c(null,this)}else Array.isArray(e)?(this._clearCommands(),c&&c(null,this)):e._delete(a,b,d,c);else c&&c(Error("path invalid"))},_resolvePath:function(a){if(!a||0==a.length())return this;if("commands"!=a.pop())return null;if(0==a.length())return this.commands;
a=a.pop();return(a=this._getCommand(a))?a:null},_clearCommands:function(){this.commands&&this.commands.forEach(function(a){a&&(a._parent=null)});this.commands=[]},_getCommand:function(a){for(var b=0;b<this.commands.length;b++)if(this.commands[b].index==a)return this.commands[b];return null},_sortCommand:function(){var a=this.commands.length-1;do for(var b=!1,d=0;d<a;++d)this.commands[d].index>this.commands[d+1].index&&(b=this.commands[d],this.commands[d]=this.commands[d+1],this.commands[d+1]=b,b=
!0);while(1==b)}};m.aio.macromanager.MacroCommand=function(a){this._parent=null;this.classid=a;this.index=-1};
m.aio.macromanager.MacroCommand.parse=function(a){if(!a||!a.classid)return null;switch(a.classid){case m.aio.macromanager.Command.CLASS_ID:var b=m.aio.macromanager.Command.parse(a);break;case m.aio.macromanager.Navigate.CLASS_ID:b=m.aio.macromanager.Navigate.parse(a);break;case m.aio.macromanager.Sleep.CLASS_ID:b=m.aio.macromanager.Sleep.parse(a);break;default:return null}b&&(b.index=a.index);return b};
m.aio.macromanager.MacroCommand.prototype={toJSON:function(){return{classid:this.classid,index:this.index}},_create:function(a,b,d,c){(a=this._resolvePath(a))?a==this&&c&&c(Error("do not support create opreation")):c&&c(Error("path invalid"))},_read:function(a,b,d,c){(a=this._resolvePath(a))?a==this&&c&&c(null,this):c&&c(Error("path invalid"))},_update:function(a,b,d,c){a=this._resolvePath(a);if(!a)c&&c(Error("path invalid"));else if(a==this)if(d=m.aio.macromanager.MacroCommand.parse(d))if(this._parent&&
this._parent.commands){a=-1;for(b=0;b<this._parent.commands.length;b++)if(this._parent.commands[b]===this){a=b;break}0<=a&&this._parent.commands.splice(a,1);if(!d.index||0>d.index)d.index=0==this._parent.commands.length?1:this._parent.commands[this._parent.commands.length-1].index+1;this._parent.commands.push(d);d._parent=this._parent;this._parent=null;d._parent._sortCommand();c&&c(null,d)}else c&&c(Error("macro command is isolated"));else c&&c(Error("data invalid"))},_delete:function(a,b,d,c){a=
this._resolvePath(a);if(!a)c&&c(Error("path invalid"));else if(a==this){if(this._parent){if(this._parent.commands){a=-1;for(b=0;b<this._parent.commands.length;b++)if(this._parent.commands[b]===this){a=b;break}-1!=a&&this._parent.commands.splice(a,1)}this._parent=null}c&&c(null,this)}},_resolvePath:function(a){return a&&0!=a.length()?null:this}};m.aio.macromanager.Command=function(){m.aio.macromanager.MacroCommand.call(this,m.aio.macromanager.Command.CLASS_ID);this.action=null};
m.aio.macromanager.Command.prototype=new m.aio.macromanager.MacroCommand;m.aio.macromanager.Command.prototype.constructor=m.aio.macromanager.Command;m.aio.macromanager.Command.CLASS_ID="command";m.aio.macromanager.Command.parse=function(a){if(!a||!a.classid||a.classid!=m.aio.macromanager.Command.CLASS_ID)return null;var b=new m.aio.macromanager.Command;b.action=a.action;return b};
m.aio.macromanager.Command.prototype.toJSON=function(){var a=m.aio.macromanager.MacroCommand.prototype.toJSON.call(this);a.action=this.action;return a};m.aio.macromanager.Navigate=function(){m.aio.macromanager.MacroCommand.call(this,m.aio.macromanager.Navigate.CLASS_ID);this.history=this.page=null};m.aio.macromanager.Navigate.prototype=new m.aio.macromanager.MacroCommand;m.aio.macromanager.Navigate.prototype.constructor=m.aio.macromanager.Navigate;m.aio.macromanager.Navigate.CLASS_ID="navigate";
m.aio.macromanager.Navigate.parse=function(a){if(!a||!a.classid||a.classid!=m.aio.macromanager.Navigate.CLASS_ID)return null;var b=new m.aio.macromanager.Navigate;b.page=a.page;"number"===typeof a.history&&(b.history=a.history);"string"===typeof a.popup&&(b.popup=a.popup,a.device&&(b.device=a.device),a.gateway&&(b.gateway=a.gateway),a.settings&&(b.settings=a.settings));a.popup_close&&(b.popup_close=a.popup_close);a.ext&&(b.ext=a.ext);return b};
m.aio.macromanager.Navigate.prototype.toJSON=function(){var a=m.aio.macromanager.MacroCommand.prototype.toJSON.call(this);a.page=this.page;"number"===typeof this.history&&(a.history=this.history);"string"===typeof this.popup&&(a.popup=this.popup,this.device&&(a.device=this.device),this.gateway&&(a.gateway=this.gateway),this.settings&&(a.settings=this.settings));this.popup_close&&(a.popup_close=this.popup_close);this.ext&&(a.ext=this.ext);return a};
m.aio.macromanager.Sleep=function(){m.aio.macromanager.MacroCommand.call(this,m.aio.macromanager.Sleep.CLASS_ID);this.time=0};m.aio.macromanager.Sleep.prototype=new m.aio.macromanager.MacroCommand;m.aio.macromanager.Sleep.prototype.constructor=m.aio.macromanager.Sleep;m.aio.macromanager.Sleep.CLASS_ID="sleep";m.aio.macromanager.Sleep.parse=function(a){if(!a||!a.classid||a.classid!=m.aio.macromanager.Sleep.CLASS_ID)return null;var b=new m.aio.macromanager.Sleep;b.time=a.time;return b};
m.aio.macromanager.Sleep.prototype.toJSON=function(){var a=m.aio.macromanager.MacroCommand.prototype.toJSON.call(this);a.time=this.time;return a};m.aio.macromanager.Handler=function(a,b){this.tenant=a;this.macros=b?b:new m.aio.macromanager.Macros;this.waitingTask=this.runningTask=null};
m.aio.macromanager.Handler.prototype={execute:function(a,b,d,c,e){if(b=m.aio.macromanager.Path.build(b))switch(a){case "create":this._create(b,d,c,function(a,b){b=this._toJSON(b);e&&e(a,b)}.bind(this));break;case "read":this._read(b,d,c,function(a,b){b=this._toJSON(b);e&&e(a,b)}.bind(this));break;case "update":this._update(b,d,c,function(a,b){b=this._toJSON(b);e&&e(a,b)}.bind(this));break;case "delete":this._delete(b,d,c,function(a,b){b=this._toJSON(b);e&&e(a,b)}.bind(this));break;default:e&&e(Error("invalid operation"))}else e&&
e(Error("invalid path"))},findMacro:function(a,b,d){this.macros.findMacro(a,b,d)},findMacroIdx:function(a,b,d){this.macros.findMacroIdx(a,b,d)},_create:function(a,b,d,c){this.macros._create(a,b,d,function(a,b){a?c&&c(a):this._saveMacros(function(a){c&&c(a,a?null:b)})}.bind(this))},_read:function(a,b,d,c){this.macros._read(a,b,d,c)},_update:function(a,b,d,c){this.macros._update(a,b,d,function(a,b){a?c&&c(a):this._saveMacros(function(a){c&&c(a,a?null:b)})}.bind(this))},_delete:function(a,b,d,c){this.macros._delete(a,
b,d,function(a,b){a?c&&c(a):this._saveMacros(function(a){c&&c(a,a?null:b)})}.bind(this))},_saveMacros:function(a){this.runningTask?this.waitingTask?this.waitingTask.addCallback(a):this.waitingTask=new m.aio.macromanager.Handler.SaveMacrosTask(this,a):(this.runningTask=new m.aio.macromanager.Handler.SaveMacrosTask(this,a),this.runningTask.save())},_loadMacros:function(a){if(this.tenant){var b=this.tenant.getFolderPath();if(b){var d=require("fs"),c=require("path");b=b+c.sep+m.aio.macromanager.MacroManager.DB;
var e=this;this._fileExistsSync(b)?d.readFile(b,{encoding:"utf8"},function(b,c){if(!b&&c){try{var d=JSON.parse(c)}catch(k){}if(c=m.aio.macromanager.Macros.parse(d))this.macros=c}a&&a(b)}.bind(this)):d.writeFile(b,"",function(){e._loadMacros(a)})}else a&&a(Error("tenant folder invalid"))}else a&&a(Error("tenant is null"))},_saveMacrosFinish:function(){this.runningTask=null;this.waitingTask&&(this.runningTask=this.waitingTask,this.waitingTask=null,this.runningTask.save())},_fileExistsSync:function(a){var b=
require("fs");try{b.statSync(a)}catch(d){if("ENOENT"==d.code)return!1}return!0},_toJSON:function(a){if("undefined"==typeof a||null==a)return null;if(a.toJSON&&"function"==typeof a.toJSON)return a.toJSON();if(Array.isArray(a)){var b=[];a.forEach(function(a){b.push(this._toJSON(a))}.bind(this));return b}return a}};m.aio.macromanager.Handler.SaveMacrosTask=function(a,b){this._handler=a;this._callbacks=[];b&&this._callbacks.push(b)};
m.aio.macromanager.Handler.SaveMacrosTask.prototype={addCallback:function(a){for(var b=0;b<this._callbacks.length;b++)if(this._callbacks[b]===a)return;this._callbacks.push(a)},save:function(){this._saveFile(function(a){this._callbacks.forEach(function(b){b&&b(a)});this._handler._saveMacrosFinish()}.bind(this))},_saveFile:function(a){if(this._handler.tenant){var b=this._handler.tenant.getFolderPath();if(b){var d=require("fs"),c=require("path");d.writeFile(b+c.sep+m.aio.macromanager.MacroManager.DB,
JSON.stringify(this._handler.macros.toJSON()),function(b){a(b)})}else a&&a(Error("tenant folder invalid"))}else a(Error("tenant is null"))}};m.aio.macromanager.MacroManager=function(){this.handlers=[];this._configmanager=null};m.aio.macromanager.MacroManager.DB="macros_db";
m.aio.macromanager.MacroManager.prototype={init:function(a,b,d){a&&a.children?(this._configmanager=b,require("async").each(a.children,function(a,b){a=new m.aio.macromanager.Handler(a);this.handlers.push(a);a._loadMacros(function(){b()})}.bind(this),function(a){d&&d(a)})):d&&d()},addTenant:function(a,b){a=new m.aio.macromanager.Handler(a);this.handlers.push(a);a._loadMacros(function(a){b&&b()})},removeTenant:function(a,b){this._removeHandler(a.index);b&&b()},execute:function(a,b,d,c,e,f){this._configmanager.trace("config/tenants/"+
a,function(h,g){if(h)g||this._removeHandler(a),f&&f(Error("no tenant with index "+a));else if(g.isAccessible()){var k=this._getHandler(a);k?k.execute(b,d,c,e,f):this.addTenant(g,function(a){a?f&&f(a):k.execute(b,d,c,e,f)})}else f&&f(Error("not permitted"))}.bind(this))},saveRemote:function(a,b){if(a.parent){var d=a.parent.parent;if(d)if(d=d.getFolderPath()){a=a.getFolderPath();var c=require("fs"),e=require("fs-extra"),f=require("path"),h=d+f.sep+m.aio.macromanager.MacroManager.DB,g=a+f.sep+m.aio.macromanager.MacroManager.DB;
c.exists(h,function(a){a?e.copy(h,g,function(a){b&&b(a)}):b&&b()})}else b&&b(Error("invalid tenant folder"));else b&&b(Error("remote do not belong to any tenant"))}else b&&b(Error("remote is isolated"))},reloadTenant:function(a,b){for(var d=-1,c=0;c<this.handlers.length;c++){var e=this.handlers[c];if(e&&e.tenant&&e.tenant.index==a.index){d=c;break}}-1!=d&&this.handlers.splice(d,1);a=new m.aio.macromanager.Handler(a);this.handlers.push(a);a._loadMacros(function(){b()})},_getHandler:function(a){for(var b=
0;b<this.handlers.length;b++){var d=this.handlers[b];if(d&&d.tenant&&d.tenant.index==a)return d}return null},_removeHandler:function(a){for(var b=-1,d=0;d<this.handlers.length;d++){var c=this.handlers[d];if(c&&c.tenant&&c.tenant.index==a){b=d;break}}-1!=b&&this.handlers.splice(b,1)}};m.aio.macromanager.MM=new m.aio.macromanager.MacroManager;m.aio.macromanager.MM.Macros=m.aio.macromanager.Macros;m.aio.macromanager.MM.Handler=m.aio.macromanager.Handler;
"undefined"!=typeof module&&null!=module&&(module.exports=m.aio.macromanager.MM);
