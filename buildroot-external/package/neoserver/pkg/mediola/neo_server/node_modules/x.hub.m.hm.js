var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,k,m){e instanceof String&&(e=String(e));for(var g=e.length,h=0;h<g;h++){var l=e[h];if(k.call(m,l,h,e))return{i:h,v:l}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,k,m){e!=Array.prototype&&e!=Object.prototype&&(e[k]=m.value)};$jscomp.getGlobal=function(e){e=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,e];for(var k=0;k<e.length;++k){var m=e[k];if(m&&m.Math==Math)return m}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(e,k,m,g){if(k){m=$jscomp.global;e=e.split(".");for(g=0;g<e.length-1;g++){var h=e[g];h in m||(m[h]={});m=m[h]}e=e[e.length-1];g=m[e];k=k(g);k!=g&&null!=k&&$jscomp.defineProperty(m,e,{configurable:!0,writable:!0,value:k})}};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(k,e){return $jscomp.findInternal(this,k,e).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(e){var k=0;return function(){return k<e.length?{done:!1,value:e[k++]}:{done:!0}}};
$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(e,k){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:k})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function e(m){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(m||"")+"_"+k++,m)}var k=0;return e}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};
$jscomp.iteratorFromArray=function(e,k){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var m=0,g={next:function(){if(m<e.length){var h=m++;return{value:k(h,e[h]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(k){return k})}},"es6","es3");
var util=require("util"),EventEmitter=require("events"),async=require("async"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.hm=x.hub.m.hm||{};x.hub.m.hm.CCU_INIT_STATE=!0;x.hub.m.hm.HM_MODULE=require("xnm.aio.hm.js");
x.hub.m.hm.RFDeviceTypes={"HM-PB-4Dis-WM":0,"ZEL STG RM DWT 10":0,"263 155":0,"HM-PB-4Dis-WM-2":0,ASH550I:1,ASH550:1,"HM-WDS10-TH-O":1,"263 158":1,"HM-WDS20-TH-O":1,"HM-WDS40-TH-I":1,"263 157":1,"IS-WDS-TH-OD-S-R3":1,"HM-WDS40-TH-I-2":1,"HM-LC-Bl1-SM":2,"HM-LC-Bl1-FM":2,"HM-LC-Bl1-PB-FM":2,"ZEL STG RM FEP 230V":2,"263 146":2,"HM-LC-BlX":2,"HM-LC-Bl1-SM-2":2,"HM-LC-Bl1-FM-2":2,"HM-LC-Bl1PBU-FM":2,"263 147":2,"HM-CC-RT-DN":3,"HM-CC-RT-DN-BoM":4,"HM-CC-TC":5,"ZEL STG RM FWT":5,"HM-CC-VD":6,"ZEL STG RM FSA":6,
CENTRAL:7,"HM-RCV-50":7,"HM-OU-CF-Pl":8,"HM-OU-CFM-Pl":9,"HM-OU-CFM-TW":9,"HM-OU-CM-PCB":10,"HM-LC-AO-SM":11,"HM-LC-Dim1L-Pl":11,"HM-LC-Dim1L-Pl-2":11,"HM-LC-Dim1L-CV":11,"263 132":11,"HM-LC-Dim2L-CV":11,"HM-LC-Dim2L-SM":11,"HSS-DX":11,"HM-LC-Dim1L-Pl-3":11,"HM-LC-Dim1L-CV-2":11,"HM-LC-Dim2L-SM-2":11,"HM-LC-Dim1PWM-CV":12,"HM-LC-Dim1PWM-CV-2":12,"HM-LC-Dim1TPBU-FM":13,"HM-LC-Dim1TPBU-FM-2":13,"263 133":13,"HM-LC-Dim1T-Pl":13,"HM-LC-Dim1T-CV":13,"HM-LC-Dim1T-FM":13,"HM-LC-Dim1T-Pl-3":13,"HM-LC-Dim1T-CV-2":13,
"HM-LC-Dim1T-FM-2":13,"HM-LC-Dim2T-SM":13,"HM-LC-Dim2T-SM-2":13,"HM-LC-Dim1T-Pl-2":13,"263 134":13,"HM-LC-Dim1T-DR":13,"HM-LC-Dim1T-FM-LF":13,"OLIGO.smart.iq.HM":11,"HM-Dis-WM55":14,"HM-MOD-EM-8":15,"HM-ES-PMSw1-Pl":16,"HM-ES-PMSw1-Pl-DN-R1":16,"HM-ES-PMSw1-Pl-DN-R2":16,"HM-ES-PMSw1-Pl-DN-R3":16,"HM-ES-PMSw1-Pl-DN-R4":16,"HM-ES-PMSw1-Pl-DN-R5":16,"HM-ES-PMSw1-DR":16,"HM-ES-PMSw1-SM":16,"HM-Dis-TD-T":17,"HM-Sec-Key":18,"HM-Sec-Key-S":18,"HM-Sec-Key-O":18,"HM-Sec-Key-Generic":18,KS550:19,KS888:19,KS550Tech:19,
KS550LC:19,"HM-WDS100-C6-O":19,"HM-WDS100-C6-O-2":19,"HM-OU-LED16":20,"HM-OU-X":20,"HM-PB-2-WM55-2":21,"HM-PB-2-WM55":21,"ZEL STG RM WT 2":21,"263 135":21,"HM-PB-2-FM":21,"HM-PBI-4-FM":21,"ZEL STG RM FST UP4":21,"263 145":21,"HM-PBI-X":21,"HM-RC-4-2":21,"HM-PB-6-WM55":21,"HM-RC-8":21,"HM-RC-4":21,"HM-RC-4-3":21,"HM-RC-4-B":21,"HM-RC-P1":21,"HM-RC-Sec3":21,"HM-RC-Sec3-B":21,"HM-RC-Key3":21,"HM-RC-Key3-B":21,"HM-PB-4-WM":21,"HM-PB-2-WM":21,"HM-RC-2-PBU-FM":21,"RC-H":21,atent:21,"ZEL STG RM HS 4":21,
"HM-RC-X":21,"BRC-H":21,"HM-RC-SB-X":21,"HM-RC-12":21,"HM-RC-12-B":21,"HM-RC-12-SW":21,"HM-RC-Key4-2":22,"HM-RC-Sec4-2":22,"HM-RC-Key4-3":22,"HM-RC-Sec4-3":22,"HM-RC-19":23,"HM-RC-19-B":23,"HM-RC-19-SW":23,"HM-Sen-RD-O":24,"HM-Sec-RHS":25,"HM-Sec-RHS-2":25,"ZEL STG RM FDK":25,"HM-Sec-xx":25,"HM-LC-Sw1-Pl":26,"HM-LC-Sw1-Pl-2":26,"HM-LC-Sw1-SM":26,"HM-LC-Sw2-SM":26,"HM-LC-Sw4-SM":26,"HM-LC-Sw4-PCB":26,"HM-LC-Sw4-WM":26,"HM-LC-Sw1-FM":26,"263 130":26,"HM-LC-Sw2-FM":26,"HM-LC-Sw1-PB-FM":26,"HM-LC-Sw2-PB-FM":26,
"HM-LC-Sw4-DR":26,"HM-LC-Sw2-DR":26,"ZEL STG RM FZS":26,"ZEL STG RM FZS-2":26,"HM-LC-Sw1PBU-FM":26,"HM-LC-Sw2PBU-FM":26,"263 131":26,"HM-MOD-Re-8":26,"HM-LC-Sw1-Ba-PCB":26,"HM-LC-Sw4-Ba-PCB":26,"HM-LC-Sw1-Pl-3":26,"HM-LC-Sw1-SM-2":26,"HM-LC-Sw4-SM-2":26,"HM-LC-Sw4-PCB-2":26,"HM-LC-Sw4-WM-2":26,"HM-LC-Sw1-FM-2":26,"HM-LC-Sw2-FM-2":26,"HM-LC-Sw4-DR-2":26,"HM-LC-Sw2-DR-2":26,"HM-LC-Sw1-Pl-DN-R1":26,"HM-LC-Sw1-Pl-DN-R2":26,"HM-LC-Sw1-Pl-DN-R3":26,"HM-LC-Sw1-Pl-DN-R4":26,"HM-LC-Sw1-Pl-DN-R5":26,"HM-LC-Sw1-DR":26,
"HM-LC-Sw1-Pl-CT-R1":26,"HM-LC-Sw1-Pl-CT-R2":26,"HM-LC-Sw1-Pl-CT-R3":26,"HM-LC-Sw1-Pl-CT-R4":26,"HM-LC-Sw1-Pl-CT-R5":26,"HM-LC-Sw1-PCB":26,"HM-LC-Sw1-Pl-OM54":26,"HM-LC-Sw1-SM-ATmega168":26,"HM-LC-Sw4-SM-ATmega168":26,S550IA:27,"HM-WDS30-T-O":27,"HM-Sec-SC":28,"ZEL STG RM FFK":28,"HM-Sec-SC-2":28,"HM-SCI-3-FM":29,"HM-CC-SCD":30,"263 160":30,"HM-Sec-MDIR-3":31,"HM-Sec-MDIR-2":31,"HM-Sec-MDIR":31,"263 162":31,"HM-Sec-MD":31,"HM-Sec-SD":32,"HM-Sec-SD-Generic":32,"HM-Sec-SD-2":32,"HM-Sec-SD-2-Generic":32,
"HM-Sec-SFA-SM":33,"HM-Sen-MDIR-SM":34,"HM-Sen-MDIR-O":34,"HM-MD":34,"HM-Sen-MDIR-O-2":34,"HM-Sen-MDIR-O-3":34,"HM-Sen-EP":35,"HM-Sen-X":35,"HM-Sen-Wa-Od":36,"HM-SwI-3-FM":37,"ZEL STG RM FSS UP3":37,"263 144":37,"HM-SwI-X":37,"HM-TC-IT-WM-W-EU":38,"HM-Sec-TiS":39,"HM-WDS30-OT2-SM":40,"HM-WDS30-OT2-SM-2":40,"HM-Sec-WDS":41,"HM-Sec-WDS-2":41,"HM-Sec-Win":42,"HM-Sec-Win-Generic":42,WS550:43,WS888:43,WS550Tech:43,WS550LCB:43,WS550LCW:43,"HM-WDC7000":43,"HMW-IO-12-Sw14-DR":44,"HMW-IO-12-Sw7-DR":45,"HMW-IO-12-FM":46,
"HMW-IO-4-FM":46,"HMW-LC-Bl1-DR":47,"HMW-LC-Dim1L-DR":48,"HMW-LC-Sw2-DR":49,"HMW-Sen-SC-12-DR":50,"HMW-Sen-SC-12-FM":50,"HM-CC-VG-1":51,"HM-ES-TX-WM":52,"HM-LC-RGBW-WM":53,"HM-Sec-SD-2-Team":54,"HM-Sen-LI-O":56,"HM-Sec-SCo":28,"HM-Sec-Sir-WM":57,"HM-LC-Ja1PBU-FM":58,"HM-MOD-EM-8Bit":59,"HM-Dis-EP-WM55":60,"HM-Sen-MDIR-WM55":61,"HM-LC-DW-WM":62};
x.hub.m.hm.RFDeviceCatagory=[{type:"button",channelNum:"*",channel:"KEY"},{type:"weather"},{type:"blind",channelNum:"*",channel:"BLIND"},{type:"heater2"},{type:"heater3"},{type:"wallthermo"},{type:"heater"},{type:"vbutton",channelNum:"*",channel:"VIRTUAL_KEY"},{type:"gong2"},{type:"gong"},{type:"gong"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"button",channelNum:"*",channel:"KEY"},{type:"mod_em_8",
channelNum:"*",channel:"KEY"},{type:"powerswitch"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"keymatic"},{type:"weatherstation"},{type:"ou_led16",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"rain"},{type:"window"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"temp"},{type:"contact",channelNum:"*",channel:"SHUTTER_CONTACT"},{type:"contact",channelNum:"*",
channel:"SHUTTER_CONTACT"},{type:"co2"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{type:"smoke"},{type:"siren",channelNum:"*",channel:"ALARMACTUATOR"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{},{type:"capacity"},{type:"switch_interface",channelNum:"*",channel:"SWITCH_INTERFACE"},{type:"wallthermo2"},{type:"tilt",channelNum:"*",channel:"TILT_SENSOR"},{type:"temp2",channel:"WEATHER"},{type:"water",channelNum:"*",channel:"WATERDETECTIONSENSOR"},{},{type:"weather2"},{},
{},{},{},{},{},{},{},{type:"energymeter"},{type:"rgb"},{},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"lux"},{type:"siren2"},{type:"jalousie",channelNum:"*",channel:"JALOUSIE"},{type:"mod_em_8bit"},{type:"button",channelNum:"*",channel:"KEY"},{},{type:"dualwhite"}];
x.hub.m.hm.IPDeviceTypes={"HMIP-PS":0,"HmIP-PCBS":0,"HmIP-PCBS-BAT":0,"HMIP-SWDO":1,"HmIP-SWDO-I":1,"HmIP-SWDM":1,"HmIP-SWDM-B2":1,"Contact AA":1,"HMIP-WTH":2,"HmIP-WTH-2":2,"HmIP-STH":2,"HmIP-STHD":2,"HMIP-eTRV":3,"HMIP-eTRV-2":3,"HmIP-eTRV-2-UK":3,"HmIP-eTRV-B":3,"HmIP-eTRV-B1":3,"HmIP-eTRV-B-UK":3,"HmIP-eTRV-C":3,"HMIP-WRC2":4,"HmIP-SMI":5,"HmIP-SMO":5,"HmIP-SMO-A":5,"HmIP-SRH":6,"HmIP-SWSD":7,"HmIP-PSM":8,"Smart Plug AA":8,"HmIP-PSM-PE":8,"HmIP-PSM-UK":8,"HmIP-PSM-IT":8,"HmIP-PSM-CH":8,"HmIP-BSM":9,
"HmIP-BDT":10,"HmIP-ASIR":11,"HmIP-KRC4":12,"HmIP-KRCA":12,"HmIP-PDT":13,"HmIP-PDT-UK":13,"HmIP-FSM":14,"HmIP-FSM16":14,"HmIP-BROLL":15,"HmIP-FROLL":15,"HmIP-FBL":16,"HmIP-BBL":16,"HmIP-SPI":17,"HmIP-FDT":18,"HmIP-BWTH":19,"HmIP-BWTH24":19,"HmIP-FAL230-C6":20,"HmIP-FAL24-C6":20,"HmIP-FAL230-C10":20,"HmIP-FAL24-C10":20,"HmIP-WRC6":21,"HmIP-SWO-B":22,"HmIP-SWO-PL":23,"HmIP-SWO-PR":27,"HmIP-STHO":24,"HmIP-STHO-A":24,"HmIP-SPDR":25,"HmIP-SMI55":26,"HmIP-RC8":28,"HmIP-MIOB":0,"HmIP-SWD":31,"HmIP-SAM":32,
"HmIP-WGC":33,"HmIP-BSL":34,"HmIP-MOD-TM":35,"HmIP-DBB":36,"HmIP-FCI1":37,"HmIP-FCI6":37,"HmIP-SLO":38,"HmIP-BRC2":4,"HmIP-PMFS":39,"HmIP-MOD-RC8":37,"HmIP-MOD-OC8":1,"HmIP-WRCR":40};
x.hub.m.hm.IPDeviceCatagory=[{type:"ip_switch"},{type:"ip_contact"},{type:"ip_wallthermo"},{type:"ip_heater"},{type:"ip_button2"},{type:"ip_motion"},{type:"ip_window"},{type:"ip_smoke"},{type:"ip_powerswitch"},{type:"ip_energyactor"},{type:"ip_dimmer"},{type:"ip_siren"},{type:"ip_button4"},{type:"ip_dimmer2"},{type:"ip_energyactor2"},{type:"ip_blind"},{type:"ip_jalousie"},{type:"ip_presence"},{type:"ip_dimmer3"},{type:"ip_wallthermo2"},{type:"ip_floor_heater"},{type:"ip_button6"},{type:"ip_weather"},
{type:"ip_weather2"},{type:"ip_weather3"},{type:"ip_direction"},{type:"ip_motion2"},{type:"ip_weather4"},{type:"ip_button8"},{type:"ip_generic_input"},{type:"ip_analog_output"},{type:"ip_water"},{type:"ip_acce"},{type:"ip_garagedoor"},{type:"ip_bsl"},{type:"ip_tormatic"},{type:"ip_button"},{type:"ip_multi_input_bat"},{type:"ip_lux"},{type:"ip_pmfs"},{type:"ip_rotary"}];
x.hub.m.hm.Util={clearHttpOptionForLog:function(e){try{var k=JSON.parse(JSON.stringify(e));k.auth&&(k.auth="xxxxxx:xxxxxx");if(k.headers)for(var m in headers)if(m&&"authorization"==m.toLocaleLowerCase()){var g=headers[m];if(g){var h=g.indexOf(" ");headers[m]=-1==h?"xxxxxx":g.substr(0,h)+" xxxxxx"}}return k}catch(l){return e}}};
x.hub.m.hm.Client=function(){var e=function(k,e,g,h,l){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Client");this.ip=k;this.port=e;this.port||(this.port=2001);this.username=g;this.password=h;this.useHttps=l;this.timeout=2E4;this.xml2js=null};e.prototype._doRequest=function(k,e,g){var h=require("http");this.useHttps&&(h=require("https"));k={host:this.ip,port:this.port,path:"/",method:k,headers:{"User-Agent":"mediola",Connection:"keep-alive"}};this.username&&(k.auth=this.username+":"+(this.password?
this.password:""));e&&(k.headers["Content-Length"]=e.length);var l=g,m=this;this._logger.log("trace","send http request:"+x.hub.m.hm.Util.clearHttpOptionForLog(k));this._logger.log("trace","send http data:"+e);g=h.request(k,function(h){var g="";h.setEncoding("utf-8");h.on("data",function(h){g+=h});h.on("end",function(){m._logger.log("trace","http response status:"+h.statusCode);m._logger.log("trace","http response data:"+g);var n=null;200!=h.statusCode&&(n=Error("http response "+h.statusCode));l&&
l(n,g,h.statusCode)})});g.on("error",function(h){m._logger.log("trace","http request error:"+h.stack);l&&l(h);l=null});g.setTimeout(this.timeout,function(){m._logger.log("trace","http request timeout");l&&l(Error("http timeout"));l=null});e&&g.write(e);g.end()};e.prototype._doXMLRpcRequest=function(k,e,g){var h=require("x.xmlrpc.js");k='<?xml version="1.0" encoding="ISO-8859-1"?><methodCall><methodName>'+k+"</methodName><params>";for(var l=0;l<e.length;l++)k=e[l]&&e[l].type&&void 0!=e[l].value?k+
("<param>"+h.serializeValue(e[l].value,e[l].type)+"</param>"):k+("<param>"+h.serializeValue(e[l])+"</param>");this._doRequest("POST",k+"</params></methodCall>",function(l,n){if(l)g&&g(l);else if(n)try{var k=h.deserializeRsp(n);k.error?g&&g(Error("xml rcp return error:"+k.error.faultString+" @code:"+k.error.faultCode),k.error):g&&g(null,k.params)}catch(p){g&&g(p)}else g&&g(Error("xml rcp response format invalid"))})};e.prototype.convertHmIPKeyBase32ToBase16=function(k){k=k.replace(/-/g,"").toUpperCase();
var e="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),g=new ArrayBuffer(16);g=new Uint8Array(g);for(var h=0,l=k.length-1,q=0,n=g.length-1,r="";0<=l;){for(var p=0;p<e.length;p++)if(e[p]==k.charAt(l)){h|=p<<q;break}q+=5;for(l--;8<q&&0<=n;)g[n]=h&255,h>>=8,q-=8,n--}for(p=0;p<g.length;p++)16>g[p]&&(r+="0"),r+=g[p].toString(16);return r.toUpperCase()};e.prototype._getValue=function(k){var e=null;if(this.xml2js)if(k["boolean"]&&k["boolean"][0])e=parseInt(k["boolean"][0])?!0:!1;else if(k.i4&&k.i4[0])e=parseInt(k.i4[0]);
else if(k.double&&k.double[0])e=parseFloat(k.double[0]);else if(k.array&&k.array[0]&&k.array[0].data&&k.array[0].data[0]&&k.array[0].data[0].value){e=[];k=k.array[0].data[0].value;for(var g in k)e.push(k[g])}else e=k;else if(g=k,k=k.find("value"),0<k.length&&(g=$(k[0])),g&&(e=g.text(),!e&&g.children()&&0<g.children().length))if(k=$(g.children()[0]),"boolean"==k.prop("tagName"))e=parseInt(k.text())?!0:!1;else if("i4"==k.prop("tagName"))e=parseInt(k.text());else if("double"==k.prop("tagName"))e=parseFloat(k.text());
else if("array"==k.prop("tagName"))for(e=[],k=k.find("data value"),g=0;g<k.length;g++){var h=$(k[g]).text();h&&e.push(h)}else XC.debugf("unknown valuetype:"),XC.debugf(k.getXMLString());return e};e.prototype._getStructData=function(k){var e={};if(k.struct&&k.struct[0]&&k.struct[0].member){k=k.struct[0].member;for(var g in k)k[g].name&&k[g].name[0]&&k[g].value&&k[g].value[0]&&(e[k[g].name[0]]=this._getValue(k[g].value[0]))}return e};e.prototype._waitForNewDevices=function(k,e,g){var h=this;this.getDeviceList(function(l){if(0>=
e||Object.keys(l).length>Object.keys(k).length){for(var m in l)k[m]||XC.debugf("new device: "+m);g&&g(l)}else setTimeout(function(){h._waitForNewDevices(k,e-4,g)},4E3)})};e.prototype.init=function(k,e,g){this._doXMLRpcRequest("init",[k,e],function(h){g&&g(h)})};e.prototype.getIP=function(){return this.ip};e.prototype.getPort=function(){return this.port};e.prototype.setPort=function(k){this.port=k};e.prototype.getValue=function(k,e,g,h){k=[k,e];"undefined"!=typeof g&&null!=g&&k.push(g);this._doXMLRpcRequest("getValue",
k,function(g,k){var l=null;!g&&k?l=k[0]:g&&k&&(l=k);h&&h(g,l)})};e.prototype.setValue=function(k,e,g,h){this._doXMLRpcRequest("setValue",[k,e,g],function(g){h&&h(g)})};e.prototype.getParamset=function(k,e,g,h){this._doXMLRpcRequest("getParamset",[k,e,g],function(g,k){var l=null;!g&&k?l=k[0]:g&&k&&(l=k);h&&h(g,l)})};e.prototype.putParamset=function(k,e,g,h){this._doXMLRpcRequest("putParamset",[k,e,g],function(g,k){var l=null;!g&&k?l=k[0]:g&&k&&(l=k);h&&h(g,l)})};e.prototype.listDevices=function(k){this._doXMLRpcRequest("listDevices",
[],function(e,g){var h=[];!e&&g&&(h=g[0]);k&&k(e,h)})};e.prototype.deleteDevice=function(k,e,g){this._doXMLRpcRequest("deleteDevice",[k,e],function(h){g&&g(h)})};e.prototype.setInstallMode=function(k,e,g,h){var l=[];l.push(k);"undefined"!=typeof e&&null!=e&&l.push(e);"undefined"!=typeof g&&null!=g&&l.push(g);this._doXMLRpcRequest("setInstallMode",l,function(g){h&&h(g)})};e.prototype.setInstallModeWithWhitelist=function(k,e,g,h){var l=[];l.push(k);"undefined"!=typeof e&&null!=e&&l.push(e);"undefined"!=
typeof g&&null!=g&&l.push(g);this._doXMLRpcRequest("setInstallModeWithWhitelist",l,function(g){h&&h(g)})};e.prototype.addNewDevice=function(k){var e=this;this.getDeviceList(function(g){e._doRequest("setInstallMode",[!0,30,2],function(h){setTimeout(function(){e._waitForNewDevices(g,30,k)},4E3)})})};e.prototype.addNewDeviceWithSGTN=function(k,e,g){var h=this;this.getDeviceList(function(l){h._doRequest("setInstallModeWithWhitelist",[!0,30,[{ADDRESS:e,KEY_MODE:"LOCAL",KEY:g}]],function(g){setTimeout(function(){h._waitForNewDevices(l,
30,k)},4E3)})})};e.prototype.listBidcosInterfaces=function(k){this._doXMLRpcRequest("listBidcosInterfaces",[],function(e,g){var h=[];!e&&g&&(h=g[0]);k&&k(e,h)})};e.prototype.reportValueUsage=function(k,e,g,h){this._doXMLRpcRequest("reportValueUsage",[k,e,g],function(g,k){var l;!g&&k&&(l=k[0]);h&&h(g,l)})};e.prototype.ping=function(k,e){this._doXMLRpcRequest("ping",[k],function(g){e&&e(g)})};return e}();
x.hub.m.hm.Server=function(){var e=function(k){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Server");this._port=9099;k&&0<k&&(this._port=k);this._server=null;this._servlet={}};e.prototype.getPort=function(){return this._port};e.prototype.stop=function(k){this._server?this._server.close():k&&k()};e.prototype.start=function(k){if(this._server)k&&k();else{var e=k,g=this,h=require("http").createServer(function(h,k){g._logger.log("trace","receive request method:"+h.method);g._logger.log("trace",
"receive request path:"+h.url);g._logger.log("trace","receive request header:"+JSON.stringify(h.headers));var l="";h.on("data",function(h){l+=h.toString()});h.on("end",function(){g._logger.log("trace","receive request body:"+l);"POST"==h.method?g._handleRequest(l,h,k):(g._logger.log("trace","send 404 response"),k.writeHead(404,"Not found"),k.end())})});h.on("error",function(h){g._logger.log("trace","xmlrpc server err:"+h.stack);e&&e(h);e=null;g._server=null});h.listen(this._port,function(){g._logger.log("trace",
"xmlrpc server listening on port:"+g._port);g._server=h;e&&e();e=null})}};e.prototype.registServlet=function(k,e){k&&e&&(this._servlet[k]=e)};e.prototype.unregistServlet=function(k){k&&delete this._servlet[k]};e.prototype._handleRequest=function(k,e,g){var h=e.url,l=require("x.xmlrpc.js"),m=this;try{var n=l.deserializeReq(k);if("system.multicall"==n.methodName)this._handleMultiCall(n.params[0],e,g);else if(this._logger.log("debug","receive method call:"+n.methodName),this._logger.log("debug","params:"+
JSON.stringify(n.params)),"system.listMethods"==n.methodName)this._sendSuccessResponse(["event listDevices newDevices deleteDevices updateDevice replaceDevice readdedDevice".split(" ")],g);else if(this._servlet[h])this._servlet[h](n.methodName,n.params,function(h,l){h?m._sendErrorResponse(h,g):m._sendSuccessResponse([l],g)});else this._sendSuccessResponse([[]],g)}catch(r){this._sendErrorResponse(r,g)}};e.prototype._handleMultiCall=function(k,e,g){e=e.url;this._logger.log("trace","---------------------------------");
this._logger.log("trace","receive system.multicall");for(var h=0;h<k.length;h++){var l=k[h];this._logger.log("trace","receive method call:"+l.methodName);this._logger.log("trace","params:"+JSON.stringify(l.params));if(this._servlet[e])this._servlet[e](l.methodName,l.params)}this._logger.log("trace","---------------------------------");this._sendSuccessResponse([[]],g)};e.prototype._sendSuccessResponse=function(k,e){k=require("x.xmlrpc.js").serializeRsp(null,k);this._logger.log("trace","send xml success response:"+
k);e.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(k)+""});e.write(k);e.end()};e.prototype._sendErrorResponse=function(e,m){var g=require("x.xmlrpc.js"),h=-1;e.errCode&&(h=e.errCode);e=g.serializeRsp({faultCode:h,faultString:e.message});this._logger.log("trace","send xml fault response:"+e);m.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(e)+""});m.write(e);m.end()};return e}();
x.hub.m.hm._Controller=function(){var e=function(h,g,e,n,k,m){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller");this._client=new x.hub.m.hm.Client(h,g,e,n,k);this._initStates=m;this.interface=null;this._devices={};this._status={};this._learnDeviceCbs=[];this._learnDeviceTO=null;this._readValueCbs={}};util.inherits(e,EventEmitter);e.prototype.getIP=function(){return this._client.getIP()};e.prototype.getPort=function(){return this._client.getPort()};e.prototype.setPort=function(h){return this._client.setPort(h)};
e.prototype.getAllBufferedStates=function(){var h={},g;for(g in this._devices){var e=this._devices[g];!e.PARENT&&e.CHILDREN?h[g]={device:{type:e.TYPE,"interface":this.interface,address:e.ADDRESS,channels:{}},states:{}}:e.PARENT&&(h[e.PARENT].device.channels[e.ADDRESS]={type:e.TYPE,address:e.ADDRESS});if(e.CHILDREN)for(var n=0,k=e.CHILDREN.length;n<k;n++){var m=e.CHILDREN[n];if(this._status[m]){h[g].states[m]={};for(var t in this._status[m])h[g].states[m][t]=this._status[m][t]}}}return h};e.prototype.getBufferedState=
function(h){if(!h)return null;var g=h.indexOf(":");-1!=g&&(h=h.substr(0,g));h=this._devices[h];if(!h)return null;var e={};if(h.CHILDREN){var n=this;h.CHILDREN.forEach(function(h){if(n._status[h]){e[h]={};for(var g in n._status[h])e[h][g]=n._status[h][g]}})}return e};e.prototype.getBufferedDevices=function(){return this._getDeviceStructs(this._devices)};e.prototype.getState=function(h,g,e){var l=this.getBufferedState(h);if(l&&l[h]&&l[h][g]){l=l[h][g];var k=l.value;if("undefined"!=typeof k&&null!=k){e&&
e(null,l);return}}this.updateState(h,g,function(h,g){e&&e(h,g)})};e.prototype.updateState=function(h,g,e){var l=this;this.readValue(h,g,function(n,k){n?setTimeout(function(){var n,k=l.getBufferedState(h);k&&k[h]&&k[h][g]&&(n=k[h][g]);e&&e(null,n)},1E3):e&&e(null,{value:k,time:(new Date).getTime()})})};e.prototype.reset=function(h){var g=[];Object.keys(this._devices).forEach(function(h){h&&-1==h.indexOf(":")&&"BidCoS-RF"!=h&&g.push(h)});if(0==g.length)h&&h();else{var e=0,n=this,k=function(l){e++;e<
g.length?n.deleteDevice(g[e],k):h&&h()};this.deleteDevice(g[e],k)}};e.prototype.register=function(h,g,e){if(h){this._logger.log("debug","register:"+g+" to "+h);var l=this;this._client.init(h,g,function(h){l._logger.log("debug","registed:"+g+(h?" err:"+h.message:""));e&&e(h,h?null:g)})}else e&&e(Error("arguments invalid"))};e.prototype.unregister=function(h,g){h?this._client.init(h,"",function(h){g&&g(h)}):g&&g(Error("url invalid"))};e.prototype.getDevices=function(h){this._client.listDevices(function(g,
e){if(g)h&&h(g);else for(g=0;g<e.length;g++);})};e.prototype.learnNewDevice=function(h){var g=this._learnDeviceCbs.length;h&&-1==this._learnDeviceCbs.indexOf(h)&&this._learnDeviceCbs.push(h);if(0==g){var e=this;this._learnDeviceTO=setTimeout(function(){var h=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var g=0;g<h.length;g++){var l=h[g];l&&l(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,1,function(h){if(h){e._learnDeviceTO&&(clearTimeout(e._learnDeviceTO),e._learnDeviceTO=
null);var g=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var n=g[l];n&&n(h)}}})}};e.prototype.learnNewDeviceSN=function(h,g){var l=this._learnDeviceCbs.length;g&&-1==this._learnDeviceCbs.indexOf(g)&&this._learnDeviceCbs.push(g);if(0==l){var e=this;this._learnDeviceTO=setTimeout(function(){var h=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var g=0;g<h.length;g++){var l=h[g];l&&l(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,h,function(h){if(h){e._learnDeviceTO&&
(clearTimeout(e._learnDeviceTO),e._learnDeviceTO=null);var g=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var n=g[l];n&&n(h)}}})}};e.prototype.learnNewIPDevice=function(h,g,e){var l=this._learnDeviceCbs.length;e&&-1==this._learnDeviceCbs.indexOf(e)&&this._learnDeviceCbs.push(e);if(0==l){var k=this;this._learnDeviceTO=setTimeout(function(){var h=k._learnDeviceCbs;k._learnDeviceCbs=[];for(var g=0;g<h.length;g++){var l=h[g];l&&l(Error("learn device timeout"))}},6E4);h={ADDRESS:h.replace(/-/g,
"").toUpperCase(),KEY_MODE:"LOCAL",KEY:this._convertHmIPKeyBase32ToBase16(g)};this._client.setInstallModeWithWhitelist(!0,60,[h],function(h){if(h){k._learnDeviceTO&&(clearTimeout(k._learnDeviceTO),k._learnDeviceTO=null);var g=k._learnDeviceCbs;k._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var e=g[l];e&&e(h)}}})}};e.prototype.learnNewIPDeviceQR=function(h,g){var l=this._learnDeviceCbs.length;g&&-1==this._learnDeviceCbs.indexOf(g)&&this._learnDeviceCbs.push(g);if(0==l){var e=this;this._learnDeviceTO=
setTimeout(function(){var h=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var g=0;g<h.length;g++){var l=h[g];l&&l(Error("learn device timeout"))}},3E4);g=h.substr(6,24);h=h.substring(h.length-32,h.length);h={ADDRESS:g.replace(/-/g,"").toUpperCase(),KEY_MODE:"LOCAL",KEY:h.toUpperCase()};this._client.setInstallModeWithWhitelist(!0,30,[h],function(h){if(h){e._learnDeviceTO&&(clearTimeout(e._learnDeviceTO),e._learnDeviceTO=null);var g=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var k=
g[l];k&&k(h)}}})}};e.prototype.deleteDevice=function(h,g){if(h){var l=h.indexOf(":");-1!=l&&(h=h.substr(0,l));this._client.deleteDevice(h,2,g)}else g&&g(Error("address is empty"))};e.prototype.readValue=function(h,g,e){var l=h+"."+g,k=this._readValueCbs[l];k||(k=[],this._readValueCbs[l]=k);var m=k.length;e&&-1==k.indexOf(e)&&k.push(e);if(0==m){var q=this;this._client.getValue(h,g,null,function(e,k){e||q._updateStatusBuffer(h,g,k);var n=q._readValueCbs[l];delete q._readValueCbs[l];n.forEach(function(h){h&&
h(e,k)})})}};e.prototype.writeValue=function(h,g,e,k){var l=this;this._client.setValue(h,g,e,function(n){n||l._updateStatusBuffer(h,g,e.type?e.value:e);k&&k(n)})};e.prototype.getValuesParamset=function(h,g){this._logger.log("trace","getValuesParamset:"+h);var l=this;this._client.getParamset(h,"VALUES",0,function(e,k){if(e)l._logger.log("trace","getValuesParamset error:"+e.message),g&&g(e);else{if(k){e=0;var n=h.indexOf(":");-1!=n&&(e=h.substr(n+1));for(var m in k)k.hasOwnProperty(m)&&(0==e?"INSTALL_MODE"!=
m&&l._updateStatusBuffer(h,m,k[m]):l._updateStatusBuffer(h,m,k[m]))}l._logger.log("trace","getValuesParamset finish:"+JSON.stringify(k));g&&g(null,k)}})};e.prototype.getParamset=function(h,g,e){this._client.getParamset(h,g,0,function(g,h){e&&e(g,h)})};e.prototype.setParamset=function(g,l,e,k){this._client.putParamset(g,l,e,function(g){k&&k(g)})};e.prototype.reportValueUsage=function(g,l,e,k){this._client.reportValueUsage(g,l,e,function(g,h){k&&k(g,h)})};e.prototype.getDevice=function(g){if(!g)return null;
var h=g,e=g.indexOf(":");-1!=e&&(h=g.substr(0,e));if(!this._devices[h])return null;var k=[];g=this._devices[h];k.push(g);if(g.CHILDREN){var m=this;g.CHILDREN.forEach(function(g){g&&m._devices[g]&&k.push(m._devices[g])})}return(g=this._getDeviceStructs(k))?g[h]:null};e.prototype._getDeviceStructs=function(g){if(!g)return null;var h={},e=this;g.forEach(function(g){if(g.ADDRESS&&g.TYPE)if(!g.PARENT&&g.CHILDREN)h[g.ADDRESS]={type:g.TYPE,"interface":e.interface,address:g.ADDRESS,channels:{}};else if(g.PARENT){var l=
h[g.PARENT];l&&(l.channels[g.ADDRESS]={type:g.TYPE,address:g.ADDRESS})}});return h};e.prototype._updateStatusBuffer=function(g,l,e,k){if("CENTRAL"!=g||"PONG"!=l){if("PRESS_SHORT"==l||"PRESS_LONG"==l||"PRESS_CONT"==l||"PRESS_LONG_RELEASE"==l){var h={};k={value:e,time:(new Date).getTime()};var n=!0}else{var m=this._status[g];m||(m={},this._status[g]=m);h=m[l];h||(h={},m[l]=h);k={value:e,time:k?k:(new Date).getTime()};h&&h.time&&k&&k.time&&h.time>k.time?n=!1:(m[l]=k,n=!0)}m=this.getDevice(g);n&&this.emit("event",
{device:m,"interface":this.interface,channel:g,datapoint:l,value:k,changed:h.value!=k.value,oldValue:h});h=g.indexOf(":");-1!=h&&(k=g.substr(0,h),"1"==g.substr(h+1)&&"STATE"==l&&0==e&&m&&m.channels&&m.channels[k+":2"]&&"POWERMETER"==m.channels[k+":2"].type&&(this._updateStatusBuffer(k+":2","POWER",0),this._updateStatusBuffer(k+":2","CURRENT",0)))}};e.prototype._initNewDeviceStates=function(g,l){if(this._initStates){var h=this,e=function(g,l){g.ADDRESS&&g.PARAMSETS&&-1!=g.PARAMSETS.indexOf("VALUES")?
h.getValuesParamset(g.ADDRESS,l):l()},k=0,m=function(){k++;k<g.length?e(g[k],m):l&&l()};e(g[k],m)}else l&&l()};e.prototype._convertHmIPKeyBase32ToBase16=function(g){g=g.replace(/-/g,"").toUpperCase();var h="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),e=new ArrayBuffer(16);e=new Uint8Array(e);for(var k=0,m=g.length-1,p=0,t=e.length-1,z="";0<=m;){for(var v=0;v<h.length;v++)if(h[v]==g.charAt(m)){k|=v<<p;break}p+=5;for(m--;8<p&&0<=t;)e[t]=k&255,k>>=8,p-=8,t--}for(v=0;v<e.length;v++)16>e[v]&&(z+="0"),
z+=e[v].toString(16);return z.toUpperCase()};e.prototype._xmlrpcCall=function(g,l,e){this._logger.log("trace","receive call:"+g);this._logger.log("trace","params:"+JSON.stringify(l));var h=[],k;switch(g){case "newDevices":if(l[1]){this._initNewDeviceStates(l[1],null);for(k=0;k<l[1].length;k++)(g=l[1][k])&&g.ADDRESS&&(this._devices[g.ADDRESS]=g);g=this._getDeviceStructs(l[1]);try{this.emit("newDevices",g)}catch(t){}if(!l[1]||!l[1][0]||"HM-RCV-50"!=l[1][0].TYPE)for(l=this._learnDeviceCbs,this._learnDeviceCbs=
[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<l.length&&this._client.setInstallMode(!1,null,null,null),k=0;k<l.length;k++){var m=l[k];m&&m(null,g)}}break;case "readdedDevice":if(l[1]&&l[1][0])for(k=this.getDevice(l[1][0]),g={},g[l[1][0]]=k,l=this._learnDeviceCbs,this._learnDeviceCbs=[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<l.length&&this._client.setInstallMode(!1,null,null,null),k=0;k<l.length;k++)(m=l[k])&&m(null,
g);break;case "listDevices":if(l[1]){l=[];for(k in this._devices)this._devices.hasOwnProperty(k)&&this._devices[k]&&l.push(this._devices[k]);h.push(l)}break;case "deleteDevices":if(l[1])for(k=0;k<l[1].length;k++)if(g=l[1][k])delete this._devices[g],delete this._status[g];break;case "event":this._logger.log("trace","get event:"+JSON.stringify(l)),this._updateStatusBuffer(l[1],l[2],l[3])}e&&e(null,h)};var k=function(g,l,e,k,m,p){x.hub.m.hm._Controller.call(this,g,l,e,k,m,p);this.interface="BidCos-RF";
this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.RF")};k.prototype=new e;k.prototype.constructor=k;k.prototype.listBidcosInterfaces=function(g){this._client.listBidcosInterfaces(function(h,e){g&&g(h,e)})};k.prototype.ping=function(g,l){this._client.ping(g,function(g){l&&l(g)})};var m=function(g,l,e,k,m,p){x.hub.m.hm._Controller.call(this,g,l,e,k,m,p);this.interface="BidCos-Wired";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.Wired")};util.inherits(m,e);var g=
function(g,l,e,k,m,p){x.hub.m.hm._Controller.call(this,g,l,e,k,m,p);this.interface="HmIP-RF";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.IP")};util.inherits(g,e);g.prototype.deleteDevice=function(g,l){var h=g.indexOf(":");-1!=h&&(g=g.substr(0,h));this._client.deleteDevice(g,2,l)};e.getController=function(h,l,e){switch(h){case "BidCos-RF":h=k;break;case "BidCos-Wired":h=m;break;case "HmIP-RF":h=g;break;default:return null}return new h(l.ip,l.port,l.username,l.password,e.useHttps,
e.initStates)};return e}();
x.hub.m.hm.Monitor=function(){var e=function(g,h,l){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.ControllerMonitor");this._type=l;this._monitor=g;this._controller=h;this._xmlrpcServer=null;this._retryWait=1E4;this._retryCount=0;this._retryTO=null;this._state=0;this._err=null};e.prototype.start=function(g,h){0==this._state&&(this._xmlrpcServer=g,this._connect(g));h&&h()};e.prototype.stop=function(g,h){var l=this._state;this._retryTO&&clearTimeout(this._retryTO);this._retryTO=null;
this._state=0;this._err=null;this._retryCount=0;0!=l?this._unregister(g,function(){h&&h()}):h&&h()};e.prototype.getMonitorState=function(){return{state:this._state,error:this._err?this._err.message:null}};e.prototype._connect=function(){this._logger.log("info","start regist "+this._type+" monitor at "+this._controller.getIP()+":"+this._controller.getPort());this._state=1;var g=this;this._register(this._xmlrpcServer,function(h){h?(g._logger.log("warn","regist "+g._type+" monitor at "+g._controller.getIP()+
":"+g._controller.getPort()+" error:"+h.message),g._state=3,g._err=h,g._retryCount++,g._retryTO=setTimeout(function(){g._logger.log("trace","retry timeout for regist "+g._type+" monitor at "+g._controller.getIP()+":"+g._controller.getPort()+" expired");g._connect()},Math.min(6E4,Math.ceil(g._retryCount/10)*g._retryWait))):(g._logger.log("info","regist "+g._type+" monitor at "+g._controller.getIP()+":"+g._controller.getPort()+" success"),g._state=2,g._err=null,g._retryCount=0,g._monitor._onControllerMonitorConnected(g._type))})};
e.prototype._register=function(g,h){var l=this._monitor.localMac.replace(/:/g,""),e="/"+this._monitor.serialNumber;g=g.getPort();this._controller.register("http://"+this._monitor.localIP+":"+(g?g:80)+e,this._monitor.serialNumber+"_"+this._controller.getPort()+"_"+l,h)};e.prototype._unregister=function(g,h){var l="/"+this._monitor.serialNumber;g=g.getPort();this._controller.unregister("http://"+this._monitor.localIP+":"+(g?g:80)+l,h)};var k=function(g){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.PinPongHandler");
this._monitor=g;this._pingWait=3E4;this._pingTO=null;this._pingMiss=0};k.prototype.start=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._startPingTO()};k.prototype.stop=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0};k.prototype._startPingTO=function(){var g=this;this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingTO=setTimeout(function(){g._pingMiss++;4>g._pingMiss?(g._ping(),g._startPingTO()):
g._pingFail()},this._pingWait)};k.prototype._ping=function(g){var h=this._monitor._rfController;h?(this._logger.log("trace","send PING"),h.ping(this._monitor.localMac,function(h){g&&g(h)})):g&&g(Error("no rf controller for ping"))};k.prototype._pingFail=function(){this._logger.log("warn","PING Fail");this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._monitor._onPingFail()};k.prototype._onPong=function(){this._pingMiss=0};var m=function(g,h){this.ip=g.ip;this.serialNumber=
g.uuid;this.ccuType=g.type;this.ccuType||(this.ccuType=2);this.localIP=h?h.localIP:null;this.localMac=h?h.localMac:null;this.isChip=h?"chip"==h.localChip:!1;this.isCCU3=h?"ccu3"==h.localChip:!1;this.persistant=h?h.persistant:!1;this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor");g={ip:this.ip,port:null,username:g.username,password:g.password};h={useHttps:!1,initStates:this.isChip?!0:!1};g.port=this.isCCU3?32001:2001;this._rfController=x.hub.m.hm._Controller.getController("BidCos-RF",
g,h);this._rfController.on("event",this._onEvent.bind(this));this._rfController.on("newDevices",this._onNewDevices.bind(this));g.port=this.isCCU3?32010:2010;this._ipController=x.hub.m.hm._Controller.getController("HmIP-RF",g,h);this._ipController.on("event",this._onEvent.bind(this));this._ipController.on("newDevices",this._onNewDevices.bind(this));g.port=this.isCCU3?32E3:2E3;this._wiredController=x.hub.m.hm._Controller.getController("BidCos-Wired",g,h);this._wiredController.on("event",this._onEvent.bind(this));
this._wiredController.on("newDevices",this._onNewDevices.bind(this));this._wiredMonitor=this._ipMonitor=this._rfMonitor=null;this._pingpong=new k(this);this._pingTO=this._manager=this._xmlrpcServer=null;this._pingMiss=0;this._wiredRegisted=this._ipRegisted=this._rfRegisted=!1;this._reconnectTO=null;this._reconnectCount=0};util.inherits(m,EventEmitter);m.prototype.getMonitorState=function(g){var h={chip:this.isChip};if(this._rfMonitor){var l=this._rfMonitor.getMonitorState();h.bidcos=l}this._ipMonitor&&
(l=this._ipMonitor.getMonitorState(),h.hmip=l);this._wiredMonitor&&(l=this._wiredMonitor.getMonitorState(),h.bidcos_wired=l);h.bidcos&&2==h.bidcos.state?this._rfController.listBidcosInterfaces(function(l,e){e&&(h.info=e);g&&g(null,h)}):g&&g(null,h)};m.prototype.getAllBufferedStates=function(){var g={},h,l=this._rfController.getAllBufferedStates();if(l)for(h in l)l.hasOwnProperty(h)&&(g[h]=l[h]);if(l=this._wiredController.getAllBufferedStates())for(h in l)l.hasOwnProperty(h)&&(g[h]=l[h]);if(l=this._ipController.getAllBufferedStates())for(h in l)l.hasOwnProperty(h)&&
(g[h]=l[h]);return g};m.prototype.getBufferedDevice=function(g,h){switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:return null}return g.getDevice(h)};m.prototype.getState=function(g,h){if(!(g&&g.interface&&g.channel&&g.datapoint))return h&&h(Error("argument invalid")),null;switch(g.interface){case "BidCos-RF":var l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=
this._ipController;break;default:return null}l.getState(g.channel,g.datapoint,h)};m.prototype.updateState=function(g,h){if(!(g&&g.interface&&g.channel&&g.datapoint))return h&&h(Error("argument invalid")),null;switch(g.interface){case "BidCos-RF":var l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:return null}l.updateState(g.channel,g.datapoint,h)};m.prototype.init=function(g,h){this._logger.log("info","init monitor ("+
this.ip+")");this._xmlrpcServer=g;this._init(h)};m.prototype._init=function(g){var h=this;this.getSerialNumber(function(l){l?g&&g(l):h.register(h._xmlrpcServer,function(){g&&g()})})};m.prototype.update=function(g,h,l,e){l&&this.serialNumber!=l&&(this.serialNumber=l);var k=this;g&&this.ip!=g||h&&this.localIP!=h?this.unregister(this._xmlrpcServer,function(){k.ip=g;k.localIP=h;k.register(k._xmlrpcServer,e)}):e&&e()};m.prototype.finalize=function(g){this.removeAllListeners();this._manager&&this._manager.deleteMonitor(this.ip);
this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null);this.unregister(this._xmlrpcServer,function(){g&&g()})};m.prototype.getSerialNumber=function(g){var h=this;global&&"CCU3"==global.PLATFORM?(this._rfController.setPort(32001),h.getRFInterfaces(function(l,e){l?(h._rfController.setPort(2001),h.getRFInterfaces(function(l,e){l?g&&g():(h.serialNumber=e[0].ADDRESS,g&&g(null,h.serialNumber))})):(h._ipController.setPort(32010),
h._wiredController.setPort(32E3),h.serialNumber=e[0].ADDRESS,g&&g(null,h.serialNumber))})):this.getRFInterfaces(function(l,e){l?g&&g():(h.serialNumber=e[0].ADDRESS,g&&g(null,h.serialNumber))})};m.prototype.getRFInterfaces=function(g){this._rfController.listBidcosInterfaces(function(h,l){g&&g(h,l)})};m.prototype.register=function(g,h){var l=this;g.registServlet("/"+this.serialNumber,function(g,h,e){l._xmlrpcCall(g,h,e)});this._rfMonitor=new e(this,this._rfController,"rf");this._ipMonitor=new e(this,
this._ipController,"ip");this._wiredMonitor=new e(this,this._wiredController,"wired");this._rfMonitor.start(g);this._ipMonitor.start(g);this.isChip||this._wiredMonitor.start(g);h&&h()};m.prototype.unregister=function(g,h){g.unregistServlet("/"+this.serialNumber);this._rfMonitor.stop(g);this._ipMonitor.stop(g);this.isChip||this._wiredMonitor.stop(g);h&&h()};m.prototype._onControllerMonitorConnected=function(g){"rf"==g&&this._pingpong.start()};m.prototype._onPingFail=function(){var g=this;this.unregister(this._xmlrpcServer,
function(){g.register(g._xmlrpcServer,function(){})})};m.prototype._onPong=function(){this._pingpong._onPong()};m.prototype.reset=function(g){var h=this;this._rfController.reset(function(){h._ipController.reset(function(){h._wiredController.reset(function(){g&&g()})})})};m.prototype.learnRF=function(g){this._rfController.learnNewDevice(function(h,e){g&&g(h,e)})};m.prototype.learnRFSN=function(g,h){this._rfController.learnNewDeviceSN(g,function(g,e){h&&h(g,e)})};m.prototype.learnIP=function(g,h,e){this._ipController.learnNewIPDevice(g,
h,function(g,h){e&&e(g,h)})};m.prototype.learnIPQR=function(g,h){this._ipController.learnNewIPDeviceQR(g,function(g,e){h&&h(g,e)})};m.prototype.deleteDevice=function(g,h,e){if(!g||!h)return e&&e(Error("argument invalid")),null;switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:e&&e(Error("no such interface"));return}g.deleteDevice(h,e)};m.prototype.getDevices=function(g){var h=0;this._rfController&&
h++;this._ipController&&h++;this._wiredController&&h++;var e=[],k=function(l){h--;l?g&&g(l):0==h&&g&&g(null,e)},n=this;this._rfController&&this._rfController.getBufferedDevices(function(g,h){g?(k&&k(g),k=null):(e=e.concat(n._parseDevices(h,"BidCos-RF")),k&&k())});this._ipController&&this._ipController.getBufferedDevices(function(g,h){g?(k&&k(g),k=null):(e=e.concat(n._parseDevices(h,"HmIP-RF")),k&&k())});this._wiredController&&this._wiredController.getBufferedDevices(function(g,h){g?(k&&k(g),k=null):
(e=e.concat(n._parseDevices(h,"BidCos-Wired")),k&&k())})};m.prototype.getParamset=function(g,h,e,k){if(g&&h&&e){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:k&&k(Error("unknow interface"));return}l.getParamset(h,e,function(g,h){k&&k(g,h)})}else k&&k(Error("argument invalid"))};m.prototype.setParamset=function(g,h,e,k,n){if(g&&h&&e&&k){var l=null;switch(g){case "BidCos-RF":l=this._rfController;
break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:n&&n(Error("unknow interface"));return}l.setParamset(h,e,k,function(g,h){n&&n(g,h)})}else n&&n(Error("argument invalid"))};m.prototype.readValue=function(g,h,e,k){if(g&&h&&e){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:k&&k(Error("unknow interface"));return}l.readValue(h,e,
function(g,h){k&&k(g,h)})}else k&&k(Error("argument invalid"))};m.prototype.writeValue=function(g,h,e,k,n){if(g&&h&&e){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:n&&n(Error("unknow interface"));return}l.writeValue(h,e,k,function(g){n&&n(g)})}else n&&n(Error("argument invalid"))};m.prototype.reportValueUsage=function(g,h,e,k){if(g&&h&&e){var l=null;switch(g){case "BidCos-RF":l=
this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:k&&k(Error("unknow interface"));return}l.reportValueUsage(h,e,1,function(g,h){k&&k(g,h)})}else k&&k(Error("argument invalid"))};m.prototype.updateStatusBuffer=function(g,h,e,k,n){if(g&&h&&e){switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:return}g._updateStatusBuffer(h,
e,k,n)}};m.prototype._parseDevices=function(g,h){h||(h="BidCos-RF");var e=new (require("xnm.aio.hm.js").CCU),k={},n;for(n in g)if(g.hasOwnProperty(n)){var m=g[n],p={typename:"DEVICE",hsstype:m.TYPE,address:m.ADDRESS,interface:h,rfAddr:m.RF_ADDRESS,channels:{}};if(m.CHILDREN)for(var t=0,z=m.CHILDREN.length;t<z;t++){var v=m.CHILDREN[t];p.channels[v]={hsstype:g[v].TYPE,address:v}}k[n]=p}return e._parseDevices(k)};m.prototype._xmlrpcCall=function(g,h,e){this._logger.log("trace","receive call:"+g);this._logger.log("trace",
"params:"+JSON.stringify(h));if("event"==g&&"CENTRAL"==h[1]&&"PONG"==h[2])this._onPong(),e&&e(null,[]);else{var k=h[0].split("_");3<=k.length?(k=k[1],-1!=k.indexOf("2001")&&this._rfController?this._rfController._xmlrpcCall(g,h,e):-1!=k.indexOf("2010")&&this._ipController?this._ipController._xmlrpcCall(g,h,e):-1!=k.indexOf("2000")&&this._wiredController?this._wiredController._xmlrpcCall(g,h,e):e&&e(null,[])):e&&e(null,[])}};m.prototype._onNewDevices=function(g){this._logger.log("debug","find new devices");
this._logger.log("debug",JSON.stringify(g));this.emit("new_devices",g)};m.prototype._onEvent=function(g){this._logger.log("trace","receive event:"+JSON.stringify(g));this._logger.log("debug","EVENT:\t"+g.interface+"\t"+g.device.type+"\t"+g.channel+"\t"+g.datapoint+"\t"+g.value.value);g.ip=this.ip;g.serialNumber=this.serialNumber;this.emit("event",g,this)};return m}();
x.hub.m.hm.MonitorManager=function(){var e=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.MonitorManager");this._monitors=[];this._xmlrpcServer=null;this._tmpMonitors={};this._monitorEvtListener=this.onDeviceEvent.bind(this)};e.prototype.init=function(e,m){this._xmlrpcServer=e;m&&m()};e.prototype.startMonitorForIP=function(e,m,g){this.startMonitor({ip:e},{localIP:m},g)};e.prototype.startMonitor=function(e,m,g){if(this._xmlrpcServer)if(e&&e.ip){var h=this.getMonitor(e.ip,e.uuid);
if(h)g&&g();else if(m||(m={}),m.localIP||(m.localIP=x.hub.m.hm._Util.getLocalIP(null,e.ip)),m.localIP){m.localMac||(m.localMac=x.hub.m.hm._Util.getLocalMac(m.localIP));var k=e.ip;this._tmpMonitors[k]||(this._tmpMonitors[k]=[]);var q=this._tmpMonitors[k].length,n=this._tmpMonitors[k];g||(g=function(){});-1==n.indexOf(g)&&n.push(g);if(!(0<q)){var r=this;h=new x.hub.m.hm.Monitor(e,m);h._manager=this;h.init(this._xmlrpcServer,function(g){g||(r._monitors.push(h),h.on("event",r._monitorEvtListener));var e=
r._tmpMonitors[k];delete r._tmpMonitors[k];e.forEach(function(h){h&&h(g)})})}}else g&&g(Error("local ip address invalid"))}else g&&g(Error("gateway invalid"));else g&&g(Error("xml rpc server not started"))};e.prototype.getAllMonitor=function(){return this._monitors};e.prototype.getMonitor=function(e,m){var g=null,h=null;this._monitors.forEach(function(k){k&&k.ip==e&&(g=k);k&&k.serialNumber==m&&(h=k)});return h?h:g};e.prototype.getMonitorStates=function(e){if(0==this._monitors.length)e&&e(null,[]);
else{var k=this,g=0,h=[],l=function(m,n){!m&&n&&(n.ip=k._monitors[g].ip,n.serialNumber=k._monitors[g].serialNumber,h.push(n));g++;g<k._monitors.length?k._monitors[g].getMonitorState(l):e&&e(null,h)};this._monitors[g].getMonitorState(l)}};e.prototype.deleteMonitor=function(e){for(var k=-1,g=0,h=this._monitors.length;g<h;g++){var l=this._monitors[g];if(l&&l.ip==e){k=g;break}}-1!=g&&this._monitors.splice(k,1)};e.prototype.onFindHomeMatic=function(e,m,g){var h=this.getMonitor(null,g),k=this.getMonitor(e);
k?(k.update(e,m,g),h&&h!=k&&(h.finalize(),this.deleteMonitor(h.ip))):(h&&(h.finalize(),this.deleteMonitor(h.ip)),this.startMonitorForIP(e,m))};e.prototype.onDeviceEvent=function(e,m){require("x.hub.m.hm.js").onDeviceEvent(e,m.isChip)};return e}();
x.hub.m.hm._Channel=function(){var e=function(){var g=[];this.map.forEach(function(h){h&&h.dpt&&h.state&&0<h.state.length&&-1==g.indexOf(h.dpt)&&g.push(h.dpt)});return g},k=function(g){var h=null;this.map.forEach(function(e){e&&e.dpt&&e.state&&-1!=e.state.indexOf(g)&&(h=e.dpt)});return h},m=function(g){var h=null;this.map.forEach(function(e){e&&e.dpt&&e.command&&-1!=e.command.indexOf(g)&&(h=e.dpt)});return h};return{"HmIP-RF":{T_MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},
{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]},{dpt:"ACTUAL_TEMPERATURE",state:["maintainTemp"],event:["maintainTemp"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){switch(g){case "UNREACH":return{timeout:h};case "LOW_BAT":return{lowbat:h};
case "SABOTAGE":return{sabotage:h};case "OPERATING_VOLTAGE":return{voltage:parseFloat(h)};case "ERROR_CODE":return{errorCode:parseInt(h)};case "ACTUAL_TEMPERATURE":return{maintainTemp:parseFloat(h)}}return null}},MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){switch(g){case "UNREACH":return{timeout:h};case "LOW_BAT":return{lowbat:h};
case "SABOTAGE":return{sabotage:h}}return null}},MAINTENANCE_BAT_EL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){switch(g){case "UNREACH":return{timeout:h};
case "LOW_BAT":return{lowbat:h};case "SABOTAGE":return{sabotage:h};case "OPERATING_VOLTAGE":return{voltage:parseFloat(h)};case "ERROR_CODE":return{errorCode:parseInt(h)};case "SENSOR_ERROR":return{sensorError:h}}return null}},MAINTENANCE_BAT_CL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"ERROR_NON_FLAT_POSITIONING",state:["sabotage"],event:["sabotage"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){switch(g){case "UNREACH":return{timeout:h};
case "LOW_BAT":return{lowbat:h};case "ERROR_NON_FLAT_POSITIONING":return{sabotage:h}}return null}},SWITCH_TRANSMITTER:{map:[{dpt:"STATE",state:["switchTState"],event:["switchTState"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "STATE":e=1==h?{switchTState:"on"}:0==h?{switchTState:"off"}:{switchTState:"?"}}return e}},SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"STATE",state:["switchState"],event:["switchState"],command:["on","off","toggle"]}],getReadableDpts:e,
getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "STATE":e=1==h?{switchState:"on"}:0==h?{switchState:"off"}:{switchState:"?"}}return e},executeCommand:function(g,h,e,k,n){var l=m.call(this,k);"onFor"==k.substr(0,5)&&(l="STATE");if(l)switch(k){case "on":g.writeValue(h,e,l,!0,n);break;case "off":g.writeValue(h,e,l,!1,n);break;case "toggle":g.getState({interface:h,channel:e,datapoint:l},function(k,m){k?n&&n(k):m?(k=!0,m.value&&(k=!1),g.writeValue(h,e,l,k,n)):n&&n(Error("get switch current value return invalid"))});
break;default:"onFor"==k.substr(0,5)?(k=parseFloat(k.substr(5)),isNaN(k)?n&&n(Error("onFor command invalid")):(l="ON_TIME",g.writeValue(h,e,l,{type:"double",value:k},function(k){k?n&&n(k):(l="STATE",g.writeValue(h,e,l,!0,n))}))):n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+k))}},ENERGIE_METER_TRANSMITTER:{map:[{dpt:"ENERGY_COUNTER",state:["meterEnergyCounter"],event:["meterEnergyCounter"]},{dpt:"POWER",state:["meterPower"],event:["meterPower"]},{dpt:"CURRENT",
state:["meterCurrent"],event:["meterCurrent"]},{dpt:"VOLTAGE",state:["meterVoltage"],event:["meterVoltage"]},{dpt:"FREQUENCY",state:["meterFrequency"],event:["meterFrequency"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){switch(g){case "ENERGY_COUNTER":return{meterEnergyCounter:parseFloat(h).toFixed(2)};case "POWER":return{meterPower:parseFloat(h).toFixed(2)};case "CURRENT":return{meterCurrent:parseFloat(h).toFixed(2)};case "VOLTAGE":return{meterVoltage:parseFloat(h).toFixed(2)};
case "FREQUENCY":return{meterFrequency:parseFloat(h).toFixed(2)}}return null}},DIMMER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["dimmerTLevel"],event:["dimmerTLevel"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "LEVEL":e={dimmerTLevel:Math.round(100*parseFloat(h))};break;case "COLOR":e={dimmerTColor:"off blue green torqoise red purple yellow white".split(" ")[parseInt(h)]}}return e}},DIMMER_VIRTUAL_RECEIVER:{map:[{dpt:"LEVEL",state:["dimmerLevel"],event:["dimmerLevel"],
command:["dimOff","dimUp","dimDown","dimTo","toggleTo"]},{dpt:"COLOR",state:["dimmerColor"],event:["dimmerColor"],command:["colorTo"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "LEVEL":e={dimmerLevel:Math.round(100*parseFloat(h))}}return e},executeCommand:function(g,h,e,k,n){if(k){if("dimOff"==k.substr(0,6))var l="dimOff";else if("dimUp"==k.substr(0,5)){l="dimUp";var p=k.substr(5)}else if("dimDown"==k.substr(0,7))l="dimDown",p=k.substr(7);else if("dimTo"==
k.substr(0,5)){if(l="dimTo",p=k.substr(5),!p){n&&n(Error("dimTo has no value"));return}}else if("toggleTo"==k.substr(0,8)){if(l="toggleTo",p=k.substr(8),!p){n&&n(Error("toggleTo has no value"));return}}else if("colorTo"==k.substr(0,7)&&(l="colorTo",p=k.substr(7),!p)){n&&n(Error("colorTo has no value"));return}var q=m.call(this,l);if(q)switch(l){case "dimOff":g.writeValue(h,e,q,{type:"double",value:0},n);break;case "dimUp":p||(p=10);p=parseInt(p)/100;g.getState({interface:h,channel:e,datapoint:q},
function(k,l){k?n&&n(k):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(h,e,q,{type:"double",value:p},n))});break;case "dimDown":p||(p=10);p=parseInt(p)/100;g.getState({interface:h,channel:e,datapoint:q},function(k,l){k?n&&n(k):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(h,e,q,{type:"double",value:p},n))});break;case "toggleTo":p=parseInt(p)/100;
g.getState({interface:h,channel:e,datapoint:q},function(k,l){k?n&&n(k):l?(l.value&&(p=0),g.writeValue(h,e,q,{type:"double",value:p},n)):n&&n(Error("get switch current value return invalid"))});break;case "dimTo":p=parseInt(p)/100;g.writeValue(h,e,q,{type:"double",value:p},n);break;case "colorTo":p=p.toLowerCase();p="off blue green torqoise red purple yellow white".split(" ").indexOf(p);if(-1==p){n&&n(Error("unknown color"));break}g.writeValue(h,e,q,{type:"double",value:p},n);break;default:n&&n(Error("no such command"))}else n&&
n(Error("can not find datapoint for command:"+k))}else n&&n(Error("command in null"))}},MOTIONDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_MOTION",command:["reset"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"MOTION_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "MOTION":e={state:h?
"on":"off"};break;case "ILLUMINATION":e={illumination:h};break;case "MOTION_DETECTION_ACTIVE":e={active:h}}return e},executeCommand:function(g,h,e,k,n){if(k){var l=m.call(this,k);if(l)switch(k){case "reset":g.writeValue(h,e,l,!0,n);break;case "activate":g.writeValue(h,e,l,!0,n);break;case "deactivate":g.writeValue(h,e,l,!1,n);break;case "toggleActivate":g.getState({interface:h,channel:e,datapoint:l},function(k,m){k?n&&n(k):m?(k=!0,m.value&&(k=!1),g.writeValue(h,e,l,k,n)):n&&n(Error("get switch current value return invalid"))});
break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+k))}else n&&n(Error("command in null"))}},KEY_TRANRECEIVER:{map:[{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){h=null;switch(g){case "PRESS_SHORT":h={pressShort:!0};break;case "PRESS_LONG":h={pressLong:!0}}return h}},ALARM_SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"ACOUSTIC_ALARM_SELECTION",command:["setAudio"]},
{dpt:"OPTICAL_ALARM_SELECTION",command:["setVisual"]},{dpt:"DURATION_UNIT",command:["setDuraionUnit"]},{dpt:"DURATION_VALUE",command:["setDuraion"]},{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "STATE":e=1==h?{state:"on"}:0==h?{state:"off"}:{state:"?"}}return e},executeCommand:function(g,h,e,k,n){if(k){var l=null;if("triggerAlarm"==k.substr(0,12)){l="triggerAlarm";var p=k.substr(12);if(!p){n&&n(Error("triggerAlarm format invalid"));
return}}if(m.call(this,l)||"triggerAlarm"==l)switch(l){case "triggerAlarm":var q=p.split(",");if(4>q.length){n&&n(Error("triggerAlarm format invalid"));break}g.writeValue(h,e,"ACOUSTIC_ALARM_SELECTION",{type:"double",value:parseInt(q[0])},function(k,l){k?n&&n(k):g.writeValue(h,e,"OPTICAL_ALARM_SELECTION",{type:"double",value:parseInt(q[1])},function(k,l){k?n&&n(k):g.writeValue(h,e,"DURATION_VALUE",{type:"double",value:parseInt(q[2])},function(k,l){k?n&&n(k):g.writeValue(h,e,"DURATION_UNIT",{type:"double",
value:parseInt(q[3])},n)})})});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+k))}else n&&n(Error("command in null"))}},HEATING_CLIMATECONTROL_TRANSCEIVER:{map:[{dpt:"SET_POINT_TEMPERATURE",command:["tempTo","tempUp","tempDown"],state:["state"],event:["state"]},{dpt:"HUMIDITY",state:["hum"],event:["hum"]},{dpt:"CONTROL_MODE",command:["auto","manu"]},{dpt:"FROST_PROTECTION",state:["frost"],event:["frost"]},{dpt:"SET_POINT_MODE",state:["mode"],event:["mode"]},
{dpt:"ACTIVE_PROFILE",command:["setProfile"],state:["profile"],event:["profile"]},{dpt:"WINDOW_STATE",command:["winOpen","winClose"],state:["window"],event:["window"]},{dpt:"ACTUAL_TEMPERATURE",state:["temp"],event:["temp"]},{dpt:"BOOST_MODE",command:["boostOn","boostOff"],state:["boost"],event:["boost"]},{dpt:"LEVEL",command:["setValve","valveUp","valveDown"],state:["valve"],event:["valve"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e={};switch(g){case "ACTIVE_PROFILE":e.profile=
parseInt(h);break;case "ACTUAL_TEMPERATURE":e.temp=parseFloat(h);break;case "BOOST_MODE":e.boost=h;break;case "FROST_PROTECTION":e.frost=h;break;case "HUMIDITY":e.hum=parseInt(h);break;case "SET_POINT_MODE":0==h?e.mode="auto":1==h&&(e.mode="manu");break;case "SET_POINT_TEMPERATURE":e.state=parseFloat(h);break;case "LEVEL":e.valve=Math.round(100*parseFloat(h));break;case "WINDOW_STATE":switch(h){case 0:e.window="closed";break;case 1:e.window="open"}break;default:return null}return e},executeCommand:function(g,
h,e,k,n){if(k){var l=k;if("tempTo"==k.substr(0,6)){l="tempTo";var p=k.substr(6);if(!p){n&&n(Error("tempTo has no value"));return}}else if("tempUp"==k.substr(0,6))l="tempUp",p=k.substr(6);else if("tempDown"==k.substr(0,8))l="tempDown",p=k.substr(8);else if("setProfile"==k.substr(0,10)){if(l="setProfile",p=k.substr(10),!p){n&&n(Error("setProfile has no value"));return}}else if("setValve"==k.substr(0,8)){if(l="setValve",p=k.substr(8),!p){n&&n(Error("setValve has no value"));return}}else"valveUp"==k.substr(0,
7)?(l="valveUp",p=k.substr(7)):"valveDown"==k.substr(0,9)&&(l="valveDown",p=k.substr(9));var q=m.call(this,l);if(q)switch(l){case "tempTo":p=parseFloat(p);if(isNaN(p)){n&&n(Error("tempTo value invalid"));break}30.5<p&&(p=30.5);4.5>p&&(p=4.5);g.writeValue(h,e,q,{type:"double",value:p},n);break;case "tempUp":p||(p=1);p=parseFloat(p);if(isNaN(p)){n&&n(Error("tempUp value invalid"));break}g.getState({interface:h,channel:e,datapoint:q},function(k,l){k?n&&n(k):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):
(p=l.value+p,30.5<p&&(p=30.5),g.writeValue(h,e,q,{type:"double",value:p},n))});break;case "tempDown":p||(p=1);p=parseFloat(p);if(isNaN(p)){n&&n(Error("tempDown value invalid"));break}g.getState({interface:h,channel:e,datapoint:q},function(k,l){k?n&&n(k):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,4.5>p&&(p=4.5),g.writeValue(h,e,q,{type:"double",value:p},n))});break;case "auto":g.writeValue(h,e,q,{type:"double",value:0},n);break;case "manu":g.writeValue(h,
e,q,{type:"double",value:1},n);break;case "setProfile":p=parseInt(p);if(isNaN(p)){n&&n(Error("setTemp value invalid"));break}g.writeValue(h,e,q,p,n);break;case "winOpen":g.writeValue(h,e,q,1,n);break;case "winClose":g.writeValue(h,e,q,0,n);break;case "boostOn":g.writeValue(h,e,q,!0,n);break;case "boostOff":g.writeValue(h,e,q,!1,n);break;case "setValve":p=parseInt(p);if(isNaN(p)){n&&n(Error("setValve value invalid"));break}p/=100;1<p&&(p=1);0>p&&(p=0);g.writeValue(h,e,q,{type:"double",value:p},n);
break;case "valveUp":p||(p=10);p=parseInt(p);if(isNaN(p)){n&&n(Error("tempUp value invalid"));break}p/=100;g.getState({interface:h,channel:e,datapoint:q},function(k,l){k?n&&n(k):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(h,e,q,{type:"double",value:p},n))});break;case "valveDown":p||(p=10);p=parseInt(p);if(isNaN(p)){n&&n(Error("tempUp value invalid"));break}p/=100;g.getState({interface:h,channel:e,datapoint:q},function(k,
l){k?n&&n(k):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(h,e,q,{type:"double",value:p},n))});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+k))}else n&&n(Error("command in null"))}},SHUTTER_CONTACT_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "STATE":e={state:0==
h?"closed":"open"}}return e}},SMOKE_DETECTOR:{map:[{dpt:"SMOKE_DETECTOR_COMMAND",command:"reservedAlarmOff intrusionAlarmOff intrusionAlarmOn smokeTest commTest commTestRepeated".split(" ")},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["state"],event:["state"]},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["alarmDetail"],event:["alarmDetail"]},{dpt:"SMOKE_DETECTOR_TEST_RESULT",state:["testResult"],event:["testResult"]},{dpt:"ERROR_CODE",state:["error"],event:["error"]}],getReadableDpts:e,getDptFromState:k,
parseDptState:function(g,h){var e=null;switch(g){case "SMOKE_DETECTOR_ALARM_STATUS":e={state:0==h?"ok":"smoke"};e.alarmDetail=h;break;case "SMOKE_DETECTOR_TEST_RESULT":switch(h){case 0:e={testResult:"none"};break;case 1:e={testResult:"smoke_ok"};break;case 2:e={testResult:"smoke_nok"};break;case 3:e={testResult:"comm_sent"};break;case 4:e={testResult:"comm_ok"}}break;case "ERROR_CODE":e={error:h}}return e},executeCommand:function(g,h,e,k,n){if(k){var l=m.call(this,k);if(l)switch(k){case "reservedAlarmOff":case "intrusionAlarmOff":case "intrusionAlarmOn":case "smokeTest":case "commTest":case "commTestRepeated":switch(k){case "reservedAlarmOff":var p=
0;break;case "intrusionAlarmOff":p=1;break;case "intrusionAlarmOn":p=2;break;case "smokeTest":p=3;break;case "commTest":p=4;break;case "commTestRepeated":p=5}g.writeValue(h,e,l,p,n);break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+k))}else n&&n(Error("command in null"))}},ROTARY_HANDLE_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "STATE":switch(h){case 0:e=
{state:"closed"};break;case 1:e={state:"tilted"};break;case 2:e={state:"open"}}}return e}},SHUTTER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTLevel"],event:["blindTLevel"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "LEVEL":e={blindTLevel:Math.round(100*parseFloat(h))}}return e}},SHUTTER_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindLevel"],event:["blindLevel"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]}],
getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "LEVEL":e={blindLevel:Math.round(100*parseFloat(h))}}return e},executeCommand:function(g,h,e,k,n){if(k){if("moveUp"==k.substr(0,6))var l="moveUp";else if("moveDown"==k.substr(0,8)){l="moveDown";var p=k.substr(8)}else if("stepUp"==k.substr(0,6))l="stepUp",p=k.substr(6);else if("stepDown"==k.substr(0,8))l="stepDown",p=k.substr(8);else if("moveTo"==k.substr(0,6)){if(l="moveTo",p=k.substr(6),!p){n&&n(Error("moveTo has no value"));
return}}else"stop"==k.substr(0,4)&&(l="stop");var q=m.call(this,l);if(q)switch(l){case "moveUp":g.writeValue(h,e,q,{type:"double",value:1},n);break;case "moveDown":g.writeValue(h,e,q,{type:"double",value:0},n);break;case "stop":g.writeValue(h,e,q,!0,n);break;case "stepUp":p||(p=5);p=parseInt(p)/100;g.getState({interface:h,channel:e,datapoint:q},function(k,l){k?n&&n(k):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(h,e,q,{type:"double",
value:p},n))});break;case "stepDown":p||(p=5);p=parseInt(p)/100;g.getState({interface:h,channel:e,datapoint:q},function(k,l){k?n&&n(k):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(h,e,q,{type:"double",value:p},n))});break;case "moveTo":p=parseInt(p)/100;g.writeValue(h,e,q,{type:"double",value:p},n);break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+k))}else n&&n(Error("command in null"))}},
BLIND_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTPos"],event:["blindTPos"]},{dpt:"LEVEL_2",state:["lamellaTPos"],event:["lamellaTPos"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "LEVEL":e={blindTPos:Math.round(100*parseFloat(h))};break;case "LEVEL_2":e={lamellaTPos:Math.round(100*parseFloat(h))}}return e}},BLIND_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindPos"],event:["blindPos"],command:["moveUp","moveDown","stepUp",
"stepDown","moveTo"]},{dpt:"LEVEL_2",state:["lamellaPos"],event:["lamellaPos"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "LEVEL":e={blindPos:Math.round(100*parseFloat(h))};break;case "LEVEL_2":e={lamellaPos:Math.round(100*parseFloat(h))}}return e},executeCommand:function(g,h,e,k,n){if(k){var l=k;if("lamellaStepUp"==k.substr(0,13)){l="lamellaStepUp";var p=k.substr(13)}else if("lamellaStepDown"==
k.substr(0,15))l="lamellaStepDown",p=k.substr(15);else if("lamellaTo"==k.substr(0,9)){if(l="lamellaTo",p=k.substr(9),!p){n&&n(Error("lamellaTo has no value"));return}}else if("stepUp"==k.substr(0,6))l="stepUp",p=k.substr(6);else if("stepDown"==k.substr(0,8))l="stepDown",p=k.substr(8);else if("moveTo"==k.substr(0,6)){if(l="moveTo",p=k.substr(6),!p){n&&n(Error("moveTo has no value"));return}}else"stop"==k.substr(0,4)&&(l="stop");var q=m.call(this,l);if(q)switch(l){case "moveUp":case "moveDown":g.writeValue(h,
e,"LEVEL_2",{type:"double",value:"moveUp"==l?1:0},function(k){k?n&&n(k):g.writeValue(h,e,"LEVEL",{type:"double",value:"moveUp"==l?1:0},function(g){n&&n(g)})});break;case "stop":g.writeValue(h,e,q,!0,n);break;case "moveTo":p=parseInt(p)/100;g.writeValue(h,e,"LEVEL",{type:"double",value:p},n);break;case "lamellaUp":case "lamellaDown":g.getState({interface:h,channel:e,datapoint:"LEVEL"},function(k,m){k?n&&n(k):g.writeValue(h,e,"LEVEL",{type:"double",value:m.value},function(k){k?n&&n(k):g.writeValue(h,
e,"LEVEL_2",{type:"double",value:"lamellaUp"==l?1:0},function(g){n&&n(g)})})});break;case "stepUp":case "stepDown":p||(p=5);p=parseInt(p)/100;g.getState({interface:h,channel:e,datapoint:"LEVEL"},function(k,m){k?n&&n(k):"undefined"==typeof m||null==m?n&&n(Error("get jalousie current value return invalid")):(p="stepUp"==l?m.value+p:m.value-p,1<p&&(p=1),0>p&&(p=0),g.writeValue(h,e,"LEVEL",{type:"double",value:p},n))});break;case "lamellaStepUp":case "lamellaStepDown":p||(p=5);p=parseInt(p)/100;g.getState({interface:h,
channel:e,datapoint:"LEVEL"},function(k,m){if(k)n&&n(k);else if("undefined"==typeof m||null==m)n&&n(Error("get jalousie current value return invalid"));else{var q=m.value;g.getState({interface:h,channel:e,datapoint:"LEVEL_2"},function(k,m){k?n&&n(k):"undefined"==typeof m||null==m?n&&n(Error("get jalousie current value return invalid")):(p="lamellaStepUp"==l?m.value+p:m.value-p,1<p&&(p=1),0>p&&(p=0),g.writeValue(h,e,"LEVEL_2",{type:"double",value:p},function(k){k?n&&n(k):g.writeValue(h,e,"LEVEL",{type:"double",
value:q},n)}))})}});break;case "lamellaTo":p=parseInt(p)/100;g.writeValue(h,e,"LEVEL_2",{type:"double",value:p},n);break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+k))}else n&&n(Error("command in null"))}},PRESENCEDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_PRESENCE",command:["reset"]},{dpt:"PRESENCE_DETECTION_STATE",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"CURRENT_ILLUMINATION",state:["current_illumination"],
event:["current_illumination"]},{dpt:"PRESENCE_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "PRESENCE_DETECTION_STATE":e={state:h?"on":"off"};break;case "ILLUMINATION":e={illumination:h};break;case "CURRENT_ILLUMINATION":e={current_illumination:h};break;case "PRESENCE_DETECTION_ACTIVE":e={active:h}}return e},executeCommand:function(g,h,e,k,n){if(k){var l=
m.call(this,k);if(l)switch(k){case "reset":g.writeValue(h,e,l,!0,n);break;case "activate":g.writeValue(h,e,l,!0,n);break;case "deactivate":g.writeValue(h,e,l,!1,n);break;case "toggleActivate":g.getState({interface:h,channel:e,datapoint:l},function(k,m){k?n&&n(k):m?(k=!0,m.value&&(k=!1),g.writeValue(h,e,l,k,n)):n&&n(Error("get switch current value return invalid"))});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+k))}else n&&n(Error("command in null"))}},
CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER:{map:[{dpt:"EMERGENCY_OPERATION",state:["cl_fd_emergencyOP"],event:["cl_fd_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fd_frostProtection"],event:["cl_fd_frostProtection"]},{dpt:"STATE",state:["cl_fd_state"],event:["cl_fd_state"]},{dpt:"HUMIDITY_ALARM",state:["cl_fd_humidityAlarm"],event:["cl_fd_humidityAlarm"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "EMERGENCY_OPERATION":e={cl_fd_emergencyOP:h};break;
case "FROST_PROTECTION":e={cl_fd_frostProtection:h};break;case "STATE":e=1==h?{cl_fd_state:"on"}:0==h?{cl_fd_state:"off"}:{cl_fd_state:"?"};break;case "HUMIDITY_ALARM":e={cl_fd_humidityAlarm:h}}return e}},CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_fp_humidityLimiter"],event:["cl_fp_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_fp_emergencyOP"],event:["cl_fp_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fp_frostProtection"],event:["cl_fp_frostProtection"]},
{dpt:"STATE",state:["cl_fp_state"],event:["cl_fp_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_fp_dewPointAlarm"],event:["cl_fp_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_fp_externalClock"],event:["cl_fp_externalClock"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "HUMIDITY_LIMITER":e={cl_fp_humidityLimiter:h};break;case "EMERGENCY_OPERATION":e={cl_fp_emergencyOP:h};break;case "FROST_PROTECTION":e={cl_fp_frostProtection:h};break;case "STATE":e=1==
h?{cl_fp_state:"on"}:0==h?{cl_fp_state:"off"}:{cl_fp_state:"?"};break;case "DEW_POINT_ALARM":e={cl_fp_dewPointAlarm:h};break;case "EXTERNAL_CLOCK":e={cl_fp_externalClock:h}}return e}},CLIMATECONTROL_FLOOR_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_f_humidityLimiter"],event:["cl_f_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_f_emergencyOP"],event:["cl_f_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_f_frostProtection"],event:["cl_f_frostProtection"]},{dpt:"STATE",state:["cl_f_state"],
event:["cl_f_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_f_dewPointAlarm"],event:["cl_f_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_f_externalClock"],event:["cl_f_externalClock"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "HUMIDITY_LIMITER":e={cl_f_humidityLimiter:h};break;case "EMERGENCY_OPERATION":e={cl_f_emergencyOP:h};break;case "FROST_PROTECTION":e={cl_f_frostProtection:h};break;case "STATE":e=1==h?{cl_f_state:"on"}:0==h?{cl_f_state:"off"}:
{cl_f_state:"?"};break;case "DEW_POINT_ALARM":e={cl_f_dewPointAlarm:h};break;case "EXTERNAL_CLOCK":e={cl_f_externalClock:h}}return e}},WEATHER_TRANSMIT:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["weatherActualTemp"],event:["weatherActualTemp"]},{dpt:"HUMIDITY",state:["weatherHum"],event:["weatherHum"]},{dpt:"ILLUMINATION",state:["weatherIllu"],event:["weatherIllu"]},{dpt:"SUNSHINEDURATION",state:["weatherSunD"],event:["weatherSunD"]},{dpt:"SUNSHINEDURATION_OVERFLOW",state:["weatherSunDOF"],event:["weatherSunDOF"]},
{dpt:"SUNSHINE_THRESHOLD_OVERRUN",state:["weatherSunTOR"],event:["weatherSunTOR"]},{dpt:"WIND_SPEED",state:["weatherWindS"],event:["weatherWindS"]},{dpt:"WIND_THRESHOLD_OVERRUN",state:["weatherWindTOR"],event:["weatherWindTOR"]},{dpt:"WIND_DIR",state:["weatherWindD"],event:["weatherWindD"]},{dpt:"WIND_DIR_RANGE",state:["weatherWindDR"],event:["weatherWindDR"]},{dpt:"RAINING",state:["weatherRain"],event:["weatherRain"]},{dpt:"RAIN_COUNTER",state:["weatherRainC"],event:["weatherRainC"]},{dpt:"RAIN_COUNTER_OVERFLOW",
state:["weatherRainCOF"],event:["weatherRainCOF"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,h){var e=null;switch(g){case "ACTUAL_TEMPERATURE":e={weatherActualTemp:h};break;case "HUMIDITY":e={weatherHum:h};break;case "ILLUMINATION":e={weatherIllu:h};break;case "SUNSHINEDURATION":e={weatherSunD:h};break;case "SUNSHINEDURATION_OVERFLOW":e={weatherSunDOF:h};break;case "SUNSHINE_THRESHOLD_OVERRUN":e={weatherSunTOR:h};break;case "WIND_SPEED":e={weatherWindS:h};break;case "WIND_THRESHOLD_OVERRUN":e=
{weatherWindTOR:h};break;case "RAINING":e={weatherRain:h};break;case "RAIN_COUNTER":e={weatherRainC:h};break;case "RAIN_COUNTER_OVERFLOW":e={weatherRainCOF:h};break;case "WIND_DIR":e={weatherWindD:h};break;case "WIND_DIR_RANGE":e={weatherWindDR:h}}return e}},CLIMATE_TRANSCEIVER:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["temperature"],event:["temperature"]},{dpt:"HUMIDITY",state:["humidity"],event:["humidity"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){var h=null;switch(g){case "ACTUAL_TEMPERATURE":h=
{temperature:e};break;case "HUMIDITY":h={humidity:e}}return h}},PASSAGE_DETECTOR_DIRECTION_TRANSMITTER:{map:[{dpt:"CURRENT_PASSAGE_DIRECTION",state:["current_direction"],event:["current_direction"]},{dpt:"LAST_PASSAGE_DIRECTION",state:["last_direction"],event:["last_direction"]},{dpt:"PASSAGE_COUNTER_OVERFLOW",state:["passage_counter_overflow"],event:["passage_counter_overflow"]},{dpt:"PASSAGE_COUNTER_VALUE",state:["passage_counter"],event:["passage_counter"]}],getReadableDpts:e,getDptFromState:k,
parseDptState:function(g,e){var h=null;switch(g){case "CURRENT_PASSAGE_DIRECTION":h={current_direction:e};break;case "LAST_PASSAGE_DIRECTION":h={last_direction:e};break;case "PASSAGE_COUNTER_OVERFLOW":h={passage_counter_overflow:e};break;case "PASSAGE_COUNTER_VALUE":h={passage_counter:e}}return h}},GENERIC_INPUT_TRANSMITER:{map:[{dpt:"CHANGE_OVER",state:["genInputChangeOver"],event:["genInputChangeOver"]},{dpt:"EXTERNAL_CLOCK",state:["genInputExtClock"],event:["genInputExtClock"]},{dpt:"HUMIDITY_LIMITER",
state:["genInputHumidityLimiter"],event:["genInputHumidityLimiter"]},{dpt:"STATE",state:["genInputState"],event:["genInputState"]},{dpt:"TACTILE_SWITCH",state:["genInputTactileSwitch"],event:["genInputTactileSwitch"]},{dpt:"TEMPERATURE_LIMITER",state:["genInputTempLimiter"],event:["genInputTempLimiter"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){var h=null;switch(g){case "CHANGE_OVER":h={genInputChangeOver:e};break;case "EXTERNAL_CLOCK":h={genInputExtClock:e};break;case "HUMIDITY_LIMITER":h=
{genInputHumidityLimiter:e};break;case "STATE":h=1==e?{genInputState:"on"}:0==e?{genInputState:"off"}:{genInputState:"?"};break;case "TACTILE_SWITCH":h={genInputTactileSwitch:e};break;case "TEMPERATURE_LIMITER":h={genInputTempLimiter:e}}return h}},ANALOG_OUTPUT_TRANSCEIVER:{map:[{dpt:"LEVEL",state:["outputLevel"],event:["outputLevel"],command:["outputOff","outputUp","outputDown","outputTo","toggleTo"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){var h=null;switch(g){case "LEVEL":h=
{outputLevel:Math.round(100*parseFloat(e))}}return h},executeCommand:function(g,e,k,q,n){if(q){if("outputOff"==q.substr(0,9))var h="outputOff";else if("outputUp"==q.substr(0,8)){h="outputUp";var l=q.substr(8)}else if("outputDown"==q.substr(0,10))h="outputDown",l=q.substr(10);else if("outputTo"==q.substr(0,8)){if(h="outputTo",l=q.substr(8),!l){n&&n(Error("outputTo has no value"));return}}else if("toggleTo"==q.substr(0,8)){if(h="toggleTo",l=q.substr(8),!l){n&&n(Error("toggleTo has no value"));return}}else isNaN(parseInt(q))||
(h="outputTo",l=parseInt(q));var t=m.call(this,h);if(t)switch(h){case "outputOff":g.writeValue(e,k,t,{type:"double",value:0},n);break;case "outputUp":l||(l=10);l=parseInt(l)/100;g.getState({interface:e,channel:k,datapoint:t},function(h,m){h?n&&n(h):"undefined"==typeof m||null==m?n&&n(Error("get dimmer current value return invalid")):(l=m.value+l,1<l&&(l=1),g.writeValue(e,k,t,{type:"double",value:l},n))});break;case "outputDown":l||(l=10);l=parseInt(l)/100;g.getState({interface:e,channel:k,datapoint:t},
function(h,m){h?n&&n(h):"undefined"==typeof m||null==m?n&&n(Error("get dimmer current value return invalid")):(l=m.value-l,0>l&&(l=0),g.writeValue(e,k,t,{type:"double",value:l},n))});break;case "toggleTo":l=parseInt(l)/100;g.getState({interface:e,channel:k,datapoint:t},function(h,m){h?n&&n(h):m?(m.value&&(l=0),g.writeValue(e,k,t,{type:"double",value:l},n)):n&&n(Error("get switch current value return invalid"))});break;case "outputTo":l=parseInt(l)/100;g.writeValue(e,k,t,{type:"double",value:l},n);
break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+q))}else n&&n(Error("command in null"))}},WATER_DETECTION_TRANSMITTER:{map:[{dpt:"ALARMSTATE",state:["alarm"],event:["alarm"]},{dpt:"MOISTURE_DETECTED",state:["moisture"],event:["moisture"]},{dpt:"WATERLEVEL_DETECTED",state:["water"],event:["water"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){var h=null;switch(g){case "ALARMSTATE":h={alarm:e};break;case "MOISTURE_DETECTED":h={moisture:e};
break;case "WATERLEVEL_DETECTED":h={water:e}}return h}},ACCELERATION_TRANSCEIVER:{map:[{dpt:"MOTION",state:["motion"],event:["motion"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){var h=null;switch(g){case "MOTION":h={motion:e}}return h}},DOOR_RECEIVER:{map:[{dpt:"DOOR_STATE",state:["doorState"],event:["doorState"]},{dpt:"DOOR_COMMAND",command:["open","close","partialOpen","stop"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){var h=null;switch(g){case "DOOR_STATE":e=
parseInt(e),h=0==e?{doorState:"closed"}:1==e?{doorState:"open"}:2==e?{doorState:"ventilation"}:{doorState:"unknown"}}return h},executeCommand:function(g,e,k,q,n){if(q){var h=m.call(this,q);if(h)switch(q){case "open":g.writeValue(e,k,h,{type:"double",value:1},n);break;case "stop":g.writeValue(e,k,h,{type:"double",value:2},n);break;case "close":g.writeValue(e,k,h,{type:"double",value:3},n);break;case "partialOpen":g.writeValue(e,k,h,{type:"double",value:4},n);break;default:n&&n(Error("no such command"))}else n&&
n(Error("can not find datapoint for command:"+q))}else n&&n(Error("command in null"))}},SIMPLE_SWITCH_RECEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"],command:["on","off","toggle"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){var h=null;switch(g){case "STATE":h=1==e?{state:"on"}:0==e?{state:"off"}:{state:"?"}}return h},executeCommand:function(g,e,k,q,n){var h=m.call(this,q);if(h)switch(q){case "on":g.writeValue(e,k,h,!0,n);break;case "off":g.writeValue(e,k,h,!1,n);
break;case "toggle":g.getState({interface:e,channel:k,datapoint:h},function(l,m){l?n&&n(l):m?(l=!0,m.value&&(l=!1),g.writeValue(e,k,h,l,n)):n&&n(Error("get switch current value return invalid"))});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+q))}},MULTI_MODE_INPUT_TRANSMITTER:{map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,
e){var h=null;switch(g){case "STATE":h=1==e?{state:"on"}:0==e?{state:"off"}:{state:"?"};break;case "PRESS_SHORT":h={pressShort:!0};break;case "PRESS_LONG":h={pressLong:!0}}return h}},BRIGHTNESS_TRANSMITTER:{map:[{dpt:"AVERAGE_ILLUMINATION",state:["avgIllu"],event:["avgIllu"]},{dpt:"CURRENT_ILLUMINATION",state:["illu"],event:["illu"]},{dpt:"HIGHEST_ILLUMINATION",state:["maxIllu"],event:["maxIllu"]},{dpt:"LOWEST_ILLUMINATION",state:["minIllu"],event:["minIllu"]}],getReadableDpts:e,getDptFromState:k,
parseDptState:function(g,e){var h=null;switch(g){case "AVERAGE_ILLUMINATION":h={avgIllu:parseFloat(parseFloat(e).toFixed(2))};break;case "CURRENT_ILLUMINATION":h={illu:parseFloat(parseFloat(e).toFixed(2))};break;case "HIGHEST_ILLUMINATION":h={maxIllu:parseFloat(parseFloat(e).toFixed(2))};break;case "LOWEST_ILLUMINATION":h={minIllu:parseFloat(parseFloat(e).toFixed(2))}}return h}},POWER_MAINS_TRANSMITTER:{map:[{dpt:"POWER_MAINS_FAILURE",state:["powerMainsFailure"],event:["powerMainsFailure"]}],getReadableDpts:e,
getDptFromState:k,parseDptState:function(g,e){var h=null;switch(g){case "POWER_MAINS_FAILURE":h={powerMainsFailure:e}}return h}},ANALOG_INPUT_TRANSMITTER:{map:[{dpt:"VOLTAGE",state:["voltage"],event:["voltage"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){var h=null;switch(g){case "VOLTAGE":h={voltage:parseFloat(e)}}return h}}},"BidCos-RF":{MAINTENANCE:{device:"maintenance",map:[{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]},{dpt:"UNREACH",state:["timeout"],event:["timeout"]}],
getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){switch(g){case "LOWBAT":return{lowbat:e};case "UNREACH":return{timeout:e};default:return null}}},KEY:{device:"button",map:[{dpt:"PRESS_SHORT",event:["pressShort"],command:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"],command:["pressLong"]},{dpt:"PRESS_LONG_RELEASE",event:["pressLongRel"]},{dpt:"PRESS_CONT",event:["pressCont"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){switch(g){case "PRESS_SHORT":return{pressShort:e};
case "PRESS_LONG":return{pressLong:e};case "PRESS_CONT":return{pressCont:e};case "PRESS_LONG_RELEASE":return{pressLongRel:e};default:return null}},executeCommand:function(g,e,k,q,n){var h=m.call(this,q);switch(q){case "pressShort":g.writeValue(e,k,h,!0,n);break;case "pressLong":g.writeValue(e,k,h,!0,n);break;default:n&&n(Error("no such command"))}}},SWITCH_INTERFACE:{device:"switch_interface",map:[{dpt:"PRESS",event:["press"],command:["press"]}],parseDptState:function(g,e){switch(g){case "PRESS":return{press:!0};
default:return null}},executeCommand:function(g,e,k,q,n){var h=m.call(this,q);switch(q){case "press":g.writeValue(e,k,h,!0,n);break;default:n&&n(Error("no such command"))}}},SHUTTER_CONTACT:{device:"contact",map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){switch(g){case "STATE":return{state:e?"open":"closed"};case "ERROR":return{error:1==
e?"sabotage":"no_error"};case "LOWBAT":return{lowbat:e};default:return null}}},JALOUSIE:{device:"jalousie",map:[{dpt:"LEVEL",state:["jalState"],event:["jalState"],command:["moveUp","moveDown","stepUp","stepDown","%d"]},{dpt:"STOP",command:["stop"]},{dpt:"LEVEL_SLATS",state:["jalLmlState"],event:["jalLmlState"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo%d"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){var h=null;switch(g){case "LEVEL":e=Math.round(100*
parseFloat(e));h={jalState:e};break;case "LEVEL_SLATS":e=Math.round(100*parseFloat(e)),h={jalLmlState:e}}return h},executeCommand:function(g,e,k,q,n){var h=m.call(this,q);switch(q){case "moveUp":g.writeValue(e,k,h,{type:"double",value:1},n);break;case "moveDown":g.writeValue(e,k,h,{type:"double",value:0},n);break;case "stepUp":g.getState({interface:e,channel:k,datapoint:h},function(l,m){if(l)n&&n(l);else if(m){var p=m.value+.05;1<p&&(p=1);g.writeValue(e,k,h,{type:"double",value:p},function(l){l?n&&
n(l):(g.updateStatusBuffer(e,k,h,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current jalousie state result invalid"))});break;case "stepDown":g.getState({interface:e,channel:k,datapoint:h},function(l,m){if(l)n&&n(l);else if(m){var p=m.value-.05;0>p&&(p=0);g.writeValue(e,k,h,{type:"double",value:p},function(l){l?n&&n(l):(g.updateStatusBuffer(e,k,h,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current blind state result invalid"))});break;case "stop":g.writeValue(e,k,h,!0,
n);break;case "lamellaUp":g.writeValue(e,k,h,{type:"double",value:1},n);break;case "lamellaDown":g.writeValue(e,k,h,{type:"double",value:0},n);break;case "lamellaStepUp":g.getState({interface:e,channel:k,datapoint:h},function(l,m){if(l)n&&n(l);else if(m){var p=m.value+.05;1<p&&(p=1);g.writeValue(e,k,h,{type:"double",value:p},function(l){l?n&&n(l):(g.updateStatusBuffer(e,k,h,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current lamella state result invalid"))});break;case "lamellaStepDown":g.getState({interface:e,
channel:k,datapoint:h},function(l,m){if(l)n&&n(l);else if(m){var p=m.value-.05;0>p&&(p=0);g.writeValue(e,k,h,{type:"double",value:p},function(l){l?n&&n(l):(g.updateStatusBuffer(e,k,h,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current lamella state result invalid"))});break;default:if("lamellaTo"==q.substr(0,9)){q=q.substr(9);var l=parseInt(q);l/=100;h="LEVEL_SLATS";g.writeValue(e,k,h,{type:"double",value:l},function(m){m?n&&n(m):(g.updateStatusBuffer(e,k,h,l,(new Date).getTime()+1E3),
n&&n())})}else"moveTo"==q.substr(0,6)||q.match(/^[-+]?[0-9]+$/)?("moveTo"==q.substr(0,6)&&(q=q.substr(6)),l=parseInt(q),l/=100,h="LEVEL",g.writeValue(e,k,h,{type:"double",value:l},function(m){m?n&&n(m):(g.updateStatusBuffer(e,k,h,l,(new Date).getTime()+1E3),n&&n())})):n&&n(Error("no such command"))}}},MOD_EM8BIT_TRANSMITTER:{map:[{dpt:"STATE",state:["state8bit"],event:["state8bit"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){var h=
null;switch(g){case "STATE":e=parseInt(e);h={state8bit:e};break;case "LOWBAT":h={lowbat:e}}return h}},KEYMATIC:{device:"keymatic",map:[{dpt:"STATE",state:["state"],event:["state"],command:["open","close"]},{dpt:"OPEN",command:["openDoor"]},{dpt:"STATE_UNCERTAIN",state:["uncertain"],event:["uncertain"]},{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){switch(g){case "STATE":return{state:e?"open":"closed"};case "STATE_UNCERTAIN":return{uncertain:e};
case "ERROR":switch(e){case 0:e="no_error";break;case 1:e="cluth_failure";break;case 2:e="motor_aborted"}return{error:e}}return null},executeCommand:function(g,e,k,q,n){var h=m.call(this,q);switch(q){case "open":g.writeValue(e,k,h,!0,n);break;case "close":g.writeValue(e,k,h,!1,n);break;case "openDoor":g.writeValue(e,k,h,!0,n);break;default:n&&n(Error("no such command"))}}},MOTION_DETECTOR:{device:"motion",map:[{dpt:"BRIGHTNESS",state:["bri"],event:["bri"]},{dpt:"MOTION",state:["state"],event:["state"]},
{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(g,e){var h={};switch(g){case "BRIGHTNESS":h.bri=e;break;case "MOTION":h.state=e?"motion":"ok";break;case "ERROR":h.error=e?"sabotage":"no_error";break;default:return null}return h}},DUAL_WHITE_BRIGHTNESS:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["direction"],event:["direction"]},{dpt:"ERROR_OVERHEAT",state:["error_overheat"],event:["error_overheat"]},{dpt:"ERROR_REDUCED",state:["error_reduced"],
event:["error_reduced"]},{dpt:"LEVEL",state:["bri"],event:["bri"],command:["off","dimUp","dimDown","toggle","dimTo%d"]},{dpt:"LEVEL_REAL",state:["bri_real"],event:["bri_real"]},{dpt:"OLD_LEVEL",command:["on"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(e,h){var g={};switch(e){case "DIRECTION":g.direction=h;break;case "ERROR_OVERHEAT":g.error_overheat=h?!0:!1;break;case "ERROR_REDUCED":g.error_reduced=h?!0:!1;break;case "LEVEL":g.bri=Math.round(100*parseFloat(h));break;case "LEVEL_REAL":g.bri_real=
Math.round(100*parseFloat(h));break;default:return null}return g},executeCommand:function(g,e,k,q,n){var h=m.call(this,q);switch(q){case "on":g.writeValue(e,k,h,!0,n);break;case "off":g.writeValue(e,k,h,{type:"double",value:0},n);break;case "dimUp":g.getState({interface:e,channel:k,datapoint:h},function(l,m){if(l)n&&n(l);else if(m){var p=m.value+.05;1<p&&(p=1);g.writeValue(e,k,h,{type:"double",value:p},function(l){l?n&&n(l):(g.updateStatusBuffer(e,k,h,p,(new Date).getTime()+1E3),n&&n())})}else n&&
n(Error("get current jalousie state result invalid"))});break;case "dimDown":g.getState({interface:e,channel:k,datapoint:h},function(l,m){if(l)n&&n(l);else if(m){var p=m.value-.05;0>p&&(p=0);g.writeValue(e,k,h,{type:"double",value:p},function(l){l?n&&n(l):(g.updateStatusBuffer(e,k,h,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current blind state result invalid"))});break;case "toggle":h="LEVEL";g.getState({interface:e,channel:k,datapoint:h},function(l,m){l?n&&n(l):m?0!=m.value?g.writeValue(e,
k,h,{type:"double",value:0},n):g.writeValue(e,k,"OLD_LEVEL",!0,n):n&&n(Error("get current dimmer state result invalid"))});break;default:if("dimTo"==q.substr(0,5)){q=q.substr(5);var l=parseInt(q);l/=100;h="LEVEL";g.writeValue(e,k,h,{type:"double",value:l},function(m){m?n&&n(m):(g.updateStatusBuffer(e,k,h,l,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("no such command"))}}},DUAL_WHITE_COLOR:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["color_direction"],event:["color_direction"]},{dpt:"LEVEL",
state:["color"],event:["color"],command:["colorOff","colorUp","colorDown","colorToggle","colorTo%d"]},{dpt:"LEVEL_REAL",state:["color_real"],event:["color_real"]},{dpt:"OLD_LEVEL",command:["colorOn"]}],getReadableDpts:e,getDptFromState:k,parseDptState:function(e,h){var g={};switch(e){case "DIRECTION":g.direction=h;break;case "LEVEL":g.color=Math.round(100*parseFloat(h));break;case "LEVEL_REAL":g.color_real=Math.round(100*parseFloat(h));break;default:return null}return g},executeCommand:function(e,
h,k,q,n){var g=m.call(this,q);switch(q){case "colorOn":e.writeValue(h,k,g,!0,n);break;case "colorOff":e.writeValue(h,k,g,{type:"double",value:0},n);break;case "colorUp":e.getState({interface:h,channel:k,datapoint:g},function(l,m){if(l)n&&n(l);else if(m){var p=m.value+.05;1<p&&(p=1);e.writeValue(h,k,g,{type:"double",value:p},function(l){l?n&&n(l):(e.updateStatusBuffer(h,k,g,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current jalousie state result invalid"))});break;case "colorDown":e.getState({interface:h,
channel:k,datapoint:g},function(l,m){if(l)n&&n(l);else if(m){var p=m.value-.05;0>p&&(p=0);e.writeValue(h,k,g,{type:"double",value:p},function(l){l?n&&n(l):(e.updateStatusBuffer(h,k,g,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current blind state result invalid"))});break;case "colorToggle":g="LEVEL";e.getState({interface:h,channel:k,datapoint:g},function(l,m){l?n&&n(l):m?0!=m.value?e.writeValue(h,k,g,{type:"double",value:0},n):e.writeValue(h,k,"OLD_LEVEL",!0,n):n&&n(Error("get current dimmer state result invalid"))});
break;default:if("colorTo"==q.substr(0,7)){q=q.substr(7);var l=parseInt(q);l/=100;g="LEVEL";e.writeValue(h,k,g,{type:"double",value:l},function(m){m?n&&n(m):(e.updateStatusBuffer(h,k,g,l,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("no such command"))}}}}}}();
x.hub.m.hm._Device=function(){var e=function(f,a,b){this.deviceType=f;this.deviceIF=a;this.deviceAdr=b;this.legacyType=null};e.prototype.initStates=function(f,a){var b=this._getReadableDpts();this._initDptStates(f,b,a)};e.prototype._getReadableDpts=function(){return[]};e.prototype._getDptFromRef=function(f){return null};e.prototype._initDptStates=function(f,a,b){if(a&&0!=a.length){var c=0,e=this,g=function(w,h){c++;c==a.length?b&&b():f.readValue(e.deviceIF,a[c].channel,a[c].dpt,g)};f.readValue(this.deviceIF,
a[c].channel,a[c].dpt,g)}else b&&b()};e.prototype.parseDptState=function(f,a,b){return null};e.prototype.toLegacyAdr=function(){return this.deviceType+"."+this.deviceIF+"."+this.deviceAdr};e.prototype.toLegacyType=function(){return this.legacyType};e.prototype.getSerial=function(){var f=this.deviceAdr,a=this.deviceAdr.indexOf(":");-1!=a&&(f=f.substr(0,a));return f};e.prototype.parseChnState=function(f,a){var b={},c;for(c in a){var e=this.parseDptState(f,c,a[c].value);if(e){var g={},h=a[c].time,k;
for(k in e)g[k]={value:e[k],time:h};b=x.hub.m.hm._Util.mergeObj(b,g)}}return b};e.prototype.parseStates=function(f){var a={},b;for(b in f){var c=this.parseChnState(b,f[b]);c&&(a=x.hub.m.hm._Util.mergeObj(a,c))}return a};e.prototype.executeCommand=function(f,a,b){b&&b()};e.prototype.getState=function(f,a,b){switch(a){case "timeout":var c={channel:this.deviceAdr+":0",dataPoint:"UNREACH"};break;default:c=this._getDptFromRef(a)}if(c){var e=this;f.getState({interface:this.deviceIF,channel:c.channel,datapoint:c.dataPoint},
function(f,g){f?b&&b(f):g?(f=e.parseDptState(c.channel,c.dataPoint,g.value))?b&&b(null,{value:f[a],time:g.time}):b&&b(null,null):b&&b(null,null)})}else b&&b(Error("no such state"))};e.prototype.isButton=function(){return!1};var k=function(f,a,b){e.call(this,f,a,b);this.channel=0;this.legacyType="maintenance"};util.inherits(k,e);k.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"].MAINTENANCE.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+
":0",dpt:b})});return f};k.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};k.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||f!=this.channel)return null;
c={};"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b;return c};var m=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="button"};util.inherits(m,e);m.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};m.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=
0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};m.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "PRESS_SHORT":return{pressShort:b};
case "PRESS_LONG":return{pressLong:b};case "PRESS_CONT":return{pressCont:b};case "PRESS_LONG_RELEASE":return{pressLongRel:b};default:return null}};m.prototype.isButton=function(){return!0};m.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(e,g){e&&console.error("button claim PRESS_SHORT event error:"+e.stack);f.reportValueUsage(c.deviceIF,b,"PRESS_LONG",function(b,c){b&&
console.error("button claim PRESS_LONG event error:"+b.stack);a&&a()})})};var g=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="button"};util.inherits(g,e);g.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};g.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint=
"LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};g.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "PRESS_SHORT":return{pressShort:b};case "PRESS_LONG":return{pressLong:b};
case "PRESS_CONT":return{pressCont:b};case "PRESS_LONG_RELEASE":return{pressLongRel:b};default:return null}};g.prototype.isButton=function(){return!1};g.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(e,g){e&&console.error("button claim PRESS_SHORT event error:"+e.stack);f.reportValueUsage(c.deviceIF,b,"PRESS_LONG",function(b,c){b&&console.error("button claim PRESS_LONG event error:"+
b.stack);a&&a()})})};var h=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="switch"};util.inherits(h,e);h.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"}]};h.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&
this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;default:return null}return a};h.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;switch(a){case "on":var g="STATE";
f.writeValue(this.deviceIF,c,g,!0,b);break;case "off":g="STATE";f.writeValue(this.deviceIF,c,g,!1,b);break;case "toggle":g="STATE";f.getState({interface:this.deviceIF,channel:c,datapoint:g},function(a,w){a?b&&b(a):w?(a=!0,w.value&&(a=!1),f.writeValue(e.deviceIF,c,g,a,b)):b&&b(Error("get switch current value return invalid"))});break;default:"onFor"==a.substr(0,5)?(a=parseFloat(a.substr(5)),isNaN(a)?b&&b(Error("onFor command invalid")):(g="ON_TIME",f.writeValue(this.deviceIF,c,g,{type:"double",value:a},
function(a){a?b&&b(a):(g="STATE",f.writeValue(e.deviceIF,c,g,!0,b))}))):b&&b(Error("no such command"))}};h.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;var h;switch(a){case "STATE":return 1==b?h="on":
0==b&&(h="off"),{state:h};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};default:return null}};h.prototype.getConfig=function(f,a){var b=this.deviceAdr+":"+this.channel;f.getParamset(this.deviceIF,b,"MASTER",function(c,f){if(c)a&&a(c);else{var e={},g=null;f&&(g={AES_ACTIVE:f.AES_ACTIVE});e[b]=g;a&&a(c,e)}})};h.prototype.setConfig=function(f,a,b){if(a){var c=this.deviceAdr+":"+this.channel;if(a=a[c]){var e={};e.AES_ACTIVE=a.AES_ACTIVE;f.setParamset(this.deviceIF,c,"MASTER",e,function(c){b&&
b(c)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var l=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="dimmer"};util.inherits(l,e);l.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"}]};l.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LEVEL";break;case "levelReal":a.dataPoint="LEVEL_REAL";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;case "direction":a.dataPoint="DIRECTION";break;default:return null}return a};l.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.channel,e=this,g=null;switch(a){case "on":var h="OLD_LEVEL";f.writeValue(this.deviceIF,c,h,!0,b);break;case "off":h="LEVEL";f.writeValue(this.deviceIF,
c,h,{type:"double",value:0},b);break;case "dimUp":h="LEVEL";f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,g){a?b&&b(a):g?(a=g.value+.05,1<a&&(a=1),f.writeValue(e.deviceIF,c,h,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});break;case "dimDown":h="LEVEL";f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,g){a?b&&b(a):g?(a=g.value-.05,0>a&&(a=0),f.writeValue(e.deviceIF,c,h,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});
break;case "toggle":h="LEVEL";f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,g){a?b&&b(a):g?0!=g.value?f.writeValue(e.deviceIF,c,h,{type:"double",value:0},b):f.writeValue(e.deviceIF,c,"OLD_LEVEL",!0,b):b&&b(Error("get current dimmer state result invalid"))});break;default:"toggleTo"==a.substr(0,8)?(g=parseInt(a.substr(8)),isNaN(g)?b&&b(Error("toggleTo command invalid")):(h="LEVEL",g/=100,f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,w){a?b&&b(a):w?(a=
g,w.value&&(a=0),f.writeValue(e.deviceIF,c,h,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))}))):"onTo"==a.substr(0,4)||a.match(/^[-+]?[0-9]+$/)?("onTo"==a.substr(0,4)&&(a=a.substr(4)),g=parseInt(a),g/=100,h="LEVEL",f.writeValue(this.deviceIF,c,h,{type:"double",value:g},b)):b&&b(Error("no such command"))}};l.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");
-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LEVEL":return a=Math.round(100*parseFloat(b)),{state:a};case "LEVEL_REAL":return a=Math.round(100*parseFloat(b)),{levelReal:a};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};case "DIRECTION":return{direction:b};default:return null}};var q=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="blind"};
util.inherits(q,e);q.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"DIRECTION"}]};q.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LEVEL";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;case "direction":a.dataPoint="DIRECTION";break;default:return null}return a};q.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.channel,e=this,g=0;"stepUpFor"==a.substr(0,9)?((g=a.substr(9))||(g=1),g=parseFloat(g),a="stepUpFor"):"stepUp"==a.substr(0,6)?((g=a.substr(6))||(g=5),g=parseInt(g)/100,a="stepUp"):"stepDownFor"==a.substr(0,
11)?((g=a.substr(11))||(g=1),g=parseFloat(g),a="stepDownFor"):"stepDown"==a.substr(0,8)&&((g=a.substr(8))||(g=5),g=parseInt(g)/100,a="stepDown");switch(a){case "stepUp":var h="LEVEL";f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,w){if(a)b&&b(a);else if(w){g||(g=.05);var k=w.value+g;1<k&&(k=1);f.writeValue(e.deviceIF,c,h,{type:"double",value:k},function(a){a?b&&b(a):(f.updateStatusBuffer(e.deviceIF,c,h,k,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("get current blind state result invalid"))});
break;case "stepDown":h="LEVEL";f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,w){if(a)b&&b(a);else if(w){g||(g=.05);var k=w.value-g;0>k&&(k=0);f.writeValue(e.deviceIF,c,h,{type:"double",value:k},function(a){a?b&&b(a):(f.updateStatusBuffer(e.deviceIF,c,h,k,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("get current blind state result invalid"))});break;case "stepUpFor":h="LEVEL";f.writeValue(this.deviceIF,c,h,{type:"double",value:1},function(a){a?b&&b(a):setTimeout(function(){h=
"STOP";f.writeValue(e.deviceIF,c,h,!0,b)},1E3*g)});break;case "stepDownFor":h="LEVEL";f.writeValue(this.deviceIF,c,h,{type:"double",value:0},function(a){a?b&&b(a):setTimeout(function(){h="STOP";f.writeValue(e.deviceIF,c,h,!0,b)},1E3*g)});break;case "up":h="LEVEL";f.writeValue(this.deviceIF,c,h,{type:"double",value:1},b);break;case "down":h="LEVEL";f.writeValue(this.deviceIF,c,h,{type:"double",value:0},b);break;case "stop":h="STOP";f.writeValue(this.deviceIF,c,h,!0,b);break;default:if("moveTo"==a.substr(0,
6)||a.match(/^[-+]?[0-9]+$/)){"moveTo"==a.substr(0,6)&&(a=a.substr(6));var k=parseInt(a);k/=100;h="LEVEL";f.writeValue(this.deviceIF,c,h,{type:"double",value:k},function(a){a?b&&b(a):(f.updateStatusBuffer(e.deviceIF,c,h,k,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("no such command"))}};q.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,
c));if(g!=e||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LEVEL":return a=Math.round(100*parseFloat(b)),{state:a};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};case "DIRECTION":return{direction:b};default:return null}};q.prototype.getConfig=function(f,a){var b=this.deviceAdr+":"+this.channel;f.getParamset(this.deviceIF,b,"MASTER",function(c,f){if(c)a&&a(c);else{var g={},e=null;f&&(e={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,
REFERENCE_RUNNING_TIME_BOTTOM_TOP:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP,REFERENCE_RUNNING_TIME_TOP_BOTTOM:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});g[b]=e;a&&a(c,g)}})};q.prototype.setConfig=function(f,a,b){if(a){var c=this.deviceAdr+":"+this.channel;if(a=a[c]){var g={};g.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};g.REFERENCE_RUNNING_TIME_BOTTOM_TOP={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP};g.REFERENCE_RUNNING_TIME_TOP_BOTTOM=
{__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM};g.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;f.setParamset(this.deviceIF,c,"MASTER",g,function(c){b&&b(c)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var n=function(f,a,b){h.call(this,f,a,b);this.legacyType="powerswitch";this.powChannel=2};util.inherits(n,h);n.prototype._getReadableDpts=function(){var f=h.prototype._getReadableDpts.call(this);f.push({channel:this.deviceAdr+":"+this.powChannel,
dpt:"BOOT"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"ENERGY_COUNTER"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"POWER"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"CURRENT"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"VOLTAGE"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"FREQUENCY"});return f};n.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";
break;case "state":a.channel+=":1";a.dataPoint="STATE";break;case "inhibit":a.channel+=":1";a.dataPoint="INHIBIT";break;case "working":a.channel+=":1";a.dataPoint="WORKING";break;case "boot":a.channel+=":2";a.dataPoint="BOOT";break;case "energy_counter":a.channel+=":2";a.dataPoint="ENERGY_COUNTER";break;case "power":a.channel+=":2";a.dataPoint="POWER";break;case "current":a.channel+=":2";a.dataPoint="CURRENT";break;case "voltage":a.channel+=":2";a.dataPoint="VOLTAGE";break;case "frequency":a.channel+=
":2";a.dataPoint="FREQUENCY";break;default:return null}return a};n.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);c=f.substr(c+1);return g!=this.deviceAdr?null:0==c?(f={},"UNREACH"==a?f.timeout=b:f["0_"+a.toLowerCase()]=b,f):"1"==c?h.prototype.parseDptState.call(this,f,a,b):"2"==c?(f={},f[a.toLowerCase()]=b,f):null};n.prototype.getConfig=function(f,a){var b=this,c=null;h.prototype.getConfig.call(this,f,function(g,e){g?a&&a(g):(c=e,b._getCh2Config(f,
function(b,f){if(b)a&&a(b);else{for(var g in f)f.hasOwnProperty(g)&&(c[g]=f[g]);a&&a(null,c)}}))})};n.prototype.setConfig=function(f,a,b){if(a){var c=Object.keys(a);if(c&&0!=c.length){var g=this;async.eachSeries(c,function(b,c){var e=b.indexOf(":");-1==e&&c(Error("channel address is null"));e=b.substr(e+1);1==e?h.prototype.setConfig.call(g,f,a,c):2==e?g._setCh2Config(f,a[b],c):c(Error("unknow channel:"+e))},function(c){b&&b(c)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};
n.prototype._getCh2Config=function(f,a){var b=this.deviceAdr+":2";f.getParamset(this.deviceIF,b,"MASTER",function(c,f){if(c)a&&a(c);else{var g={},e=null;f&&(e={AES_ACTIVE:f.AES_ACTIVE});g[b]=e;a&&a(c,g)}})};n.prototype._setCh2Config=function(f,a,b){if(a){var c=this.deviceAdr+":2",g={};g.AES_ACTIVE=a.AES_ACTIVE;f.setParamset(this.deviceIF,c,"MASTER",g,function(c){b&&b(c)})}else b&&b(Error("config data invalid"))};var r=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="weather"};util.inherits(r,
e);r.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"}]};r.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint="TEMPERATURE";
break;case "hum":a.dataPoint="HUMIDITY";break;default:return null}return a};r.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "TEMPERATURE":return a=parseFloat(b),{temp:a};case "HUMIDITY":return a=
parseInt(b),{hum:a};default:return null}};var p=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="weather2"};util.inherits(p,r);p.prototype._getReadableDpts=function(){var f=r.prototype._getReadableDpts.call(this);f.push({channel:this.deviceAdr+":"+this.channel,dpt:"AIR_PRESSURE"});return f};p.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "air":a.dataPoint="AIR_PRESSURE";break;default:return r.prototype._getDptFromRef.call(this,
f)}return a};p.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c),e=f.substr(c+1),h=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(h=this.deviceAdr.substr(0,c));if(g!=h||0!=e&&e!=this.channel)return null;if(0==e)return f={},"UNREACH"==a?f.timeout=b:"LOWBAT"==a?f.lowbat=b:f["0_"+a.toLowerCase()]=b,f;f=r.prototype.parseDptState.call(this,f,a,b);switch(a){case "AIR_PRESSURE":f||(f={}),f.air=parseInt(b)}return f};var t=function(f,a,b){e.call(this,
f,a,b);this.channel=1;this.legacyType="weatherstation"};util.inherits(t,e);t.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAINING"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAIN_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_SPEED"},
{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION_RANGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"SUNSHINEDURATION"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"}]};t.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint=
"TEMPERATURE";break;case "hum":a.dataPoint="HUMIDITY";break;case "rain":a.dataPoint="RAINING";break;case "rainC":a.dataPoint="RAIN_COUNTER";break;case "windS":a.dataPoint="WIND_SPEED";break;case "windD":a.dataPoint="WIND_DIRECTION";break;case "windDR":a.dataPoint="WIND_DIRECTION_RANGE";break;case "sunD":a.dataPoint="SUNSHINEDURATION";break;case "bri":a.dataPoint="BRIGHTNESS";break;default:return null}return a};t.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=
f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "TEMPERATURE":c.temp=parseFloat(b);break;case "HUMIDITY":c.hum=parseInt(b);break;case "RAINING":c.rain=b;break;case "RAIN_COUNTER":c.rainC=parseFloat(b);break;case "WIND_SPEED":c.windS=parseFloat(b);break;case "WIND_DIRECTION":c.windD=
b;break;case "WIND_DIRECTION_RANGE":c.windDR=b;break;case "SUNSHINEDURATION":c.sunD=b;break;case "BRIGHTNESS":c.bri=b;break;default:return null}return c};var z=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="heater"};util.inherits(z,e);z.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"VALVE_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"});return f};z.prototype._getDptFromRef=
function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "error":a.dataPoint="ERROR";break;case "state":a.dataPoint="VALVE_STATE";break;default:return null}return a};z.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c={};if(0==f)return"UNREACH"==
a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(f==this.channel){switch(a){case "ERROR":switch(b){case 0:c.error="no_error";break;case 1:c.error="VALVE_DRIVE_BLOCKED";break;case 2:c.error="VALVE_DRIVE_LOOSE";break;case 3:c.error="ADJUSTING_RANGE_TO_SMALL";break;case 4:c.error="lowbat"}break;case "VALVE_STATE":c.state=b}return c}return null};var v=function(f,a,b){e.call(this,f,a,b);this.channel=4;this.legacyType="thermostat"};util.inherits(v,e);v.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+
":"+this.channel,dpt:"CONTROL_MODE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"FAULT_REPORTING"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"BATTERY_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"BOOST_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"ACTUAL_TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"SET_TEMPERATURE"});return f};v.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(f){case "mode":a.dataPoint="CONTROL_MODE";break;case "error":a.dataPoint="FAULT_REPORTING";break;case "batLvl":a.dataPoint="BATTERY_STATE";break;case "valveLvl":a.dataPoint="VALVE_STATE";break;case "boostTime":a.dataPoint="BOOST_STATE";break;case "act_temp":a.dataPoint="ACTUAL_TEMPERATURE";break;case "state":a.dataPoint="SET_TEMPERATURE";break;default:return null}return a};v.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.channel,g=this;switch(a){case "setAuto":var e=
"AUTO_MODE";f.writeValue(this.deviceIF,c,e,!0,function(a){a||f.updateStatusBuffer(g.deviceIF,c,"CONTROL_MODE",0);b&&b(a)});break;case "setManu":e="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,h){a?b&&b(a):(e="MANU_MODE",f.writeValue(g.deviceIF,c,e,{type:"double",value:h.value},function(a){a||f.updateStatusBuffer(g.deviceIF,c,"CONTROL_MODE",1);b&&b(a)}))});break;case "setBoost":e="BOOST_MODE";f.writeValue(this.deviceIF,c,e,!0,function(a){a||f.updateStatusBuffer(g.deviceIF,
c,"CONTROL_MODE",3);b&&b(a)});break;case "tempUp":e="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,h){a?b&&b(a):h?(a=h.value+.5,30.5<a&&(a=30.5),f.writeValue(g.deviceIF,c,e,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":e="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,h){a?b&&b(a):h?(a=h.value-.5,4.5>a&&(a=4.5),f.writeValue(g.deviceIF,c,e,{type:"double",value:a},
b)):b&&b(Error("get current temp state result invalid"))});break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),e="SET_TEMPERATURE",f.writeValue(this.deviceIF,c,e,{type:"double",value:a},b)):b&&b(Error("no such command"))}};v.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,
c));if(g!=e)return null;c={};if(0==f)return c["0_"+a.toLowerCase()]=b,c;if(f==this.channel){switch(a){case "CONTROL_MODE":switch(b){case 0:c.mode="auto";break;case 1:c.mode="manu";break;case 2:c.mode="party";break;case 3:c.mode="boost"}break;case "FAULT_REPORTING":switch(b){case 0:c.error="no_error";break;case 1:c.error="valve_tight";break;case 2:c.error="ADJUSTING_RANGE_TOO_LARGE";break;case 3:c.error="ADJUSTING_RANGE_TOO_SMALL";break;case 4:c.error="comm_error";break;case 5:c.error="";break;case 6:c.error=
"lowbat";break;case 7:c.error="VALVE_ERROR_POSITION"}break;case "BATTERY_STATE":c.batLvl=b;break;case "VALVE_STATE":c.valveLvl=b;break;case "BOOST_STATE":c.boostTime=b;break;case "ACTUAL_TEMPERATURE":c.act_temp=b;break;case "SET_TEMPERATURE":c.state=b;break;default:return null}return c}return null};var na=function(f,a,b){e.call(this,f,a,b);this.channel=4;this.legacyType="thermostat"};util.inherits(na,v);na.prototype._getReadableDpts=function(){var f=v.prototype._getReadableDpts.callback(this);f.push({channel:this.deviceAdr+
":"+this.channel,dpt:"WINDOW_STATE"});return f};na.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "window":a.dataPoint="WINDOW_STATE";break;default:return v.prototype._getDptFromRef.call(this,f)}return a};na.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c),e=f.substr(c+1),h=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(h=this.deviceAdr.substr(0,c));if(g!=h)return null;c=
{};if(0==e)return c["0_"+a.toLowerCase()]=b,c;if(e==this.channel)switch(a){case "WINDOW_STATE":return c.window=b?"closed":"open",c;default:return v.prototype.parseDptState.call(this,f,a,b)}else return null};var R=function(f,a,b){e.call(this,f,a,b);this.weatherChannel=1;this.thermoChannel=2;this.legacyType="wallthermo"};util.inherits(R,e);R.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});f.push({channel:this.deviceAdr+":0",dpt:"LOWBAT"});f.push({channel:this.deviceAdr+
":"+this.weatherChannel,dpt:"TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.weatherChannel,dpt:"HUMIDITY"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SETPOINT"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_COMMAND"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_DATA"});return f};R.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=a+":0";b.dataPoint="UNREACH";
break;case "lowbat":b.channel=a+":0";b.dataPoint="LOWBAT";break;case "temp":b.channel=a+":1";b.dataPoint="TEMPERATURE";break;case "hum":b.channel=a+":1";b.dataPoint="HUMIDITY";break;case "state":b.channel=a+":2";b.dataPoint="SETPOINT";break;case "adjusting_command":b.channel=a+":2";b.dataPoint="ADJUSTING_COMMAND";break;case "adjusting_data":b.channel=a+":2";b.dataPoint="ADJUSTING_DATA";break;default:return null}return b};R.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.thermoChannel;
switch(a){case "tempUp":var g="SETPOINT";f.getState({interface:this.deviceIF,channel:c,datapoint:g},function(a,e){a?b&&b(a):e?(a=e.value+.5,30<a&&(a=30),f.writeValue(self.deviceIF,c,g,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":g="SETPOINT";f.getState({interface:this.deviceIF,channel:c,datapoint:g},function(a,e){a?b&&b(a):e?(a=e.value-.5,6>a&&(a=6),f.writeValue(self.deviceIF,c,g,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});
break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),g="SETPOINT",f.writeValue(this.deviceIF,c,g,{type:"double",value:a},b)):b&&b(Error("no such command"))}};R.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);if(g!=this.deviceAdr)return null;g={};if(0==f)return"UNREACH"==a?g.timeout=b:"LOWBAT"==a?g.lowbat=b:g["0_"+a.toLowerCase()]=b,g;if("1"==f){switch(a){case "TEMPERATURE":g.temp=
b;break;case "HUMIDITY":g.hum=b}return g}if("2"==f){switch(a){case "SETPOINT":g.state=b;break;case "ADJUSTING_COMMAND":g.adjusting_command=b;break;case "ADJUSTING_DATA":g.adjusting_data=b}return g}return null};var S=function(f,a,b){e.call(this,f,a,b);this.thermoChannel=2;this.legacyType="wallthermostat"};util.inherits(S,e);S.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"CONTROL_MODE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,
dpt:"LOWBAT_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"COMMUNICATION_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"WINDOW_OPEN_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BATTERY_STATE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BOOST_STATE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_HUMIDITY"});
f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SET_TEMPERATURE"});return f};S.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.thermoChannel,dataPoint:null};switch(f){case "mode":a.dataPoint="CONTROL_MODE";break;case "lowbat":a.dataPoint="LOWBAT_REPORTING";break;case "comm":a.dataPoint="COMMUNICATION_REPORTING";break;case "window":a.dataPoint="WINDOW_OPEN_REPORTING";break;case "batLvl":a.dataPoint="BATTERY_STATE";break;case "boostTime":a.dataPoint="BOOST_STATE";
break;case "temp":a.dataPoint="ACTUAL_TEMPERATURE";break;case "hum":a.dataPoint="ACTUAL_HUMIDITY";break;case "state":a.dataPoint="SET_TEMPERATURE";break;default:return null}return a};S.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.thermoChannel,g=this;switch(a){case "setAuto":var e="AUTO_MODE";f.writeValue(this.deviceIF,c,e,!0,function(a){a||f.updateStatusBuffer(g.deviceIF,c,"CONTROL_MODE",0);b&&b(a)});break;case "setManu":e="SET_TEMPERATURE";f.getState({interface:this.deviceIF,
channel:c,datapoint:e},function(a,h){a?b&&b(a):(e="MANU_MODE",f.writeValue(g.deviceIF,c,e,{type:"double",value:h.value},function(a){a||f.updateStatusBuffer(g.deviceIF,c,"CONTROL_MODE",1);b&&b(a)}))});break;case "setBoost":e="BOOST_MODE";f.writeValue(this.deviceIF,c,e,!0,function(a){a||f.updateStatusBuffer(g.deviceIF,c,"CONTROL_MODE",3);b&&b(a)});break;case "tempUp":e="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,h){a?b&&b(a):h?(a=h.value+.5,30.5<a&&(a=30.5),
f.writeValue(g.deviceIF,c,e,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":e="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,h){a?b&&b(a):h?(a=h.value-.5,4.5>a&&(a=4.5),f.writeValue(g.deviceIF,c,e,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),
e="SET_TEMPERATURE",f.writeValue(this.deviceIF,c,e,{type:"double",value:a},b)):"setWeekProfile"==a.substr(0,14)?(a=parseInt(a.substr(14)),f.setParamset(this.deviceIF,this.deviceAdr,"MASTER",{WEEK_PROGRAM_POINTER:a-1},function(a){b&&b(a)})):b&&b(Error("no such command"))}};S.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);if(g!=this.deviceAdr)return null;g={};if(0==f)return g["0_"+a.toLowerCase()]=b,g;if("2"==f){switch(a){case "CONTROL_MODE":switch(b){case 0:g.mode=
"auto";break;case 1:g.mode="manu";break;case 2:g.mode="party";break;case 3:g.mode="boost"}break;case "LOWBAT_REPORTING":g.lowbat=b;break;case "COMMUNICATION_REPORTING":g.comm=b;break;case "WINDOW_OPEN_REPORTING":g.window=b;break;case "BATTERY_STATE":g.batLvl=b;break;case "BOOST_STATE":g.boostTime=b;break;case "ACTUAL_TEMPERATURE":g.temp=b;break;case "ACTUAL_HUMIDITY":g.hum=b;break;case "SET_TEMPERATURE":g.state=b}return g}return null};var oa=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType=
"contact"};util.inherits(oa,e);oa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};oa.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint=
"STATE";break;case "error":a.dataPoint="ERROR";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};oa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":return{state:b?"open":"closed"};
case "ERROR":return{error:1==b?"sabotage":"no_error"};case "LOWBAT":return{lowbat:b};default:return null}};var T=function(f,a,b){e.call(this,f,a,b);this.rainChannel=1;this.heatChannel=2;this.legacyType="rain"};util.inherits(T,e);T.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.rainChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+
":"+this.heatChannel,dpt:"WORKING"}]};T.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "rain":b.channel=a+":"+this.rainChannel;b.dataPoint="STATE";break;case "heat":b.channel=a+":"+this.heatChannel;b.dataPoint="STATE";break;case "inhibit":b.channel=a+":"+this.heatChannel;b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.heatChannel;b.dataPoint="WORKING";break;default:return null}return b};
T.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.heatChannel&&(c+=":"+this.heatChannel);var g=this;switch(a){case "heaterOn":var e="STATE";f.writeValue(this.deviceIF,c,e,!0,b);break;case "heaterOff":e="STATE";f.writeValue(this.deviceIF,c,e,!1,b);break;case "heaterToggle":e="STATE";f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,h){a?b&&b(a):h?(a=!0,h.value&&(a=!1),f.writeValue(g.deviceIF,c,e,a,b)):b&&b(Error("get switch current value return invalid"))});
break;default:b&&b(Error("no such command"))}};T.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(1==f){switch(a){case "STATE":c.rain=1==b?"rain":"dry";break;default:return null}return c}if(2==f){switch(a){case "STATE":c.heat=b?"on":"off";break;case "INHIBIT":c.inhibit=
b;break;case "WORKING":c.working=b;break;default:return null}return c}};var F=function(f,a,b){e.call(this,f,a,b);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong2"};util.inherits(F,e);F.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.chimeChannel,
dpt:"STATE"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"WORKING"}]};F.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "led":b.channel=a+":"+this.ledChannel;b.dataPoint="STATE";break;case "led_inhibit":b.channel=a+":"+this.ledChannel;b.dataPoint="INHIBIT";break;case "led_working":b.channel=a+":"+this.ledChannel;b.dataPoint=
"WORKING";break;case "chime":b.channel=a+":"+this.chimeChannel;b.dataPoint="STATE";break;case "chime_inhibit":b.channel=a+":"+this.chimeChannel;b.dataPoint="INHIBIT";break;case "chime_working":b.channel=a+":"+this.chimeChannel;b.dataPoint="WORKING";break;default:return null}return b};F.prototype.executeCommand=function(f,a,b){switch(a){case "ledOn":a=this.deviceAdr+":"+this.ledChannel;f.writeValue(this.deviceIF,a,"STATE",!0,b);break;case "ledOff":a=this.deviceAdr+":"+this.ledChannel;f.writeValue(this.deviceIF,
a,"STATE",!1,b);break;case "chimeOn":a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"STATE",!0,b);break;case "chimeOff":a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"STATE",!1,b);break;default:b&&b(Error("no such command"))}};F.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=
{};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(1==f){switch(a){case "STATE":c.led=b?"on":"off";break;case "INHIBIT":c.led_inhibit=b;break;case "WORKING":c.led_working=b;break;default:return null}return c}if(2==f){switch(a){case "STATE":c.chime=b?"on":"off";break;case "INHIBIT":c.chime_inhibit=b;break;case "WORKING":c.chime_working=b;break;default:return null}return c}};var Ma=function(f,a,b){e.call(this,f,a,b);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong"};
util.inherits(Ma,F);Ma.prototype.executeCommand=function(f,a,b){if(0==a.indexOf("vChannel")){var c=a.substr(8);c=parseInt(c);a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"SUBMIT","0.8,1,5,"+c,b)}else if(0==a.indexOf("setChime")){var g=a.substr(8);parseInt(c);a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"SUBMIT",g,b)}else 0==a.indexOf("ledGreen")?((c=a.substr(8))||(c=10),a=this.deviceAdr+":"+this.ledChannel,f.writeValue(this.deviceIF,a,"SUBMIT","1,10,"+
c+",34",b)):0==a.indexOf("ledRed")?((c=a.substr(6))||(c=10),a=this.deviceAdr+":"+this.ledChannel,f.writeValue(this.deviceIF,a,"SUBMIT","1,10,"+c+",18",b)):F.prototype.executeCommand.call(this,f,a,b)};var pa=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="window"};util.inherits(pa,e);pa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"},
{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};pa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "error":a.dataPoint="ERROR";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};pa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=
this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":switch(b){case 0:c.state="closed";break;case 1:c.state="tilted";break;case 2:c.state="open"}break;case "ERROR":switch(b){case 0:c.error="no_error";break;case 1:case 7:c.error="sabotage"}break;case "LOWBAT":c.lowbat=b;break;default:return null}return c};var qa=function(f,a,b){e.call(this,f,a,b);this.channel=
1;this.legacyType="temp"};util.inherits(qa,e);qa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"}]};qa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint="TEMPERATURE";
break;default:return null}return a};qa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "TEMPERATURE":return{temp:parseFloat(b)};default:return null}};var ra=function(f,a,b){e.call(this,f,a,
b);this.temp1=1;this.temp2=2;this.tempDiff12=3;this.tempDiff21=4;this.legacyType="temp2"};util.inherits(ra,e);ra.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.temp1,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.temp1,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.temp2,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff12,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff21,dpt:"TEMPERATURE"}]};ra.prototype._getDptFromRef=
function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "lowbat":a.channel=this.temp1;a.dataPoint="LOWBAT";break;case "temp1":a.channel=this.temp1;a.dataPoint="TEMPERATURE";break;case "temp2":a.channel=this.temp2;a.dataPoint="TEMPERATURE";break;case "tempDiff12":a.channel=this.tempDiff12;a.dataPoint="TEMPERATURE";break;case "tempDiff21":a.channel=this.tempDiff21;a.dataPoint="TEMPERATURE";break;default:return null}return a};
ra.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LOWBAT":return{lowbat:b};case "TEMPERATURE":return 1==f?{temp1:parseFloat(b)}:2==f?{temp2:parseFloat(b)}:3==f?{tempDiff12:parseFloat(b)}:4==f?{tempDiff21:parseFloat(b)}:null;default:return null}};
var sa=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="co2"};util.inherits(sa,e);sa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};sa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;default:return null}return a};sa.prototype.parseDptState=
function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":switch(b){case 0:c.state="normal";break;case 1:c.state="medium";break;case 2:c.state="high"}break;default:return null}return c};var ta=function(f,a,b){e.call(this,f,a,b);this.channel=
1;this.legacyType="motion"};util.inherits(ta,e);ta.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"},{channel:this.deviceAdr+":"+this.channel,dpt:"MOTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};ta.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint=
"LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "bri":a.dataPoint="BRIGHTNESS";break;case "state":a.dataPoint="MOTION";break;case "error":a.dataPoint="ERROR";break;default:return null}return a};ta.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==
a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "BRIGHTNESS":c.bri=b;break;case "MOTION":c.state=b?"motion":"ok";break;case "ERROR":c.error=b?"sabotage":"no_error";break;default:return null}return c};var ua=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="smoke"};util.inherits(ua,e);ua.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,
dpt:"STATE"}]};ua.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;default:return null}return a};ua.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,
c));if(g!=e||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":c.state=b?"smoke":"ok";break;default:return null}return c};var U=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="siren"};util.inherits(U,e);U.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,
dpt:"ERROR_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_BATTERY"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};U.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint=
"STATE";break;case "error_power":a.dataPoint="ERROR_POWER";break;case "error_sabotage":a.dataPoint="ERROR_SABOTAGE";break;case "error_battery":a.dataPoint="ERROR_BATTERY";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;default:return null}return a};U.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.channel,g=this;switch(a){case "on":var e="STATE";f.writeValue(this.deviceIF,c,e,!0,b);break;case "off":e="STATE";f.writeValue(this.deviceIF,
c,e,!1,b);break;case "toggle":e="STATE";f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,h){a?b&&b(a):(a=!0,h.value&&(a=!1),f.writeValue(g.deviceIF,c,e,a,b))});break;default:b&&b(Error("no such command"))}};U.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==
a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":c.state=b?"on":"off";break;case "ERROR_POWER":c.error_power=b?"power_failure":"no_error";break;case "ERROR_SABOTAGE":c.error_sabotage=b?"sabotage":"no_error";break;case "ERROR_BATTERY":c.error_battery=b?"battery_defect":"no_error";break;case "INHIBIT":c.inhibit=b;break;case "WORKING":c.working=b;break;default:return null}return c};var va=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="capacity"};util.inherits(va,e);
va.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"FILLING_LEVEL"}]};va.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="FILLING_LEVEL";break;default:return null}return a};va.prototype.parseDptState=
function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "FILLING_LEVEL":c.state=b;break;default:return null}return c};var N=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="switch_interface"};util.inherits(N,
e);N.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};N.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};N.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==
c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "PRESS":return{press:b};default:return null}};N.prototype.isButton=function(){return!0};N.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);f.reportValueUsage(this.deviceIF,
b,"PRESS",function(b,f){b&&console.error("switch interface claim PRESS event error:"+b.stack);a&&a()})};var wa=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="tilt"};util.inherits(wa,e);wa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};wa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};wa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":c.state=
b?"open":"closed";break;case "LOWBAT":c.lowbat=b;break;default:return null}return c};var xa=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="water"};util.inherits(xa,e);xa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};xa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};xa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":switch(b){case 0:c.state=
"ok";break;case 1:c.state="moist";break;case 2:c.state="water"}break;case "LOWBAT":c.lowbat=b;break;default:return null}return c};var ya=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="energymeter"};util.inherits(ya,e);ya.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BOOT"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_ENERGY_COUNTER"},{channel:this.deviceAdr+
":"+this.channel,dpt:"GAS_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ENERGY_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"POWER"}]};ya.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "boot":a.dataPoint="BOOT";break;case "gas_energy":a.dataPoint="GAS_ENERGY_COUNTER";break;case "gas_power":a.dataPoint="GAS_POWER";
break;case "energy":a.dataPoint="ENERGY_COUNTER";break;case "power":a.dataPoint="POWER";break;default:return null}return a};ya.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "BOOT":c.boot=
b;break;case "GAS_ENERGY_COUNTER":c.gas_energy=b;break;case "GAS_POWER":c.gas_power=b;break;case "ENERGY_COUNTER":c.energy=b;break;case "POWER":c.power=b;break;default:return null}return c};var O=function(f,a,b){e.call(this,f,a,b);this.dimChannel=1;this.rgbChannel=2;this.autoChannel=3;this.legacyType="rgb"};util.inherits(O,e);O.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.dimChannel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+
this.rgbChannel,dpt:"COLOR"},{channel:this.deviceAdr+":"+this.autoChannel,dpt:"PROGRAM"}]};O.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.channel=a+":"+this.dimChannel;b.dataPoint="LEVEL";break;case "color":b.channel=a+":"+this.rgbChannel;b.dataPoint="COLOR";break;case "program":b.channel=a+":"+this.autoChannel;b.dataPoint="PROGRAM";break;case "inhibit":b.channel=a+":"+this.dimChannel;
b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.dimChannel;b.dataPoint="WORKING";break;case "direction":b.channel=a+":"+this.dimChannel;b.dataPoint="DIRECTION";break;default:return null}return b};O.prototype.executeCommand=function(f,a,b){var c=this;switch(a){case "on":var g=this.deviceAdr+":"+this.dimChannel;var e="OLD_LEVEL";f.writeValue(this.deviceIF,g,e,!0,b);break;case "off":g=this.deviceAdr+":"+this.dimChannel;e="LEVEL";f.writeValue(this.deviceIF,g,e,{type:"double",value:0},
b);break;case "white":g=this.deviceAdr+":"+this.rgbChannel;e="COLOR";f.writeValue(this.deviceIF,g,e,200,b);break;case "dimUp":g=this.deviceAdr+":"+this.dimChannel;e="LEVEL";f.getState({interface:this.deviceIF,channel:g,datapoint:e},function(a,h){a?b&&b(a):h?(a=h.value+.05,1<a&&(a=1),f.writeValue(c.deviceIF,g,e,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});break;case "dimDown":g=this.deviceAdr+":"+this.dimChannel;e="LEVEL";f.getState({interface:this.deviceIF,
channel:g,datapoint:e},function(a,h){a?b&&b(a):h?(a=h.value-.05,0>a&&(a=0),f.writeValue(c.deviceIF,g,e,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});break;default:if("onTo"==a.substr(0,4)||a.match(/^[-+]?[0-9]+$/)){"onTo"==a.substr(0,4)&&(a=a.substr(4));var h=parseInt(a);g=this.deviceAdr+":"+this.dimChannel;e="LEVEL";f.writeValue(this.deviceIF,g,e,{type:"double",value:h/100},b)}else if("setProg"==a.substr(0,7))a=a.substr(7),h=parseInt(a),g=this.deviceAdr+":"+
this.autoChannel,e="PROGRAM",f.writeValue(this.deviceIF,g,e,h,b);else if("setRampTime"==a.substr(0,11))a=a.substr(11),h=parseFloat(a),g=this.deviceAdr+":"+this.dimChannel,e="RAMP_TIME",f.writeValue(this.deviceIF,g,e,{type:"double",value:h},b);else if(a.toLowerCase().match(/^([0-9a-f]{6})$/i)){h=parseInt(a.substr(0,2),16);var k=parseInt(a.substr(2,2),16);a=parseInt(a.substr(4,2),16);var l=0;h=this._RGBToHSV(h,k,a);l=.1>h[1]?200:Math.round(h[0]/1.8);g=this.deviceAdr+":"+this.rgbChannel;e="COLOR";f.writeValue(this.deviceIF,
g,e,l,b)}else b&&b(Error("no such command"))}};O.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.dimChannel&&f!=this.rgbChannel&&f!=this.autoChannel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LEVEL":c.state=100*parseFloat(b);break;case "COLOR":c.color=b;break;case "PROGRAM":c.program=
b;break;case "INHIBIT":c.inhibit=b;break;case "WORKING":c.working=b;break;case "DIRECTION":c.direction=b;break;default:return null}return c};O.prototype._RGBToHSV=function(f,a,b){f/=255;a/=255;b/=255;var c=Math.min(f,Math.min(a,b)),g=Math.max(f,Math.max(a,b));return c==g?[0,0,c]:[60*((f==c?3:b==c?1:5)-(f==c?a-b:b==c?f-a:b-f)/(g-c)),(g-c)/g,g]};var za=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="lux"};util.inherits(za,e);za.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+
":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LUX"}]};za.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LUX";break;default:return null}return a};za.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,
c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LUX":c.state=b;break;default:return null}return c};var V=function(f,a,b){e.call(this,f,a,b);this.swChannel1=1;this.swChannel2=2;this.panicChannel=3;this.armingChannel=4;this.legacyType="siren2"};util.inherits(V,e);V.prototype._getReadableDpts=
function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.swChannel1,dpt:"STATE"},{channel:this.deviceAdr+":"+this.swChannel2,dpt:"STATE"},{channel:this.deviceAdr+":"+this.panicChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ARMSTATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+
":"+this.armingChannel,dpt:"LOWBAT"}]};V.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "switchSensorInState":b.channel=a+":"+this.swChannel1;b.dataPoint="STATE";break;case "switchSensorExState":b.channel=a+":"+this.swChannel2;b.dataPoint="STATE";break;case "switchPanicState":b.channel=a+":"+this.panicChannel;b.dataPoint="STATE";break;case "arming":b.channel=a+":"+this.armingChannel;b.dataPoint=
"ARMSTATE";break;case "inhibit":b.channel=a+":"+this.armingChannel;b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.armingChannel;b.dataPoint="WORKING";break;case "sabotage":b.channel=a+":"+this.armingChannel;b.dataPoint="ERROR_SABOTAGE";break;case "lowbat":b.channel=a+":"+this.armingChannel;b.dataPoint="LOWBAT";break;default:return null}return b};V.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;
c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(1==f){switch(a){case "STATE":c.switchSensorInState=b?"on":"off";break;default:return null}return c}if(2==f){switch(a){case "STATE":c.switchSensorExState=b?"on":"off";break;default:return null}return c}if(3==f){switch(a){case "STATE":c.switchPanicState=b?"on":"off";break;default:return null}return c}if(4==f){switch(a){case "ARMSTATE":switch(b){case 0:c.arming=
"disarmed";break;case 1:c.arming="ex_armed";break;case 2:c.arming="all_armed";break;case 3:c.arming="blocked"}break;case "INHIBIT":c.inhibit=b;break;case "WORKING":c.working=b;break;case "ERROR_SABOTAGE":switch(b){case 0:c.sabotage="no_error";break;case 1:c.sabotage="ex_armed"}break;case "LOWBAT":c.lowbat=b;break;default:return null}return c}};V.prototype.executeCommand=function(f,a,b){var c=this;switch(a){case "switchSensorInOn":var g="STATE";var e=this.deviceAdr+":"+this.swChannel1;f.writeValue(this.deviceIF,
e,g,!0,b);break;case "switchSensorInOff":g="STATE";e=this.deviceAdr+":"+this.swChannel1;f.writeValue(this.deviceIF,e,g,!1,b);break;case "switchSensorInToggle":g="STATE";e=this.deviceAdr+":"+this.swChannel1;f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(a,h){a?b&&b(a):(a=!0,h.value&&(a=!1),f.writeValue(c.deviceIF,e,g,a,b))});break;case "switchSensorExOn":g="STATE";e=this.deviceAdr+":"+this.swChannel2;f.writeValue(this.deviceIF,e,g,!0,b);break;case "switchSensorExOff":g="STATE";
e=this.deviceAdr+":"+this.swChannel2;f.writeValue(this.deviceIF,e,g,!1,b);break;case "switchSensorExToggle":g="STATE";e=this.deviceAdr+":"+this.swChannel2;f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(a,h){a?b&&b(a):(a=!0,h.value&&(a=!1),f.writeValue(c.deviceIF,e,g,a,b))});break;case "switchPanicOn":g="STATE";e=this.deviceAdr+":"+this.panicChannel;f.writeValue(this.deviceIF,e,g,!0,b);break;case "switchPanicOff":g="STATE";e=this.deviceAdr+":"+this.panicChannel;f.writeValue(this.deviceIF,
e,g,!1,b);break;case "switchPanicToggle":g="STATE";e=this.deviceAdr+":"+this.panicChannel;f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(a,h){a?b&&b(a):(a=!0,h.value&&(a=!1),f.writeValue(c.deviceIF,e,g,a,b))});break;case "armingDisarm":g="ARMSTATE";e=this.deviceAdr+":"+this.armingChannel;f.writeValue(this.deviceIF,e,g,0,b);break;case "armingIntern":g="ARMSTATE";e=this.deviceAdr+":"+this.armingChannel;f.writeValue(this.deviceIF,e,g,1,b);break;case "armingAll":g="ARMSTATE";e=this.deviceAdr+
":"+this.armingChannel;f.writeValue(this.deviceIF,e,g,2,b);break;default:b&&b(Error("no such command"))}};var W=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="jalousie"};util.inherits(W,e);W.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});(b=b.JALOUSIE.getReadableDpts())&&b.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};W.prototype._getDptFromRef=function(f){var a=
this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["BidCos-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint="UNREACH";break;default:if(b.channel=a+":"+this.channel,b.dataPoint=c.JALOUSIE.getDptFromState(f),!b.dataPoint)return null}return b};W.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["BidCos-RF"].JALOUSIE.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};W.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==
c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==a)return{timeout:b};c={};c["0_"+a.toLowerCase()]=b;return c}return f==this.channel?c.JALOUSIE.parseDptState(a,b):null};var G=function(f,a,b){e.call(this,f,a,b);this.keyChannel1=1;this.keyChannel2=2;this.em8bitChannel=3;this.legacyType="mod_em_8bit"};util.inherits(G,e);G.prototype._getReadableDpts=
function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});var c=b.KEY.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b});f.push({channel:a.deviceAdr+":2",dpt:b})});(c=b.MOD_EM8BIT_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};G.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=
a+":0";b.dataPoint="UNREACH";break;case "lowbat":b.channel=a+":3";b.dataPoint="LOWBAT";break;case "state8bit":b.channel=a+":3";b.dataPoint="STATE";break;default:return null}return b};G.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "ch1pressShort":a=this.deviceAdr+":"+this.keyChannel1;c.KEY.executeCommand(f,this.deviceIF,a,"pressShort",b);break;case "ch1pressLong":a=this.deviceAdr+":"+this.keyChannel1;c.KEY.executeCommand(f,this.deviceIF,a,"pressLong",
b);break;case "ch2pressShort":a=this.deviceAdr+":"+this.keyChannel2;c.KEY.executeCommand(f,this.deviceIF,a,"pressShort",b);break;case "ch2pressLong":a=this.deviceAdr+":"+this.keyChannel2;c.KEY.executeCommand(f,this.deviceIF,a,"pressLong",b);break;default:b&&b(Error("no such command"))}};G.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=
e)return null;g=x.hub.m.hm._Channel["BidCos-RF"];c=null;if(0==f){if("UNREACH"==a)return{timeout:b};c={};c["0_"+a.toLowerCase()]=b;return c}if(f==this.keyChannel1){if(a=g.KEY.parseDptState(a,b))c={},a.pressShort&&(c.ch1pressShort=!0),a.pressLong&&(c.ch1pressLong=!0),"undefined"!=typeof a.pressCont&&null!=a.pressCont&&(c.ch1pressCont=!0),a.pressLongRel&&(c.ch1pressLongRel=!0);return c}if(f==this.keyChannel2){if(a=g.KEY.parseDptState(a,b))c={},a.pressShort&&(c.ch2pressShort=!0),a.pressLong&&(c.ch2pressLong=
!0),"undefined"!=typeof a.pressCont&&null!=a.pressCont&&(c.ch2pressCont=!0),a.pressLongRel&&(c.ch2pressLongRel=!0);return c}return f==this.em8bitChannel?g.MOD_EM8BIT_TRANSMITTER.parseDptState(a,b):null};G.prototype.isButton=function(){return!0};G.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,b+":1","PRESS_SHORT",function(g,e){g&&console.error("button claim PRESS_SHORT event error:"+g.stack);
f.reportValueUsage(c.deviceIF,b+":1","PRESS_LONG",function(g,e){g&&console.error("button claim PRESS_LONG event error:"+g.stack);f.reportValueUsage(c.deviceIF,b+":2","PRESS_SHORT",function(g,e){g&&console.error("button claim PRESS_SHORT event error:"+g.stack);f.reportValueUsage(c.deviceIF,b+":2","PRESS_LONG",function(b,c){a&&a()})})})})};var H=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="mod_em_8"};util.inherits(H,e);H.prototype._getReadableDpts=function(){var f=[],a=this,b=
x.hub.m.hm._Channel["BidCos-RF"],c=b.KEY.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});(c=b.SWITCH_INTERFACE.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});(c=b.SHUTTER_CONTACT.getReadableDpts())&&c.forEach(function(b){"ERROR"!=b&&f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};H.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "state":a.dataPoint=
"STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};H.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"],g=this.deviceAdr+":"+this.channel;switch(a){case "pressShort":c.KEY.executeCommand(f,this.deviceIF,g,"pressShort",b);break;case "pressLong":c.KEY.executeCommand(f,this.deviceIF,g,"pressLong",b);break;case "press":c.SWITCH_INTERFACE.executeCommand(f,this.deviceIF,g,"press",b);break;default:b&&b(Error("no such command"))}};H.prototype.parseDptState=
function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["BidCos-RF"];g=null;if(f==this.channel){g={};if(f=c.KEY.parseDptState(a,b))f.pressShort&&(g.pressShort=!0),f.pressLong&&(g.pressLong=!0),"undefined"!=typeof f.pressCont&&null!=f.pressCont&&(g.pressCont=!0),f.pressLongRel&&(g.pressCont=!0);(f=c.SWITCH_INTERFACE.parseDptState(a,
b))&&f.press&&(g.press=!0);if(f=c.SHUTTER_CONTACT.parseDptState(a,b))f.state&&(g.state=f.state),"undefined"!=typeof f.lowbat&&null!=f.lowbat&&(g.lowbat=f.lowbat)}return g};H.prototype.isButton=function(){return!0};H.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(g,e){g&&console.error("button claim PRESS_SHORT event error:"+g.stack);f.reportValueUsage(c.deviceIF,b,"PRESS_LONG",
function(g,e){g&&console.error("button claim PRESS_LONG event error:"+g.stack);f.reportValueUsage(c.deviceIF,b,"PRESS",function(b,c){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);a&&a()})})})};var X=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="keymatic"};util.inherits(X,e);X.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});
(c=b.KEYMATIC.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};X.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=a+":0";b.dataPoint="UNREACH";break;case "lowbat":b.channel=a+":0";b.dataPoint="LOWBAT";break;case "state":b.channel=a+":1";b.dataPoint="STATE";break;case "uncertain":b.channel=a+":1";b.dataPoint="STATE_UNCERTAIN";break;case "error":b.channel=a+":1";b.dataPoint=
"ERROR";break;default:return null}return b};X.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "open":a=this.deviceAdr+":"+this.channel;c.KEYMATIC.executeCommand(f,this.deviceIF,a,"open",b);break;case "close":a=this.deviceAdr+":"+this.channel;c.KEYMATIC.executeCommand(f,this.deviceIF,a,"close",b);break;case "openDoor":a=this.deviceAdr+":"+this.channel;c.KEYMATIC.executeCommand(f,this.deviceIF,a,"openDoor",b);break;default:b&&b(Error("no such command"))}};
X.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==a||"LOWBAT"==a)return c.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return f==this.channel?a=c.KEYMATIC.parseDptState(a,b):null};var I=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType=
"ou_led16"};util.inherits(I,e);I.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this.channel,dpt:"LED_STATUS"}]};I.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "led":a.dataPoint="LED_STATUS";break;default:return null}return a};I.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;
c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LED_STATUS":switch(b){case 0:return{led:"off"};case 1:return{led:"red"};case 2:return{led:"green"};case 3:return{led:"orange"};default:return null}default:return null}};I.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);
switch(a){case "pressShort":f.writeValue(this.deviceIF,c,"PRESS_SHORT",!0,b);break;case "ledOff":f.writeValue(this.deviceIF,c,"LED_STATUS",0,b);break;case "ledRed":f.writeValue(this.deviceIF,c,"LED_STATUS",1,b);break;case "ledGreen":f.writeValue(this.deviceIF,c,"LED_STATUS",2,b);break;case "ledOrange":f.writeValue(this.deviceIF,c,"LED_STATUS",3,b);break;case "ledSleepOff":f.writeValue(this.deviceIF,c,"LED_SLEEP_MODE",0,b);break;case "ledSleepOn":f.writeValue(this.deviceIF,c,"LED_SLEEP_MODE",1,b);
break;default:b&&b(Error("no such command"))}};I.prototype.isButton=function(){return!0};I.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(b,f){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);a&&a()})};var Na=function(f,a,b){e.call(this,f,a,b);this.channel=3;this.legacyType="hm_dis_ep_wm55"};util.inherits(Na,e);Na.prototype.executeCommand=function(f,a,b){if("submit"==
a.substr(0,6)){var c=a.substr(6);a=this.deviceAdr+":"+this.channel;f.writeValue(this.deviceIF,a,"SUBMIT",c,b)}else b&&b(Error("no such command"))};var Y=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="dualwhite"};util.inherits(Y,e);Y.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.DUAL_WHITE_BRIGHTNESS.getReadableDpts())&&
c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});(c=b.DUAL_WHITE_COLOR.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b})});return f};Y.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["BidCos-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "bri":case "bri_real":case "error_overheat":case "error_reduced":case "direction":b.channel=
a+":1";b.dataPoint=c.DUAL_WHITE_BRIGHTNESS.getDptFromState(f);break;case "color":case "color_real":case "color_direction":b.channel=a+":2";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState(f);break;default:return null}return b};Y.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "off":case "on":case "toggle":case "dimUp":case "dimDown":c.DUAL_WHITE_BRIGHTNESS.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b);break;case "colorOff":case "colorOn":case "colorToggle":case "colorUp":case "colorDown":c.DUAL_WHITE_COLOR.executeCommand(f,
this.deviceIF,this.deviceAdr+":2",a,b);break;default:"dimTo"==a.substr(0,5)?c.DUAL_WHITE_BRIGHTNESS.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b):"colorTo"==a.substr(0,7)?c.DUAL_WHITE_COLOR.executeCommand(f,this.deviceIF,this.deviceAdr+":2",a,b):b&&b(Error("no such command"))}};Y.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=
e)return null;c=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==a)return c.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.DUAL_WHITE_BRIGHTNESS.parseDptState(a,b):2==f?c.DUAL_WHITE_COLOR.parseDptState(a,b):null};var Pa=function(f,a,b){h.call(this,f,a,b);this.channel=3;this.legacyType="ip_switch"};util.inherits(Pa,h);var Aa=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_contact"};util.inherits(Aa,e);Aa.prototype._getReadableDpts=
function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SHUTTER_CONTACT_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Aa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":b.channel=a+":1";b.dataPoint=c.SHUTTER_CONTACT_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};Aa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==
a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.SHUTTER_CONTACT_TRANSCEIVER.parseDptState(a,b):null};var Z=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_heater"};util.inherits(Z,e);Z.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&
c.forEach(function(b){"HUMIDITY"!=b&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Z.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "mode":case "state":case "window":b.channel=a+":1";b.dataPoint=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(f);
break;default:return null}return b};Z.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};Z.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];g=null;if(0==f){if("UNREACH"==
a||"LOW_BAT"==a)return c.MAINTENANCE.parseDptState(a,b);g={};g["0_"+a.toLowerCase()]=b;return g}return 1==f?c.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,b):g};var aa=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_powerswitch"};util.inherits(aa,e);aa.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&
c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":6",dpt:b})});return f};aa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "switchState":b.channel=a+":3";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=a+":6";b.dataPoint=c.ENERGIE_METER_TRANSMITTER.getDptFromState(f);break;default:return null}return b};aa.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":var g=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,g,"on",b);break;case "off":g=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,
g,"off",b);break;case "toggle":g=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,g,"toggle",b);break;default:"onFor"==a.substr(0,5)?(g=this.deviceAdr+":3",c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,g,a,b)):b&&b(Error("no such command"))}};aa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;
c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a)return c.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 3==f?c.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b):6==f?c.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var ba=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_energyactor"};util.inherits(ba,e);ba.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==
b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SWITCH_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b});f.push({channel:a.deviceAdr+":6",dpt:b})});(c=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":7",dpt:b})});return f};ba.prototype._getDptFromRef=
function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "switchState":b.channel=a+":3";b.dataPoint=c.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case "ch4State":b.channel=a+":4";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch5State":b.channel=a+":5";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "ch6State":b.channel=a+":6";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=a+":7";b.dataPoint=c.ENERGIE_METER_TRANSMITTER.getDptFromState(f);break;default:return null}return b};ba.prototype.executeCommand=function(f,a,b){var c=null,g=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":case "ch4on":case "ch5on":case "ch6on":switch(a){case "on":case "ch4on":c=
this.deviceAdr+":4";break;case "ch5on":c=this.deviceAdr+":5";break;case "ch6on":c=this.deviceAdr+":6"}g.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"on",b);break;case "off":case "ch4off":case "ch5off":case "ch6off":switch(a){case "off":case "ch4off":c=this.deviceAdr+":4";break;case "ch5off":c=this.deviceAdr+":5";break;case "ch6off":c=this.deviceAdr+":6"}g.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"off",b);break;case "toggle":case "ch4toggle":case "ch5toggle":case "ch6toggle":switch(a){case "toggle":case "ch4toggle":c=
this.deviceAdr+":4";break;case "ch5toggle":c=this.deviceAdr+":5";break;case "ch6toggle":c=this.deviceAdr+":6"}g.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"toggle",b);break;default:b&&b(Error("no such command"))}};ba.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==
f){if("UNREACH"==a)return g.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==f){if(a=g.SWITCH_TRANSMITTER.parseDptState(a,b))c={},c.switchState=a.switchTState;return c}if(4==f||5==f||6==f){if(a=g.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 4:c.ch4State=a.switchState;break;case 5:c.ch5State=a.switchState;break;case 6:c.ch6State=a.switchState}return c}return 7==f?g.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var ca=function(f,a,b){e.call(this,
f,a,b);this.channel=1;this.legacyType="ip_energyactor2"};util.inherits(ca,e);ca.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SWITCH_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b});
f.push({channel:a.deviceAdr+":3",dpt:b});f.push({channel:a.deviceAdr+":4",dpt:b})});(c=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":5",dpt:b})});return f};ca.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "switchState":b.channel=a+":1";b.dataPoint=c.SWITCH_TRANSMITTER.getDptFromState("switchTState");
break;case "ch2State":b.channel=a+":2";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch3State":b.channel=a+":3";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":b.channel=a+":4";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=a+":5";b.dataPoint=c.ENERGIE_METER_TRANSMITTER.getDptFromState(f);
break;default:return null}return b};ca.prototype.executeCommand=function(f,a,b){var c=null,g=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":case "ch2on":case "ch3on":case "ch4on":switch(a){case "on":case "ch2on":c=this.deviceAdr+":2";break;case "ch3on":c=this.deviceAdr+":3";break;case "ch4on":c=this.deviceAdr+":4"}g.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"on",b);break;case "off":case "ch2off":case "ch3off":case "ch4off":switch(a){case "off":case "ch2off":c=this.deviceAdr+":2";
break;case "ch3off":c=this.deviceAdr+":3";break;case "ch4off":c=this.deviceAdr+":4"}g.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"off",b);break;case "toggle":case "ch2toggle":case "ch3toggle":case "ch4toggle":switch(a){case "toggle":case "ch2toggle":c=this.deviceAdr+":2";break;case "ch3toggle":c=this.deviceAdr+":3";break;case "ch4toggle":c=this.deviceAdr+":4"}g.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"toggle",b);break;default:b&&b(Error("no such command"))}};ca.prototype.parseDptState=
function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a)return g.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f){if(a=g.SWITCH_TRANSMITTER.parseDptState(a,b))c={},c.switchState=a.switchTState;return c}if(2==f||3==f||4==f){if(a=g.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,
b))switch(c={},parseInt(f)){case 2:c.ch2State=a.switchState;break;case 3:c.ch3State=a.switchState;break;case 4:c.ch4State=a.switchState}return c}return 5==f?g.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var da=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_dimmer"};util.inherits(da,e);da.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+
":0",dpt:b})});(c=b.DIMMER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b});f.push({channel:a.deviceAdr+":6",dpt:b})});return f};da.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":b.channel=a+":3";b.dataPoint=c.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch5Level":b.channel=a+":5";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":b.channel=a+":6";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return b};
da.prototype.executeCommand=function(f,a,b){var c=null,g=x.hub.m.hm._Channel["HmIP-RF"],e=a;if(-1!=a.indexOf("dimUp")){var h=a.indexOf("dimUp");e=a.substr(0,h+5);var k=a.substr(h+5)}else-1!=a.indexOf("dimDown")?(h=a.indexOf("dimDown"),e=a.substr(0,h+7),k=a.substr(h+7)):-1!=a.indexOf("dimTo")?(h=a.indexOf("dimTo"),e=a.substr(0,h+5),k=a.substr(h+5)):-1!=a.indexOf("toggleTo")&&(h=a.indexOf("toggleTo"),e=a.substr(0,h+8),k=a.substr(h+8));var l=this;switch(e){case "dimOff":g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","dimOff",function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimOff",function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimOff",b)})});break;case "dimUp":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value+
k,1<k&&(k=1),k=Math.round(100*k),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+k,b)})}))});break;case "dimDown":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==
typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value-k,0>k&&(k=0),k=Math.round(100*k),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+k,b)})}))});break;case "dimTo":if(!k){b&&b(Error("dimTo has no value"));break}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!k){b&&b(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(c.value&&(k=0),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+k,b)})}))});break;case "ch4dimOff":case "ch5dimOff":case "ch6dimOff":switch(e){case "ch4dimOff":c=
this.deviceAdr+":4";break;case "ch5dimOff":c=this.deviceAdr+":5";break;case "ch6dimOff":c=this.deviceAdr+":6"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimOff",b);break;case "ch4dimUp":case "ch5dimUp":case "ch6dimUp":switch(e){case "ch4dimUp":c=this.deviceAdr+":4";break;case "ch5dimUp":c=this.deviceAdr+":5";break;case "ch6dimUp":c=this.deviceAdr+":6"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimUp"+k,b);break;case "ch4dimDown":case "ch5dimDown":case "ch6dimDown":switch(e){case "ch4dimDown":c=
this.deviceAdr+":4";break;case "ch5dimDown":c=this.deviceAdr+":5";break;case "ch6dimDown":c=this.deviceAdr+":6"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimDown"+k,b);break;case "ch4dimTo":case "ch5dimTo":case "ch6dimTo":switch(e){case "ch4dimTo":c=this.deviceAdr+":4";break;case "ch5dimTo":c=this.deviceAdr+":5";break;case "ch6dimTo":c=this.deviceAdr+":6"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimTo"+k,b);break;case "ch4toggleTo":case "ch5toggleTo":case "ch6toggleTo":switch(e){case "ch4toggleTo":c=
this.deviceAdr+":4";break;case "ch5toggleTo":c=this.deviceAdr+":5";break;case "ch6toggleTo":c=this.deviceAdr+":6"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"toggleTo"+k,b);break;default:b&&b(Error("no such command"))}};da.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=
null;if(0==f){if("UNREACH"==a)return g.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==f){if(a=g.DIMMER_TRANSMITTER.parseDptState(a,b))c={},c.dimmerLevel=a.dimmerTLevel;return c}if(4==f||5==f||6==f){if(a=g.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 4:c.ch4Level=a.dimmerLevel;break;case 5:c.ch5Level=a.dimmerLevel;break;case 6:c.ch6Level=a.dimmerLevel}return c}return null};var ea=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType=
"ip_dimmer2"};util.inherits(ea,e);ea.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.DIMMER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b})});(c=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b});f.push({channel:a.deviceAdr+":4",dpt:b});
f.push({channel:a.deviceAdr+":5",dpt:b})});return f};ea.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":b.channel=a+":2";b.dataPoint=c.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":b.channel=a+":3";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;
case "ch5Level":b.channel=a+":4";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":b.channel=a+":5";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return b};ea.prototype.executeCommand=function(f,a,b){var c=null,g=x.hub.m.hm._Channel["HmIP-RF"],e=a;if(-1!=a.indexOf("dimUp")){var h=a.indexOf("dimUp");e=a.substr(0,h+5);var k=a.substr(h+5)}else-1!=a.indexOf("dimDown")?(h=a.indexOf("dimDown"),e=a.substr(0,h+7),k=
a.substr(h+7)):-1!=a.indexOf("dimTo")?(h=a.indexOf("dimTo"),e=a.substr(0,h+5),k=a.substr(h+5)):-1!=a.indexOf("toggleTo")&&(h=a.indexOf("toggleTo"),e=a.substr(0,h+8),k=a.substr(h+8));var l=this;switch(e){case "dimOff":g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3","dimOff",function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimOff",function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":5","dimOff",b)})});break;case "dimUp":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value+k,1<k&&(k=1),k=Math.round(100*k),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?
b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,b)})}))});break;case "dimDown":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value-k,0>k&&(k=0),k=Math.round(100*k),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,b)})}))});break;case "dimTo":if(!k){b&&b(Error("dimTo has no value"));break}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":5","dimTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":2","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!k){b&&b(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(c.value&&(k=0),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,
l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,b)})}))});break;case "ch3dimOff":case "ch4dimOff":case "ch5dimOff":switch(e){case "ch3dimOff":c=this.deviceAdr+":3";break;case "ch4dimOff":c=this.deviceAdr+":4";break;case "ch5dimOff":c=this.deviceAdr+":5"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,
c,"dimOff",b);break;case "ch3dimUp":case "ch4dimUp":case "ch5dimUp":switch(e){case "ch3dimUp":c=this.deviceAdr+":3";break;case "ch4dimUp":c=this.deviceAdr+":4";break;case "ch5dimUp":c=this.deviceAdr+":5"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimUp"+k,b);break;case "ch3dimDown":case "ch4dimDown":case "ch5dimDown":switch(e){case "ch3dimDown":c=this.deviceAdr+":3";break;case "ch4dimDown":c=this.deviceAdr+":4";break;case "ch5dimDown":c=this.deviceAdr+":5"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,c,"dimDown"+k,b);break;case "ch3dimTo":case "ch4dimTo":case "ch5dimTo":switch(e){case "ch3dimTo":c=this.deviceAdr+":3";break;case "ch4dimTo":c=this.deviceAdr+":4";break;case "ch5dimTo":c=this.deviceAdr+":5"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimTo"+k,b);break;case "ch3toggleTo":case "ch4toggleTo":case "ch5toggleTo":switch(e){case "ch3toggleTo":c=this.deviceAdr+":3";break;case "ch4toggleTo":c=this.deviceAdr+":4";break;case "ch5toggleTo":c=this.deviceAdr+":5"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,c,"toggleTo"+k,b);break;default:b&&b(Error("no such command"))}};ea.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a)return g.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(2==f){if(a=g.DIMMER_TRANSMITTER.parseDptState(a,
b))c={},c.dimmerLevel=a.dimmerTLevel;return c}if(3==f||4==f||5==f){if(a=g.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 3:c.ch3Level=a.dimmerLevel;break;case 4:c.ch4Level=a.dimmerLevel;break;case 5:c.ch5Level=a.dimmerLevel}return c}return null};var fa=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_dimmer3"};util.inherits(fa,e);fa.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();
c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.DIMMER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});(c=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b});f.push({channel:a.deviceAdr+":3",dpt:b});f.push({channel:a.deviceAdr+":4",dpt:b})});return f};fa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},
c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":b.channel=a+":1";b.dataPoint=c.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch2Level":b.channel=a+":2";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch3Level":b.channel=a+":3";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");
break;default:return null}return b};fa.prototype.executeCommand=function(f,a,b){var c=null,g=x.hub.m.hm._Channel["HmIP-RF"],e=a;if(-1!=a.indexOf("dimUp")){var h=a.indexOf("dimUp");e=a.substr(0,h+5);var k=a.substr(h+5)}else-1!=a.indexOf("dimDown")?(h=a.indexOf("dimDown"),e=a.substr(0,h+7),k=a.substr(h+7)):-1!=a.indexOf("dimTo")?(h=a.indexOf("dimTo"),e=a.substr(0,h+5),k=a.substr(h+5)):-1!=a.indexOf("toggleTo")&&(h=a.indexOf("toggleTo"),e=a.substr(0,h+8),k=a.substr(h+8));var l=this;switch(e){case "dimOff":g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":2","dimOff",function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimOff",function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimOff",b)})});break;case "dimUp":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value+
k,1<k&&(k=1),k=Math.round(100*k),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,b)})}))});break;case "dimDown":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==
typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value-k,0>k&&(k=0),k=Math.round(100*k),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,b)})}))});break;case "dimTo":if(!k){b&&b(Error("dimTo has no value"));break}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":2","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":1","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!k){b&&b(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(c.value&&(k=0),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,b)})}))});break;case "ch2dimOff":case "ch3dimOff":case "ch4dimOff":switch(e){case "ch2dimOff":c=
this.deviceAdr+":2";break;case "ch3dimOff":c=this.deviceAdr+":3";break;case "ch4dimOff":c=this.deviceAdr+":4"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimOff",b);break;case "ch2dimUp":case "ch3dimUp":case "ch4dimUp":switch(e){case "ch2dimUp":c=this.deviceAdr+":2";break;case "ch3dimUp":c=this.deviceAdr+":3";break;case "ch4dimUp":c=this.deviceAdr+":4"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimUp"+k,b);break;case "ch2dimDown":case "ch3dimDown":case "ch4dimDown":switch(e){case "ch2dimDown":c=
this.deviceAdr+":2";break;case "ch3dimDown":c=this.deviceAdr+":3";break;case "ch4dimDown":c=this.deviceAdr+":4"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimDown"+k,b);break;case "ch2dimTo":case "ch3dimTo":case "ch4dimTo":switch(e){case "ch2dimTo":c=this.deviceAdr+":2";break;case "ch3dimTo":c=this.deviceAdr+":3";break;case "ch4dimTo":c=this.deviceAdr+":4"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimTo"+k,b);break;case "ch2toggleTo":case "ch3toggleTo":case "ch4toggleTo":switch(e){case "ch2toggleTo":c=
this.deviceAdr+":2";break;case "ch3toggleTo":c=this.deviceAdr+":3";break;case "ch4toggleTo":c=this.deviceAdr+":4"}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"toggleTo"+k,b);break;default:b&&b(Error("no such command"))}};fa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=
null;if(0==f){if("UNREACH"==a)return g.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f){if(a=g.DIMMER_TRANSMITTER.parseDptState(a,b))c={},c.dimmerLevel=a.dimmerTLevel;return c}if(2==f||3==f||4==f){if(a=g.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 2:c.ch2Level=a.dimmerLevel;break;case 3:c.ch3Level=a.dimmerLevel;break;case 4:c.ch4Level=a.dimmerLevel}return c}return null};var ha=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType=
"ip_motion"};util.inherits(ha,e);ha.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};ha.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "active":b.channel=a+":1";b.dataPoint=c.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};ha.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":c.MOTIONDETECTOR_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b);break;default:b&&b(Error("no such command"))}};
ha.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.MOTIONDETECTOR_TRANSCEIVER.parseDptState(a,b):null};var J=function(f,a,b){e.call(this,
f,a,b);this.channel=3;this.legacyType="ip_motion2"};util.inherits(J,e);J.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};J.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,
dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "active":b.channel=a+":3";b.dataPoint=c.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};J.prototype.executeCommand=function(f,a,b){switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":break;default:b&&b(Error("no such command"))}};J.prototype.parseDptState=
function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];g=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);g={};g["0_"+a.toLowerCase()]=b;return g}1==f&&(e=c.KEY_TRANRECEIVER.parseDptState(a,b))&&(e.pressShort&&(g={btn1pressShort:!0}),e.pressLong&&(g={btn1pressLong:!0}));2==f&&(e=
c.KEY_TRANRECEIVER.parseDptState(a,b))&&(e.pressShort&&(g={btn2pressShort:!0}),e.pressLong&&(g={btn2pressLong:!0}));return 3==f?c.MOTIONDETECTOR_TRANSCEIVER.parseDptState(a,b):g};J.prototype.isButton=function(){return!0};J.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,g){b&&console.error("button:1 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(c.deviceIF,
c.deviceAdr+":1","PRESS_LONG",function(b,g){b&&console.error("button:1 claim PRESS_LONG event error:"+b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_SHORT",function(b,g){b&&console.error("button:2 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_LONG",function(b,c){b&&console.error("button:2 claim PRESS_LONG event error:"+b.stack);a&&a()})})})})};var P=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_button"};util.inherits(P,
e);P.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};P.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};
P.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return g.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}f==this.channel&&(a=g.KEY_TRANRECEIVER.parseDptState(a,b))&&(a.pressShort&&(c={pressShort:!0}),a.pressLong&&
(c={pressLong:!0}));return c};P.prototype.isButton=function(){return!0};P.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,g){b&&console.error("button:1 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":1","PRESS_LONG",function(b,c){b&&console.error("button:1 claim PRESS_LONG event error:"+b.stack);a&&a()})})};var Q=
function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_button2"};util.inherits(Q,e);Q.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};Q.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};Q.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];g=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);g={};g["0_"+a.toLowerCase()]=b;return g}1==f&&(e=c.KEY_TRANRECEIVER.parseDptState(a,
b))&&(e.pressShort&&(g={btn1pressShort:!0}),e.pressLong&&(g={btn1pressLong:!0}));2==f&&(e=c.KEY_TRANRECEIVER.parseDptState(a,b))&&(e.pressShort&&(g={btn2pressShort:!0}),e.pressLong&&(g={btn2pressLong:!0}));return g};Q.prototype.isButton=function(){return!0};Q.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,g){b&&console.error("button:1 claim PRESS_SHORT event error:"+
b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":1","PRESS_LONG",function(b,g){b&&console.error("button:1 claim PRESS_LONG event error:"+b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_SHORT",function(b,g){b&&console.error("button:2 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_LONG",function(b,c){b&&console.error("button:2 claim PRESS_LONG event error:"+b.stack);a&&a()})})})})};var K=function(f,a,b){e.call(this,f,a,b);this.channel=
1;this.legacyType="ip_button4"};util.inherits(K,e);K.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};K.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);
break;default:return null}return b};K.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return g.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f||2==f||3==f||4==f)if(a=g.KEY_TRANRECEIVER.parseDptState(a,b))c||
(c={}),a.pressShort&&(c["btn"+f+"pressShort"]=!0),a.pressLong&&(c["btn"+f+"pressLong"]=!0);return c};K.prototype.isButton=function(){return!0};K.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,f,function(){c._claimButtonEvent(2,f,function(){c._claimButtonEvent(3,f,function(){c._claimButtonEvent(4,f,function(){a&&a()})})})})};K.prototype._claimButtonEvent=function(f,a,b){var c=this;a.reportValueUsage(this.deviceIF,
this.deviceAdr+":"+f,"PRESS_SHORT",function(g,e){g&&console.error("button:"+f+" claim PRESS_SHORT event error:"+g.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+f,"PRESS_LONG",function(a,c){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var L=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_button6"};util.inherits(L,e);L.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();
b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};L.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};L.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=
this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return g.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f||2==f||3==f||4==f||5==f||6==f)if(a=g.KEY_TRANRECEIVER.parseDptState(a,b))c||(c={}),a.pressShort&&(c["btn"+f+"pressShort"]=!0),a.pressLong&&(c["btn"+f+"pressLong"]=!0);return c};L.prototype.isButton=function(){return!0};L.prototype.claimEvent=
function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,f,function(){c._claimButtonEvent(2,f,function(){c._claimButtonEvent(3,f,function(){c._claimButtonEvent(4,f,function(){c._claimButtonEvent(5,f,function(){c._claimButtonEvent(6,f,function(){a&&a()})})})})})})};L.prototype._claimButtonEvent=function(f,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(g,e){g&&console.error("button:"+
f+" claim PRESS_SHORT event error:"+g.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+f,"PRESS_LONG",function(a,c){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var ia=function(f,a,b){e.call(this,f,a,b);this.channel=3;this.legacyType="ip_siren"};util.inherits(ia,e);ia.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});
(c=b.ALARM_SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};ia.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":b.channel=a+":3";b.dataPoint=c.ALARM_SWITCH_VIRTUAL_RECEIVER.getDptFromState(f);break;default:return null}return b};
ia.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].ALARM_SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3",a,b)};ia.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}return 3==f?c.ALARM_SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b):null};var C=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_wallthermo"};util.inherits(C,e);C.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){"LEVEL"!=
b&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};C.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":b.channel=a+":1";b.dataPoint=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(f);break;
default:return null}return b};C.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};C.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];g=null;if(0==f){if("UNREACH"==a||
"LOW_BAT"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);g={};g["0_"+a.toLowerCase()]=b;return g}return 1==f?c.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,b):g};var Ba=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_wallthermo2"};util.inherits(Ba,C);Ba.prototype._getReadableDpts=function(){var f=C.prototype._getReadableDpts.call(this);f||(f=[]);var a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+
":8",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":10",dpt:b})});return f};Ba.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "valveState":b.channel=a+":10";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "cl_fd_emergencyOP":case "cl_fd_frostProtection":case "cl_fd_state":case "cl_fd_humidityAlarm":b.channel=
a+":8";b.dataPoint=c.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getDptFromState(f);break;default:return C.prototype._getDptFromRef.call(this,f)}return b};Ba.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return g.MAINTENANCE_BAT_EL.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f)return g.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,b);if(8==f)return g.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.parseDptState(a,b);10==f&&(c={},a=g.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b),c.valveState=a?a.switchState:"?");return c};var ja=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_smoke"};util.inherits(ja,e);ja.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();
c&&c.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SMOKE_DETECTOR.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};ja.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":b.channel=
a+":1";b.dataPoint=c.SMOKE_DETECTOR.getDptFromState(f);break;default:return null}return b};ja.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].SMOKE_DETECTOR.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};ja.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];
g=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE.parseDptState(a,b);g={};g["0_"+a.toLowerCase()]=b;return g}return 1==f?c.SMOKE_DETECTOR.parseDptState(a,b):g};var Ca=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_window"};util.inherits(Ca,e);Ca.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.ROTARY_HANDLE_TRANSCEIVER.getReadableDpts())&&
c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ca.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":b.channel=a+":1";b.dataPoint=c.ROTARY_HANDLE_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};Ca.prototype.parseDptState=function(f,
a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];g=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);g={};g["0_"+a.toLowerCase()]=b;return g}return 1==f?c.ROTARY_HANDLE_TRANSCEIVER.parseDptState(a,b):g};var A=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType=
"ip_blind"};util.inherits(A,e);A.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SHUTTER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.SHUTTER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b});f.push({channel:a.deviceAdr+
":6",dpt:b})});return f};A.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "blindLevel":b.channel=a+":3";b.dataPoint=c.SHUTTER_TRANSMITTER.getDptFromState("blindTLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=c.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch5Level":b.channel=a+":5";
b.dataPoint=c.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch6Level":b.channel=a+":6";b.dataPoint=c.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;default:return null}return b};A.prototype.executeCommand=function(f,a,b){var c=null,g=x.hub.m.hm._Channel["HmIP-RF"],e=a;if(-1!=a.indexOf("stepUp")){var h=a.indexOf("stepUp");e=a.substr(0,h+6);var k=a.substr(h+6)}else-1!=a.indexOf("stepDown")?(h=a.indexOf("stepDown"),e=a.substr(0,h+8),k=a.substr(h+8)):-1!=a.indexOf("moveTo")?
(h=a.indexOf("moveTo"),e=a.substr(0,h+6),k=a.substr(h+6)):-1!=a.indexOf("stop")&&(h=a.indexOf("stop"),e=a.substr(0,h+4),k=a.substr(h+4));var l=this;switch(e){case "stop":g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","stop",function(a,c){a?b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","stop",function(a,c){a?b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","stop",b)})});break;case "moveUp":g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","moveUp",function(a,c){a?b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo0",function(a,c){a?b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo0",b)})});break;case "moveDown":g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveDown",function(a,c){a?b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo0",function(a,c){a?
b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo0",b)})});break;case "stepUp":k=k?parseInt(k)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(k=c.value+k,1<k&&(k=1),k=Math.round(100*k),g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":5","moveTo0",function(a,c){a?b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo0",function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "stepDown":k=k?parseInt(k)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):
(k=c.value-k,0>k&&(k=0),k=Math.round(100*k),g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo0",function(a,c){a?b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo0",function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});
break;case "moveTo":if(!k){b&&b(Error("moveTo has no value"));break}g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo0",function(a,c){a?b&&b(a,c):g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo0",function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+
1E3),b&&b(a))})})});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(e){case "ch4stop":c=this.deviceAdr+":4";break;case "ch5stop":c=this.deviceAdr+":5";break;case "ch6stop":c=this.deviceAdr+":6"}g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stop",b);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(e){case "ch4moveUp":c=this.deviceAdr+":4";break;case "ch5moveUp":c=this.deviceAdr+":5";break;case "ch6moveUp":c=this.deviceAdr+":6"}g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,c,"moveUp",b);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(e){case "ch4moveDown":c=this.deviceAdr+":4";break;case "ch5moveDown":c=this.deviceAdr+":5";break;case "ch6moveDown":c=this.deviceAdr+":6"}g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"moveDown",b);break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(e){case "ch4stepUp":c=this.deviceAdr+":4";break;case "ch5stepUp":c=this.deviceAdr+":5";break;case "ch6stepUp":c=this.deviceAdr+
":6"}g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stepUp"+k,b);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(e){case "ch4stepDown":c=this.deviceAdr+":4";break;case "ch5stepDown":c=this.deviceAdr+":5";break;case "ch6stepDown":c=this.deviceAdr+":6"}g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stepDown"+k,b);break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(e){case "ch4moveTo":c=this.deviceAdr+":4";break;case "ch5moveTo":c=this.deviceAdr+
":5";break;case "ch6moveTo":c=this.deviceAdr+":6"}g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"moveTo"+k,b);break;default:b&&b(Error("no such command"))}};A.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a)return g.MAINTENANCE.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==f){if(a=g.SHUTTER_TRANSMITTER.parseDptState(a,b))c={},c.blindLevel=a.blindTLevel;return c}if(4==f||5==f||6==f){if(a=g.SHUTTER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 4:c.ch4Level=a.blindLevel;break;case 5:c.ch5Level=a.blindLevel;break;case 6:c.ch6Level=a.blindLevel}return c}return null};A.prototype.getConfig=function(f,a){var b=this.deviceAdr+":3";f.getParamset(this.deviceIF,b,"MASTER",function(c,f){if(c)a&&a(c);else{var g=
{},e=null;f&&(e={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});g[b]=e;a&&a(c,g)}})};A.prototype.setConfig=function(f,a,b){if(a){var c=this.deviceAdr+
":3";if(a=a[c]){var g={};g.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};g.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};f.setParamset(this.deviceIF,c,"MASTER",g,function(a){b&&b(a)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};A.prototype.isButton=function(){return!0};A.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,f,function(){c._claimButtonEvent(2,f,function(){a&&
a()})})};A.prototype._claimButtonEvent=function(f,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(g,e){g&&console.error("button:"+f+" claim PRESS_SHORT event error:"+g.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+f,"PRESS_LONG",function(a,c){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var B=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_jalousie"};util.inherits(B,e);B.prototype._getReadableDpts=
function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.BLIND_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b});f.push({channel:a.deviceAdr+":6",dpt:b})});return f};B.prototype._getDptFromRef=
function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "blindLevel":b.channel=a+":3";b.dataPoint=c.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":b.channel=a+":3";b.dataPoint=c.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;case "ch4blindLevel":b.channel=a+":4";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");
break;case "ch4lamellaLevel":b.channel=a+":4";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch5blindLevel":b.channel=a+":5";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch5lamellaLevel":b.channel=a+":5";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch6blindLevel":b.channel=a+":6";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch6lamellaLevel":b.channel=a+":6";b.dataPoint=
c.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;default:return null}return b};B.prototype.executeCommand=function(f,a,b){var c=null,g=x.hub.m.hm._Channel["HmIP-RF"],e=a;if(-1!=a.indexOf("stepUp")){var k=a.indexOf("stepUp");e=a.substr(0,k+6);var h=a.substr(k+6)}else-1!=a.indexOf("stepDown")?(k=a.indexOf("stepDown"),e=a.substr(0,k+8),h=a.substr(k+8)):-1!=a.indexOf("moveTo")?(k=a.indexOf("moveTo"),e=a.substr(0,k+6),h=a.substr(k+6)):-1!=a.indexOf("stop")?(k=a.indexOf("stop"),e=a.substr(0,
k+4),h=a.substr(k+4)):-1!=a.indexOf("lamellaStepUp")?(k=a.indexOf("lamellaStepUp"),e=a.substr(0,k+13),h=a.substr(k+13)):-1!=a.indexOf("lamellaStepDown")?(k=a.indexOf("lamellaStepDown"),e=a.substr(0,k+15),h=a.substr(k+15)):-1!=a.indexOf("lamellaTo")&&(k=a.indexOf("lamellaTo"),e=a.substr(0,k+9),h=a.substr(k+9));var l=this;switch(e){case "stop":case "moveUp":case "moveDown":g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4",e,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":5",e,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6",e,b)})});break;case "lamellaUp":case "lamellaDown":f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(h=c.value,h=Math.round(100*h),g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4",e,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5",e,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6",e,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,c){b&&b(a,c)})})})})})}))});break;case "stepUp":h=
h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(h=c.value+h,1<h&&(h=1),h=Math.round(100*h),g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "stepDown":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(h=c.value-h,0>h&&(h=0),h=Math.round(100*h),g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "moveTo":if(!h){b&&b(Error("moveTo has no value"));break}g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","moveTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "lamellaStepUp":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var e=c.value;e=Math.round(100*e);f.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get lamella current value return invalid")):(h=c.value+h,1<h&&(h=1),h=Math.round(100*h),g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":4","lamellaTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+e,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","lamellaTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+e,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":6","moveTo"+e,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",c,(new Date).getTime()+1E3),b&&b(a))})})})})})}))})}});break;case "lamellaStepDown":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var e=c.value;e=Math.round(100*
e);f.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get lamella current value return invalid")):(h=c.value-h,0>h&&(h=0),h=Math.round(100*h),g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","lamellaTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+e,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,
l.deviceAdr+":5","lamellaTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+e,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+e,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",c,(new Date).getTime()+1E3),b&&
b(a))})})})})})}))})}});break;case "lamellaTo":if(!h){b&&b(Error("lamellaTo has no value"));break}f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var e=c.value;e=Math.round(100*e);g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","lamellaTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,
l.deviceAdr+":4","moveTo"+e,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","lamellaTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+e,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(a,c){a?b&&b(a,c):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+e,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&
(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",c,(new Date).getTime()+1E3),b&&b(a))})})})})})})}});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(e){case "ch4stop":c=this.deviceAdr+":4";break;case "ch5stop":c=this.deviceAdr+":5";break;case "ch6stop":c=this.deviceAdr+":6"}g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stop",b);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(e){case "ch4moveUp":c=this.deviceAdr+":4";break;case "ch5moveUp":c=
this.deviceAdr+":5";break;case "ch6moveUp":c=this.deviceAdr+":6"}g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"moveUp",b);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(e){case "ch4moveDown":c=this.deviceAdr+":4";break;case "ch5moveDown":c=this.deviceAdr+":5";break;case "ch6moveDown":c=this.deviceAdr+":6"}g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"moveDown",b);break;case "ch4lamellaUp":case "ch5lamellaUp":case "ch6lamellaUp":switch(e){case "ch4lamellaUp":c=
this.deviceAdr+":4";break;case "ch5lamellaUp":c=this.deviceAdr+":5";break;case "ch6lamellaUp":c=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,e){if(a)b&&b(a);else if("undefined"==typeof e||null==e)b&&b(Error("get blind current value return invalid"));else{var h=e.value;h=Math.round(100*h);g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"lamellaUp",function(a,e){a?b&&b(a):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"moveTo"+h,function(a,
c){b&&b(a,c)})})}});break;case "ch4lamellaDown":case "ch5lamellaDown":case "ch6lamellaDown":switch(e){case "ch4lamellaDown":c=this.deviceAdr+":4";break;case "ch5lamellaDown":c=this.deviceAdr+":5";break;case "ch6lamellaDown":c=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,e){if(a)b&&b(a);else if("undefined"==typeof e||null==e)b&&b(Error("get blind current value return invalid"));else{var h=e.value;h=Math.round(100*h);g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,c,"lamellaDown",function(a,e){a?b&&b(a):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"moveTo"+h,function(a,c){b&&b(a,c)})})}});break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(e){case "ch4stepUp":c=this.deviceAdr+":4";break;case "ch5stepUp":c=this.deviceAdr+":5";break;case "ch6stepUp":c=this.deviceAdr+":6"}g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stepUp"+h,b);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(e){case "ch4stepDown":c=
this.deviceAdr+":4";break;case "ch5stepDown":c=this.deviceAdr+":5";break;case "ch6stepDown":c=this.deviceAdr+":6"}g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stepDown"+h,b);break;case "ch4lamellaStepUp":case "ch5lamellaStepUp":case "ch6lamellaStepUp":switch(e){case "ch4lamellaStepUp":c=this.deviceAdr+":4";break;case "ch5lamellaStepUp":c=this.deviceAdr+":5";break;case "ch6lamellaStepUp":c=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,
e){if(a)b&&b(a);else if("undefined"==typeof e||null==e)b&&b(Error("get blind current value return invalid"));else{var k=e.value;k=Math.round(100*k);g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"lamellaStepUp"+h,function(a,e){a?b&&b(a):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"moveTo"+k,function(a,c){b&&b(a,c)})})}});break;case "ch4lamellaStepDown":case "ch5lamellaStepDown":case "ch6lamellaStepDown":switch(e){case "ch4lamellaStepDown":c=this.deviceAdr+":4";break;case "ch5lamellaStepDown":c=
this.deviceAdr+":5";break;case "ch6lamellaStepDown":c=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,e){if(a)b&&b(a);else if("undefined"==typeof e||null==e)b&&b(Error("get blind current value return invalid"));else{var k=e.value;k=Math.round(100*k);g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"lamellaStepDown"+h,function(a,e){a?b&&b(a):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"moveTo"+k,function(a,c){b&&b(a,c)})})}});break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(e){case "ch4moveTo":c=
this.deviceAdr+":4";break;case "ch5moveTo":c=this.deviceAdr+":5";break;case "ch6moveTo":c=this.deviceAdr+":6"}g.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"moveTo"+h,b);break;case "ch4lamellaTo":case "ch5lamellaTo":case "ch6lamellaTo":switch(e){case "ch4lamellaTo":c=this.deviceAdr+":4";break;case "ch5lamellaTo":c=this.deviceAdr+":5";break;case "ch6lamellaTo":c=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,e){if(a)b&&b(a);else if("undefined"==
typeof e||null==e)b&&b(Error("get blind current value return invalid"));else{var k=e.value;k=Math.round(100*k);g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"lamellaTo"+h,function(a,e){a?b&&b(a):g.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"moveTo"+k,function(a,c){b&&b(a,c)})})}});break;default:b&&b(Error("no such command"))}};B.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");
-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a)return g.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==f){if(b=g.BLIND_TRANSMITTER.parseDptState(a,b))c={},"LEVEL"==a?c.blindLevel=b.blindTPos:"LEVEL_2"==a&&(c.lamellaLevel=b.lamellaTPos);return c}if(4==f||5==f||6==f){if(b=g.BLIND_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 4:"LEVEL"==a?c.ch4blindLevel=b.blindPos:"LEVEL_2"==
a&&(c.ch4lamellaLevel=b.lamellaPos);break;case 5:"LEVEL"==a?c.ch5blindLevel=b.blindPos:"LEVEL_2"==a&&(c.ch5lamellaLevel=b.lamellaPos);break;case 6:"LEVEL"==a?c.ch6blindLevel=b.blindPos:"LEVEL_2"==a&&(c.ch6lamellaLevel=b.lamellaPos)}return c}return null};B.prototype.getConfig=function(f,a){var b=this.deviceAdr+":3";f.getParamset(this.deviceIF,b,"MASTER",function(c,f){if(c)a&&a(c);else{var g={},e=null;f&&(e={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:f.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:f.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});g[b]=e;a&&a(c,g)}})};B.prototype.setConfig=function(f,a,b){if(a){var c=
this.deviceAdr+":3";if(a=a[c]){var g={};g.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};g.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};g.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_UNIT};g.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_VALUE};f.setParamset(this.deviceIF,c,"MASTER",g,function(a){b&&b(a)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};B.prototype.isButton=
function(){return!0};B.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,f,function(){c._claimButtonEvent(2,f,function(){a&&a()})})};B.prototype._claimButtonEvent=function(f,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(g,e){g&&console.error("button:"+f+" claim PRESS_SHORT event error:"+g.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+f,"PRESS_LONG",
function(a,c){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var ka=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_presence"};util.inherits(ka,e);ka.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.PRESENCEDETECTOR_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+
":1",dpt:b})});return f};ka.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "current_illumination":case "active":b.channel=a+":1";b.dataPoint=c.PRESENCEDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};ka.prototype.executeCommand=
function(f,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":c.PRESENCEDETECTOR_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b);break;default:b&&b(Error("no such command"))}};ka.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];
if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.PRESENCEDETECTOR_TRANSCEIVER.parseDptState(a,b):null};var Da=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_floor_heater"};util.inherits(Da,e);Da.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_TRANSCEIVER.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+
":"+a.channel,dpt:b})});return f};Da.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "cl_f_humidityLimiter":case "cl_f_emergencyOP":case "cl_f_frostProtection":case "cl_f_state":case "cl_f_dewPointAlarm":case "cl_f_externalClock":b.channel=a+":"+this.channel;b.dataPoint=c.CLIMATECONTROL_FLOOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};Da.prototype.parseDptState=function(f,
a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?c.CLIMATECONTROL_FLOOR_TRANSCEIVER.parseDptState(a,b):null};var Ea=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_floor_pump_heater"};util.inherits(Ea,e);Ea.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getReadableDpts();
b&&b.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};Ea.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "cl_fp_humidityLimiter":case "cl_fp_emergencyOP":case "cl_fp_frostProtection":case "cl_fp_state":case "cl_fp_dewPointAlarm":case "cl_fp_externalClock":b.channel=a+":"+this.channel;b.dataPoint=c.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};
Ea.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?c.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.parseDptState(a,b):null};var Fa=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_weather"};util.inherits(Fa,e);Fa.prototype._getReadableDpts=function(){var f=
[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.WEATHER_TRANSMIT.getReadableDpts())&&c.forEach(function(b){-1==b.indexOf("RAIN")&&-1==b.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Fa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=a+":1";f=c.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;b.dataPoint=f}return b};Fa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.WEATHER_TRANSMIT.parseDptState(a,b):null};var Ga=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_weather2"};util.inherits(Ga,e);Ga.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.WEATHER_TRANSMIT.getReadableDpts())&&c.forEach(function(b){-1==b.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+
":1",dpt:b})});return f};Ga.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=a+":1";f=c.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;b.dataPoint=f}return b};Ga.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+
1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.WEATHER_TRANSMIT.parseDptState(a,b):null};var Ha=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_weather3"};util.inherits(Ha,e);Ha.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],
c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.CLIMATE_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ha.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=
a+":1";f=c.CLIMATE_TRANSCEIVER.getDptFromState(f);if(!f)return null;b.dataPoint=f}return b};Ha.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.CLIMATE_TRANSCEIVER.parseDptState(a,
b):null};var Ia=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_weather4"};util.inherits(Ia,e);Ia.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.WEATHER_TRANSMIT.getReadableDpts())&&c.forEach(function(b){-1==b.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ia.prototype._getDptFromRef=function(f){var a=
this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=a+":1";f=c.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;b.dataPoint=f}return b};Ia.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,
c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.WEATHER_TRANSMIT.parseDptState(a,b):null};var la=function(f,a,b){e.call(this,f,a,b);this.channel=2;this.legacyType="ip_direction"};util.inherits(la,e);la.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+
":0",dpt:b})});(c=b.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b});f.push({channel:a.deviceAdr+":3",dpt:b})});return f};la.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "ch2State":b.channel=a+":2";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "ch3State":b.channel=a+":3";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":b.channel=a+":4";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;default:b.channel=a+":2";f=c.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getDptFromState(f);if(!f)return null;b.dataPoint=f}return b};la.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");
-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return g.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(2==f){if(a=g.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(a,b))c={},"undefined"!=typeof a.current_direction&&(c.current_passage_r2l=a.current_direction),"undefined"!=typeof a.last_direction&&(c.last_passage_r2l=a.last_direction),"undefined"!=typeof a.passage_counter&&
(c.r2l_passage_counter=a.passage_counter),"undefined"!=typeof a.passage_counter_overflow&&(c.r2l_passage_counter_overflow=a.passage_counter_overflow);return c}if(3==f){if(a=g.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(a,b))c={},"undefined"!=typeof a.current_direction&&(c.current_passage_l2r=a.current_direction),"undefined"!=typeof a.last_direction&&(c.last_passage_l2r=a.last_direction),"undefined"!=typeof a.passage_counter&&(c.l2r_passage_counter=a.passage_counter),"undefined"!=typeof a.passage_counter_overflow&&
(c.l2r_passage_counter_overflow=a.passage_counter_overflow);return c}return null};la.prototype.parseStates=function(f){var a={},b;for(b in f){var c=this.parseChnState(b,f[b]);c&&(a=x.hub.m.hm._Util.mergeObj(a,c))}a.current_passage_r2l&&a.current_passage_l2r&&(a.current_direction=a.current_passage_r2l.value?{value:"right_to_left",time:a.current_passage_r2l.time}:{value:"left_to_right",time:a.current_passage_l2r.time});a.last_passage_r2l&&a.last_passage_l2r&&(a.last_direction=a.last_passage_r2l.value?
{value:"right_to_left",time:a.last_passage_r2l.time}:{value:"left_to_right",time:a.last_passage_l2r.time});delete a.current_passage_r2l;delete a.current_passage_l2r;delete a.last_passage_r2l;delete a.last_passage_l2r;return a};var M=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_button8"};util.inherits(M,e);M.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+
":0",dpt:b})});return f};M.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};M.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,
c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return g.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f||2==f||3==f||4==f||5==f||6==f||7==f||8==f)if(a=g.KEY_TRANRECEIVER.parseDptState(a,b))c||(c={}),a.pressShort&&(c["btn"+f+"pressShort"]=!0),a.pressLong&&(c["btn"+f+"pressLong"]=!0);return c};M.prototype.isButton=function(){return!0};M.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&
this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,f,function(){c._claimButtonEvent(2,f,function(){c._claimButtonEvent(3,f,function(){c._claimButtonEvent(4,f,function(){c._claimButtonEvent(5,f,function(){c._claimButtonEvent(6,f,function(){c._claimButtonEvent(7,f,function(){c._claimButtonEvent(8,f,function(){a&&a()})})})})})})})})};M.prototype._claimButtonEvent=function(f,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(g,e){g&&console.error("button:"+
f+" claim PRESS_SHORT event error:"+g.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+f,"PRESS_LONG",function(a,c){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var Ja=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_generic_input"};util.inherits(Ja,e);Ja.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].GENERIC_INPUT_TRANSMITER.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+
":"+a.channel,dpt:b})});return f};Ja.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];b.channel=a+":"+this.channel;f=c.GENERIC_INPUT_TRANSMITER.getDptFromState(f);if(!f)return null;b.dataPoint=f;return b};Ja.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));
if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?c.GENERIC_INPUT_TRANSMITER.parseDptState(a,b):null};var ma=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_analog_output"};util.inherits(ma,e);ma.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};ma.prototype._getDptFromRef=function(f){var a=
this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "outputLevel":b.channel=a+":"+this.channel;b.dataPoint=c.ANALOG_OUTPUT_TRANSCEIVER.getDptFromState("outputLevel");break;default:return null}return b};ma.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,function(a,f){b&&b(a,f)})};ma.prototype.parseDptState=function(f,a,b){var c=
f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];g=null;f==this.channel&&(g=c.ANALOG_OUTPUT_TRANSCEIVER.parseDptState(a,b));return g};var Ka=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_water"};util.inherits(Ka,e);Ka.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();
c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.WATER_DETECTION_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ka.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(f);break;case "alarm":case "moisture":case "water":b.channel=
a+":1";b.dataPoint=c.WATER_DETECTION_TRANSMITTER.getDptFromState(f);break;default:return null}return b};Ka.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"ERROR_NON_FLAT_POSITIONING"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=
b;return c}return 1==f?c.WATER_DETECTION_TRANSMITTER.parseDptState(a,b):null};var La=function(f,a,b){e.call(this,f,a,b);this.channel=1;this.legacyType="ip_acce"};util.inherits(La,e);La.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.ACCELERATION_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",
dpt:b})});return f};La.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "volatage":case "errorCode":case "sensorError":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "motion":b.channel=a+":1";b.dataPoint=c.ACCELERATION_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};La.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");
if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"OPERATING_VOLTAGE"==a||"ERROR_CODE"==a||"SENSOR_ERROR"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.ACCELERATION_TRANSCEIVER.parseDptState(a,b):null};var D=function(f,a,b){e.call(this,f,a,b);this.channel=
1;this.legacyType="ip_garagedoor"};util.inherits(D,e);D.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};D.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "voltage":case "errorCode":b.channel=a+":0";b.dataPoint=
c.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};D.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":var g=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,g,"onFor0.5",b);break;default:"onFor"==a.substr(0,5)?(g=this.deviceAdr+":3",c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,g,a,b)):b&&b(Error("no such command"))}};D.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==
c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"OPERATING_VOLTAGE"==a||"ERROR_CODE"==a)return g.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f){if(a=g.KEY_TRANRECEIVER.parseDptState(a,b))c||(c={}),a.pressShort&&(c.btnPressShort=!0),a.pressLong&&(c.btnPressLong=!0);return c}return null};
D.prototype.isButton=function(){return!0};D.prototype.claimEvent=function(f,a){this._claimButtonEvent(1,f,function(){a&&a()})};D.prototype._claimButtonEvent=function(f,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(g,e){g&&console.error("button:"+f+" claim PRESS_SHORT event error:"+g.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+f,"PRESS_LONG",function(a,c){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var Ta=
function(){var f=function(a,b,c){e.call(this,a,b,c);this._chMaintenance=0;this._chKeyTransceiver1=1;this._chKeyTransceiver2=2;this._chSwitchTransmitter3=3;this._chSwitchVirtualReceiver4=4;this._chDimmerTransmitter7=7;this._chDimmerVirtualReceiver8=8;this._chDimmerTransmitter11=11;this._chDimmerVirtualReceiver12=12;this._chDimmerWeekProfile=15;this.legacyType="ip_bsl"};util.inherits(f,e);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+
":"+this._chSwitchTransmitter3,dpt:"STATE"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"COLOR"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"COLOR"}]};f.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "state":b.channel+=
this._chSwitchTransmitter3;b.dataPoint="STATE";break;case "led1Level":b.channel+=this._chDimmerTransmitter7;b.dataPoint="LEVEL";break;case "led1Color":b.channel+=this._chDimmerTransmitter7;b.dataPoint="COLOR";break;case "led2Level":b.channel+=this._chDimmerTransmitter11;b.dataPoint="LEVEL";break;case "led2Color":b.channel+=this._chDimmerTransmitter11;b.dataPoint="COLOR";break;default:return null}return b};f.prototype.executeCommand=function(a,b,c){var f=x.hub.m.hm._Channel["HmIP-RF"],g=this.getSerial();
var e=b;if(-1!=b.indexOf("dimUp")){var h=b.indexOf("dimUp");e=b.substr(0,h+5);h=b.substr(h)}else-1!=b.indexOf("dimDown")?(h=b.indexOf("dimDown"),e=b.substr(0,h+7),h=b.substr(h)):-1!=b.indexOf("dimTo")?(h=b.indexOf("dimTo"),e=b.substr(0,h+5),h=b.substr(h)):-1!=b.indexOf("toggleTo")?(h=b.indexOf("toggleTo"),e=b.substr(0,h+8),h=b.substr(h)):-1!=b.indexOf("colorTo")&&(h=b.indexOf("colorTo"),e=b.substr(0,h+7),h=b.substr(h));switch(e){case "on":case "off":case "toggle":b=g+":"+this._chSwitchVirtualReceiver4;
f.SWITCH_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,e,c);break;case "led1on":case "led1off":case "led1dimUp":case "led1dimDown":case "led1dimTo":case "led1toggleTo":case "led1colorTo":case "led2on":case "led2off":case "led2dimUp":case "led2dimDown":case "led2dimTo":case "led2toggleTo":case "led2colorTo":b="led1"==e.substr(0,4)?g+":"+this._chDimmerVirtualReceiver12:g+":"+this._chDimmerVirtualReceiver8;"led1on"==e?h="dimTo100":"led1off"==e?h="dimOff":"led2on"==e?h="dimTo100":"led2off"==e&&(h=
"dimOff");f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,h,c);break;default:"onFor"==e.substr(0,5)?(b=g+":"+this._chSwitchVirtualReceiver4,f.SWITCH_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,e,c)):c&&c(Error("no such command"))}};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var g=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(g!=f)return null;g=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return g.MAINTENANCE.parseDptState(b,
c);default:var e={};e["0_"+b.toLowerCase()]=c;return e}case this._chKeyTransceiver1:case this._chKeyTransceiver2:if(c=g.KEY_TRANRECEIVER.parseDptState(b,c))e||(e={}),c.pressShort&&(e["btn"+a+"pressShort"]=!0),c.pressLong&&(e["btn"+a+"pressLong"]=!0);return e;case this._chSwitchTransmitter3:switch(b){case "STATE":if(c=g.SWITCH_TRANSMITTER.parseDptState(b,c))e={},e.state=c.switchTState;return e;default:return null}case this._chDimmerTransmitter7:if(c=g.DIMMER_TRANSMITTER.parseDptState(b,c))e={},"LEVEL"==
b?e.led2Level=c.dimmerTLevel:"COLOR"==b&&(e.led2Color=c.dimmerTColor);return e;case this._chDimmerTransmitter11:if(c=g.DIMMER_TRANSMITTER.parseDptState(b,c))e={},"LEVEL"==b?e.led1Level=c.dimmerTLevel:"COLOR"==b&&(e.led1Color=c.dimmerTColor);return e;default:return null}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(a,b){var c=this.getSerial(),f=this;a.reportValueUsage(this.deviceIF,c+":"+this._chKeyTransceiver1,"PRESS_SHORT",function(g,e){g&&console.error("button:1 claim PRESS_SHORT event error:"+
g.stack);a.reportValueUsage(f.deviceIF,c+":"+f._chKeyTransceiver1,"PRESS_LONG",function(g,e){g&&console.error("button:1 claim PRESS_LONG event error:"+g.stack);a.reportValueUsage(f.deviceIF,c+":"+f._chKeyTransceiver2,"PRESS_SHORT",function(g,e){g&&console.error("button:2 claim PRESS_SHORT event error:"+g.stack);a.reportValueUsage(f.deviceIF,c+":"+f._chKeyTransceiver2,"PRESS_LONG",function(a,c){a&&console.error("button:2 claim PRESS_LONG event error:"+a.stack);b&&b()})})})})};return f}(),Ua=function(){var f=
function(a,b,c){e.call(this,a,b,c);this._chMaintenance=0;this._chDoorReceiver=1;this._chSimpleSwitchReceiver=2;this.legacyType="ip_tormatic"};util.inherits(f,e);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this._chDoorReceiver,dpt:"DOOR_STATE"},{channel:this.deviceAdr+":"+this._chSimpleSwitchReceiver,dpt:"STATE"}]};f.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};
switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "doorState":b.channel+=this._chDoorReceiver;b.dataPoint="DOOR_STATE";break;case "lightState":b.channel+=this._chSimpleSwitchReceiver;b.dataPoint="STATE";break;default:return null}return b};f.prototype.executeCommand=function(a,b,c){var f=x.hub.m.hm._Channel["HmIP-RF"],g=this.getSerial();switch(b){case "open":case "close":case "partialOpen":case "stop":g=g+":"+this._chDoorReceiver;f.DOOR_RECEIVER.executeCommand(a,
this.deviceIF,g,b,c);break;case "lightOn":case "lightOff":case "lightToggle":b=b.substr(5).toLowerCase();g=g+":"+this._chSimpleSwitchReceiver;f.SIMPLE_SWITCH_RECEIVER.executeCommand(a,this.deviceIF,g,b,c);break;default:c&&c(Error("no such command"))}};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var g=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(g!=f)return null;g=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return g.MAINTENANCE.parseDptState(b,
c);default:var e={};e["0_"+b.toLowerCase()]=c;return e}case this._chDoorReceiver:return(b=g.DOOR_RECEIVER.parseDptState(b,c))&&(e=b),e;case this._chSimpleSwitchReceiver:if(b=g.SIMPLE_SWITCH_RECEIVER.parseDptState(b,c))e={},e.lightState=b.state;return e;default:return null}};return f}(),Va=function(){var f=function(a,b,c){e.call(this,a,b,c);this._chMaintenance=0;this._chBrightness=1;this.legacyType="ip_lux"};util.inherits(f,e);f.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],
f=c.MAINTENANCE_BAT_EL.getReadableDpts();f&&f.forEach(function(c){"SABOTAGE"!=c&&"ERROR_CODE"!=c&&"SENSOR_ERROR"!=c&&a.push({channel:b.deviceAdr+":0",dpt:c})});(f=c.BRIGHTNESS_TRANSMITTER.getReadableDpts())&&f.forEach(function(c){a.push({channel:b.deviceAdr+":1",dpt:c})});return a};f.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "volatage":c.channel=b+":0";c.dataPoint=
f.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "illu":case "avgIllu":case "maxIllu":case "minIllu":c.channel=b+":1";c.dataPoint=f.BRIGHTNESS_TRANSMITTER.getDptFromState(a);break;default:return null}return c};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var g=a.substr(0,f);a=a.substr(f+1);var e=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(e=this.deviceAdr.substr(0,f));if(g!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];if(0==a){if("UNREACH"==b||"LOW_BAT"==
b||"OPERATING_VOLTAGE"==b)return f.MAINTENANCE_BAT_EL.parseDptState(b,c);f={};f["0_"+b.toLowerCase()]=c;return f}return 1==a?f.BRIGHTNESS_TRANSMITTER.parseDptState(b,c):null};return f}(),Wa=function(){var f=function(a,b,c){e.call(this,a,b,c);this._chMaintenance=0;this._chPowerMainsTransmitter=1;this.legacyType="ip_pmfs"};util.inherits(f,e);f.prototype._getReadableDpts=function(){var a=this.getSerial(),b=[],c=this,f=x.hub.m.hm._Channel["HmIP-RF"],g=f.MAINTENANCE.getReadableDpts();g&&g.forEach(function(f){"UNREACH"==
f&&b.push({channel:a+":"+c._chMaintenance,dpt:f})});(g=f.POWER_MAINS_TRANSMITTER.getReadableDpts())&&g.forEach(function(f){b.push({channel:a+":"+c._chPowerMainsTransmitter,dpt:f})});return b};f.prototype._getDptFromRef=function(a){var b=this.getSerial(),c={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":c.channel=b+":"+this._chMaintenance;c.dataPoint=f.MAINTENANCE.getDptFromState(a);break;case "powerMainsFailure":c.channel=b+":"+this._chPowerMainsTransmitter;
c.dataPoint=f.POWER_MAINS_TRANSMITTER.getDptFromState(a);break;default:return null}return c};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var g=a.substr(0,f);a=a.substr(f+1);var e=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(e=this.deviceAdr.substr(0,f));if(g!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];if(a==this._chMaintenance){if("UNREACH"==b)return f.MAINTENANCE.parseDptState(b,c);f={};f["0_"+b.toLowerCase()]=c;return f}return a==this._chPowerMainsTransmitter?
f.POWER_MAINS_TRANSMITTER.parseDptState(b,c):null};return f}(),Xa=function(){var f=function(a,b,c){e.call(this,a,b,c);this.channel=1;this.legacyType="ip_rotary"};util.inherits(f,e);f.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&"ERROR_CODE"!=c&&"SENSOR_ERROR"!=c&&a.push({channel:b.deviceAdr+":0",dpt:c})});return a};f.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+
":"+this.channel,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "voltage":c.channel=b+":0";c.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(a);break;default:return null}return c};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var g=a.substr(0,f);a=a.substr(f+1);var e=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(e=this.deviceAdr.substr(0,f));if(g!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==a){if("UNREACH"==
b||"LOW_BAT"==b||"OPERATING_VOLTAGE"==b)return g.MAINTENANCE_BAT_EL.parseDptState(b,c);f={};f["0_"+b.toLowerCase()]=c;return f}if(1==a||2==a||3==a)if(b=g.KEY_TRANRECEIVER.parseDptState(b,c))f||(f={}),b.pressShort&&(f["btn"+a+"pressShort"]=!0),b.pressLong&&(f["btn"+a+"pressLong"]=!0);return f};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(a,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var f=this;this._claimButtonEvent(1,a,function(){f._claimButtonEvent(2,
a,function(){f._claimButtonEvent(3,a,function(){b&&b()})})})};f.prototype._claimButtonEvent=function(a,b,c){var f=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+":"+a,"PRESS_SHORT",function(g,e){g&&console.error("button:"+a+" claim PRESS_SHORT event error:"+g.stack);b.reportValueUsage(f.deviceIF,f.deviceAdr+":"+a,"PRESS_LONG",function(b,f){b&&console.error("button:"+a+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};return f}(),Oa=function(){var f=function(a,b,c){e.call(this,a,b,c);this._chKeyTransceivers=
[1];this._chMaintenance=0;this._chMaintenanceDpts=["UNREACH","LOW_BAT"];this.legacyType=1==this._chKeyTransceivers.length?"ip_button":"ip_button"+this._chKeyTransceivers};util.inherits(f,e);f.prototype._getReadableDpts=function(){var a=[],b=this,c=this.getSerial(),f=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getReadableDpts();f&&f.forEach(function(f){-1!=b._chMaintenanceDpts.indexOf(f)&&a.push({channel:c+":"+b._chMaintenance,dpt:f})});return a};f.prototype._getDptFromRef=function(a){return(a=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getDptFromState(a))?
{channel:this.getSerial()+":"+this._chMaintenance,dataPoint:a}:null};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var g=x.hub.m.hm._Channel["HmIP-RF"],e=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(e!=f)return null;if(parseInt(a)==this._chMaintenance){if(-1!=this._chMaintenanceDpts.indexOf(b))return g.T_MAINTENANCE.parseDptState(b,c);var h={};h["0_"+b.toLowerCase()]=c;return h}if(-1!=this._chKeyTransceivers.indexOf(parseInt(a))){if(tmp=g.KEY_TRANRECEIVER.parseDptState(b,
c))h={},1==this._chKeyTransceivers.length?h=tmp:(tmp.pressShort&&(h["btn"+a+"pressShort"]=!0),tmp.pressLong&&(h["btn"+a+"pressLong"]=!0));return h}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(a,b){var c=0,f=this,g=function(){c++;c<f._chKeyTransceivers.length?f._claimButtonEvent(f._chKeyTransceivers[c],a,g):b&&b()};this._claimButtonEvent(this._chKeyTransceivers[c],a,g)};f.prototype._claimButtonEvent=function(a,b,c){var f=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+
":"+a,"PRESS_SHORT",function(g,e){g&&console.error("button:"+a+" claim PRESS_SHORT event error:"+g.stack);b.reportValueUsage(f.deviceIF,f.deviceAdr+":"+a,"PRESS_LONG",function(b,f){b&&console.error("button:"+a+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};f.parse=function(a){var b=null,c=a.address,g=a.address.indexOf(":");-1!=g&&(b=a.address.substr(g+1),c=a.address.substr(0,g));g=null;switch(a.type){case "HmIP-MOD-OC8":g=new f(a.type,a.interface,c),g._chMaintenance=0,g._chMaintenanceDpts=
["UNREACH","OPERATING_VOLTAGE"],g._chKeyTransceivers=[parseInt(b)]}return g};f.resolve=function(a,b){return"HmIP-MOD-OC8"==a?this._resolveIPMultiButton(a,b,1,8,["UNREACH","OPERATING_VOLTAGE"]):"HmIP-RCV-50"==a.substr(0,11)?this._resolveIPMultiButton(a,b,1,50,null):null};f._resolveIPMultiButton=function(a,b,c,g,e){var h,k=[];for(h=0;h<g;h++){var l=new f(a,b.interface,b.address+":"+(h+c));l._chMaintenance=0;e&&(l._chMaintenanceDpts=e);l._chKeyTransceivers=[h+c];k.push(l)}return k};return f}(),E=function(){var f=
function(a,b,c){e.call(this,a,b,c);this.channel=1;this._chMaintenance=this._switchIdx=0;this._chSwitchVirtualReceiver1=2;this._chSwitchVirtualReceiver2=3;this._chSwitchVirtualReceiver3=4;this._chSwitchWeekProfile=5;this.legacyType="ip_switch"};util.inherits(f,e);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};f.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",
dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "state":b.channel+=this.channel;b.dataPoint="STATE";break;default:return null}return b};f.prototype.executeCommand=function(a,b,c){var f=this.getSerial(),g=this;switch(b){case "on":var e="STATE";var h=f+":"+this._chSwitchVirtualReceiver1;a.writeValue(this.deviceIF,h,e,!0,c);break;case "off":e="STATE";h=f+":"+this._chSwitchVirtualReceiver1;a.writeValue(this.deviceIF,h,e,!1,c);break;case "toggle":e=
"STATE";h=f+":"+this.channel;a.getState({interface:this.deviceIF,channel:h,datapoint:e},function(b,k){b?c&&c(b):k?(b=!0,k.value&&(b=!1),e="STATE",h=f+":"+g._chSwitchVirtualReceiver1,a.writeValue(g.deviceIF,h,e,b,c)):c&&c(Error("get switch current value return invalid"))});break;default:"onFor"==b.substr(0,5)?(b=parseFloat(b.substr(5)),isNaN(b)?c&&c(Error("onFor command invalid")):(e="ON_TIME",h=f+":"+g._chSwitchVirtualReceiver1,a.writeValue(this.deviceIF,h,e,{type:"double",value:b},function(b){b?
c&&c(b):(e="STATE",h=f+":"+g._chSwitchVirtualReceiver1,a.writeValue(g.deviceIF,h,e,!0,c))}))):c&&c(Error("no such command"))}};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var g=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(g!=f)return null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return{timeout:c};default:return g={},g["0_"+b.toLowerCase()]=c,g}case this.channel:switch(b){case "STATE":return{state:1==c?"on":"off"};default:return null}default:return null}};
f.parse=function(a){var b=null,c=a.address.indexOf(":");-1!=c&&(b=a.address.substr(c+1));c=null;switch(a.type){case "HmIP-MOD-OC8":c=this._parseTSwitch(a,b,41)}return c};f._parseTSwitch=function(a,b,c){a=new f(a.type,a.interface,a.address);a._chMaintenance=0;a.channel=parseInt(b);a._chSwitchVirtualReceiver1=a.channel+1;a._chSwitchVirtualReceiver2=a.channel+2;a._chSwitchVirtualReceiver3=a.channel+3;a._chSwitchWeekProfile=c;return a};f.resolve=function(a,b,c,g){var e=[];if("HmIP-MOD-OC8"==a)for(l=0;8>
l;l++)d=new f(a,b.interface,b.address+":"+(4*l+9)),d._chMaintenance=0,d.channel=4*l+9,d._chSwitchVirtualReceiver1=d.channel+1,d._chSwitchVirtualReceiver2=d.channel+2,d._chSwitchVirtualReceiver3=d.channel+3,d._chSwitchWeekProfile=41,e.push(d);else if(!c||!c.length){c=[];if(b.channels)for(l in b.channels){var h=b.channels[l];if(h&&"SWITCH_TRANSMITTER"==h.type&&h.address){var k=h.address.indexOf(":");-1!=k&&(h=parseInt(h.address.substr(k+1)),isNaN(h)||c.push(h))}else h&&"SWITCH_WEEK_PROFILE"==h.type&&
h.addres&&(k=h.address.indexOf(":"),-1!=k&&(h=parseInt(h.address.substr(k+1)),isNaN(h)||(g=h)))}if(c&&c.length)for(var l=0;l<c.length;l++)d=new f(a,b.interface,b.address+":"+c[l]),d._chMaintenance=0,d.channel=c[l],d._switchIdx=l,d._chSwitchVirtualReceiver1=d.channel+1,d._chSwitchVirtualReceiver2=d.channel+2,d._chSwitchVirtualReceiver3=d.channel+3,d._chSwitchWeekProfile=g,e.push(d)}return e};return f}(),Qa=function(){var f=function(a,b,c){e.call(this,a,b,c);this.channel=1;this._chMaintenance=0;this._chDimmerVirtualReceiver1=
2;this._chDimmerVirtualReceiver2=3;this._chDimmerVirtualReceiver3=4;this._chDimmerWeekProfile=13;this.legacyType="ip_dimmer"};util.inherits(f,e);f.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],f=c.MAINTENANCE.getReadableDpts();f&&f.forEach(function(c){"UNREACH"==c&&a.push({channel:b.deviceAdr+":"+b._chMaintenance,dpt:c})});(f=c.DIMMER_TRANSMITTER.getReadableDpts())&&f.forEach(function(c){a.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});(f=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&
f.forEach(function(c){a.push({channel:b.deviceAdr+":"+b._chDimmerVirtualReceiver1,dpt:c});a.push({channel:b.deviceAdr+":"+b._chDimmerVirtualReceiver2,dpt:c});a.push({channel:b.deviceAdr+":"+b._chDimmerVirtualReceiver3,dpt:c})});return a};f.prototype._getDptFromRef=function(a){var b=this.getSerail(),c={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":c.channel=b+":"+this._chMaintenance;c.dataPoint=f.MAINTENANCE.getDptFromState(a);break;case "dimmerLevel":c.channel=
b+":"+this.channel;c.dataPoint=f.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;default:return null}return c};f.prototype.executeCommand=function(a,b,c){var f=x.hub.m.hm._Channel["HmIP-RF"],g=b;if(-1!=b.indexOf("dimUp")){var e=b.indexOf("dimUp");g=b.substr(0,e+5);var h=b.substr(e+5)}else-1!=b.indexOf("dimDown")?(e=b.indexOf("dimDown"),g=b.substr(0,e+7),h=b.substr(e+7)):-1!=b.indexOf("dimTo")?(e=b.indexOf("dimTo"),g=b.substr(0,e+5),h=b.substr(e+5)):-1!=b.indexOf("toggleTo")&&(e=b.indexOf("toggleTo"),
g=b.substr(0,e+8),h=b.substr(e+8));var k=this.getSerial(),l=this;switch(g){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+this._chDimmerVirtualReceiver1,"dimOff",c);break;case "dimUp":h=h?parseInt(h)/100:.1;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,g){b?c&&c(b):"undefined"==typeof g||null==g?c&&c(Error("get dimmer current value return invalid")):(h=g.value+h,1<h&&(h=1),h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,
l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,c))});break;case "dimDown":h=h?parseInt(h)/100:.1;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,g){b?c&&c(b):"undefined"==typeof g||null==g?c&&c(Error("get dimmer current value return invalid")):(h=g.value-h,0>h&&(h=0),h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,c))});break;case "dimTo":if(!h){c&&c(Error("dimTo has no value"));
break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,channel);break;case "toggleTo":if(!h){c&&c(Error("toggle has no value"));break}a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,g){b?c&&c(b):"undefined"==typeof g||null==g?c&&c(Error("get dimmer current value return invalid")):(g.value&&(h=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,c))});break;
default:c&&c(Error("no such command"))}};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var g=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(g!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];g=null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return f.MAINTENANCE.parseDptState(b,c);default:return g={},g["0_"+b.toLowerCase()]=c,g}case this.channel:if(b=f.DIMMER_TRANSMITTER.parseDptState(b,c))g={},g.dimmerLevel=b.dimmerTLevel;return g}return null};
return f}(),Ra=function(){var f=function(a,b,c){e.call(this,a,b,c);this.channel=1;this._chMaintenance=0;this._chBlindVirtualReceiver1=2;this._chBlindVirtualReceiver2=3;this._chBlindVirtualReceiver3=4;this._chBlindWeekProfile=5;this.legacyType="ip_jalousie"};util.inherits(f,e);f.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],f=c.MAINTENANCE.getReadableDpts();f&&f.forEach(function(c){"UNREACH"==c&&a.push({channel:b.deviceAdr+":"+b._chMaintenance,dpt:c})});(f=
c.BLIND_TRANSMITTER.getReadableDpts())&&f.forEach(function(c){a.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});(f=c.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&f.forEach(function(c){a.push({channel:b.deviceAdr+":"+b._chBlindVirtualReceiver1,dpt:c});a.push({channel:b.deviceAdr+":"+b._chBlindVirtualReceiver2,dpt:c});a.push({channel:b.deviceAdr+":"+b._chBlindVirtualReceiver3,dpt:c})});return a};f.prototype._getDptFromRef=function(a){var b=this.getSerial(),c={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];
switch(a){case "timeout":c.channel=b+":"+this._chMaintenance;c.dataPoint=f.MAINTENANCE.getDptFromState(a);break;case "blindLevel":c.channel=b+":"+this.channel;c.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":c.channel=b+":"+this.channel;c.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;default:return null}return c};f.prototype.executeCommand=function(a,b,c){var f=x.hub.m.hm._Channel["HmIP-RF"],g=b;if(-1!=b.indexOf("stepUp")){var e=b.indexOf("stepUp");
g=b.substr(0,e+6);var h=b.substr(e+6)}else-1!=b.indexOf("stepDown")?(e=b.indexOf("stepDown"),g=b.substr(0,e+8),h=b.substr(e+8)):-1!=b.indexOf("moveTo")?(e=b.indexOf("moveTo"),g=b.substr(0,e+6),h=b.substr(e+6)):-1!=b.indexOf("stop")?(e=b.indexOf("stop"),g=b.substr(0,e+4),h=b.substr(e+4)):-1!=b.indexOf("lamellaStepUp")?(e=b.indexOf("lamellaStepUp"),g=b.substr(0,e+13),h=b.substr(e+13)):-1!=b.indexOf("lamellaStepDown")?(e=b.indexOf("lamellaStepDown"),g=b.substr(0,e+15),h=b.substr(e+15)):-1!=b.indexOf("lamellaTo")&&
(e=b.indexOf("lamellaTo"),g=b.substr(0,e+9),h=b.substr(e+9));var k=this.getSerial(),l=this;switch(g){case "stop":case "moveUp":case "moveDown":f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+this._chBlindVirtualReceiver1,g,c);break;case "lamellaUp":case "lamellaDown":a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,
this.deviceIF,k+":"+this._chBlindVirtualReceiver1,"lamellaTo"+(g=100),function(b){b?c&&c(b):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+Math.round(100*e.value),c)})});break;case "stepUp":case "stepDown":h=h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):(h="stepUp"==g?e.value+h:e.value-
h,1<h&&(h=1),0>h&&(h=0),h=Math.round(100*h),f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+h,c))});break;case "moveTo":if(!h){c&&c(Error("moveTo has no value"));break}f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+this._chBlindVirtualReceiver1,"moveTo"+h,c);break;case "lamellaStepUp":case "lamellaStepDown":h=h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,e){if(b)c&&c(b);
else if("undefined"==typeof e||null==e)c&&c(Error("get blind current value return invalid"));else{var m=e.value;m=Math.round(100*m);a.getState({interface:l.deviceIF,channel:k+":"+l.channel,datapoint:"LEVEL_2"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get lamella current value return invalid")):(h="lamellaStepUp"==g?e.value+h:e.value-h,1<h&&(h=1),0>h&&(h=0),h=Math.round(100*h),f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"lamellaTo"+
h,function(b,g){b?c&&c(b,g):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+m,c)}))})}});break;case "lamellaTo":if(!h){c&&c(Error("lamellaTo has no value"));break}a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,g){if(b)c&&c(b);else if("undefined"==typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var e=g.value;e=Math.round(100*e);f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,
k+":"+l._chBlindVirtualReceiver1,"lamellaTo"+h,function(b){b?c&&c(b):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+e,c)})}});break;default:c&&c(Error("no such command"))}};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var g=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(g!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];g=null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return f.MAINTENANCE.parseDptState(b,
c);default:return g={},g["0_"+b.toLowerCase()]=c,g}case this.channel:if(c=f.BLIND_TRANSMITTER.parseDptState(b,c))g={},"LEVEL"==b?g.blindLevel=c.blindTPos:"LEVEL_2"==b&&(g.lamellaLevel=c.lamellaTPos);return g}return null};f.prototype.getConfig=function(a,b){var c=this.getSerial()+":"+this.channel;a.getParamset(this.deviceIF,c,"MASTER",function(a,f){if(a)b&&b(a);else{var g={},e=null;f&&(e={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:f.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:f.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});g[c]=e;b&&b(a,g)}})};f.prototype.setConfig=function(a,b,c){if(b){var f=
this.getSerial()+":"+this.channel;if(b=b[f]){var g={};g.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:b.CHANGE_OVER_DELAY};g.REFERENCE_RUN_COUNTER=b.REFERENCE_RUN_COUNTER;g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};g.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_UNIT};g.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_VALUE};a.setParamset(this.deviceIF,f,"MASTER",g,function(a){c&&c(a)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};return f}(),
y=function(){var f=function(a,c,f){e.call(this,a,c,f);this.channel=1;this._chMaintenance=0;this.legacyType="ip_multi_input"};util.inherits(f,e);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};f.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "state":b.channel+=
this.channel;b.dataPoint="STATE";break;default:return null}return b};f.prototype.parseDptState=function(a,c,f){var b=a.indexOf(":");if(-1==b)return null;var g=a.substr(0,b);a=a.substr(b+1);b=this.getSerial();if(g!=b)return null;g=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(c){case "UNREACH":return{timeout:f};default:return g={},g["0_"+c.toLowerCase()]=f,g}case this.channel:switch(c){case "STATE":return{state:1==f?"on":"off"};case "PRESS_SHORT":case "PRESS_LONG":return g.KEY_TRANRECEIVER.parseDptState(c,
f);default:return null}default:return null}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(a,c){this._claimButtonEvent(this.channel,a,function(){c&&c()})};f.prototype._claimButtonEvent=function(a,c,f){var b=this.getSerial()+":"+a,g=this;c.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(e,h){e&&console.error("button:"+a+" claim PRESS_SHORT event error:"+e.stack);c.reportValueUsage(g.deviceIF,b,"PRESS_LONG",function(b,c){b&&console.error("button:"+a+" claim PRESS_LONG event error:"+
b.stack);f&&f()})})};var a=function(a,c,g){f.call(this,a,c,g);this.legacyType="ip_multi_input_bat"};util.inherits(a,f);a.prototype._getReadableDpts=function(){for(var a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts,c=x.hub.m.hm._Channel["HmIP-RF"].MULTI_MODE_INPUT_TRANSMITTER.getReadableDpts,f=[],g=0;g<a.length;g++)f.push({channel:this.deviceAdr+":"+this._chMaintenance,dpt:a[g]});for(g=0;g<c.length;g++)f.push({channel:this.deviceAdr+":"+this.channel,dpt:c[g]});return f};a.prototype._getDptFromRef=
function(a){var b={channel:this.getSerial()+":",dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "voltage":case "errorCode":b.channel+=this._chMaintenance;b.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "state":b.channel+=this.channel;b.dataPoint=f.MULTI_MODE_INPUT_TRANSMITTER.getDptFromState(a);break;default:return null}return b};a.prototype.parseDptState=function(a,c,f){var b=a.indexOf(":");if(-1==b)return null;var g=a.substr(0,b);a=a.substr(b+
1);b=this.getSerial();if(g!=b)return null;g=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(c){case "UNREACH":case "LOW_BAT":case "OPERATING_VOLTAGE":case "ERROR_CODE":return g.MAINTENANCE_BAT_EL.parseDptState(c,f);default:return g={},g["0_"+c.toLowerCase()]=f,g}case this.channel:switch(c){case "STATE":case "PRESS_SHORT":case "PRESS_LONG":return g.MULTI_MODE_INPUT_TRANSMITTER.parseDptState(c,f);default:return null}default:return null}};f.resolve=function(b,c,g){if("HmIP-FCI"==
b.substr(0,8)){g=parseInt(b.substr(8));var e=a}else if("HmIP-MOD-RC"==b.substr(0,11))g=parseInt(b.substr(11)),e=a;else if("HmIPW-DRI"==b.substr(0,9))g=parseInt(b.substr(9)),e=f;else{if(!g||!g.length)if(g=[],c.channels)for(e in c.channels){var h=c.channels[e];if(h&&"MULTI_MODE_INPUT_TRANSMITTER"==h.type&&h.address){var k=h.address.indexOf(":");-1!=k&&(h=parseInt(h.address.substr(k+1)),isNaN(h)||g.push(h))}}if(!g||!g.length)return[];e=[];for(h=0;h<g.length;h++)k=new f(b,c.interface,c.address+":"+g[h]),
k._chMaintenance=0,k.channel=g[h],e.push(k);return e}return this._resolveIPMultiInput(b,c,g,e)};f._resolveIPMultiInput=function(a,c,f,g){var b,e=[];for(b=0;b<f;b++){var h=new g(a,c.interface,c.address+":"+(b+1));h._chMaintenance=0;h.channel=b+1;e.push(h)}return e};f.parse=function(b){var c=null,f=b.address,g=b.address.indexOf(":");-1!=g&&(c=b.address.substr(g+1),f=b.address.substr(0,g));g=y;if("HmIP-FCI1"==b.type||"HmIP-FCI6"==b.type||"HmIP-MOD-RC8"==b.type)g=a;b=new g(b.type,b.interface,f);b._chMaintenance=
0;b.channel=parseInt(c);return b};return f}(),Ya=function(){var f=function(a,b,c){e.call(this,a,b,c);this.channel=3;this._chKeyTransceivers=[];this._chMaintenance=0;this._chMaintenanceDpts=["UNREACH"];this._chMotionDetectorTransceiver=3;this.legacyType="ip_motion2"};util.inherits(f,e);f.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],f=c.MAINTENANCE_BAT_EL.getReadableDpts();f&&f.forEach(function(c){-1!=b._chMaintenanceDpts.indexOf(c)&&a.push({channel:serialNum+
":"+b._chMaintenance,dpt:c})});(f=c.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&f.forEach(function(c){a.push({channel:b.deviceAdr+":"+b._chMotionDetectorTransceiver,dpt:c})});return a};f.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "state":case "illumination":case "active":c.channel=b+":"+
this._chMotionDetectorTransceiver;c.dataPoint=f.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(a);break;default:return null}return c};f.prototype.executeCommand=function(a,b,c){var f=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "reset":case "activate":case "deactivate":case "toggleActivate":f.MOTIONDETECTOR_TRANSCEIVER.executeCommand(a,this.deviceIF,this.deviceAdr+":"+this._chMotionDetectorTransceiver,b,c);break;default:c&&c(Error("no such command"))}};f.prototype.parseDptState=function(a,b,c){var f=
a.indexOf(":");if(-1==f)return null;var g=a.substr(0,f);a=a.substr(f+1);var e=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(e=this.deviceAdr.substr(0,f));if(g!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];g=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return f.MAINTENANCE_BAT_EL.parseDptState(b,c);g={};g["0_"+b.toLowerCase()]=c;return g}1==a&&(e=f.KEY_TRANRECEIVER.parseDptState(b,c))&&(e.pressShort&&(g={btn1pressShort:!0}),e.pressLong&&(g={btn1pressLong:!0}));2==a&&(e=f.KEY_TRANRECEIVER.parseDptState(b,
c))&&(e.pressShort&&(g={btn2pressShort:!0}),e.pressLong&&(g={btn2pressLong:!0}));return 3==a?f.MOTIONDETECTOR_TRANSCEIVER.parseDptState(b,c):g};f.prototype.isButton=function(){return 0<this._chKeyTransceivers.length};f.prototype.claimEvent=function(a,b){if(this._chKeyTransceivers&&this._chKeyTransceivers.length){var c=function(b,c,f,g){a.reportValueUsage(b,c+":"+f,"PRESS_SHORT",function(e,h){e&&console.error("button:1 claim PRESS_SHORT event error:"+e.stack);a.reportValueUsage(b,c+":"+f,"PRESS_LONG",
function(a,b){a&&console.error("button:1 claim PRESS_LONG event error:"+a.stack);g()})})},f=this,g=0,e=function(){g++;g<f._chKeyTransceivers.length?c(f.deviceIF,f.deviceAdr,f._chKeyTransceivers[g],e):b&&b()},h=this.deviceAdr;-1==h.indexOf(":")&&this.channel&&(h+=":"+this.channel);c(this.deviceIF,this.deviceAdr,this._chKeyTransceivers[g],e)}else b&&b()};f.resolve=function(a,b){b=new f(a,b.interface,b.address);"HmIPW-SMI55"==a&&(b._chKeyTransceivers=[1,2],b._chMotionDetectorTransceiver=3);return b};
return f}(),Sa=function(){var f=function(a,b,c){e.call(this,a,b,c);this.channel=1;this._chMaintenance=0;this.legacyType="ip_analog_input"};util.inherits(f,e);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"VOLTAGE"}]};f.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;
case "state":b.channel+=this.channel;b.dataPoint="VOLTAGE";break;default:return null}return b};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var g=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(g!=f)return null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return{timeout:c};default:return g={},g["0_"+b.toLowerCase()]=c,g}case this.channel:switch(b){case "VOLTAGE":return{voltage:parseFloat(c)};default:return null}default:return null}};
f.parse=function(a){var b=null,c=a.address,g=a.address.indexOf(":");-1!=g&&(b=a.address.substr(g+1),c=a.address.substr(0,g));a=new f(a.type,a.interface,c);a._chMaintenance=0;a.channel=parseInt(b);return a};return f}(),u={};u.CLASS_MAP={maintenance:k,button:m,vbutton:g,switch:h,dimmer:l,blind:q,powerswitch:n,weather:r,heater:z,heater2:v,heater3:na,wallthermo:R,wallthermo2:S,contact:oa,weatherstation:t,rain:T,gong2:F,gong:Ma,window:pa,temp:qa,co2:sa,motion:ta,smoke:ua,siren:U,capacity:va,switch_interface:N,
tilt:wa,temp2:ra,water:xa,weather2:p,energymeter:ya,rgb:O,lux:za,siren2:V,jalousie:W,mod_em_8bit:G,mod_em_8:H,keymatic:X,ou_led16:I,hm_dis_ep_wm55:Na,dualwhite:Y};u.CLASS_MAP_IP={ip_switch:Pa,ip_contact:Aa,ip_heater:Z,ip_powerswitch:aa,ip_energyactor:ba,ip_dimmer:da,ip_motion:ha,ip_motion2:J,ip_button2:Q,ip_siren:ia,ip_wallthermo:C,ip_smoke:ja,ip_window:Ca,ip_button4:K,ip_dimmer2:ea,ip_energyactor2:ca,ip_blind:A,ip_jalousie:B,ip_presence:ka,ip_dimmer3:fa,ip_wallthermo2:Ba,ip_floor_heater:Da,ip_floor_pump_heater:Ea,
ip_button6:L,ip_weather:Fa,ip_weather2:Ga,ip_weather3:Ha,ip_weather4:Ia,ip_direction:la,ip_button8:M,ip_generic_input:Ja,ip_analog_output:ma,ip_water:Ka,ip_acce:La,ip_garagedoor:D,ip_bsl:Ta,ip_tormatic:Ua,ip_button:P,ip_lux:Va,ip_pmfs:Wa,ip_rotary:Xa};u.parseJson=function(f){if(!(f&&f.type&&f.interface&&f.address))return null;switch(f.interface){case "BidCos-RF":f=this._parseRFDeviceJson(f);break;case "HmIP-RF":f=this._parseIPDeviceJson(f);break;default:return null}return f};u._parseRFDeviceJson=
function(f){var a=x.hub.m.hm.RFDeviceTypes[f.type];if("undefined"==typeof a||null==a)return null;a=x.hub.m.hm.RFDeviceCatagory[a];if(!a||!a.type)return null;var b=this.CLASS_MAP[a.type];if(!b)return null;a=null;var c=f.address.indexOf(":");-1!=c&&(a=f.address.substr(c+1));"HM-Dis-EP-WM55"==f.type&&3==a&&(b=this.CLASS_MAP.hm_dis_ep_wm55);f=new b(f.type,f.interface,f.address);a&&(f.channel=parseInt(a));return f};u._parseIPDeviceJson=function(f){if("HmIPW"==f.type.substr(0,5))return this._parseIPW(f);
if("HmIP-MIOB"==f.type)return u._parse_HMIP_MIOB(f);if("HmIP-FCI1"==f.type||"HmIP-FCI6"==f.type||"HmIP-MOD-RC8"==f.type)return y.parse(f);var a=null,b=f.address.indexOf(":");-1!=b&&(a=f.address.substr(b+1));switch(f.type){case "HmIP-WHS2":return this._parseTSwitch(f,a,9);case "HmIP-MOD-OC8":return 8>=parseInt(a)?Oa.parse(f):E.parse(f);case "HmIP-MIO16-PCB":return 13>parseInt(a)?Sa.parse(f):17>parseInt(a)?y.parse(f):E.parse(f)}a=u._getIPMetaIndex(f.type);if("undefined"==typeof a||null==a)return null;
a=x.hub.m.hm.IPDeviceCatagory[a];if(!a||!a.type)return null;var c=this.CLASS_MAP_IP[a.type];if(!c)return null;a=null;b=f.address.indexOf(":");-1!=b&&(a=f.address.substr(b+1));f=new c(f.type,f.interface,f.address);a&&(f.channel=parseInt(a));return f};u._parseIPW=function(f){var a=null;var b=f.address.indexOf(":");-1!=b&&(a=f.address.substr(b+1));return"HmIPW-DRS"==f.type.substr(0,9)?(b=parseInt(f.type.substr(9)),f=new E(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chSwitchVirtualReceiver1=
f.channel+1,f._chSwitchVirtualReceiver2=f.channel+2,f._chSwitchVirtualReceiver3=f.channel+3,f._chSwitchWeekProfile=4*b+1,f):"HmIPW-DRD"==f.type.substr(0,9)?(b=parseInt(f.type.substr(9)),f=new Qa(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chDimmerVirtualReceiver1=f.channel+1,f._chDimmerVirtualReceiver2=f.channel+2,f._chDimmerVirtualReceiver3=f.channel+3,f._chDimmerWeekProfile=4*b+1,f):"HmIPW-DRBL"==f.type.substr(0,10)?(b=parseInt(f.type.substr(10)),f=new Ra(f.type,f.interface,
f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chBlindVirtualReceiver1=f.channel+1,f._chBlindVirtualReceiver2=f.channel+2,f._chBlindVirtualReceiver3=f.channel+3,f._chBlindWeekProfile=4*b+1,f):"HmIPW-DRI"==f.type.substr(0,9)?(parseInt(f.type.substr(9)),f=new y(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f):"HmIPW-FIO"==f.type.substr(0,9)?(b=parseInt(f.type.substr(9)),a=parseInt(a),a<=b?(f=new y(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a)):
(f=new E(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chSwitchVirtualReceiver1=f.channel+1,f._chSwitchVirtualReceiver2=f.channel+2,f._chSwitchVirtualReceiver3=f.channel+3,f._chSwitchWeekProfile=b+4*b+1),f):null};u._parse_HMIP_MIOB=function(f){var a=f.address,b=null,c=f.address.indexOf(":");-1!=c&&(a=f.address.substr(0,c),b=f.address.substr(c+1));c=null;0==b?c=this.CLASS_MAP.maintenance:3==b||7==b?c=this.CLASS_MAP_IP.ip_switch:9==b||10==b?c=this.CLASS_MAP_IP.ip_generic_input:
11==b&&(c=this.CLASS_MAP_IP.ip_analog_output);return c?(f=new c(f.type,f.interface,a),f.channel=b,f):null};u._parseTSwitch=function(f,a,b){f=new E(f.type,f.interface,f.address);f._chMaintenance=0;f.channel=parseInt(a);f._chSwitchVirtualReceiver1=f.channel+1;f._chSwitchVirtualReceiver2=f.channel+2;f._chSwitchVirtualReceiver3=f.channel+3;f._chSwitchWeekProfile=b;return f};u.resolve=function(f){if(!f||!f.type||!f.interface)return null;switch(f.interface){case "BidCos-RF":f=this._resolveRFFromType(f.type,
f);break;case "HmIP-RF":f=this._resolveIPFromType(f.type,f);break;default:return null}return f?Array.isArray(f)?f:[f]:null};u._resolveRFFromType=function(f,a){if("HM-MOD-EM-8"==f)return this._resolve_HM_MOD_EM_8(f,a);if("HM-OU-LED16"==f)return this._resolve_HM_OU_LED16(f,a);if("HM-Dis-EP-WM55"==f)return this._resolve_HM_Dis_EP_WM55(f,a);var b=x.hub.m.hm.RFDeviceTypes[f];if("undefined"==typeof b||null==b)return null;b=x.hub.m.hm.RFDeviceCatagory[b];if(!b||!b.type)return this._resolveRFFromTypeGeneral(f,
a);var c=[];if(a.channels)for(var g in a.channels){var e=a.channels[g];e.type==b.channel&&c.push(e)}var h=this.CLASS_MAP[b.type];if(!h)return null;if("*"==b.channelNum){var k=[];c.forEach(function(b){var g=new h(f,a.interface,a.address),e=b.address.indexOf(":");1<c.length&&(g.deviceAdr=b.address);g.channel=b.address.substr(e+1);k.push(g)});return k}g=new h(f,a.interface,a.address);"undefined"!=typeof b.channelNum&&null!=b.channelNum&&(g.channel=b.channelNum);return g};u._resolveIPFromType=function(f,
a){if("HmIPW"==f.substr(0,5))return this._resolveIPW(f,a);if("HmIP-MOD-OC8"==f){var b=Oa.resolve(f,a),c=E.resolve(f,a);return b.concat(c)}if(0==f.indexOf("HmIP-FAL"))return u._resolve_HMIP_FAL_X(f,a);if(0==f.indexOf("HmIP-MIOB"))return u._resolve_HMIP_MIOB(f,a);if("HmIP-DRSI"==f.substr(0,9)){b=parseInt(f.substr(9));c=[];for(var g=1;g<=b;g++)c.push(g);return y.resolve(f,a,c)}if("HmIP-DRDI"==f.substr(0,9)){b=parseInt(f.substr(9));c=[];for(g=1;g<=b;g++)c.push(g);return y.resolve(f,a,c)}if("HmIP-DRBLI"==
f.substr(0,10)){b=parseInt(f.substr(10));c=[];for(g=1;g<=2*b;g++)c.push(g);return y.resolve(f,a,c)}switch(f){case "HmIP-PCBS2":return Oa._resolveIPMultiButton(f,a,1,2,["UNREACH","OPERATING_VOLTAGE"]);case "HmIP-WHS2":return this._resolveIPMultiSwitch(f,a,2);case "HmIP-FCI1":case "HmIP-FCI6":case "HmIP-MOD-RC8":return y.resolve(f,a);case "HmIP-MIO16-PCB":return u._resolve_HMIP_MIO16_PCB(f,a)}b=this._getIPMetaIndex(f);if("undefined"==typeof b||null==b)return null;b=x.hub.m.hm.IPDeviceCatagory[b];if(!b||
!b.type)return null;var e=[];if(a.channels)for(c in a.channels)g=a.channels[c],g.type==b.channel&&e.push(g);var h=this.CLASS_MAP_IP[b.type];if(!h)return null;if("*"==b.channelNum){var k=[];e.forEach(function(b){var c=new h(f,a.interface,a.address),g=b.address.indexOf(":");1<e.length&&(c.deviceAdr=b.address);c.channel=b.address.substr(g+1);k.push(c)});return k}c=new h(f,a.interface,a.address);"undefined"!=typeof b.channelNum&&null!=b.channelNum&&(c.channel=b.channelNum);return c};u._resolveIPW=function(f,
a){var b,c=[];if("HmIPW-DRS"==f.substr(0,9)){var g=parseInt(f.substr(9));c=this._resolveIPMultiSwitch(f,a,g)}else if("HmIPW-DRD"==f.substr(0,9))for(g=parseInt(f.substr(9)),b=0;b<g;b++){var e=new Qa(f,a.interface,a.address+":"+(4*b+1));e._chMaintenance=0;e.channel=4*b+1;e._chDimmerVirtualReceiver1=e.channel+1;e._chDimmerVirtualReceiver2=e.channel+2;e._chDimmerVirtualReceiver3=e.channel+3;e._chDimmerWeekProfile=4*g+1;c.push(e)}else if("HmIPW-DRBL"==f.substr(0,10))for(g=parseInt(f.substr(10)),b=0;b<
g;b++)e=new Ra(f,a.interface,a.address+":"+(4*b+1)),e._chMaintenance=0,e.channel=4*b+1,e._chBlindVirtualReceiver1=e.channel+1,e._chBlindVirtualReceiver2=e.channel+2,e._chBlindVirtualReceiver3=e.channel+3,e._chBlindWeekProfile=4*g+1,c.push(e);else if("HmIPW-DRI"==f.substr(0,9))for(g=parseInt(f.substr(9)),b=0;b<g;b++)e=new y(f,a.interface,a.address+":"+(b+1)),e._chMaintenance=0,e.channel=b+1,c.push(e);else if("HmIPW-FIO"==f.substr(0,9))for(g=parseInt(f.substr(9)),b=0;b<g;b++)e=new y(f,a.interface,a.address+
":"+(b+1)),e._chMaintenance=0,e.channel=b+1,c.push(e),e=new E(f,a.interface,a.address+":"+(4*b+g+1)),e._chMaintenance=0,e.channel=4*b+g+1,e._chSwitchVirtualReceiver1=e.channel+1,e._chSwitchVirtualReceiver2=e.channel+2,e._chSwitchVirtualReceiver3=e.channel+3,e._chSwitchWeekProfile=g+4*g+1,c.push(e);else"HmIPW-SMI55"==f&&(e=Ya.resolve(f,a),c.push(e));return c};u._resolveIPMultiSwitch=function(f,a,b){var c,g=[];for(c=0;c<b;c++){var e=new E(f,a.interface,a.address+":"+(4*c+1));e._chMaintenance=0;e.channel=
4*c+1;e._chSwitchVirtualReceiver1=e.channel+1;e._chSwitchVirtualReceiver2=e.channel+2;e._chSwitchVirtualReceiver3=e.channel+3;e._chSwitchWeekProfile=4*b+1;g.push(e)}return g};u._resolveRFFromTypeGeneral=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,g;for(g in c){var e=c[g];if(e&&e.type&&x.hub.m.hm._Channel["BidCos-RF"][e.type]&&(e=x.hub.m.hm._Channel["BidCos-RF"][e.type].device)&&(e=this.CLASS_MAP[e])){e=new e(f,a.interface,g);var h=g.indexOf(":");e.channel=g.substr(h+1);
b.push(e)}}return b};u._resolve_HM_MOD_EM_8=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,g;for(g in c){c=g.indexOf(":");c=g.substr(c+1);var e=new (0==c?this.CLASS_MAP.maintenance:this.CLASS_MAP.mod_em_8)(f,a.interface,g);e.channel=c;b.push(e)}return b};u._resolve_HM_OU_LED16=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,g;for(g in c){c=g.indexOf(":");c=g.substr(c+1);var e=new (0==c?this.CLASS_MAP.maintenance:this.CLASS_MAP.ou_led16)(f,a.interface,
g);e.channel=c;b.push(e)}return b};u._resolve_HM_Dis_EP_WM55=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,g;for(g in c){c=g.indexOf(":");c=g.substr(c+1);var e=null;0==c?e=this.CLASS_MAP.maintenance:1==c||2==c?e=this.CLASS_MAP.button:3==c&&(e=this.CLASS_MAP.hm_dis_ep_wm55);e&&(e=new e(f,a.interface,g),e.channel=c,b.push(e))}return b};u._resolve_HMIP_FAL_X=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,g;for(g in c){var e=c[g],h=g.indexOf(":");h=g.substr(h+
1);if(0==h)var k=this.CLASS_MAP.maintenance;else"CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER"==e.type?k=this.CLASS_MAP_IP.ip_floor_pump_heater:"CLIMATECONTROL_FLOOR_TRANSCEIVER"==e.type&&(k=this.CLASS_MAP_IP.ip_floor_heater);k&&(e=new k(f,a.interface,g),e.channel=h,b.push(e))}return b};u._resolve_HMIP_MIOB=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,g;for(g in c){c=g.indexOf(":");c=g.substr(c+1);var e=null;0==c?e=this.CLASS_MAP.maintenance:3==c||7==c?e=this.CLASS_MAP_IP.ip_switch:
9==c||10==c?e=this.CLASS_MAP_IP.ip_generic_input:11==c&&(e=this.CLASS_MAP_IP.ip_analog_output);e&&(e=new e(f,a.interface,g),e.channel=c,b.push(e))}return b};u._resolve_HMIP_MIO16_PCB=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,g;for(g in c){c=g.indexOf(":");c=g.substr(c+1);var e;if(e=0==c?this.CLASS_MAP.maintenance:1<=c&&12>=c?Sa:13<=c&&16>=c?y:E)e=new e(f,a.interface,g),e.channel=c,b.push(e)}return b};u._getIPMetaIndex=function(f){for(var a in x.hub.m.hm.IPDeviceTypes)if(x.hub.m.hm.IPDeviceTypes.hasOwnProperty(a)&&
a.toUpperCase()==f.toUpperCase())return x.hub.m.hm.IPDeviceTypes[a];return null};return u}();
x.hub.m.hm.Manager=function(){var e=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager");this._gateway=e;this._devices={};this._meta={}};e.prototype.init=function(e){x.hub.m.hm._Util.isIP(this._gateway.ip)?(this._logger.log("info","start connect monitor to "+this._gateway.ip),this._startMonitor(e)):e&&e()};e.prototype.onDeviceEvent=function(e){this._logger.log("trace","receive device event:"+JSON.stringify({device:e.device?e.device.type:null,address:e.device?e.device.address:
null,channel:e.channel,datapoint:e.datapoint,value:e.value?e.value.value:null,ip:e.ip}));var k=function(g,e){var h=null;if(!e||0==e.length)return null;e.forEach(function(e){e&&e.key==g&&(h=e)});return h};if(!e||!e.device)return null;var g=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!g)return null;var h=e.device;h.hsstype=h.type;if(h.channels)for(var l in h.channels)if(h.channels.hasOwnProperty(l)){var q=h.channels[l];q.hsstype=q.type}h=g._parseDevice(h);if(!h||0==h.length)return null;var n;
1==h.length?n=h[0]:h.forEach(function(g){if(g.address==e.channel)n=g;else if(0==e.channel.indexOf(g.address)){var h=e.channel.split(":")[1];if(g.channels)for(var k in g.channels)if(g.channels[k].address==h){n=g;break}}});if(!n)return null;h=x.hub.m.hm._Util.getDeviceHashCode(n);var r=g.resolveState(n,e,e.oldValue.value);g=g.resolveState(n,e,e.value.value);if(!g)return null;this._logger.log("trace","event to device state");this._logger.log("trace","device:"+JSON.stringify(n));this._logger.log("trace",
"state:"+JSON.stringify(g));var p=[];Array.isArray(g)?g.forEach(function(g){var e=k(g.key,r);p.push({device:n,gateway:this._gateway,data:{key:g.key,value:g.value,changed:e?g.value!=e.value:!0,oldValue:e?e.value:void 0}})}.bind(this)):p.push({device:n,gateway:this._gateway,data:{key:g.key,value:g.value,changed:g.value!=r.value,oldValue:r.value}});this._generateEvent(h,p)};e.prototype._generateEvent=function(e,m){var g=require("x.hub.eventbus.js");if((e=this._meta[e])&&0<e.length)for(var h=0;h<e.length;h++){var k=
e[h];if(k)for(var q=0;q<m.length;q++){var n=m[q];n&&n.data&&(n.data.key==k.statusKey||"*"==n.data.key)&&g.emit("status",{module:"hm",device:n.device,gateway:n.gateway,data:n.data},k)}}};e.prototype.addStateDevice=function(e,m,g){if(e){e=JSON.parse(JSON.stringify(e));var h=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[h]||(delete e.gateway,this._devices[h]=e);this._meta[h]||(this._meta[h]=[]);g&&this._meta[h].push(g);m&&m()}else m&&m(Error("device json invalid"))};e.prototype.removeStateDevice=
function(e,m,g){if(!e)m&&m(Error("device json invalid"));else if(g){e=JSON.parse(JSON.stringify(e));e=x.hub.m.hm._Util.getDeviceHashCode(e);var h=this._meta[e];if(h){for(var k=-1,q=0;q<h.length;q++){var n=h[q];if(n&&"taskman"==n.src&&"taskman"==g.src&&n.taskID==g.taskID&&n.statusKey==g.statusKey){k=q;break}}0<=k&&h.splice(k,1);0==h.length&&(delete this._devices[e],delete this._meta[e])}m&&m()}};e.prototype.getAllStates=function(){var e=[],m;for(m in this._devices)if(this._devices.hasOwnProperty(m)){var g=
this._devices[m];g&&g.device&&(g=this.getStates(g.device))&&e.push(g)}return e};e.prototype.getStates=function(e){if(!e)return null;e=JSON.parse(JSON.stringify(e));var k=x.hub.m.hm._Util.getDeviceHashCode(e),g=this._devices[k];g||this.addStateDevice(e);var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return null;var l={};g=this._devices[k];for(var q in g.states)k=h.getBufferedState(g.states[q]),l[q]=this._resolveRawState(e,q,k);return{device:e,gateway:this._gateway,
states:l}};e.prototype.updateStates=function(e,m){if(e){e=JSON.parse(JSON.stringify(e));var g=x.hub.m.hm._Util.getDeviceHashCode(e),h=this._devices[g];h||this.addStateDevice(e);h=this._devices[g];this._updateStates(e,h.states,m)}else m&&m(Error("device json is null"))};e.prototype.getState=function(e,m,g){if(!e||!m)return g&&g(Error("argument invalid")),null;if("SysVar"==e.type||"CUxD"==e["interface"])x.hub.m.hm.HM_MODULE.doStatus("var",this._gateway,e,{value:m},function(e,h){e?g&&g(e):h?(e={value:h.status,
time:(new Date).getTime()},g&&g(null,e)):g&&g(Error("get sys var status return null"))});else{e=JSON.parse(JSON.stringify(e));var h=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[h]||this.addStateDevice(e);h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return g&&g(Error("no monitor for gateway")),null;var k=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!k)return g&&g(Error("gateway json invalid")),null;var q=k.resolveDatapointInfo(e,m);
if(!q)return g&&g(Error("device json or state ref invalid")),null;h.getState(q,function(h,l){if(h)g&&g(h);else if(l){h=k.resolveState(e,q,l.value);var n;h?Array.isArray(h)?h.forEach(function(g){g&&g.key==m&&(n={value:g.value,time:l.time})}):n={value:h.value,time:l.time}:n={value:h,time:l.time};g&&g(null,n)}else g&&g(null,null)})}};e.prototype.executeCommand=function(e,m,g){var h=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!h)return g&&g(Error("gateway json invalid")),null;h.executeCommandCreator(e,
m,g)};e.prototype.updateState=function(e,m,g){if(!e||!m)return g&&g(Error("argument invalid")),null;e=JSON.parse(JSON.stringify(e));var h=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[h]||this.addStateDevice(e);h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return g&&g(Error("no monitor for gateway")),null;var k=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!k)return g&&g(Error("gateway json invalid")),null;var q=k.resolveDatapointInfo(e,
m);if(!q)return g&&g(Error("device json or state ref invalid")),null;h.updateState(q,function(h,l){if(h)g&&g(h);else{h=k.resolveState(e,q,l);var n;h?Array.isArray(h)?h.forEach(function(g){g&&g.key==m&&(n={value:g.value})}):n={value:h.value}:n={value:h};g&&g(null,n)}})};e.prototype._startMonitor=function(e){var k=require("x.hub.m.hm.js")._monitorManager,g=this;k.startMonitor(this._gateway,{persistant:!0},function(h){var l=k.getMonitor(g._gateway.ip,g._gateway.uuid);if(l)l.on("new_devices",g._onNewDevices.bind(g));
e&&e(h)})};e.prototype._onNewDevices=function(e){var k=[],g;for(g in e)if(e.hasOwnProperty(g)){var h=x.hub.m.hm._Device.resolve(e[g]);h&&0<h.length&&(h=h.filter(function(g){return g&&g.isButton()}),k=k.concat(h))}var l=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(l&&0<k.length){var q=0,n=function(){q++;q<k.length&&k[q].claimEvent(l,n)};k[q].claimEvent(l,n)}};e.prototype._updateStates=function(e,m,g){var h=this;require("x.hub.m.hm.js")._monitorManager.startMonitor(this._gateway,
{persistant:!0},function(k){k?g&&g(k):h._getStateByScript(e,m,g)})};e.prototype._resolveDetailDpt=function(e){var k=require("xnm.aio.hm.js").devicemanager,g=k.applyUIFilter(e,{catagory:"status",elems:"*"}),h=g?g.status:null;k=(g=k.applyUIFilter(e,{catagory:"command",elems:"*"}))?g.command:null;g={states:{},commands:{}};if(h&&0<=h.length)for(var l=0;l<h.length;l++){var q=h[l],n=this._resolveDatapointRef(e,q.ref.value,!1);n&&(g.states[q.ref.value]=n)}if(k&&0<=k.length)for(l=0;l<k.length;l++)h=k[l],
(n=this._resolveDatapointRef(e,h.ref.value,!0))&&(g.commands[h.ref.value]=n);return g};e.prototype.learnRFDevice=function(e){var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);k?k.learnRF(function(g,h){if(g)e&&e(g);else{g=[];var k=new x.hub.m.hm.HM_MODULE.CCU,m;for(m in h){var n=h[m];n.hsstype=n.type;if(n.channels)for(m in n.channels)n.channels[m].hsstype=n.channels[m].type;(n=k._parseDevice(n))&&(g=g.concat(n))}e&&e(null,g)}}):e&&e(Error("monitor not started"))};
e.prototype.learnIPDevice=function(e,m,g){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnIP(e,m,function(e,h){if(e)g&&g(e);else{e=[];var k=new x.hub.m.hm.HM_MODULE.CCU,l;for(l in h){var m=h[l];m.hsstype=m.type;if(m.channels)for(l in m.channels)m.channels[l].hsstype=m.channels[l].type;(m=k._parseDevice(m))&&(e=e.concat(m))}g&&g(null,e)}}):g&&g(Error("monitor not started"))};e.prototype.learnIPDeviceQR=function(e,m){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,
this._gateway.uuid);g?g.learnIPQR(e,function(g,e){if(g)m&&m(g);else{g=[];var h=new x.hub.m.hm.HM_MODULE.CCU,k;for(k in e){var l=e[k];l.hsstype=l.type;if(l.channels)for(k in l.channels)l.channels[k].hsstype=l.channels[k].type;(l=h._parseDevice(l))&&(g=g.concat(l))}m&&m(null,g)}}):m&&m(Error("monitor not started"))};e.prototype.deleteDevice=function(e,m,g){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.deleteDevice(e,m,g):g&&g(Error("monitor not started"))};
e.prototype.getRFInterfaces=function(e){var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);k?k.getRFInterfaces(e):e&&e(Error("monitor not started"))};return e}();x.hub.m.hm.ChipManager=function(e){x.hub.m.hm.Manager.call(this,e);this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager.ChipManager")};util.inherits(x.hub.m.hm.ChipManager,x.hub.m.hm.Manager);
x.hub.m.hm.ChipManager.prototype.init=function(e){if(x.hub.m.hm._Util.isIP(this._gateway.ip)){this._logger.log("info","start connect monitor to "+this._gateway.ip);var k=this,m=require("x.hub.m.hm.js")._monitorManager;m.startMonitor(this._gateway,{localChip:"chip",persistant:!0},function(g){var h=m.getMonitor(k._gateway.ip,k._gateway.uuid);if(h)h.on("new_devices",k._onNewDevices.bind(k));e&&e(g)},!0,!0)}else e&&e()};
x.hub.m.hm.ChipManager.prototype.reset=function(e){var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!k)return e&&e(Error("no chip monitor")),null;k.reset(e)};
x.hub.m.hm.ChipManager.prototype.executeCommand=function(e,k,m){if(e&&e.address&&k)if(e=e.address.split("."),3>e.length)m&&m({error:Error("address invalid")});else{var g={type:e[0],interface:e[1],address:e[2]};e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return m&&m(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.executeCommand(e,k.value,m):m&&m(Error("unknow device"))}else m&&m(Error("argument invalid"))};
x.hub.m.hm.ChipManager.prototype.getState=function(e,k,m){if(!e||!e.address||!k)return m&&m(Error("argument invalid")),null;e=e.address.split(".");if(3>e.length)m&&m(Error("address invalid"));else{var g={type:e[0],interface:e[1],address:e[2]};e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return m&&m(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.getState(e,k.value,m):m&&m(Error("unknow device"))}};
x.hub.m.hm.ChipManager.prototype.getBufferedStateLegacy=function(e,k){if(!e)return null;e=x.hub.m.hm._Device.resolve(e);if(!e||0==e.length)return null;var m;1==e.length?m=e[0]:e.forEach(function(g){g.deviceAdr==k&&(m=g)});if(!m)return null;var g;if(e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid)){e=e.getAllBufferedStates();var h=m.deviceAdr,l=h.indexOf(":");-1!=l&&(h=h.substr(0,l));e[h]&&e[h].states&&(g=m.parseStates(e[h].states))}if(!g)return null;e={type:"HM",
adr:m.toLegacyAdr(),state:{}};for(var q in g)e.state[q]=g[q].value;return e};
x.hub.m.hm.ChipManager.prototype.checkButtonEvent=function(e){if(!e||!e.device||!e.datapoint||0!=e.datapoint.indexOf("PRESS"))return null;var k=x.hub.m.hm._Device.resolve(e.device);if(!k||0==k.length)return null;var m;1==k.length?m=k[0]:k.forEach(function(g){g.deviceAdr==e.channel&&(m=g)});if(!m)return null;k=m.parseDptState(e.channel,e.datapoint,e.value.value);if(!k)return null;var g={type:"HM",adr:m.deviceType+"."+m.deviceIF+"."+m.deviceAdr,state:{},_ver:"v5+"},h=Object.keys(k);g.state[h[0]]=k[h[0]];
require("x.hub.eventbus.js").emit("gatewayevent",g,{address:"HM"},"BTN")};
x.hub.m.hm.ChipManager.prototype.onDeviceEvent=function(e){if(!e||!e.device)return null;var k=x.hub.m.hm._Device.resolve(e.device);if(!k||0==k.length)return null;var m;1==k.length?m=k[0]:k.forEach(function(g){g.deviceAdr==e.channel&&(m=g)});if(!m)return null;k=m.parseDptState(e.channel,e.datapoint,e.oldValue.value);var g=m.parseDptState(e.channel,e.datapoint,e.value.value);if(!g)return null;var h={sys:"aio",type:"HM",address:m.deviceType+"."+m.deviceIF+"."+m.deviceAdr},l=this._gateway,q={key:null,
value:null,changed:e.changed,oldValue:null},n=Object.keys(g);q.key=n[0];q.value=g[n[0]];q.oldValue=k?k[n[0]]:void 0;this._logger.log("debug","EVENT:\t"+h.address+"\t"+q.key+"\t"+q.value);return{device:h,gateway:l,data:q}};
x.hub.m.hm.ChipManager.prototype.learnRFDevice=function(e){var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);k?k.learnRF(function(k,g){if(k)e&&e(k);else{var h=[],l;for(l in g){var m=x.hub.m.hm._Device.resolve(g[l]);m&&(h=h.concat(m))}e&&e(k,h)}}):e&&e(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnRFDeviceSN=function(e,k){var m=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);m?m.learnRFSN(e,function(g,e){if(g)k&&k(g);else{var h=[],m;for(m in e){var n=x.hub.m.hm._Device.resolve(e[m]);n&&(h=h.concat(n))}k&&k(g,h)}}):k&&k(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDevice=function(e,k,m){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);g?g.learnIP(e,k,function(g,e){if(g)m&&m(g);else{var h=[],k;for(k in e){var l=x.hub.m.hm._Device.resolve(e[k]);l&&(h=h.concat(l))}m&&m(g,h)}}):m&&m(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDeviceQR=function(e,k){var m=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);m?m.learnIPQR(e,function(g,e){if(g)k&&k(g);else{var h=[],m;for(m in e){var n=x.hub.m.hm._Device.resolve(e[m]);n&&(h=h.concat(n))}k&&k(g,h)}}):k&&k(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.getAllBufferedStates=function(){var e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return[];e=e.getAllBufferedStates();var k=[],m;for(m in e){var g=e[m],h=x.hub.m.hm._Device.resolve(g.device);if(h)for(var l=0,q=h.length;l<q;l++){var n=h[l],r=n.parseStates(g.states);k.push({device:n,states:r})}}return k};
x.hub.m.hm.ChipManager.prototype.getConfig=function(e,k){if(e&&e.address)if(e=e.address.split("."),3>e.length)k&&k({error:Error("address invalid")});else{var m={type:e[0],interface:e[1],address:e[2]};e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return k&&k(Error("no chip monitor")),null;(m=x.hub.m.hm._Device.parseJson(m))?m.getConfig(e,k):k&&k(Error("unknow device"))}else k&&k(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype.setConfig=function(e,k,m){if(e&&e.address)if(e=e.address.split("."),3>e.length)m&&m({error:Error("address invalid")});else{var g={type:e[0],interface:e[1],address:e[2]};e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return m&&m(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.setConfig(e,k,m):m&&m(Error("unknow device"))}else m&&m(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype._onNewDevices=function(e){var k=[],m;for(m in e)if(e.hasOwnProperty(m)){var g=x.hub.m.hm._Device.resolve(e[m]);g&&0<g.length&&(g=g.filter(function(g){return g&&g.isButton()}),k=k.concat(g))}var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(h&&0<k.length){var l=0,q=function(){l++;l<k.length&&k[l].claimEvent(h,q)};k[l].claimEvent(h,q)}};
x.hub.m.hm.CCU2Discovery=function(){var e=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.CCU2Discovery");this._autoDiscoverTO=null;var k=this;this._hmHandlerCB=function(g,e){k._logger.log("debug","find ccu:"+g.uuid+"@"+g.ip+" from netif:"+e);k._searchCB&&k._searchCB(g,e);if(g.ip){var h=!1;k._searchTmpHMs.forEach(function(e){e.ip==g.ip&&(h=!0)});h||k._searchTmpHMs.push(g)}};this._searchCB=e;this._searchRunning=!1;this._searchTmpHMs=[];this._searchTmpCBs=[]};e.prototype.discover=
function(e){e&&-1==this._searchTmpCBs.indexOf(e)&&this._searchTmpCBs.push(e);if(!this._searchRunning){this._searchRunning=!0;this._searchTmpHMs=[];this._autoDiscoverTO&&(clearTimeout(this._autoDiscoverTO),this._autoDiscoverTO=null);require("xnm.aio.hm.js").discoverCCUs(this._hmHandlerCB);var k=this;setTimeout(function(){k._searchRunning=!1;k._autoDiscoverTO=setTimeout(function(){k.discover()},3E4);k._searchTmpCBs.forEach(function(g){g&&g(k._searchTmpHMs)});k._searchTmpCBs=[]},3E3)}};return e}();
x.hub.m.hm._Util={isDeviceJsonValid:function(e){return e&&e.type&&e.address&&e.interface},isGatewayJsonValid:function(e){return e&&e.ip},getDeviceHashCode:function(e){if(!e)return-1;var k=0;k=(k<<5)-k+this._getStringHashCode(e.type);k=(k<<5)-k+this._getStringHashCode(e.address);return k=(k<<5)-k+this._getStringHashCode(e.interface)},getGatewayHashCode:function(e){if(!e)return-1;var k=80;e.port&&((k=parseInt(e.port))||(k=80));var m=0;m=(m<<5)-m+this._getStringHashCode(e.ip);m=(m<<5)-m+k;m=(m<<5)-m+
this._getStringHashCode(e.uuid);m=(m<<5)-m+this._getStringHashCode(e.username);return m=(m<<5)-m+this._getStringHashCode(e.password)},getLocalIP:function(e,k){var m=function(g){return g?(g=g.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))?(+g[1]<<24)+(+g[2]<<16)+(+g[3]<<8)+ +g[4]:-1:-1};if("127.0.0.1"==k||"localhost"==k)return"127.0.0.1";var g=require("os").networkInterfaces(),h;for(h in g)if(g.hasOwnProperty(h))for(var l=g[h],q=0;q<l.length;q++){var n=l[q];if(n&&"IPv4"==n.family&&n.address){if(e==h||!e&&
!k)return n.address;if(!e&&n.netmask&&k){var r=m(n.netmask),p=m(n.address),t=m(k);if((p&r)==(t&r))return n.address}}}return null},getLocalMac:function(e){var k=require("os").networkInterfaces(),m;for(m in k)if(k.hasOwnProperty(m))for(var g=k[m],h=0;h<g.length;h++){var l=g[h];if(l&&"IPv4"==l.family&&l.address&&l.mac&&e==l.address)return l.mac}return"00:00:00:00:00:00"},isIP:function(e){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e)},
mergeObj:function(e,k){var m={},g;for(g in e)e.hasOwnProperty(g)&&(m[g]=e[g]);for(g in k)k.hasOwnProperty(g)&&(m[g]=k[g]);return m},_getStringHashCode:function(e){var k=0,m;if("undefined"==typeof e||null==e)return-1;if(0===e.length)return k;var g=0;for(m=e.length;g<m;g++){var h=e.charCodeAt(g);k=(k<<5)-k+h}return k}};
x.hub.m.hm.UdpEventProducer=function(){var e=function(e){this._handler=e;this._pool={}};e.prototype.EVENT_TO=300;e.prototype.onEvent=function(e){if(e&&e.channel){var k=0,g=e.channel,h=g.indexOf(":");-1!=h&&(g=e.channel.substr(0,h),k=e.channel.substr(h+1));(h=this._pool[g])&&h.timeout&&clearTimeout(h.timeout);var l=this;h=setTimeout(function(){var e=l._pool[g];l._pool[g]=null;for(var h in e){var k=e[h];if(k=l._handler._chipManager.getBufferedStateLegacy(k.device,k.channel)){k._ver="v5+";var m=require("x.hub.eventbus.js");
m.emit("gatewayevent",k,{address:"HM"},"STA");m.emit("udpevent",k,"STA")}}},this.EVENT_TO);this._pool[g]||(this._pool[g]={});this._pool[g].timeout=h;this._pool[g][k]||(this._pool[g][k]=e)}};e.prototype.addSTAEvent=function(e){if(e&&e.adr){var k=(new Date).getTime(),g=e.adr,h=this._pool[g];h&&h.timeout&&clearTimeout(h.timeout);var l=this;h=setTimeout(function(){var e=l._pool[g];if(e&&e.states){var h=require("x.hub.eventbus.js");h.emit("gatewayevent",e.states,{address:"HM"},"STA");h.emit("udpevent",
e.states,"STA")}},this.EVENT_TO);this._pool[g]={states:e,timestamp:k,timeout:h}}};return e}();
x.hub.m.hm.Handler=function(){var e=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Handler");var e=this;this._udpEvtProducer=new x.hub.m.hm.UdpEventProducer(this);this._discoveryCB=function(k,g){e._onFindHM(k,g)};this._monitorManager=this._discovery=null;this._managers={};this._chipManager=this._xmlrpcServer=null};util.inherits(e,EventEmitter);e.prototype.CCU=x.hub.m.hm.CCU;e.prototype.XMLRPCClient=x.hub.m.hm.Client;e.prototype.init=function(e){var k=this;if(localStorage){var g=
!0;"false"==localStorage.getItem("x.hub.m.hm.CCU_INIT_STATE")&&(g=!1);x.hub.m.hm.CCU_INIT_STATE=g}require("x.hub.eventbus.js").on("x.hub.m.hm.CCU_INIT_STATE",function(g){var e=!0;"false"==g&&(e=!1);x.hub.m.hm.CCU_INIT_STATE=e});this._discovery=new x.hub.m.hm.CCU2Discovery(this._discoveryCB);this._monitorManager=new x.hub.m.hm.MonitorManager;this._xmlrpcServer=new x.hub.m.hm.Server(global.HM_LOCAL_PORT);this._xmlrpcServer.start(function(g){g?(k._logger.log("warn","start homematic local server error with port:"+
k._xmlrpcServer.getPort()),k._logger.log("warn",g.stack),e&&e({error:g})):k._monitorManager.init(k._xmlrpcServer,function(g){g?e&&e({error:g}):global&&global.HM_CHIP?k._initChipManager(function(g){e&&e({error:g})}):e&&e({})})})};e.prototype.getSystems=function(){return["hm"]};e.prototype.addStateDevice=function(e,m,g){if(e)if(e.gateway&&"mediola"!=e.gateway.uuid)if(e.gateway.ip&&x.hub.m.hm._Util.isIP(e.gateway.ip))if(x.hub.m.hm._Util.isIP(e.gateway.ip)){var h=this._getManager(e.gateway);h?h.addStateDevice(e,
function(g){m&&m({error:g})},g):(h=this._addManager(e.gateway),h.init(function(g){}),h.addStateDevice(e,function(g){m&&m({error:g})},g))}else this._logger.log("warn","ccu has ip:"+e.gateway.ip," , may not receive event from it."),m&&m({error:Error("gateway ip is url")});else m&&m({error:Error("gateway ip format invalid")});else m&&m();else m&&m({error:Error("device json format invalid")})};e.prototype.removeStateDevice=function(e,m,g){if(e)if(e.gateway&&"mediola"!=e.gateway.uuid)if(e.gateway.ip&&
x.hub.m.hm._Util.isIP(e.gateway.ip))if(x.hub.m.hm._Util.isIP(e.gateway.ip)){var h=this._getManager(e.gateway);h?h.removeStateDevice(e,function(g){m&&m({error:g})},g):m&&m({})}else this._logger.log("warn","ccu has ip:"+e.gateway.ip," , may not receive event from it."),m&&m({error:Error("gateway ip is url")});else m&&m({error:Error("gateway ip format invalid")});else m&&m();else m&&m({error:Error("device json format invalid")})};e.prototype.getAllStates=function(){return this._chipManager?this._chipManager.getAllBufferedStates():
[]};e.prototype.getStates=function(e){if(!(e&&x.hub.m.hm._Util.isDeviceJsonValid(e)&&e.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(e.gateway)))return null;var k=this._getManager(e.gateway);if(k)return k.getStates(e);k=this._addManager(e.gateway);k.init();return null};e.prototype.getState=function(e,m,g){if(!e)return g&&g({error:Error("device is null")}),null;if(!e.gateway||"mediola"==e.gateway.uuid){if(!this._chipManager){g&&g({error:Error("chip manager not inited")});return}return this._chipManager.getState(e,
{value:m},function(e,k){g&&g({error:e,data:k})})}if(!x.hub.m.hm._Util.isDeviceJsonValid(e)||!e.gateway||!x.hub.m.hm._Util.isGatewayJsonValid(e.gateway))return g&&g({error:Error("device json invalid")}),null;x.hub.m.hm.HM_MODULE.doStatus("xhub",e.gateway,e,{value:m},function(e,k){e?g&&g({error:e}):k?g&&g({data:{value:k.status}}):g&&g({error:Error("do status failed")})})};e.prototype.executeCommand=function(e,m,g){e?m?e.gateway&&"mediola"!=e.gateway.uuid?e.gateway?x.hub.m.hm.HM_MODULE.doCommand(e.gateway,
e,m,function(e){e?g&&g({error:e}):g&&g({})}):g&&g({error:Error("gateway is null")}):this._chipManager?this._chipManager.executeCommand(e,m,function(e){g&&g({error:e})}):g&&g({error:Error("chip manager not inited")}):g&&g({error:Error("command invalid")}):g&&g({error:Error("device is null")})};e.prototype.updateStates=function(e,m){if(e&&x.hub.m.hm._Util.isDeviceJsonValid(e)&&e.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(e.gateway)){var g=this._getManager(e.gateway);g?g.updateStates(e,function(g,
e){m&&m({error:g,data:e})}):(g=this._addManager(e.gateway),g.init(function(h){h?m&&m({error:h}):g.updateStates(e,function(g,e){m&&m({error:g,data:e})})}))}else m&&m({error:Error("device json format invalid")})};e.prototype.checkDeviceMatch=function(e,m){if(!(m&&m.device&&e&&e.device))return!1;if(m.gateway&&"mediola"!=m.gateway.uuid)return m=x.hub.m.hm._Util.getDeviceHashCode(m.device),e=x.hub.m.hm._Util.getDeviceHashCode(e.device),m==e;var g=e.device.address;e.device.interface&&e.device.type&&(g=
e.device.type+"."+e.device.interface+"."+e.device.address);return g!=m.device.address?!1:!0};e.prototype._initChipManager=function(e){var k="127.0.0.1";global&&global.HM_CHIP&&(k=global.HM_CHIP);this._chipManager=new x.hub.m.hm.ChipManager({ip:k,username:global.HM_CHIP_USERNAME,password:global.HM_CHIP_PASSWORD,uuid:"mediola"});this._chipManager.init(e)};e.prototype._initCCU3Manager=function(e){this._addManager({ip:"127.0.0.1",type:3}).init(function(k){e&&e(k)})};e.prototype._discover=function(e){this._discovery.discover(e)};
e.prototype._onFindHM=function(e,m){this._logger.log("debug","find ccu:"+e.uuid+"@"+e.ip+" from netif:"+m);this._monitorManager.onFindHomeMatic(e.ip,m,e.uuid)};e.prototype._getManager=function(e){e=x.hub.m.hm._Util.getGatewayHashCode(e);return this._managers[e]};e.prototype._addManager=function(e){var k=x.hub.m.hm._Util.getGatewayHashCode(e);e=new x.hub.m.hm.Manager(e);return this._managers[k]=e};e.prototype.onDeviceEvent=function(e,m){this._logger.log("trace","receive device event:"+JSON.stringify(e));
require("x.hub.eventbus.js");if(m)this._chipManager&&(this._chipManager.checkButtonEvent(e),this._udpEvtProducer.onEvent(e));else for(var g in this._managers)if(m=this._managers[g])try{m.onDeviceEvent(e)}catch(h){console.error(h.stack)}};e.prototype.resetChip=function(e){this._chipManager?this._chipManager.reset(function(){e&&e({})}):e&&e(Error("chip manager not inited"))};e.prototype.initManager=function(e,m){if(e){var g=this._getManager(e);g||(g=this._addManager(e));g.init(function(e){m&&m({error:e})})}else m&&
m({error:Error("gateway invalid")})};e.prototype.learnRFDevice=function(e,m){if(e){var g=this._getManager(e);g?g.learnRFDevice(function(e,g){m&&m({error:e,data:g})}):(g=this._addManager(e),g.init(function(e){e?m&&m({error:e}):setTimeout(function(){g.learnRFDevice(function(e,g){m&&m({error:e,data:g})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDevice(function(e,g){if(e)m&&m({error:e});else{var h=[];g.forEach(function(e){if(e){var g=e.toLegacyAdr();e=e.toLegacyType();h.push({address:g,
type:e})}});m&&m({data:h})}}):m&&m(Error("chip manager not inited"))};e.prototype.learnRFDeviceSN=function(e,m,g){if(e){var h=this._getManager(e);h?h.learnRFDevice(function(e,h){g&&g({error:e,data:h})}):(h=this._addManager(e),h.init(function(e){e?g&&g({error:e}):setTimeout(function(){h.learnRFDevice(function(e,h){g&&g({error:e,data:h})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDeviceSN(m,function(e,h){if(e)g&&g({error:e});else{var k=[];h.forEach(function(e){if(e){var g=e.toLegacyAdr();
e=e.toLegacyType();k.push({address:g,type:e})}});g&&g({data:k})}}):g&&g(Error("chip manager not inited"))};e.prototype.learnIPDevice=function(e,m,g,h){if(e){var k=this._getManager(e);k?k.learnIPDevice(m,g,function(e,g){h&&h({error:e,data:g})}):(k=this._addManager(e),k.init(function(e){e?h&&h({error:e}):setTimeout(function(){k.learnIPDevice(m,g,function(e,g){h&&h({error:e,data:g})})},3E3)}))}else m?g?this._chipManager?this._chipManager.learnIPDevice(m,g,function(e,g){if(e)h&&h({error:e});else{var k=
[];g.forEach(function(e){if(e){var g=e.toLegacyAdr();e=e.toLegacyType();k.push({address:g,type:e})}});h&&h({data:k})}}):h&&h(Error("chip manager not inited")):h&&h({error:Error("key is null")}):h&&h({error:Error("sgtin is null")})};e.prototype.learnIPDeviceQR=function(e,m,g){if(m)if(e){var h=this._getManager(e);h?h.learnIPDeviceQR(m,function(e,h){g&&g({error:e,data:h})}):(h=this._addManager(e),h.init(function(e){e?g&&g({error:e}):setTimeout(function(){h.learnIPDeviceQR(m,function(e,h){g&&g({error:e,
data:h})})},3E3)}))}else this._chipManager?this._chipManager.learnIPDeviceQR(m,function(e,h){if(e)g&&g({error:e});else{var k=[];h.forEach(function(e){if(e){var g=e.toLegacyAdr();e=e.toLegacyType();k.push({address:g,type:e})}});g&&g({data:k})}}):g&&g(Error("chip manager not inited"));else g&&g({error:Error("qrKey is null")})};e.prototype.deleteDevice=function(e,m,g){if(m){var h=m.split(".");3>h.length?g&&g({error:Error("address invalid")}):(m=h[1],h=h[2],e?g&&g({error:Error("not supported yet")}):
this._chipManager?this._chipManager.deleteDevice(m,h,function(e){g&&g({error:e})}):g&&g(Error("chip manager not inited")))}else g&&g({error:Error("address invalid")})};e.prototype.getRFInterfaces=function(e,m){if(e){var g=this._getManager(e);g?g.getRFInterfaces(function(e,g){m&&m({error:e,data:g})}):(g=this._addManager(e),g.init(function(e){e?m&&m({error:e}):setTimeout(function(){g.getRFInterfaces(function(e,g){m&&m({error:e,data:g})})},3E3)}))}else this._chipManager?this._chipManager.getRFInterfaces(function(e,
g){m&&m({error:e,data:g})}):m&&m(Error("chip manager not inited"))};e.prototype.executeCommandLegacy=function(e,m,g,h){e?h&&h({error:Error("not supported yet")}):this._chipManager?m?this.executeCommand({address:m},{value:g},function(e){h&&h({error:e?e.error:null})}):h&&h({error:Error("address invalid")}):h&&h({error:Error("chip manager not inited")})};e.prototype.getAllStatesLegacy=function(e){var k=[];try{this.getAllStates().forEach(function(e){if(e&&e.device&&e.states){var g={type:"HM",adr:e.device.toLegacyAdr(),
state:{}},l;for(l in e.states)g.state[l]=e.states[l].value;k.push(g)}})}catch(g){console.error(g.stack)}e&&e({data:k})};e.prototype.getConfig=function(e,m){e?e.gateway&&"mediola"!=e.gateway.uuid?m&&m({error:Error("not supported yet")}):this._chipManager?this._chipManager.getConfig(e,function(e,h){m&&m({error:e,data:h})}):m&&m({error:Error("chip manager not inited")}):m&&m({error:Error("device is null")})};e.prototype.setConfig=function(e,m,g){e?e.gateway&&"mediola"!=e.gateway.uuid?g&&g({error:Error("not supported yet")}):
this._chipManager?this._chipManager.setConfig(e,m,function(e){g&&g({error:e})}):g&&g({error:Error("chip manager not inited")}):g&&g({error:Error("device is null")})};e.prototype.getMonitorStates=function(e){this._monitorManager.getMonitorStates(function(k,g){e&&e({error:k,data:g})})};e.prototype.getAllDevices=function(e){var k=[];try{this.getAllStates().forEach(function(e){e&&e.device&&e.states&&(e={type:"HM",address:e.device.toLegacyAdr(),data:e.device.toLegacyType(),snr:e.device.getSerial(),_ver:"v5+"},
k.push(e))})}catch(g){console.error(g.stack)}e&&e({data:k})};e.prototype.isWindowOpen=function(){try{for(var e=this.getAllStates(),m=0;m<e.length;m++){var g=e[m];if(g&&g.device&&g.states){var h=g.device.toLegacyType();if("window"==h){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("contact"==h){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("ip_contact"==h){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("ip_window"==h&&g.states.state&&"closed"!=
g.states.state.value)return!0}}}catch(l){return!1}};return e}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.hm.Handler);
