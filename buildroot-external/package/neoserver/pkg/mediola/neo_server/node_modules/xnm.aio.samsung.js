var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.samsung=xnm.aio.samsung||{};
xnm.aio.samsung.TV=function(){var e=function(b,a){this.code=b;this.callback=a;this._socket=this._tv=null;this._state=0};e.prototype.run=function(b){this._tv=b;var a=this;this._state=1;b._connect({onError:function(c){a._finish(c)},onTimeout:function(){a._finish(Error("response timeout"))},onData:function(c){if(2==a._state)if(c=b._resolveAuthRsp(b._hex2arr(c)),1!=c){var f="";-1==c?f="data format invalid":2==c?f="access denied":3==c?f="waiting for grant":4==c&&(f="timeout or cancelled");f=Error("auth error:"+
f);f.code=c;a._socket.end();a._finish(f)}else a._state=3,a.code&&(20>a.code.length?(c=b._str2b64arr(a.code.trim()),f=[c.length+5,0,0,0,0,c.length,0],f=f.concat(c),f=b._buildReq(f)):f=b._buildReq(b._hex2arr(a.code.trim()))),b._logger&&b._logger.log("trace","send samsung request:"+b._arr2hex(f)),a._socket.write(new Buffer(f));else 3==a._state&&(a._socket.end(),a._finish())},onClose:function(){a._finish()}},function(c,f){c?a._finish(c):(a._socket=f,c=b._buildAuth(),a._state=2,b._logger&&b._logger.log("trace",
"send samsung auth request:"+b._arr2hex(c)),f.write(new Buffer(c)))})};e.prototype._finish=function(b){b&&this._tv._logger.log("warn","execute samsung command error:"+b.message);this.callback&&this.callback(b);this.callback=null;this._tv._finishTask(this)};var d=function(b,a){this.ip=b;this.port=a;this.port||(this.port=55E3);this._logger=require("x.logger.js").getLogger("xnm.aio.samsung.TV");this._tasks=[]};d.HEADER=[0,19,0,105,112,104,111,110,101,46,105,97,112,112,46,115,97,109,115,117,110,103];
d.prototype._executeCommand=function(b,a){b=new e(b,a);this._addTask(b)};d.prototype._addTask=function(b){var a=this._tasks.length;this._tasks.push(b);0==a&&this._doNextTask()};d.prototype._doNextTask=function(){this._tasks&&0<this._tasks.length&&this._tasks[0].run(this)};d.prototype._finishTask=function(b){this._tasks&&this._tasks[0]===b&&(this._tasks.splice(0,1),this._doNextTask())};d.prototype._buildAuth=function(){var b=this._str2b64arr("127.0.0.1"),a=[b.length&255,b.length>>8&255],c=this._str2b64arr("00-00-00-00-00-00"),
f=[c.length&255,c.length>>8&255],k=this._str2b64arr("aioRemote"),g=[k.length&255,k.length>>8&255],h=4+b.length+2+c.length+2+k.length;h=[h&255,h>>8&255];return[].concat(d.HEADER).concat(h).concat([100,0]).concat(a).concat(b).concat(f).concat(c).concat(g).concat(k)};d.prototype._resolveAuthRsp=function(b){if(3>b.length)return-1;var a=(b[2]<<8)+b[1];if(b.length<3+a)return-1;b=b.slice(3+a);if(2>b.length)return-1;a=(b[1]<<8)+b[0];if(b.length<2+a)return-1;b=b.slice(2,2+a);return 101==b[0]?4:10==b[0]?3:
100==b[0]&&0==b[2]?2:100==b[0]&&1==b[2]?1:-1};d.prototype._buildReq=function(b){return[].concat(d.HEADER).concat(b)};d.prototype._str2b64arr=function(b){b=(new Buffer(b)).toString("base64");for(var a=[],c=0;c<b.length;c++){var f=b.charCodeAt(c);a.push(f)}return a};d.prototype._hex2arr=function(b){for(var a=[],c=0;c<b.length;c+=2)a.push(parseInt(b.substr(c,2),16));return a};d.prototype._arr2hex=function(b){for(var a="",c=0;c<b.length;c++){for(var f=b[c].toString(16);2>f.length;)f="0"+f;a+=f.toUpperCase()}return a};
d.prototype._connect=function(b,a){var c=this,f={port:this.port,host:this.ip},k=!1,g=a,h=require("net").connect(f);b.__socket=h;h.setTimeout(1E4);h.setEncoding("hex");h.on("connect",function(){c._logger.log("trace","connect tcp to:"+c.ip);k=!0;if(g){var a=b.__socket;delete b.__socket;g(null,a)}});h.on("data",function(a){c._logger.log("trace","receive from tcp:"+c.ip+" data:"+a);b.onData(a)});h.on("error",function(a){k?(c._logger.log("trace","tcp:"+c.ip+" error:"+a.message),h.end(),b.onError(a)):(c._logger.log("trace",
"tcp:"+c.ip+" connection error:"+a.message),g&&(g(a),g=null))});h.on("timeout",function(){k?(c._logger.log("trace","tcp:"+c.ip+" data timeout"),h.end(),b.onTimeout()):(c._logger.log("trace","tcp:"+c.ip+" connection timeout"),h.end(),g&&(g(Error("connection timeout")),g=null))});h.on("close",function(){c._logger.log("trace","tcp:"+c.ip+" close socket");b.onClose()});h._doConnect&&"function"==typeof h._doConnect&&h._doConnect()};return d}();
xnm.aio.samsung.SmartHomeCloud=function(){var e=null,d=0,b=function(a,c){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.samsung.SmartHomeCloud");this._accessKey=a;this.userID=this.accessToken=null;this._appID="4199tgd4z8";this._appSecret="8913F3FF4E064526126408E0AD6E5911";this._channelKey="npbKUFXrEeIxhTwz3L3KrDI1GdooCfS37bG1dmSKctk=";this.userID=this.accessToken=null;e||(e=xnm.aio.samsung.SmartHomeCloud._StatusBuffer,d=xnm.aio.samsung.SmartHomeCloud._StatusBufferTO);
c?(this._server="simulator.cspserver.net",this._api="/api"):(this._server="api2.cspserver.net",this._api="/bridge/api");this.CommandHandler=null;this._getStateRunning=!1;this._getStateCallbacks=[]};b.prototype._sendRequest=function(a,c,f,b){var g=this;this.accessToken&&this.userID?this._doRequest(a,c,f,function(h,d,e){h&&401==e?(g._logger.log("debug","send request auth error"),g._getAuthToken(function(h){h?b&&b(h):g._doRequest(a,c,f,b)})):b&&b(h,d)}):(g._logger.log("debug","no accessToken or userID, do get auth token"),
this._getAuthToken(function(h){h?b&&b(h):g._sendRequest(a,c,f,b)}))};b.prototype._doRequest=function(a,c,f,b){a={host:this._server,path:this._api+c,method:a,headers:{"x-csp-channel-key":this._channelKey,"x-csp-appId":this._appID,"x-csp-userId":this.userID,Authorization:"Bearer "+this.accessToken,Connection:"close","Content-Type":"application/json;  charset=UTF-8"}};f&&(a.headers["Content-Length"]=f.length);c=require("https");"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED=
"0");this._logger.log("trace","do request:"+JSON.stringify(a));var g=this,h=b,d=c.request(a,function(a){a.setEncoding("utf-8");var c="";a.on("data",function(a){c+=a});a.on("end",function(){g._logger.log("trace","receive code:"+a.statusCode+" headers:"+JSON.stringify(a.headers)+" response:"+c);if(204!=a.statusCode)try{var f=c?JSON.parse(c):{}}catch(r){var b=r}204==a.statusCode?f={}:401==a.statusCode?b=Error("auth error"):200!=a.statusCode&&(b=Error("http reponse:"+a.statusCode));h&&(h(b,f,a.statusCode),
h=null)})});if(d.on)d.on("error",function(a){g._logger.log("trace","do request error:"+a.message);h&&(h(a),h=null)});d.setTimeout&&d.setTimeout(2E3,function(){g._logger.log("trace","do request timeout");d.abort();h&&(h(Error("timeout")),h=null)});f&&(this._logger.log("trace","do request send body:"+f),d.write(f));d.end()};b.prototype._getAuthToken=function(a){var c=this,f=a;$.ajax({type:"GET",url:"https://smsng.mediola.com/getAccessToken?ak="+this._accessKey,timeout:4E3,cache:!1,dataType:"json",success:function(a){c._logger.log("trace",
"get auth token response:"+JSON.stringify(a));if(a&&a.XC_SUC)c.userID=a.XC_SUC.user,c.accessToken=a.XC_SUC.token;else var b=a&&a.XC_ERR?Error(a.XC_ERR):Error("get auth token error:"+a?JSON.stringify(a):"empty");f&&(f(b,a,200),f=null)},error:function(a,b){b="get auth token error:"+(a?a.status:"0")+"-"+b;c._logger.log("trace",b);f&&(f(Error(b),a?a.responseText:null,a?a.status:null),f=null)}})};b.prototype._getBufferedStatus=function(a){for(var c in e)if(e.hasOwnProperty(c)){var b=e[c];if(b&&b.states&&
b.states[a])return b.states[a]}return null};b.prototype._getStates=function(a){var c=this;if(e[c._accessKey]&&e[c._accessKey].states){var b=e[c._accessKey].time;if(b&&(new Date).getTime()-b<d){a&&a(null,e[c._accessKey].states);return}}a&&-1==this._getStateCallbacks.indexOf(a)&&this._getStateCallbacks.push(a);this._getStateRunning||(this._getStateRunning=!0,this.getDevices(function(a,b){c._getStateRunning=!1;var f=c._getStateCallbacks;c._getStateCallbacks=[];if(a)f.forEach(function(c){c&&c(a)});else if(b&&
b.Devices){var g={};if(b=b.Devices)for(var d=0;d<b.length;d++)if(b[d]&&b[d].id){var k=xnm.aio.samsung.SmartHomeCloud._AlarmBuffer[b[d].id],m=JSON.parse(JSON.stringify(b[d]));m.Alarms=k;k=null;switch(m.type){case "Refrigerator":k=c._resolveFridgeStates(m);break;case "Washer":k=c._resolveWasherStates(m);break;case "Air_Conditioner":k=c._resolveACStates(m);break;case "Oven":k=c._resolveOvenStates(m);break;case "Dryer":k=c._resolveDryerStates(m);break;case "Robot_Cleaner":k=c._resolveRobotStates(m);break;
case "Air_Purifier":k=c._resolveAPStates(m)}k&&(g[b[d].id]=k)}e[c._accessKey]={time:(new Date).getTime(),states:g};f.forEach(function(a){a&&a(null,g)})}else f.forEach(function(a){a&&a(null,{})})}))};b.prototype._resolveFridgeStates=function(a){var c={};"undefined"!=typeof a.connected&&null!=a.connected&&(c.frdgConn=a.connected);a.Doors&&a.Doors.forEach(function(a){a&&a.id&&(a.openState&&(c["frdgDoorState"+a.id]="Close"==a.openState?"closed":"open"),a.name&&(c["frdgDoorName"+a.id]=a.name))});if(a.Fridge&&
a.Fridge.filterState){switch(a.Fridge.filterState){case "1":var b="good";break;case "2":b="order";break;case "3":b="replace"}b&&(c.frdgFilterState=b)}a.Temperatures&&a.Temperatures.forEach(function(a){if(a&&a.id){if(a.unit)switch(a.unit){case "Fahrenheit":c["frdgTempUnit"+a.id]="\u00b0F";break;case "Celsius":c["frdgTempUnit"+a.id]="\u00b0C";break;default:c["frdgTempUnit"+a.id]=a.unit}"undefined"!=typeof a.desired&&null!=a.desired&&(c["frdgTempState"+a.id]=parseFloat(a.desired).toFixed(1))}});a.Mode&&
a.Mode.modes&&(-1!=a.Mode.modes.indexOf("WATERFILTER_DISABLE")?c.frdgWFState="good":-1!=a.Mode.modes.indexOf("WATERFILTER_ENABLE")&&(c.frdgWFState="replace"));if(a.Alarms&&a.Alarms[0]){b=a.Alarms[0].id;a=a.Alarms[0].code;switch(a){case "71E":a="Freeze_High_Temp";break;case "72E":a="Fridge_High_Temp";break;case "F-Alarm":switch(b){case "0":a="Freeze_Door_Alarm";break;case "1":a="Fridge_Door_Alarm";break;case "2":a="CV_Door_Alarm";break;case "3":a="Single_Door_Alarm"}}c.frdgError=a}c.frdgError||(c.frdgError=
"");return c};b.prototype._resolveWasherStates=function(a){var c={};"undefined"!=typeof a.connected&&null!=a.connected&&(c.wshConn=a.connected);if(a.Operation&&(a.Operation.progress&&(c.wshProgress=a.Operation.progress.toLowerCase()),a.Operation.state&&(c.wshState=a.Operation.state.toLowerCase()),a.Operation.remainingTime)){c.wshRTStr=a.Operation.remainingTime;var b=a.Operation.remainingTime.split(":");if(2<=b.length){var d=parseInt(b[0]);b=parseInt(b[1]);c.wshRT=60*d+b}}a.Configuration&&(c.wshSmC=
a.Configuration.remoteControlEnabled?"on":"off");a.Alarms&&a.Alarms[0]&&(c.wshError=a.Alarms[0].code);c.wshError||(c.wshError="");return c};b.prototype._resolveACStates=function(a){var c={};if("undefined"!=typeof a.connected&&null!=a.connected)switch(a.deviceSubType){case "FAC":c.facConn=a.connected;break;case "Room_Air_Conditioner":c.racConn=a.connected}if(a.Operation){var b;a.Operation.power&&(b=a.Operation.power.toLowerCase());switch(a.deviceSubType){case "FAC":c.facPower=b;break;case "Room_Air_Conditioner":c.racPower=
b}}a.Temperatures&&a.Temperatures.forEach(function(b){if(b&&b.id){if(b.unit){switch(b.unit){case "Fahrenheit":var f="\u00b0F";break;case "Celsius":f="\u00b0C";break;default:f=b.unit}switch(a.deviceSubType){case "FAC":c.facTempUnit=f;break;case "Room_Air_Conditioner":c.racTempUnit=f}}if("undefined"!=typeof b.desired&&null!=b.desired)switch(f=parseFloat(b.desired).toFixed(1),a.deviceSubType){case "FAC":c.facSetTemp=f;break;case "Room_Air_Conditioner":c.racSetTemp=f}if("undefined"!=typeof b.current&&
null!=b.current)switch(b=parseFloat(b.current).toFixed(1),a.deviceSubType){case "FAC":c.facTemp=b;break;case "Room_Air_Conditioner":c.racTemp=b}}});if(a.Mode&&a.Mode.modes&&a.Mode.modes&&a.Mode.modes[0])switch(b=a.Mode.modes[0],a.deviceSubType){case "FAC":c.facMode=b;break;case "Room_Air_Conditioner":c.racMode=b}if(a.Mode&&a.Mode.options){var d;-1!=a.Mode.options.indexOf("Smarton_LockOff")?d="on":-1!=a.Mode.options.indexOf("Smarton_LockOn")&&(d="off");switch(a.deviceSubType){case "FAC":c.facSmC=d}}a.Alarms&&
a.Alarms[0]&&("Room_Air_Conditioner"==a.deviceSubType?c.racError=a.Alarms[0].code:c.facError=a.Alarms[0].code);"Room_Air_Conditioner"==a.deviceSubType?c.racError||(c.racError=""):c.facError||(c.facError="");return c};b.prototype._resolveOvenStates=function(a){var c={},b=this._getBufferedStatus(a.id);b&&(c.ovenTemp=b.ovenTempRaw,c.ovenTempRaw=b.ovenTempRaw,c.ovenState=b.ovenState,c.ovenTempStr=b.ovenTempRaw);"undefined"!=typeof a.connected&&null!=a.connected&&(c.ovenConn=a.connected);a.Temperatures&&
a.Temperatures.forEach(function(a){if(a&&a.id){if(a.unit)switch(a.unit){case "Fahrenheit":c.ovenTempUnit="\u00b0F";break;case "Celsius":c.ovenTempUnit="\u00b0C";break;default:c.ovenTempUnit=a.unit}"undefined"!=typeof a.desired&&null!=a.desired&&(c.ovenTemp=parseFloat(a.desired).toFixed(1),c.ovenTempRaw=c.ovenTemp,c.ovenTempStr=c.ovenTemp)}});if(a.Operation&&(a.Operation.state&&(c.ovenOp=a.Operation.state.toLowerCase()),a.Operation.operationTime&&(c.ovenOTStr=a.Operation.operationTime),a.Operation.remainingTime)){c.ovenRTStr=
a.Operation.remainingTime;var d=a.Operation.remainingTime.split(":");2<=d.length&&(b=parseInt(d[0]),d=parseInt(d[1]),c.ovenRT=60*b+d)}a.Oven&&a.Oven.state&&(c.ovenState=a.Oven.state);if(a.Alarms&&a.Alarms[0])switch(a=a.Alarms[0].code,a){case "OV_T_0001":c.ovenError="Preheating finish";break;case "OV_T_0003":c.ovenError="Cooking finish";break;case "OV_T_0004":c.ovenError="Almost finished cooking";break;case "OV_T_0005":c.ovenError="Cooking was finished";break;case "OV_T_0006":c.ovenError="Cancellation while cooking";
break;case "OV_T_0007":c.ovenError="Cleaning mode finish";break;case "OV_T_0008":c.ovenError="Cleaning mode cancel";break;default:"OV_E_"==a.substr(0,5)&&(c.ovenError="ErrorCode_"+a.substr(5))}c.ovenError||(c.ovenError="");switch(c.ovenState){case "Preheat":case "Cleaning":case "Draining":case "Cooling":case "Rinsing":c.ovenTemp=0,c.ovenTempStr="--"}return c};b.prototype._resolveDryerStates=function(a){var c={};"undefined"!=typeof a.connected&&null!=a.connected&&(c.dryConn=a.connected);if(a.Operation&&
(a.Operation.progress&&(c.dryProgress=a.Operation.progress.toLowerCase()),a.Operation.state&&(c.dryState=a.Operation.state.toLowerCase()),a.Operation.remainingTime)){c.dryRTStr=a.Operation.remainingTime;var b=a.Operation.remainingTime.split(":");if(2<=b.length){var d=parseInt(b[0]);b=parseInt(b[1]);c.dryRT=60*d+b}}a.Configuration&&(c.drySmC=a.Configuration.remoteControlEnabled?"on":"off");a.Alarms&&a.Alarms[0]&&(c.dryError=a.Alarms[0].code);c.dryError||(c.dryError="");return c};b.prototype._resolveRobotStates=
function(a){var c={};"undefined"!=typeof a.connected&&null!=a.connected&&(c.rbtConn=a.connected);if(a.Mode&&a.Mode.modes){for(var b,d,g,e,l,p,q,m=0;m<a.Mode.modes.length;m++){var n=a.Mode.modes[m];n&&"Control"==n.substr(0,7)?b=n:n&&"Cleaning"==n.substr(0,8)?d=n:n&&"Turbo"==n.substr(0,5)?g=n:n&&"Access"==n.substr(0,6)&&(e=n);switch(n){case "Control_Homing":l="Stop cleaning & Return";break;case "Control_Idle":l="Idle";break;case "Control_Alarm":l="Alarming";break;case "Control_After":l="Returning for charging";
break;case "Control_Charging":l="Charging";break;case "Control_Pause":l="Pause";break;case "Control_PowerOff":l="Power off";break;case "Control_Reserve":l="Clean reserved (one time)";break;case "Control_Cleaning":l="Cleaning status";break;case "Control_Point":l="Point Cleaning";break;case "Cleaning_Auto":p="Start cleaning";break;case "Cleaning_Part":p="Parts Cleaning";break;case "Cleaning_Repeat":p="Repeat cleaning";break;case "Cleaning_Manual":p="Manual cleaning";break;case "Cleaning_Stop":p="Stop";
break;case "Turbo_On":q="Max";break;case "Turbo_Off":q="Normal";break;case "Turbo_Silence":q="Quiet"}}b&&l&&(c.rbtCtrMode=b,c.rbtCtrModeStr=l);d&&p&&(c.rbtClnMode=d,c.rbtClnModeStr=p);g&&q&&(c.rbtTrbMode=g,c.rbtTrbModeStr=q);"Control_Point"==c.rbtCtrMode&&(c.rbtClnMode="Cleaning_Manual",c.rbtClnModeStr="Manual cleaning");"Access_UnLock"==e?c.rbtRC="on":"Access_Lock"==e&&(c.rbtRC="off")}a.Alarms&&a.Alarms[0]&&(a=a.Alarms[0].code,c.rbtError="4"==a?"Normal":a);c.rbtError||(c.rbtError="");return c};b.prototype._resolveAPStates=
function(a){var c={};"undefined"!=typeof a.connected&&null!=a.connected&&(c.apConn=a.connected);a.Operation&&a.Operation.power&&(c.apPower=a.Operation.power.toLowerCase());a.Sensors&&a.Sensors.forEach(function(a){if(a&&a.type&&a.values)switch(a.type){case "Dust":c.apDust=a.values[0];c.apDustLvl=a.values[1];break;case "FineDust":c.apFDust=a.values[0];c.apFDustLvl=a.values[1];break;case "Odor":c.apOdorLvl=a.values[0]}});a.Wind&&(c.apWSLvl=a.Wind.speedLevel,0==a.Wind.speedLevel?c.apWS="Auto":1==a.Wind.speedLevel?
c.apWS="Sleeping":2==a.Wind.speedLevel?c.apWS="Low":3==a.Wind.speedLevel?c.apWS="Medium":4==a.Wind.speedLevel&&(c.apWS="High"));a.Alarms&&a.Alarms[0]&&(c.apError=a.Alarms[0].code);c.apError||(c.apError="");return c};b.prototype._executeCommand=function(a,c,b){if(a&&a.id&&a.type&&c&&c.value){var f=function(a){b&&b(a)};switch(a.type){case "Washer":this._execWasherCmd(a,c,f);break;case "Air_Conditioner":this._execACCmd(a,c,f);break;case "Oven":this._execOvenCmd(a,c,f);break;case "Dryer":this._execDryerCmd(a,
c,f);break;case "Robot_Cleaner":this._execRobotCmd(a,c,f);break;case "Air_Purifier":this._execAPCmd(a,c,f);break;default:b&&b(Error("unknown device type"))}}else b&&b(Error("parameter invalid"))};b.prototype._execWasherCmd=function(a,c,b){switch(c.value){case "wshRun":var f="Operation";var d={Operation:{state:"Run"}};break;case "wshPause":f="Operation";d={Operation:{state:"Pause"}};break;case "wshCancel":f="Operation",d={Operation:{state:"Ready"}}}f&&d?this._sendRequest("PUT","/devices/"+a.id+"/"+
f,JSON.stringify(d),function(a){b&&b(a)}):b&&b(Error("command invalid"))};b.prototype._execACCmd=function(a,c,b){var f=this,d=this._getBufferedStatus(a.id);switch(c.value){case "facOn":case "racOn":var e="Operation";var l={Operation:{power:"On"}};break;case "facOff":case "racOff":e="Operation";l={Operation:{power:"Off"}};break;case "facToggle":case "racToggle":this._getStates(function(d,g){d?b&&b(d):g&&g[a.id]?(d=g[a.id],d="facToggle"==c.value?d.facPower:d.racPower,"on"==d?f._execACCmd(a,{value:"facToggle"==
c.value?"facOff":"racOff"},b):"off"==d?f._execACCmd(a,{value:"facToggle"==c.value?"facOn":"racOn"},b):b&&b(Error("no valid status"))):b&&b(Error("no status"))});return;case "facSetTo":case "racSetTo":if(!c.ext){b&&b(Error("command invalid"));return}e="Temperatures";l={Temperatures:[{id:"0",desired:parseFloat(c.ext)}]};break;case "facTempUp":case "facTempDown":case "racTempUp":case "racTempDown":if(d&&("Wind"==d.racMode||"Wind"==d.facMode)){e=null;e="facTempUp"==c.value||"facTempDown"==c.value?"facError":
"racError";xnm.aio.samsung.SmartHomeNotifyManager.onDummyNotification(a,e,"no temp. change in this mode");b&&b(Error("can not change temperature in wind mode"));return}if(!c.ext){b&&b(Error("command invalid"));return}this._getStates(function(d,g){if(d)b&&b(d);else if(g&&g[a.id]){var e=g[a.id];d=18;g=30;if("facTempUp"==c.value||"facTempDown"==c.value){var h=e.facSetTemp;e=e.facTempUnit}else h=e.racSetTemp,e=e.racTempUnit;if(h){h=parseFloat(h);"\u00b0F"==e&&(d=65,g=86);e=parseFloat(c.ext);if("facTempUp"==
c.value||"racTempUp"==c.value)h+=e;else if("facTempDown"==c.value||"racTempDown"==c.value)h-=e;h>g&&(h=g);h<d&&(h=d);f._execACCmd(a,{value:"facTempUp"==c.value||"facTempDown"==c.value?"facSetTo":"racSetTo",ext:h},b)}else b&&b(Error("no valid status"))}else b&&b(Error("no status"))});return;case "facSetMode":case "racSetMode":if(!c.ext){b&&b(Error("command invalid"));return}e="Mode";l={Mode:{modes:[c.ext]}}}e&&l?this._sendRequest("PUT","/devices/"+a.id+"/"+e,JSON.stringify(l),function(a){b&&b(a)}):
b&&b(Error("command invalid"))};b.prototype._execOvenCmd=function(a,b,d){switch(b.value){case "ovenStop":var c="Operation";var f={Operation:{state:"Ready"}}}c&&f?this._sendRequest("PUT","/devices/"+a.id+"/"+c,JSON.stringify(f),function(a){d&&d(a)}):d&&d(Error("command invalid"))};b.prototype._execDryerCmd=function(a,b,d){switch(b.value){case "dryRun":var c="Operation";var f={Operation:{state:"Run"}};break;case "dryPause":c="Operation";f={Operation:{state:"Pause"}};break;case "dryCancel":c="Operation",
f={Operation:{state:"Ready"}}}c&&f?this._sendRequest("PUT","/devices/"+a.id+"/"+c,JSON.stringify(f),function(a){d&&d(a)}):d&&d(Error("command invalid"))};b.prototype._execRobotCmd=function(a,b,d){switch(b.value){case "rbtStart":var c="Mode";var f={Mode:{modes:["Cleaning_Auto"]}};break;case "rbtStop":c="Mode";f={Mode:{modes:["Control_Homing"]}};break;case "rbtTurbo":if(!b.ext){d&&d(Error("command ext invalid"));return}switch(b.ext){case "Max":b="Turbo_On";break;case "Normal":b="Turbo_Off";break;case "Quiet":b=
"Turbo_Silence";break;default:d&&d(Error("command ext invalid"));return}c="Mode";f={Mode:{modes:[b]}}}c&&f?this._sendRequest("PUT","/devices/"+a.id+"/"+c,JSON.stringify(f),function(a){d&&d(a)}):d&&d(Error("command invalid"))};b.prototype._execAPCmd=function(a,b,d){var c=this;switch(b.value){case "apOn":var e="Operation";var f={Operation:{power:"On"}};break;case "apOff":e="Operation";f={Operation:{power:"Off"}};break;case "apToggle":this._getStates(function(b,e){b?d&&d(b):e&&e[a.id]?(b=e[a.id],b=b.apPower,
"on"==b?c._execAPCmd(a,{value:"apOff"},d):"off"==b?c._execAPCmd(a,{value:"apOn"},d):d&&d(Error("no valid status"))):d&&d(Error("no status"))});return;case "rbtSetWS":case "rbtSetWSLvl":if("undefined"==typeof b.ext||null==b.ext){d&&d(Error("command invalid"));return}if("rbtSetWS"==b.value)switch(b.ext){case "Auto":var l=0;break;case "Sleeping":l=1;break;case "Low":l=2;break;case "Medium":l=3;break;case "High":l=4}else l=parseInt(b.ext);4<l&&(l=4);0>l&&(l=0);e="Wind";f={Wind:{speedLevel:l}};break;case "rbtSetWSUp":case "rbtSetWSDown":this._getStates(function(e,
f){e?d&&d(e):f&&f[a.id]?(e=f[a.id].apWSLvl,"undefined"==typeof e||null==e?d&&d(Error("no valid status")):(e=parseInt(e),"rbtSetWSUp"==b.value?e+=1:"rbtSetWSDown"==b.value&&--e,4<e&&(e=4),0>e&&(e=0),c._execAPCmd(a,{value:"rbtSetWSLvl",ext:e},d))):d&&d(Error("no status"))});return}e&&f?this._sendRequest("PUT","/devices/"+a.id+"/"+e,JSON.stringify(f),function(a){d&&d(a)}):d&&d(Error("command invalid"))};b.prototype.subscibe=function(a,b){this._sendRequest("POST","/subscriptions",JSON.stringify({Subscriptions:a}),
function(a){b&&b(a)})};b.prototype.getDevices=function(a){this._sendRequest("GET","/devices",null,function(b,d){a&&a(b,d)})};b.prototype.getDeviceList=function(a){this.getDevices(function(b,d){if(b)a&&a(b);else if(d&&d.Devices){b=[];d=d.Devices;for(var c=0;c<d.length;c++){var e=d[c],f=null;if(e){switch(e.type){case "Refrigerator":e.sys="samsung_smarthome";delete e.resources;f=e;break;case "Washer":e.sys="samsung_smarthome";delete e.resources;delete e.Operation;delete e.Configuration;f=e;break;case "Air_Conditioner":e.sys=
"samsung_smarthome";delete e.resources;delete e.Operation;delete e.Temperatures;delete e.Mode;f=e;break;case "Oven":e.sys="samsung_smarthome";delete e.resources;delete e.Operation;delete e.Temperatures;delete e.Configuration;delete e.Oven;f=e;break;case "Dryer":e.sys="samsung_smarthome";delete e.resources;delete e.Operation;delete e.Configuration;f=e;break;case "Robot_Cleaner":e.sys="samsung_smarthome";delete e.resources;delete e.Mode;f=e;break;case "Air_Purifier":e.sys="samsung_smarthome",delete e.resources,
delete e.Operation,delete e.Sensors,delete e.Wind,f=e}f&&b.push(f)}}a&&a(null,b)}else a&&a(null,[])})};b.prototype.executeCommand=function(a,b,d){cmd=JSON.stringify({Temperatures:[{desired:23,id:"0"}]});this._doRequest("PUT","/devices/"+a.address+"/Temperatures",cmd,function(a){XC.debugf(a);d&&d()})};b.prototype.executeCommandCreator=function(a,b,d){this._executeCommand(a,b,d)};b.prototype.getStatesCreator=function(a,b,d){b?0==b.length?d&&d(null,[]):this._getStates(function(a,c){if(a)d&&d(a);else{a=
[];for(var e=0;e<b.length;e++)if(b[e]&&b[e].id){var f="?";b[e].device&&b[e].device.id&&b[e].status&&b[e].status.value&&c&&c[b[e].device.id]&&(f=c[b[e].device.id][b[e].status.value],"undefined"==typeof f||null==f)&&(f="?");a.push({id:b[e].id,status:f})}d&&d(null,a)}}):d&&d(Error("deviceList is null"))};b.prototype.equalsTo=function(a){return a&&a instanceof b?this._accessKey==a._accessKey:!1};b.prototype.toJSON=function(){return{sys:"samsung_smarthome",accessKey:this._accessKey}};b.parseJSON=function(a){return a.accessKey?
new b(a.accessKey,a.test):null};return b}();xnm.aio.samsung.SmartHomeCloud._StatusBuffer={};xnm.aio.samsung.SmartHomeCloud._StatusBufferTO=5E3;xnm.aio.samsung.SmartHomeCloud._AlarmBuffer={};
xnm.aio.samsung.SmartHomeCloud.DM=function(){var e={command:[{type:"enum",name:"run",ref:{value:"wshRun"}},{type:"enum",name:"pause",ref:{value:"wshPause"}},{type:"enum",name:"cancel",ref:{value:"wshCancel"}}],status:[{type:"enum",name:"connected",ref:{value:"wshConn",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"wshState",options:["ready","run","pause"]}},{type:"enum",name:"progress",ref:{value:"wshProgress",options:"finish delaywash weightsensing prewash wash rinse spin drying cooling wrinkleprevent airwash none".split(" ")}},
{type:"string",name:"remaining time (string)",ref:{value:"wshRTStr"}},{type:"int",name:"remaining time",ref:{value:"wshRT",extMeta:"0-180"}},{type:"enum",name:"Smart Control state",ref:{value:"wshSmC",options:["on","off"]}},{type:"enum",name:"error state",ref:{value:"wshError",options:["FilterAlarm","DrumClean","ErrorCode_%d"]}}]},d={command:[{type:"enum",name:"power on",ref:{value:"facOn"}},{type:"enum",name:"power off",ref:{value:"facOff"}},{type:"enum",name:"power toggle",ref:{value:"facToggle"}},
{type:"float",name:"set desired temperature",ref:{value:"facSetTo",ext:"%f",extMeta:"18.0-30.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",name:"desired temperature up",ref:{value:"facTempUp",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",name:"desired temperature down",ref:{value:"facTempDown",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"enum",name:"set mode",ref:{value:"facSetMode",ext:"%e",extMeta:["Auto","Cool","Dry","Wind","Heat"]}}],status:[{type:"enum",
name:"connected",ref:{value:"facConn",options:["true","false"]}},{type:"enum",name:"power",ref:{value:"facPower",options:["on","off"]}},{type:"float",name:"current temperature",ref:{value:"facTemp"}},{type:"float",name:"desired temperature",ref:{value:"facSetTemp"}},{type:"enum",name:"temperature unit",ref:{value:"facTempUnit",options:["\u00b0C","\u00b0F","NotSupported"]}},{type:"enum",name:"mode",ref:{value:"facMode",options:"Auto Cool Dry Heat Wind CoolClean HeatClean DryClean NotSupported".split(" ")}},
{type:"enum",name:"Smart Control state",ref:{value:"facSmC",options:["on","off"]}},{type:"enum",name:"error state",ref:{value:"facError",options:["FilterAlarm","FilterAlarm_OFF","ErrorCode_%d"]}}]},b={command:[{type:"enum",name:"power on",ref:{value:"racOn"}},{type:"enum",name:"power off",ref:{value:"racOff"}},{type:"enum",name:"power toggle",ref:{value:"racToggle"}},{type:"float",name:"set desired temperature",ref:{value:"racSetTo",ext:"%f",extMeta:"18.0-30.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",
name:"desired temperature up",ref:{value:"racTempUp",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",name:"desired temperature down",ref:{value:"racTempDown",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"enum",name:"set mode",ref:{value:"racSetMode",ext:"%e",extMeta:["Auto","Cool","Dry","Wind","Heat"]}}],status:[{type:"enum",name:"connected",ref:{value:"racConn",options:["true","false"]}},{type:"enum",name:"power",ref:{value:"racPower",options:["on","off"]}},
{type:"float",name:"current temperature",ref:{value:"racTemp"}},{type:"float",name:"desired temperature",ref:{value:"racSetTemp"}},{type:"enum",name:"temperature unit",ref:{value:"racTempUnit",options:["\u00b0C","\u00b0F","NotSupported"]}},{type:"enum",name:"mode",ref:{value:"racMode",options:"Auto Cool Dry Heat Wind NotSupported".split(" ")}},{type:"enum",name:"error state",ref:{value:"racError",options:["FilterAlarm","FilterAlarm_OFF","ErrorCode_%d"]}}]},a={command:[{type:"enum",name:"stop",ref:{value:"ovenStop"}}],
status:[{type:"enum",name:"connected",ref:{value:"ovenConn",options:["true","false"]}},{type:"enum",name:"operation",ref:{value:"ovenOp",options:["run","ready"]}},{type:"string",name:"remaining time (string)",ref:{value:"ovenRTStr"}},{type:"int",name:"remaining time",ref:{value:"ovenRT",extMeta:"0-180"}},{type:"string",name:"operation time (string)",ref:{value:"ovenOTStr"}},{type:"float",name:"desired temperature",ref:{value:"ovenTemp"}},{type:"string",name:"desired temperature (string)",ref:{value:"ovenTempStr"}},
{type:"enum",name:"temperature unit",ref:{value:"ovenTempUnit",options:["\u00b0C","\u00b0F","NotSupported"]}},{type:"enum",name:"state",ref:{value:"ovenState",options:"Preheat Cooking Cleaning Draining Rinsing Cooling Ready".split(" ")}},{type:"enum",name:"error state",ref:{value:"ovenError",options:["ErrorCode_%d"]}}]},c={command:[{type:"enum",name:"run",ref:{value:"dryRun"}},{type:"enum",name:"pause",ref:{value:"dryPause"}},{type:"enum",name:"cancel",ref:{value:"dryCancel"}}],status:[{type:"enum",
name:"connected",ref:{value:"dryConn",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"dryState",options:["ready","run","pause"]}},{type:"enum",name:"progress",ref:{value:"dryProgress",options:"finish delaywash weightsensing drying cooling wrinkleprevent none".split(" ")}},{type:"string",name:"remaining time (string)",ref:{value:"dryRTStr"}},{type:"int",name:"remaining time",ref:{value:"dryRT",extMeta:"0-180"}},{type:"enum",name:"Smart Control state",ref:{value:"drySmC",options:["on",
"off"]}},{type:"enum",name:"error state",ref:{value:"dryError",options:["FilterAlarm","DrumClean","ErrorCode_%d"]}}]},f={command:[{type:"enum",name:"start cleaning",ref:{value:"rbtStart"}},{type:"enum",name:"stop cleaning",ref:{value:"rbtStop"}},{type:"enum",name:"set turbo mode",ref:{value:"rbtTurbo",ext:"%e",extMeta:["Max","Normal","Quiet"]}}],status:[{type:"enum",name:"connected",ref:{value:"rbtConn",options:["true","false"]}},{type:"enum",name:"control mode",ref:{value:"rbtCtrMode",options:"Control_Homing Control_Idle Control_Alarm Control_After Control_Charging Control_Pause Control_PowerOff Control_Reserve Control_Cleaning Control_Point".split(" ")}},
{type:"string",name:"control mode (description)",ref:{value:"rbtCtrModeStr"}},{type:"enum",name:"cleaning mode",ref:{value:"rbtClnMode",options:["Cleaning_Auto","Cleaning_Part","Cleaning_Repeat","Cleaning_Manual","Cleaning_Stop"]}},{type:"string",name:"cleaning mode (description)",ref:{value:"rbtClnModeStr"}},{type:"enum",name:"turbo mode",ref:{value:"rbtTrbMode",options:["Turbo_On","Turbo_Off","Turbo_Silence"]}},{type:"string",name:"turbo mode (description)",ref:{value:"rbtTrbModeStr"}},{type:"enum",
name:"Smart Control state",ref:{value:"rbtRC",options:["on","off"]}},{type:"enum",name:"error state",ref:{value:"rbtError",options:["Normal","ErrorCode_%d"]}}]},k={command:[{type:"enum",name:"power on",ref:{value:"apOn"}},{type:"enum",name:"power off",ref:{value:"apOff"}},{type:"enum",name:"power toggle",ref:{value:"apToggle"}},{type:"enum",name:"set wind speed",ref:{value:"rbtSetWS",ext:"%e",extMeta:["Auto","Sleeping","Low","Medium","High"]}},{type:"int",name:"set wind speed level",ref:{value:"rbtSetWSLvl",
ext:"%d",extMeta:"0-4"}},{type:"enum",name:"wind speed up",ref:{value:"rbtSetWSUp"}},{type:"enum",name:"wind speed down",ref:{value:"rbtSetWSDown"}}],status:[{type:"enum",name:"connected",ref:{value:"apConn",options:["true","false"]}},{type:"enum",name:"power",ref:{value:"apPower",options:["on","off"]}},{type:"float",name:"PM 10.0 value",ref:{value:"apDust"}},{type:"int",name:"PM 10.0 level",ref:{value:"apDustLvl"}},{type:"float",name:"PM 2.5 value",ref:{value:"apFDust"}},{type:"int",name:"PM 2.5 level",
ref:{value:"apFDustLvl"}},{type:"int",name:"Gas level",ref:{value:"apOdorLvl"}},{type:"enum",name:"wind speed",ref:{value:"apWS",options:["Auto","Sleeping","Low","Medium","High"]}},{type:"int",name:"wind speed level",ref:{value:"apWSLvl"}},{type:"enum",name:"error state",ref:{value:"apError",options:["ErrorCode_%d"]}}]};return{SYS:"samsung_smarthome",registModule:function(a){a.register(this.SYS,"samsung")},getGatewayType:function(){return{sys:this.SYS,name:"Samsung Smart Home (Cloud)"}},getGatewayDeviceType:function(a){return a.sys==
this.SYS?[{sys:this.SYS,type:"Refrigerator",name:"Smart Refrigerator"}]:null},createGateway:function(a,b,c){b=xnm.aio.samsung.DMError;var d=xnm.aio.samsung.DMError.ERROR_CODE;a?a.accessKey?c(null,a):c(new b(d.INVALID,"accessKey is invalid")):c(new b(d.INVALID,"info is invalid"))},updateGateway:function(a,b,c,d){a=xnm.aio.samsung.DMError;c=xnm.aio.samsung.DMError.ERROR_CODE;b?b.accessKey?d(null,b):d(new a(c.INVALID,"ip is invalid")):d(new a(c.INVALID,"update is invalid"))},deleteGateway:function(a,
b,c){c()},createDevice:function(a,b,c){var d=xnm.aio.samsung.DMError,e=xnm.aio.samsung.DMError.ERROR_CODE;if(a)if(a.gateway)if(null==a.type||"undefined"==typeof a.type)c(new d(e.INVALID,"type is invalid"));else if(null==a.id||"undefined"==typeof a.id)c(new d(e.INVALID,"address is invalid"));else if(b.data&&b.data.gateways&&0!==b.data.gateways.length){b=b.data.gateways;var f;for(f=0;f<b.length;f++)if(b[f].index===a.gateway){var g=b[f];break}g?c(null,a):c(new d(e.NOT_FOUND,"gateway with index "+a.gateway+
" not exists"))}else c(new d(e.NOT_FOUND,"gateway with index "+a.gateway+" not exists"));else c(new d(e.INVALID,"gateway is invalid"));else c(new d(e.INVALID,"info is invalid"))},updateDevice:function(a,b,c){var d=xnm.aio.samsung.DMError,e=xnm.aio.samsung.DMError.ERROR_CODE;if(a)if(a.gateway)if(null==a.type||"undefined"==typeof a.type)c(new d(e.INVALID,"type is invalid"));else if(null==a.id||"undefined"==typeof a.id)c(new d(e.INVALID,"address is invalid"));else if(b.data&&b.data.gateways&&0!==b.data.gateways.length){b=
b.data.gateways;var f;for(f=0;f<b.length;f++)if(b[f].index===a.gateway){var g=b[f];break}g?c(null,a):c(new d(e.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else c(new d(e.NOT_FOUND,"gateway with index "+a.gateway+" not exists"));else c(new d(e.INVALID,"gateway is invalid"));else c(new d(e.INVALID,"info is invalid"))},deleteDevice:function(a,b,c){c()},getCommandStatusMap:function(g,h){if(!g)return null;switch(g.type){case "Refrigerator":return this._getFridgeMap(g);case "Washer":return e;
case "Air_Conditioner":switch(g.deviceSubType){case "FAC":return d;case "Room_Air_Conditioner":return b;default:return null}case "Oven":return a;case "Dryer":return c;case "Robot_Cleaner":return f;case "Air_Purifier":return k;default:return null}},_getFridgeMap:function(a){var b={command:[],status:[]};var c={type:"enum",name:"connected",ref:{value:"frdgConn",options:["true","false"]}};b.status.push(c);a.Doors&&a.Doors.forEach(function(a){if(a&&a.id&&a.name){var c={type:"enum",name:a.name+" state",
ref:{value:"frdgDoorState"+a.id,options:["open","closed"]}};b.status.push(c);c={type:"string",name:a.name+" name",ref:{value:"frdgDoorName"+a.id}};b.status.push(c)}});a.Fridge&&(c={type:"enum",name:"filter state",ref:{value:"frdgFilterState",options:["good","order","replace"]}},b.status.push(c));a.Temperatures&&a.Temperatures.forEach(function(a){if(a&&a.id&&a.name){var c={type:"float",name:a.name+" temperature",ref:{value:"frdgTempState"+a.id,extMeta:"-22.0-14.0"}};b.status.push(c);c={type:"enum",
name:a.name+" temperature unit",ref:{value:"frdgTempUnit"+a.id,options:["\u00b0C","\u00b0F","NotSupported"]}};b.status.push(c)}});a.Mode&&a.Mode.modes&&(c={type:"enum",name:"water filter state",ref:{value:"frdgWFState",options:["good","replace"]}},b.status.push(c));c={type:"enum",name:"error state",ref:{value:"frdgError",options:"Freeze_Door_Alarm Freeze_High_Temp Fridge_Door_Alarm Freeze_High_Temp CV_Door_Alarm CV_High_Temp Single_Door_Alarm".split(" ")}};b.status.push(c);return b}}}();
xnm.aio.samsung.SmartHomeNotifyManager={_logger:null,_inited:!1,_listeners:[],_devices:[],init:function(e){if(this._inited)e&&e();else{this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.samsung.SmartHomeNotifyManager");var d=require("xnm.aio.webhook.js");if(d){var b=this;d.start(function(a){a||(b._inited=!0,d.addHandler("samsung_smarthome",b));e&&e(a)})}else e&&e(Error("no webhook lib"))}},addListener:function(e){e&&-1==this._listeners.indexOf(e)&&
this._listeners.push(e)},clearListeners:function(){this._listeners=[]},subscribe:function(e,d,b){var a=require("xnm.aio.webhook.js");if(a){switch(e.sys){case xnm.aio.samsung.SmartHomeCloud.DM.SYS:var c=xnm.aio.samsung.SmartHomeCloud.parseJSON(e);break;default:b&&b(Error("do not support"));return}if(c){var f=this;for(e=0;e<d.length;e++){for(var k=!1,g=0;g<this._devices.length;g++)if(d[e]&&this._devices[g]&&d[e].id==this._devices[g].id){k=!0;break}k||this._devices.push(d[e])}c.getDeviceList(function(d,
e){if(d)b&&b(d);else{d=f._getDeviceIDs(e);var g=f._getSubscriptions(e);c.subscibe(d,function(c){c?b&&b(c):a.subscribe("samsung_smarthome",g,b)})}})}else b&&b(Error("gateway json format invalid"))}else b&&b(Error("no webhook lib"))},unsubscribeAll:function(e){var d=require("xnm.aio.webhook.js");d?(this._devices=[],d.unsubscribeType("samsung_smarthome",e)):e&&e(Error("no webhook lib"))},isUniqueSubscribe:function(e,d){if(!e||"samsung_smarthome"!=e.type||!e.device)return!1;for(var b=0;b<d.length;b++)if(d[b]&&
"samsung_smarthome"==d[b].type&&d[b].device==e.device)return!1;return!0},onNotification:function(e){if(e){this._logger.log("trace","receive notification:"+JSON.stringify(e));for(var d,b=0;b<this._devices.length;b++)if(this._devices[b]&&this._devices[b].id==e.id){d=this._handleNotification(this._devices[b],e);break}this._logger.log("trace",this._listeners.length+" resolve state:"+JSON.stringify(d));if(d)for(e=0;e<this._listeners.length;e++)try{this._listeners[e](d)}catch(a){this._logger.log("trace",
"call listener error:"+a.message)}}},onDummyNotification:function(e,d,b){if(e){this._logger.log("trace","receive dummy notification:"+JSON.stringify(e)+" key:"+d+" value:"+b);for(var a=null,c=0;c<this._devices.length;c++)if(this._devices[c]&&this._devices[c].id==e.id){a=this._devices[c];break}if(a)for(e=a._alias+":"+d,d=0;d<this._listeners.length;d++)try{this._listeners[d]([{id:e,status:b}])}catch(f){this._logger.log("trace","call listener error:"+f.message)}}},_handleNotification:function(e,d){var b=
function(a,b){xnm.aio.samsung.SmartHomeCloud._AlarmBuffer[b.id]=b.Alarms;return b};"Alarms"==d.resource&&b(e,d);b=JSON.parse(JSON.stringify(d));"Device"==d.resource&&(b=d.Device,b.id=d.id);b.Alarms=xnm.aio.samsung.SmartHomeCloud._AlarmBuffer[d.id];d=new xnm.aio.samsung.SmartHomeCloud;if(!e._alias)return null;switch(e.type){case "Refrigerator":d=d._resolveFridgeStates(b);break;case "Washer":d=d._resolveWasherStates(b);break;case "Air_Conditioner":b.deviceSubType=e.deviceSubType;d=d._resolveACStates(b);
break;case "Oven":d=d._resolveOvenStates(b);break;case "Dryer":d=d._resolveDryerStates(b);break;case "Robot_Cleaner":d=d._resolveRobotStates(b);break;case "Air_Purifier":d=d._resolveAPStates(b);break;default:return null}if(!d)return null;(function(a,b){var c=xnm.aio.samsung.SmartHomeCloud._StatusBuffer,d;for(d in c)if(c.hasOwnProperty(d)){var e=c[d],f=!1;e.states||(e.states={});e.states[a.id]||(e.states[a.id]={});for(var g in b)b.hasOwnProperty(g)&&(e.states[a.id][g]=b[g],f=!0);f&&(e.time=(new Date).getTime())}})(e,
d);var a=[],c;for(c in d){b=e._alias+":"+c;var f=d[c];a.push({id:b,status:f})}return a},_getDeviceIDs:function(e){for(var d=[],b=0;b<e.length;b++)e[b]&&e[b].id&&-1==d.indexOf(e[b].id)&&d.push(e[b].id);return d},_getSubscriptions:function(e){for(var d=[],b=[],a=0;a<e.length;a++)e[a]&&e[a].id&&-1==b.indexOf(e[a].id)&&(b.push(e[a].id),d.push({type:"samsung_smarthome",device:e[a].id}));return d}};
xnm.aio.samsung.DMError=function(){var e=function(d,b){this.code=d;this.message=b;this.stack=Error().stack};e.prototype=Error();e.prototype.name="SamsungDmError";e.prototype.code=0;e.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return e}();
xnm.aio.samsung.DM=function(){return{_getSystem:function(e){for(var d in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(d)){var b=xnm.aio.samsung[d];if(b&&b.DM&&b.DM.SYS==e)return b}return null},getGatewayType:function(){var e=[],d;for(d in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(d)){var b=xnm.aio.samsung[d];b&&b.DM&&b.DM.getGatewayType&&(b=b.DM.getGatewayType())&&e.push(b)}return e},getGatewayDeviceType:function(e){var d=[],b;for(b in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(b)){var a=
xnm.aio.samsung[b];a&&a.DM&&a.DM.getGatewayDeviceType&&(a=a.DM.getGatewayDeviceType(e))&&(Array.isArray(a)?d=d.concat(a):d.push(a))}return d},createGateway:function(e,d,b){var a=xnm.aio.samsung.DMError,c=xnm.aio.samsung.DMError.ERROR_CODE;if(e)if(e.sys){var f=this._getSystem(e.sys);f&&f.DM&&f.DM.createGateway?f.DM.createGateway(e,d,b):b&&b(new a(c.INVALID,"no such sys:"+e.sys))}else b&&b(new a(c.INVALID,"sys is invalid"));else b&&b(new a(c.INVALID,"info is invalid"))},updateGateway:function(e,d,b,
a){var c=xnm.aio.samsung.DMError,f=xnm.aio.samsung.DMError.ERROR_CODE;if(d)if(d.sys){var k=this._getSystem(d.sys);k&&k.DM&&k.DM.updateGateway?k.DM.updateGateway(e,d,b,a):a&&a(new c(f.INVALID,"no such sys:"+d.sys))}else a&&a(new c(f.INVALID,"sys is invalid"));else a(new c(f.INVALID,"info is invalid"))},deleteGateway:function(e,d,b){var a=xnm.aio.samsung.DMError,c=xnm.aio.samsung.DMError.ERROR_CODE;if(e)if(e.sys){var f=this._getSystem(e.sys);f&&f.DM&&f.DM.deleteGateway?f.DM.deleteGateway(e,d,b):b&&
b(new a(c.INVALID,"no such sys:"+e.sys))}else b&&b(new a(c.INVALID,"sys is invalid"));else b()},createDevice:function(e,d,b){var a=xnm.aio.samsung.DMError,c=xnm.aio.samsung.DMError.ERROR_CODE;if(e)if(e.sys){var f=this._getSystem(e.sys);f&&f.DM&&f.DM.createDevice?f.DM.createDevice(e,d,b):b&&b(new a(c.INVALID,"no such sys:"+e.sys))}else b&&b(new a(c.INVALID,"sys is invalid"));else b&&b(new a(c.INVALID,"info is invalid"))},updateDevice:function(e,d,b){var a=xnm.aio.samsung.DMError,c=xnm.aio.samsung.DMError.ERROR_CODE;
if(e)if(e.sys){var f=this._getSystem(e.sys);f&&f.DM&&f.DM.updateDevice?f.DM.updateDevice(e,d,b):b&&b(new a(c.INVALID,"no such sys:"+e.sys))}else b&&b(new a(c.INVALID,"sys is invalid"));else b(new a(c.INVALID,"info is invalid"))},deleteDevice:function(e,d,b){var a=xnm.aio.samsung.DMError,c=xnm.aio.samsung.DMError.ERROR_CODE;if(e)if(e.sys){var f=this._getSystem(e.sys);f&&f.DM&&f.DM.deleteDevice?f.DM.deleteDevice(e,d,b):b&&b(new a(c.INVALID,"no such sys:"+e.sys))}else b&&b(new a(c.INVALID,"sys is invalid"));
else b()},applyUIFilter:function(e,d){var b=function(a,b){if("*"==a)return!0;for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},a=function(a,c,d){var e=[];switch(d.catagory){case "command":a.command&&a.command.forEach(function(a){b(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){b(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))})}return e},c=function(b,c){var d=[],e;if(b.sys){var f=this._getSystem(b.sys);
f&&f.DM&&f.DM.getCommandStatusMap&&(e=f.DM.getCommandStatusMap(b))}e&&(b=a(e,b,c),d=d.concat(b));return d};if(!e.sys)return null;var f=JSON.parse(JSON.stringify(e)),k=null;switch(d.catagory){case "command":k=c.call(this,e,d);f.command=k;break;case "status":k=c.call(this,e,d);f.status=k;break;default:return null}return k&&0!=k.length?f:null}}}();
xnm.aio.samsung.Handler=function(){var e=function(){};e.prototype.devicemanager=xnm.aio.samsung.DM;e.prototype.SamsungTV=xnm.aio.samsung.TV;e.prototype.SmartHomeCloud=xnm.aio.samsung.SmartHomeCloud;e.prototype.SmartHomeNotifyManager=xnm.aio.samsung.SmartHomeNotifyManager;e.prototype.registModule=function(d){for(var b in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(b)){var a=xnm.aio.samsung[b];a&&a.DM&&a.DM.registModule&&a.DM.registModule(d)}};e.prototype.resolveGateway=function(d){switch(d.sys){case xnm.aio.samsung.SmartHomeCloud.DM.SYS:return xnm.aio.samsung.SmartHomeCloud.parseJSON(d);
default:return null}};e.prototype.getDeviceCommands=function(d,b){d=(d=xnm.aio.samsung.DM.applyUIFilter(d,{catagory:"command",elems:"*"}))?d.command:[];b&&b(null,d)};e.prototype.getDeviceStatus=function(d,b){d=(d=xnm.aio.samsung.DM.applyUIFilter(d,{catagory:"status",elems:"*"}))?d.status:[];b&&b(null,d)};e.prototype.doCommand=function(d,b,a,c){d?(d=this.resolveGateway(d))?d.executeCommandCreator(b,a,function(a){c&&c(a)}):c&&c(Error("gateway json format invalid")):c&&c(Error("only support gateway"))};
e.prototype.doStatus=function(d,b,a,c,e){(b=this.resolveGateway(b))?b.getStatesCreator(null,[{id:d,device:a,status:c}],function(a,b){a?e&&e(a):e&&e(null,b[0])}):e&&e(Error("gateway json format invalid"))};e.prototype.getSmartHomeDeviceList=function(d,b){(d=this.resolveGateway(d))?d.getDeviceList(function(a,c){b&&b(a,c)}):b&&b(Error("gateway json format invalid"))};return e}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.samsung.Handler);
