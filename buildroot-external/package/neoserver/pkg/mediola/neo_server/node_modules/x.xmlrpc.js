var x=x||{};x.xmlrpc=x.xmlrpc||{};x.xmlrpc.Handler=function(){};x.xmlrpc.Handler.prototype.serializeReq=function(a,b){if(!a)throw Error("method name invalid");a='<?xml version="1.0" encoding="UTF-8"?><methodCall><methodName>'+(this._escapeXml(a)+"</methodName>");a+=this.serializeParams(b);return a+"</methodCall>"};
x.xmlrpc.Handler.prototype.serializeRsp=function(a,b){var c='<?xml version="1.0" encoding="UTF-8"?><methodResponse>';a?c+=this.serializeFault(a):b&&(c+=this.serializeParams(b));return c+"</methodResponse>"};x.xmlrpc.Handler.prototype.serializeFault=function(a){var b="<fault>";(a=this.serializeValue(a))&&(b+=a);return b+"</fault>"};
x.xmlrpc.Handler.prototype.serializeParams=function(a){var b="<params>",c;if(a)for(var d=0;d<a.length;d++)(c=this.serializeValue(a[d]))&&(b+="<param>"+c+"</param>");return b+"</params>"};
x.xmlrpc.Handler.prototype.serializeValue=function(a,b){if(null===a||"undefined"===typeof a)return"<value><nil/></value>";if(b)return"<value><"+b+">"+a+"</"+b+"></value>";var c;switch(typeof a){case "boolean":return"<value><boolean>"+(a?1:0)+"</boolean></value>";case "number":return 0===a%1?"<value><i4>"+a+"</i4></value>":"<value><double>"+a+"</double></value>";case "string":return"<value><string>"+this._escapeXml(a)+"</string></value>";case "object":if(a instanceof Date)return"<value><dateTime.iso8601>"+
this._formatDateISO8601(a)+"</dateTime.iso8601></value>";if("[object Array]"===Object.prototype.toString.call(a)){b="<value><array><data>";for(var d=0;d<a.length;d++)(c=this.serializeValue(a[d]))&&(b+=c);return b+"</data></array></value>"}if(a.__rpcValueType)return this.serializeValue(a.__rpcValue,a.__rpcValueType);b="<value><struct>";for(d in a)a.hasOwnProperty(d)&&(c=this.serializeValue(a[d]))&&(b+="<member><name>"+this._escapeXml(d)+"</name>"+c+"</member>");return b+"</struct></value>";default:return null}};
x.xmlrpc.Handler.prototype.deserializeReq=function(a){if(!a)throw Error("xml invalid");try{var b=$($.parseXML(a))}catch(e){throw e;}a=b.children();if(!a||1!=a.length)throw Error("method call invalid:0");b=$(a[0]);var c=b.prop("tagName");if("methodCall"!=c)throw Error("method call invalid:1");a=b.children();if(!a||2!=a.length)throw Error("method call invalid:2");b=$(a[0]);c=b.prop("tagName");if("methodName"!=c)throw Error("method call invalid:3");var d=b.text();b=$(a[1]);c=b.prop("tagName");if("params"!=
c)throw Error("method call invalid:4");return{methodName:d,params:this.deserializeParams(b)}};
x.xmlrpc.Handler.prototype.deserializeRsp=function(a){if(!a)throw Error("xml invalid");try{var b=$($.parseXML(a))}catch(c){throw c;}a=b.children();if(!a||1!=a.length)throw Error("method response invalid:0");a=$(a[0]);b=a.prop("tagName");if("methodResponse"!=b)throw Error("method response invalid:1");a=a.children();if(!a||1!=a.length)throw Error("method response invalid:2");a=$(a[0]);b=a.prop("tagName");if("fault"==b)return{error:this.deserializeFault(a)};if("params"==b)return{params:this.deserializeParams(a)};
throw Error("method response invalid:3");};x.xmlrpc.Handler.prototype.deserializeFault=function(a){if(!a)throw Error("fault node is null");if("fault"!=a.prop("tagName"))throw Error("fault invalid");a=a.children();if(!a||1!=a.length||!a[0])throw Error("fault value invalid");return this.deserializeValue($(a[0]))};
x.xmlrpc.Handler.prototype.deserializeParams=function(a){if(!a)throw Error("params node is null");if("params"!=a.prop("tagName"))throw Error("params invalid");a=a.children();var b=[];if(!a||0==a.length)return b;for(var c=0;c<a.length;c++){var d=$(a[c]);if(!d||"param"!=d.prop("tagName"))throw Error("params invalid");d=d.children();if(!d||1!=d.length||!d[0])throw Error("param invalid");d=$(d[0]);d=this.deserializeValue(d);b.push(d)}return b};
x.xmlrpc.Handler.prototype.deserializeValue=function(a){if(!a)throw Error("value node is null");var b=a.prop("tagName");if("value"!=b)throw Error("value invalid");var c=a.children();if(!c||0==c.length||!c[0])return c=a.text(),null==c||"undefined"==typeof c?"":c;var d=$(c[0]);b=d.prop("tagName");switch(b){case "nil":var e=null;break;case "boolean":e=d.text();if(null==e||"undefined"==typeof e||0==e.length||"1"!=e&&"0"!=e)throw Error("boolean value invalid");e="1"==e;break;case "i4":case "int":e=d.text();
if(null==e||"undefined"==typeof e||0==e.length)throw Error("int value invalid");e=parseInt(e);if(isNaN(e))throw Error("int value invalid");break;case "double":e=d.text();if(null==e||"undefined"==typeof e||0==e.length)throw Error("double value invalid");e=parseFloat(e);if(isNaN(e))throw Error("double value invalid");break;case "string":e=(e=d.text())?e:"";break;case "dateTime.iso8601":e=d.text();if(null==e||"undefined"==typeof e||0==e.length)throw Error("dateTime value invalid");e=this._resolveDateISO8601(e);
break;case "array":c=d.children();if(!c||1!=c.length||!c[0])throw Error("array invalid");d=$(c[0]);b=d.prop("tagName");if("data"!=b)throw Error("array data invalid");c=d.children();e=[];if(c||0!=c.length)for(a=0;a<c.length;a++)c[a]&&(b=this.deserializeValue($(c[a])),e.push(b));break;case "struct":if(e={},(c=d.children())&&0!=c.length)for(a=0;a<c.length;a++)if(c[a]){d=$(c[a]);var f=d.children();if(!f||2!=f.length)throw Error("struct member invalid");if(!f[0]||!f[1])throw Error("struct member invalid");
d=$(f[0]);b=d.prop("tagName");if("name"!=b)throw Error("struct member name invalid");b=d.text();if(!b)throw Error("struct member name invalid");d=$(f[1]);e[b]=this.deserializeValue(d)}}return e};x.xmlrpc.XML_CHAR_MAP={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"};x.xmlrpc.Handler.prototype._escapeXml=function(a){return a.replace(/[<>&"']/g,function(a){return x.xmlrpc.XML_CHAR_MAP[a]})};
x.xmlrpc.Handler.prototype._unescapeXml=function(a){if(!a)return a;a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");a=a.replace(/&amp;/g,"&");a=a.replace(/&quot;/g,'"');return a=a.replace(/&apos;/g,"'")};
x.xmlrpc.Handler.prototype._formatDateISO8601=function(a){var b=function(a){a=String(a);1===a.length&&(a="0"+a);return a};return Date.prototype.toISOString?a.toISOString():this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"};
x.xmlrpc.Handler.prototype._resolveDateISO8601=function(a){a=a.replace(/\D/g," ");a=a.split(" ");a[1]--;return new Date(Date.UTC(a[0],a[1],a[2],a[3],a[4],a[5]))};"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.xmlrpc.Handler);
