var Logger=require("x.logger.js"),x=x||{};x.EventEmitter=function(){this._events=this._events||{};this._maxListeners=this._maxListeners||x.EventEmitter.defaultMaxListeners};x.EventEmitter._logger=Logger.getLogger("x.EventEmitter");x.EventEmitter.defaultMaxListeners=10;x.EventEmitter.prototype.setMaxListeners=function(b){if("number"!==typeof b||0>b||isNaN(b))throw new TypeError("n must be a positive number");this._maxListeners=b};
x.EventEmitter.prototype.emit=function(b){var a;this._events||(this._events={});if("error"===b&&(!this._events.error||"object"===typeof this._events.error&&!this._events.error.length)){var c=arguments[1];if(c instanceof Error)throw c;throw new TypeError('Uncaught, unspecified "error" event.');}var d=this._events[b];if("undefined"===typeof d)return!1;if("function"===typeof d)switch(arguments.length){case 1:d.call(this);break;case 2:d.call(this,arguments[1]);break;case 3:d.call(this,arguments[1],arguments[2]);
break;default:c=arguments.length;var e=Array(c-1);for(a=1;a<c;a++)e[a-1]=arguments[a];d.apply(this,e)}else if("object"===typeof d){c=arguments.length;e=Array(c-1);for(a=1;a<c;a++)e[a-1]=arguments[a];d=d.slice();c=d.length;for(a=0;a<c;a++)d[a].apply(this,e)}return!0};
x.EventEmitter.prototype.addListener=function(b,a){if("function"!==typeof a)throw new TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",b,"function"===typeof a.listener?a.listener:a);this._events[b]?"object"===typeof this._events[b]?this._events[b].push(a):this._events[b]=[this._events[b],a]:this._events[b]=a;"object"!==typeof this._events[b]||this._events[b].warned||(a=this._maxListeners)&&0<a&&this._events[b].length>a&&(this._events[b].warned=
!0,x.EventEmitter._logger.log("warn",Error("(node) warning: possible EventEmitter memory leak detected. "+this._events[b].length+" listeners added. Use emitter.setMaxListeners() to increase limit.").stack));return this};x.EventEmitter.prototype.on=x.EventEmitter.prototype.addListener;
x.EventEmitter.prototype.once=function(b,a){function c(){this.removeListener(b,c);d||(d=!0,a.apply(this,arguments))}if("function"!==typeof a)throw new TypeError("listener must be a function");var d=!1;c.listener=a;this.on(b,c);return this};
x.EventEmitter.prototype.removeListener=function(b,a){if("function"!==typeof a)throw new TypeError("listener must be a function");if(!this._events||!this._events[b])return this;var c=this._events[b];var d=c.length;var e=-1;if(c===a||"function"===typeof c.listener&&c.listener===a)delete this._events[b],this._events.removeListener&&this.emit("removeListener",b,a);else if("object"===typeof c){for(;0<d--;)if(c[d]===a||c[d].listener&&c[d].listener===a){e=d;break}if(0>e)return this;1===c.length?(c.length=
0,delete this._events[b]):c.splice(e,1);this._events.removeListener&&this.emit("removeListener",b,a)}return this};
x.EventEmitter.prototype.removeAllListeners=function(b){if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[b]&&delete this._events[b],this;if(0===arguments.length){for(a in this._events)"removeListener"!==a&&this.removeAllListeners(a);this.removeAllListeners("removeListener");this._events={};return this}var a=this._events[b];if("function"===typeof a)this.removeListener(b,a);else if(Array.isArray(a))for(;a.length;)this.removeListener(b,
a[a.length-1]);delete this._events[b];return this};x.EventEmitter.prototype.listeners=function(b){return this._events&&this._events[b]?"function"===typeof this._events[b]?[this._events[b]]:this._events[b].slice():[]};x.EventEmitter.listenerCount=function(b,a){return b._events&&b._events[a]?"function"===typeof b._events[a]?1:b._events[a].length:0};exports&&(exports.EventEmitter=x.EventEmitter);
