var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,g,c){b instanceof String&&(b=String(b));for(var e=b.length,d=0;d<e;d++){var f=b[d];if(g.call(c,f,d,b))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,g,c){b!=Array.prototype&&b!=Object.prototype&&(b[g]=c.value)};$jscomp.getGlobal=function(b){b=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,b];for(var g=0;g<b.length;++g){var c=b[g];if(c&&c.Math==Math)return c}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,g,c,e){if(g){c=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var d=b[e];d in c||(c[d]={});c=c[d]}b=b[b.length-1];e=c[b];g=g(e);g!=e&&null!=g&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.fritz=xnm.aio.fritz||{};
xnm.aio.fritz.SessionCache={_cache:{},STATE_TO:5E3,setSessionID:function(b,g){if(b){var c=this._cache[b];c||(this._cache[b]={},c=this._cache[b]);c.sessionID=g}},getSessionID:function(b){return b?this._cache[b]?this._cache[b].sessionID:null:null}};
xnm.aio.fritz.Box=function(){function b(e,d){var f=360,c=-1,a=null,h;for(h in g){var b=g[h];var k=Math.abs(e-b.hue);k<f&&(f=k,c=b.hue,a=h)}b=g[a];return[c,d>b.sat[0]?b.sat[0]:d>b.sat[1]?b.sat[1]:d>b.sat[2]?b.sat[2]:0]}var g={red:{hue:358,sat:[180,112,54],val:[255,255,255]},orange:{hue:35,sat:[214,140,72],val:[252,252,255]},yellow:{hue:52,sat:[153,102,51],val:[255,255,255]},lime:{hue:92,sat:[123,79,38],val:[248,250,252]},green:{hue:120,sat:[160,82,38],val:[220,232,242]},turquoise:{hue:160,sat:[145,
84,41],val:[235,242,248]},cyan:{hue:195,sat:[179,118,59],val:[255,255,255]},lightblue:{hue:212,sat:[169,110,56],val:[252,252,255]},blue:{hue:225,sat:[204,135,67],val:[255,255,255]},purple:{hue:266,sat:[169,110,54],val:[250,250,252]},magenta:{hue:296,sat:[140,92,46],val:[250,252,255]},pink:{hue:335,sat:[180,107,51],val:[255,248,250]}},c=function(e,d,f,c){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.fritz.Box");this.ip=e;this.port=
c;this.protocol="http";e&&"http://"==e.substr(0,7)?this.ip=e.substr(7):e&&"https://"==e.substr(0,8)&&(this.ip=e.substr(8),this.protocol="https");this.port||(this.port="https"==this.protocol?443:80);this.password=d;this.user="";f&&(this.user=f);this.CommandHandler=null};c.prototype._doRequest=function(e,d){var f=this;this._cachedSessionID()&&(e+="&sid="+this._cachedSessionID());var c=d;d={host:this.ip,port:this.port,path:e,method:"GET"};this._logger.log("trace","send ("+this.protocol+") req to:"+JSON.stringify(d));
var a="";e=require("http");"https"==this.protocol&&(e=require("https"),"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0"),d.port||(d.port=443));var h=e.request(d,function(d){d.on("data",function(d){a+=d});d.on("end",function(){var e=null;200==d.statusCode?f._logger.log("trace","http request success:"+a):(f._logger.log("trace","http request error:"+d.statusCode+"-"+a),e=Error("request failed with status code:"+d.statusCode));c&&c(e,a,d.statusCode);
c=null})});h.setTimeout&&h.setTimeout(6E4,function(){h.abort()});if(h.on&&"function"==typeof h.on)h.on("error",function(a){a||(a=Error("http request error"));f._logger.log("trace","http request error:"+a.message);c&&c(a);c=null});h.end()};c.prototype._sendRequest=function(e,d){var f=this;this._doRequest(e,function(c,a,h){c&&403==h?(f._setSessionID(null),f._getSessionID(function(a,c){a?(f._logger.log("trace","create new session error:"+a.message),d&&d(a)):(f._setSessionID(c),f._sendRequest(e,d))})):
d&&d(c,a)})};c.prototype._setSessionID=function(e){return xnm.aio.fritz.SessionCache.setSessionID(this.ip,e)};c.prototype._cachedSessionID=function(){return xnm.aio.fritz.SessionCache.getSessionID(this.ip)};c.prototype._getSessionID=function(e){var d=this;this._logger.log("trace","create new session");this._doRequest("/login_sid.lua",function(f,c){if(f)e&&e(f);else try{var a=$($.parseXML(c));if(a){var h=null;f=null;var b=a.find("SID");b&&(h=$(b[0]).text());(b=a.find("Challenge"))&&(f=$(b[0]).text());
if("0000000000000000"!=h)e&&e(null,h);else if(f){h=null;var m=require("x.crypt.js"),g=f+"-"+m.MD5(f+"-"+d.password,!0);d._doRequest("/login_sid.lua?username="+d.user+"&response="+g,function(a,d){if(a)e&&e(a);else try{var f=$($.parseXML(d));if(f){var c=f.find("SID");c&&(h=$(c[0]).text());"0000000000000000"==h&&(h=null)}h||(a=Error("session challenge fail"));e&&e(a,h)}catch(p){e&&e(p)}})}}}catch(n){e&&e(n)}})};c.prototype._getDeviceInfos=function(e){var d=this;d._sendRequest("/webservices/homeautoswitch.lua?switchcmd=getdevicelistinfos",
function(f,c){f?e&&e(f):(f=[],c&&(c=$($.parseXML(c)),f=d._resolveDevices(c)),e&&e(null,f))})};c.prototype._resolveDevices=function(e){var d=this,f=[];e.find("device").each(function(){var e=$(this);(e=d._resolveDevice(e))&&f.push(e)});e.find("group").each(function(){var e=$(this);(e=d._resolveGroup(e))&&f.push(e)});return f};c.prototype._resolveDevice=function(e){var d=e.attr("identifier");if(!d)return null;var f=e.find("name"),c="";f&&f[0]&&(c=$(f[0]).text());d=d.replace(" ","");f=e.attr("productname");
var a=e.attr("functionbitmask");a=parseInt(a);var h=null;if(a&1){if(!(a&8192))return null;var b=e.find("etsiunitinfo");if(b&&b[0]){h={};var g=$(b[0]).find("unittype");h.unittype=g&&g[0]?$(g[0]).text():null;b=$(b[0]).find("interfaces");h.interfaces=b&&b[0]?$(b[0]).text().split(","):null}}b="Comet DECT"==f?"thermo":"switch";"FRITZ!DECT 500"==f&&(b="colorlight");d={sys:"fritz",name:c,type:"fritz_dect",typeName:f,bitmask:parseInt(a),address:d,data:b,etsiunitinfo:h};d.states=this._resolveStates(d,e);return d};
c.prototype._resolveGroup=function(e){var d=e.attr("identifier");if(!d)return null;var f=e.find("name"),c="";f&&f[0]&&(c=$(f[0]).text());d=d.replace(" ","");(f=e.attr("productname"))||(f="Group");var a=e.attr("functionbitmask");d={sys:"fritz",name:c,type:"fritz_dect",typeName:f,bitmask:parseInt(a),address:d,data:"group"};d.states=this._resolveStates(d,e);return d};c.prototype._resolveStates=function(e,d){var f={},c=!1,a,b=d.find("present");if(b&&b[0])switch(c=!0,b=$(b[0]).text(),b){case "1":f.connected=
"true";break;case "0":f.connected="false";break;default:f.connected="?"}if((b=d.find("switch"))&&b[0]){c=!0;if((a=$(b[0]).find("state"))&&a[0])switch(a=$(a[0]).text(),a){case "1":f.state="on";break;case "0":f.state="off";break;default:f.state="?"}if((a=$(b[0]).find("mode"))&&a[0])switch(a=$(a[0]).text(),a){case "auto":f.switchMode="auto";break;case "manuell":f.switchMode="manu";break;default:f.switchMode="?"}}(b=d.find("powermeter"))&&b[0]&&(c=!0,(a=$(b[0]).find("power"))&&a[0]&&(a=$(a[0]).text(),
f.current=a?(parseInt(a)/1E3).toFixed(2):"?"),(a=$(b[0]).find("energy"))&&a[0]&&(a=$(a[0]).text(),f.energy=a?parseInt(a):"?"));(b=d.find("temperature"))&&b[0]&&(c=!0,(a=$(b[0]).find("celsius"))&&a[0]&&(a=$(a[0]).text(),f.tempC=a?(parseInt(a)/10).toFixed(1):"?"));(b=d.find("hkr"))&&b[0]&&(c=!0,(a=$(b[0]).find("tsoll"))&&a[0]&&((a=$(a[0]).text())?(a=parseInt(a),f.temp=254==a?28.5:253==a?7.5:(a/2).toFixed(1)):f.temp="?"),(a=$(b[0]).find("komfort"))&&a[0]&&((a=$(a[0]).text())?(a=parseInt(a),f.comfort=
254==a?28.5:253==a?7.5:(a/2).toFixed(1)):f.comfort="?"),(a=$(b[0]).find("absenk"))&&a[0]&&((a=$(a[0]).text())?(a=parseInt(a),f.absenk=254==a?28.5:253==a?7.5:(a/2).toFixed(1)):f.absenk="?"),(a=$(b[0]).find("batterylow"))&&a[0]&&((a=$(a[0]).text())?(a=parseInt(a),f.batlow=1==a?!0:!1):f.batlow="?"),(a=$(b[0]).find("battery"))&&a[0]&&((a=$(a[0]).text())?(a=parseInt(a),f.battery=a):f.battery="?"));if((b=d.find("simpleonoff"))&&b[0]&&(c=!0,(a=$(b[0]).find("state"))&&a[0]))switch(a=$(a[0]).text(),a){case "1":f.state=
"on";break;case "0":f.state="off";break;default:f.state="?"}(b=d.find("levelcontrol"))&&b[0]&&(c=!0,(a=$(b[0]).find("levelpercentage"))&&a[0]&&(a=$(a[0]).text(),a=parseInt(a),"colorlight"==e.data?f.brightness=a:f.level=a));if((b=d.find("colorcontrol"))&&b[0])if(c=!0,e=a=$(b[0]).attr("current_mode"),f.colormode=1==e?"color":4==e?"color_temperature":"unknonw",1==e?f.colortemperature=null:(a=$(b[0]).find("temperature"))&&a[0]&&(a=$(a[0]).text(),f.colortemperature=parseInt(a)),4==e)f.rgb="";else{if((a=
$(b[0]).find("hue"))&&a[0]){a=$(a[0]).text();var g=parseInt(a);g/=360}if((a=$(b[0]).find("saturation"))&&a[0]){a=$(a[0]).text();var k=parseInt(a);k/=255}a=this._HSVToRGB(g,k,f.brightness/100);b=("0"+parseInt(a[0]).toString(16)).slice(-2);b+=("0"+parseInt(a[1]).toString(16)).slice(-2);b+=("0"+parseInt(a[2]).toString(16)).slice(-2);f.rgb=b}return c?f:null};c.prototype.getDevices=function(e){this._getDeviceInfos(function(d,f){var c=[];if(!d&&f)for(d=0;d<f.length;d++){var a=f[d];delete a.states;c.push(a)}e&&
e(c)})};c.prototype.getStates=function(e){this._getDeviceInfos(function(d,f){var c={};if(f)for(var a=0;a<f.length;a++){var b=f[a];b.address&&b.states&&(c[b.address]=b.states)}e&&e(d,c)})};c.prototype.executeCommand=function(e,d,f){var c=d;d.value&&(c=d.value);switch(c){case "on":var a="colorlight"==e.type?"setsimpleonoff&onoff=1":e.bitmask&&parseInt(e.bitmask)&32768?"setsimpleonoff&onoff=1":"setswitchon";break;case "off":a="colorlight"==e.type?"setsimpleonoff&onoff=0":e.bitmask&&parseInt(e.bitmask)&
32768?"setsimpleonoff&onoff=0":"setswitchoff";break;case "toggle":a="colorlight"==e.type?"setsimpleonoff&onoff=2":e.bitmask&&parseInt(e.bitmask)&32768?"setsimpleonoff&onoff=2":"setswitchtoggle";break;case "brightness":"undefined"!=typeof d.ext&&null!=d.ext&&(a=parseInt(d.ext),isNaN(a)||(0>a&&(a=0),100<a&&(a=100)),a="setlevelpercentage&level="+a);break;case "rgb":if("undefined"!=typeof d.ext&&null!=d.ext&&6==d.ext.length){a=parseInt(d.ext.substr(0,2),16);c=parseInt(d.ext.substr(2,2),16);var g=parseInt(d.ext.substr(4,
2),16);a=this._RGBToHSV(a,c,g);a=b(Math.round(a[0]),Math.round(255*a[1]));a=0==a[1]?"setcolortemperature&temperature=4200&duration=0":"setcolor&hue="+a[0]+"&saturation="+a[1]+"&duration=0"}break;case "colortemperature":"undefined"!=typeof d.ext&&null!=d.ext&&(a=parseInt(d.ext),isNaN(a)||(2700>a&&(a=2700),6500<a&&(a=6500)),a="setcolortemperature&temperature="+(6200<a?6500:5600<a?5900:5E3<a?5300:4500<a?4700:4E3<a?4200:3600<a?3800:3200<a?3400:2850<a?3E3:2700)+"&duration=0");break;case "thermoOn":a="sethkrtsoll&param=254";
break;case "thermoOff":a="sethkrtsoll&param=253";break;default:0==d.indexOf("temp")&&(a=d.replace("temp",""),a=parseFloat(a),a=7.5>=a||253==a?"sethkrtsoll&param=253":28.5<=a||254==a?"sethkrtsoll&param=254":"sethkrtsoll&param="+2*a)}a?this._sendRequest("/webservices/homeautoswitch.lua?ain="+e.address+"&switchcmd="+a,function(a){f&&setTimeout(function(){f(a)},250)}):f&&f(Error("no such command "+d))};c.prototype.executeCommandCreator=function(e,d,f){if(e&&e.address&&d&&d.value){var c=d.value;if("temp"==
d.value){if(!d.ext){f&&f(Error("parameter ext invalid"));return}c+=d.ext}else if("brightness"==d.value||"colortemperature"==d.value||"rgb"==d.value)c=d;this.executeCommand(e,c,function(){f&&f()})}else f&&f(Error("parameter invalid"))};c.prototype.getStatesCreator=function(e,d,f){d?0==d.length?f&&f(null,[]):this.getStates(function(e,a){if(e)f&&f(e);else{e=[];for(var c=0;c<d.length;c++)if(d[c]&&d[c].id){var b="?";d[c].device&&d[c].device.address&&d[c].status&&d[c].status.value&&a&&a[d[c].device.address]&&
(b=a[d[c].device.address][d[c].status.value],"undefined"==typeof b||null==b)&&(b="?");e.push({id:d[c].id,status:b})}f&&f(null,e)}}):f&&f(Error("deviceList is null"))};c.prototype._RGBToHSV=function(e,d,f){e/=255;d/=255;f/=255;var c=Math.min(e,Math.min(d,f)),a=Math.max(e,Math.max(d,f));return c==a?[0,0,c]:[60*((e==c?3:f==c?1:5)-(e==c?d-f:f==c?e-d:f-e)/(a-c)),(a-c)/a,a]};c.prototype._HSVToRGB=function(e,d,c){var f=Math.floor(6*e),a=6*e-f;e=c*(1-d);var b=c*(1-a*d);d=c*(1-(1-a)*d);switch(f%6){case 0:var g=
c;var k=d;var l=e;break;case 1:g=b;k=c;l=e;break;case 2:g=e;k=c;l=d;break;case 3:g=e;k=b;l=c;break;case 4:g=d;k=e;l=c;break;case 5:g=c,k=e,l=b}return[Math.round(255*g),Math.round(255*k),Math.round(255*l)]};c.prototype.toJSON=function(){return{sys:"fritz",ip:this.ip,port:this.port,username:this.user,password:this.password}};c.prototype.equalsTo=function(c){return c&&c instanceof xnm.aio.fritz.Box?this.protocol==c.protocol&&this.ip==c.ip&&this.port==c.port&&this.user==c.user&&this.password==c.password:
!1};return c}();
xnm.aio.fritz.DM=function(){var b=function(c,e){this.code=c;this.message=e;this.stack=Error().stack};b.prototype=Error();b.prototype.name="FritzDMError";b.prototype.code=0;b.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var g={fritz_dect:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},
{type:"float",name:"current power",ref:{value:"current"}}]},hkr:{command:[{type:"float",name:"set temperature",ref:{value:"temp",ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"enum",name:"thermostat on",ref:{value:"thermoOn"}},{type:"enum",name:"thermostat off",ref:{value:"thermoOff"}}],status:[{type:"float",name:"set temperature",ref:{value:"temp",ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"float",name:"comfort temperature",ref:{value:"comfort",ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"float",
name:"spar temperature",ref:{value:"absenk",ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"enum",name:"battery low",ref:{value:"batlow",options:["true","false"]}}]},temp:{status:[{type:"float",name:"current temperature",ref:{value:"tempC",scale:"0.1"}}]},powermeter:{status:[{type:"float",name:"energy",ref:{value:"energy"}},{type:"float",name:"current power",ref:{value:"current"}}]},"switch":{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",
name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"switch mode",ref:{value:"switchMode",options:["auto","manu"]}}]},error:{status:[{type:"enum",name:"connected",ref:{value:"connected",options:["true","false"]}}]},simpleswitch:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"state",ref:{value:"state",
options:["on","off"]}}]},brightness:{command:[{type:"int",name:"brightness",ref:{value:"brightness",ext:"%d",extMeta:"0-100"}}],status:[{type:"int",name:"brightness",ref:{value:"brightness",extMeta:"0-100"}}]},colortemperature:{command:[{type:"int",name:"color temperature",ref:{value:"colortemperature",ext:"%d",extMeta:"2700-6500",scale:"100"}}],status:[{type:"int",name:"color temperature",ref:{value:"colortemperature",extMeta:"2700-6500"}}]},color:{command:[{type:"rgb",name:"rgb color",ref:{value:"rgb",
ext:"%s"}}],status:[{type:"string",name:"rgb color",ref:{value:"rgb",ext:"%s"}}]},colormode:{status:[{type:"enum",name:"color mode",ref:{value:"colormode",options:["color","color_temperature","unknown"]}}]}};return{SYS:"fritz",getGatewayType:function(){return[{sys:this.SYS,name:"FRITZ!Box",port:80}]},getGatewayDeviceType:function(){return[{sys:this.SYS,type:"fritz_dect",name:"FRITZ! Smart Home"}]},createGateway:function(c,e,d){e=b.ERROR_CODE;c?c.ip?d(null,c):d(new b(e.INVALID,"ip is invalid")):d(new b(e.INVALID,
"info is invalid"))},updateGateway:function(c,e,d,f){c=b.ERROR_CODE;e?e.ip?f(null,e):f(new b(c.INVALID,"ip is invalid")):f(new b(c.INVALID,"update is invalid"))},deleteGateway:function(c,e,d){d()},createDevice:function(c,e,d){var f=b.ERROR_CODE;if(c)if(c.gateway)if(null==c.address||"undefined"==typeof c.address)d(new b(f.INVALID,"address is invalid"));else if(null==c.type||"undefined"==typeof c.type)d(new b(f.INVALID,"type is invalid"));else if(e.data&&e.data.gateways&&0!==e.data.gateways.length){e=
e.data.gateways;var g;for(g=0;g<e.length;g++)if(e[g].index===c.gateway){var a=e[g];break}a?d(null,c):d(new b(f.NOT_FOUND,"gateway with index "+c.gateway+" not exists"))}else d(new b(f.NOT_FOUND,"gateway with index "+c.gateway+" not exists"));else d(new b(f.INVALID,"gateway is invalid"));else d(new b(f.INVALID,"info is invalid"))},updateDevice:function(c,e,d){var f=b.ERROR_CODE;if(c)if(c.gateway)if(null==c.address||"undefined"==typeof c.address)d(new b(f.INVALID,"address is invalid"));else if(null==
c.type||"undefined"==typeof c.type)d(new b(f.INVALID,"type is invalid"));else if(e.data&&e.data.gateways&&0!==e.data.gateways.length){e=e.data.gateways;var g;for(g=0;g<e.length;g++)if(e[g].index===c.gateway){var a=e[g];break}a?d(null,c):d(new b(f.NOT_FOUND,"gateway with index "+c.gateway+" not exists"))}else d(new b(f.NOT_FOUND,"gateway with index "+c.gateway+" not exists"));else d(new b(f.INVALID,"gateway is invalid"));else d(new b(f.INVALID,"info is invalid"))},deleteDevice:function(c,e,d){d()},
applyUIFilter:function(c,e){var d=this,f=function(a,c,d){var e=[];a.forEach(function(a){if("root"==a.type){a=JSON.parse(JSON.stringify(a));var b=f(a.children,c,d);b&&0<b.length&&(a.children=b,e.push(a))}else{b=d.elems;if("*"==b)b=!0;else{for(var g=!1,h=0;h<b.length;h++)if(b[h]==a.type){g=!0;break}b=g}b&&(a=JSON.parse(JSON.stringify(a)),e.push(a))}});return e},b=function(a,c){var e=[],b=d.getCommandStatusMap(a);if(b){var g=[];switch(c.catagory){case "command":b.command&&(g=f(b.command,a,c));break;
case "status":b.status&&(g=f(b.status,a,c))}e=e.concat(g)}return e};if(!c.sys)return null;var a=JSON.parse(JSON.stringify(c)),g=null;switch(e.catagory){case "command":g=b(c,e);a.command=g;break;case "status":g=b(c,e);a.status=g;break;default:return null}return g&&0!=g.length?a:null},getCommandStatusMap:function(c){if(!c||!c.type)return null;var e=parseInt(c.bitmask),d=[];e?(e&64&&d.push("hkr"),e&128&&d.push("powermeter"),e&256&&d.push("temp"),e&512&&d.push("switch"),e&32768&&d.push("simpleswitch"),
e&65536&&d.push("brightness"),e&131072&&(d.push("colortemperature"),d.push("color"),d.push("colormode"))):"colorlight"==c.type?d=["simpleswitch","brightness","colortemperature","color","colormode"]:d.push(c.type);if(0==d.length)return null;var b={command:[],status:[]};d.forEach(function(c){g[c]&&(g[c].command&&(b.command=b.command.concat(g[c].command)),g[c].status&&(b.status=b.status.concat(g[c].status)))});if(0<b.command.length||0<b.status.length)b.status=b.status.concat(g.error.status);return b}}}();
xnm.aio.fritz.Handler=function(){var b=function(){};b.prototype.Box=xnm.aio.fritz.Box;b.prototype.devicemanager=xnm.aio.fritz.DM;b.prototype.registModule=function(b){b.register(this.devicemanager.SYS,"fritz")};b.prototype.resolveGateway=function(b){return b&&b.ip?new xnm.aio.fritz.Box(b.ip,b.password,b.username,b.port):null};b.prototype.getDeviceCommands=function(b,c){b=(b=xnm.aio.fritz.DM.applyUIFilter(b,{catagory:"command",elems:"*"}))?b.command:[];c&&c(null,b)};b.prototype.getDeviceStatus=function(b,
c){b=(b=xnm.aio.fritz.DM.applyUIFilter(b,{catagory:"status",elems:"*"}))?b.status:[];c&&c(null,b)};b.prototype.doCommand=function(b,c,e,d){(b=this.resolveGateway(b))?b.executeCommandCreator(c,e,function(b){d&&d(b)}):d&&d(Error("gateway json format invalid"))};b.prototype.doStatus=function(b,c,e,d,f){(c=this.resolveGateway(c))?c.getStatesCreator(null,[{id:b,device:e,status:d}],function(b,a){b?f&&f(b):f&&f(null,a[0])}):f&&f(Error("gateway json format invalid"))};b.prototype.getDeviceList=function(b,
c){(b=this.resolveGateway(b))?b.getDevices(function(b){c&&c(null,b)}):c&&c(Error("gateway json format invalid"))};return b}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.fritz.Handler);
