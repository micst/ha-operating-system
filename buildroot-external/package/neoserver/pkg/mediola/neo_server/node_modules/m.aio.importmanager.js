var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,a,c){b instanceof String&&(b=String(b));for(var g=b.length,d=0;d<g;d++){var e=b[d];if(a.call(c,e,d,b))return{i:d,v:e}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};$jscomp.getGlobal=function(b){b=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,b];for(var a=0;a<b.length;++a){var c=b[a];if(c&&c.Math==Math)return c}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,a,c,g){if(a){c=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var d=b[g];d in c||(c[d]={});c=c[d]}b=b[b.length-1];g=c[b];a=a(g);a!=g&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");var m=m||{};m.aio=m.aio||{};m.aio.importmanager=m.aio.importmanager||{};
m.aio.importmanager.Manager=function(){var b=function(a){this._appname=a;this._appname||(this._appname="iqontrolpro")};b.prototype.setAppName=function(a){this._appname=a};b.prototype.importSteckerPRO=function(a,c,g,d){var e=function(a,c){var d={rooms:[],devices:[],gateways:[]};try{var e,g,b=$($.parseXML(c)),n=b.find("gateway");if(n&&0<n.length)for(e=0;e<n.length;e++){var h=n[e];if(h){var f=$(h).find("transmitter");if(f&&0<f.length&&f[0]){var p=$(f[0]),k=p.attr("ip"),y=p.attr("mode");k&&y&&(y=parseInt(y),
d.gateways.push({index:d.gateways.length+1,name:("hc"==a?"HC":a)+" Gateway",info:{sys:"hcgw",ip:k,port:49880,vendor:a,mode:1==y?1:0}}))}}}0==d.gateways.length&&d.gateways.push({index:d.gateways.length+1,name:("hc"==a?"HC":a)+" Gateway",info:{sys:"hcgw",ip:"0.0.0.0",port:49880,vendor:a,mode:1}});var z=b.find("location");if(z&&0<z.length)for(e=0;e<z.length;e++){var E=z[e];if(E){var w=$(E);if(g=w.attr("id")){var A={index:d.rooms.length+1,name:g};d.rooms.push(A);var x=w.find("device");if(x&&0<x.length)for(a=
0;a<x.length;a++){var F=x[a];if(F){var B=$(F);g=B.attr("id");var C=B.attr("type"),D=B.attr("address"),t=B.attr("data");if(g&&C&&D&&t){switch(C){case "BS":var v="brennenstuhl";var r="RC 3600";"heater"==t&&(r="FHT 433");break;case "ELRO":v="brennenstuhl";r="RCS 1000N";break;case "DY":v="rohrmotor24";r="RMF Motor";break;case "DY2":v="rohrmotor24";r="RMF-RS1 (AP/UP)";break;case "IT":v="intertechno",9<=D.length?(r="IT-1500 ","shutter"==t?r="ITL-1000":"dimmer"==t&&(r="ITLR-300")):(r="CMR-300","shutter"==
t&&(r="CMR-500"))}d.devices.push({index:d.devices.length+1,name:g,room:A.index,info:{sys:"hcgw",gateway:1,data:t,type:"IT"==C&&9<=D.length?"IT2":C,manufacture:v,model:r,address:D}})}}}}}}}catch(H){console.error(H)}return d},b=function(a,c){var d={groups:[]};try{var e,g=$($.parseXML(a)).find("location");if(g&&0<g.length)for(e=0;e<g.length;e++){var b=g[e];if(b){var f=$(b),h=f.attr("id"),n;if(n=h)a:{for(a=0;a<c.length;a++)if(c[a]===h){n=!0;break a}n=!1}if(n){var p={classid:"group",index:d.groups.length+
1,name:h,macros:[]};d.groups.push(p);var k=f.find("macro");if(k&&0<k.length)for(a=0;a<k.length;a++){var y=k[a];if(y){var z=$(y),E=z.attr("id");if(E){var w={classid:"macro",index:p.macros.length+1,name:E,commands:[]};p.macros.push(w);var A=z.find("command");if(A&&0<A.length)for(var x=0;x<A.length;x++){var F=A[x];if(F){var B=$(F),C=B.attr("action"),D=B.attr("sleep");if(C){var t=C.split(".");if(3==t.length){var v={classid:"command",index:w.commands.length+1,action:{type:"command",device:{name:t[1],room:t[0]},
value:t[2]}};w.commands.push(v)}}else D&&(v={classid:"sleep",index:w.commands.length+1,time:parseInt(D)},w.commands.push(v))}}}}}}}}}catch(r){console.error(r)}return d},k=require("m.aio.configmanager.js"),p=k.LicenseManager;k.trace("/config/tenants/"+a,function(f,h){if(f)d&&d(f);else if(h&&h.license){if(p.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"brennenstuhl"},h.license))f="brennenstuhl";else if(p.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"intertechno"},h.license))f="intertechno";
else if(p.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"hc"},h.license))f="hc";else{d&&d(Error("license do not have hcgw module"));return}f=e(f,c);var k=[];f&&f.rooms&&f.rooms.forEach(function(a){a&&a.name&&k.push(a.name)});var n=b(g,k);h=require("m.aio.devicemanager.js");var q=require("m.aio.macromanager.js");if(h=h.getIntHandler(a)){var u=q._getHandler(a);u?(h.data=f,h._save(function(a){a?d&&d(a):(u.macros=q.Macros.parse(n),u._saveMacros(function(a){d&&d(a)}))})):d&&d(Error("no such tenant for macros"))}else d&&
d(Error("no such tenant"))}else d&&d("invalid tenant")})};b.prototype.getConfigList_IQP=function(a,c,g,d){a+="/iqconfig/getconfigs";var e=require("url").parse(a);a=e.protocol;"http:"==a&&(a="http");"https:"==a&&(a="https");a||(a="https");var f=e.port;f||(f=443);c={host:e.hostname,port:f,path:e.path+"?app="+this._appname,auth:c+":"+g};c=require(a).request(c,function(a){a.setEncoding("utf8");var c="";a.on("data",function(a){c+=a});a.on("end",function(){if(200!=a.statusCode)d&&(d(Error("http reponse code:"+
a.statusCode)),d=null);else try{var e=[];c&&(e=JSON.parse(c));d&&(d(null,e),d=null)}catch(h){d&&(d(Error("invalid json reponse")),d=null)}})});c.on("timeout",function(){d&&(d(Error("http timeout")),d=null)});c.on("error",function(a){d&&(d(a),d=null)});c.end()};b.prototype.downloadConfig_IQP=function(a,c,g,d,e){a+="/iqconfig/getdevices";var f=require("url").parse(a);a=f.protocol;"http:"==a&&(a="http");"https:"==a&&(a="https");a||(a="https");var b=f.port;b||(b=443);c={host:f.hostname,port:b,path:f.path+
"?app="+this._appname+"&name="+encodeURIComponent(d),auth:c+":"+g};c=require(a).request(c,function(a){a.setEncoding("utf8");var c="";a.on("data",function(a){c+=a});a.on("end",function(){200!=a.statusCode?e&&(e(Error("http reponse code:"+a.statusCode)),e=null):e&&(e(null,c),e=null)})});c.on("timeout",function(){e&&(e(Error("http timeout")),e=null)});c.on("error",function(a){e&&(e(a),e=null)});c.end()};b.prototype.decryptConfig_IQP=function(a,c,g){a=require("x.crypt.js").AES.decodeString(a,c);if("string"==
typeof a&&0<a.length){c=null;try{c=JSON.parse(a),g&&g(null,c)}catch(d){g&&g(Error("invalid config json"))}}else g&&g(Error("decryption failed"))};b.prototype.importConfig_IQP=function(a,c,g,d,e){require("m.aio.configmanager.js").trace("/config/tenants/"+a,function(f,b){if(f)e&&e(f);else if(b&&b.license){f=c;c.system&&(f=c.system);var p=require("m.aio.devicemanager.js"),n=p.getIntHandler(a);if(n){var h=-1,l=[];if(f.rooms)for(var k=0;k<f.rooms.length;k++){var q=f.rooms[k];if(q)if("_cameras_288c9304ed854ca5f41185e88b240621"==
q.name){h=q.index;break}else l.push(q.index)}else f.rooms=[];if(-1==h){for(h=1;-1!=l.indexOf(h);)h++;f.rooms.push({name:"_cameras_288c9304ed854ca5f41185e88b240621",index:h})}if(f.devices)for(l=0;l<f.devices.length;l++){if(k=f.devices[l])k.info&&"cloudservice"==k.info.sys&&"ivideon"==k.info.module&&"camera"==k.info.type?k.room=h:k.info&&"cam"==k.info.sys&&(k.room=h)}else f.devices=[];if(f.gateways)for(h=0;h<f.gateways.length;h++){if(l=f.gateways[h])l.info&&"cloudservice"==l.info.sys&&(l.info.ip||(l.info.ip=
"cloud.mediola.com"),l.info.port||(l.info.port=443),l.info.username||l.info.password||(l.info.username=g,l.info.password=d)),l.info&&"aio"==l.info.sys&&"gtw"==l.info.common_type&&(f.gateways.splice(h,1),h--)}else f.gateways=[];n.data=f;n._save(function(a){a?e&&e(a):p.reloadTenant(b,function(a){e&&e(a)})})}else e&&e(Error("no such tenant"))}else e&&e("invalid tenant")})};b.prototype.downloadMacros_IQP=function(a,c,g,d,e){a+="/iqconfig/getmacros";var f=require("url").parse(a);a=f.protocol;"http:"==
a&&(a="http");"https:"==a&&(a="https");a||(a="https");var b=f.port;b||(b=443);c={host:f.hostname,port:b,path:f.path+"?app="+this._appname+"&name="+encodeURIComponent(d),auth:c+":"+g};c=require(a).request(c,function(a){a.setEncoding("utf8");var c="";a.on("data",function(a){c+=a});a.on("end",function(){200!=a.statusCode?e&&(e(Error("http reponse code:"+a.statusCode)),e=null):e&&(e(null,c),e=null)})});c.on("timeout",function(){e&&(e(Error("http timeout")),e=null)});c.on("error",function(a){e&&(e(a),
e=null)});c.end()};b.prototype.decryptMacros_IQP=function(a,c,b){a=require("x.crypt.js").AES.decodeString(a,c);if(0<a.length&&"string"==typeof a){c=null;try{c=JSON.parse(a),b&&b(null,c)}catch(d){b&&b(Error("invalid macros json"))}}else b&&b(Error("decryption failed"))};b.prototype.importMacros_IQP=function(a,c,b){require("m.aio.configmanager.js").trace("/config/tenants/"+a,function(d,e){if(d)b&&b(d);else if(e&&e.license){d=require("m.aio.macromanager.js");var f=d._getHandler(a);if(f){var g=require("m.aio.devicemanager.js").getIntHandler(a);
if(g){if(c&&c.groups)for(var p=0;p<c.groups.length;p++){var n=c.groups[p];if(n&&n.macros)for(var h=0;h<n.macros.length;h++){var l=n.macros[h];if(l&&l.commands)for(var G=0;G<l.commands.length;G++){var q=l.commands[G];if(q&&q.action&&q.action.device){var u=q.action.device.room;u&&!isNaN(parseInt(u))&&(u=g.findRoomWithIndex(parseInt(u)))&&u.name&&(q.action.device.room=u.name)}}}}f.macros=d.Macros.parse(c);f._saveMacros(function(a){a?b&&b(a):require("m.aio.devicemanager.js").reloadTenant(e,function(a){b&&
b(a)})})}else b&&b(Error("no device manager"))}else b&&b(Error("no such tenant"))}else b&&b("invalid tenant")})};return b}();m.aio.importmanager.Handler=m.aio.importmanager.Manager;"undefined"!=typeof module&&null!=module&&(module.exports=new m.aio.importmanager.Handler);
