var util=require("util"),EventEmitter=require("events"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.heos=x.hub.m.heos||{};x.hub.m.heos.MODULE=require("xnm.aio.heos.js");
x.hub.m.heos.Handler=function(){var c=function(){this._commandBuffer=[]};util.inherits(c,EventEmitter);c.prototype.init=function(b){b&&b()};c.prototype.getSystems=function(){return["heos"]};c.prototype.executeCommand=function(b,a,c){var d=b.gateway,e=x.hub.m.heos.MODULE.getController(),f=e.isIdle(),g=this;f&&(e.open(d),e.on("open",function(){g._doNextCommand()}));d=this._commandBuffer.length;this._commandBuffer.push({gateway:b.gateway,device:b,command:a,callback:c});0!=d||f||this._doNextCommand()};
c.prototype._doNextCommand=function(){if(0<this._commandBuffer.length){var b=this,a=this._commandBuffer[0];a.command&&"playUrl"==a.command.value?x.hub.m.heos.MODULE.doCommand(a.gateway,a.device,{value:"clearQueue"},function(c){x.hub.m.heos.MODULE.doCommand(a.gateway,a.device,a.command,function(){b._commandBuffer.splice(0,1);b._doNextCommand()})}):x.hub.m.heos.MODULE.doCommand(a.gateway,a.device,a.command,function(){b._commandBuffer.splice(0,1);b._doNextCommand()})}};return c}();
"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.heos.Handler);
