var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.harmony=xnm.aio.harmony||{};
xnm.aio.harmony.Hub=function(){var c=function(a,h,b){this._hub=a;this._closeSocket=h;this._callback=b;this._data="";this._devices={devices:[],activities:[]}};c.prototype.execute=function(a){a.write('<iq type="get" id="2320426445" from="e01b88af-b4cd-4d1c-8e76-85562ea3fad5"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?config"></oa></iq>')};c.prototype._onSocketData=function(a){if("<iq/>"!=a&&(this._data+=a,-1!=this._data.indexOf("</iq>"))){a=this._data.indexOf("<![CDATA");
var h=this._data.indexOf("]]\x3e</oa>");if(0<a&&h>a&&(a=JSON.parse(this._data.substring(a+9,h)))&&a.activity&&a.device){for(h=0;h<a.device.length;h++){for(var b=[],k=0;k<a.device[h].controlGroup.length;k++)for(var d=a.device[h].controlGroup[k]["function"],g=0;g<d.length;g++)try{var c=JSON.parse(d[g].action);c&&c.command&&b.push({key:c.command})}catch(l){}this._devices.devices.push({sys:xnm.aio.harmony.DM.SYS,id:a.device[h].id,type:f.DEVICE_TYPE.IR,name:a.device[h].label,ircodes:{sys:xnm.aio.harmony.DM.SYS,
codes:b}})}for(h=0;h<a.activity.length;h++)this._devices.activities.push({sys:xnm.aio.harmony.DM.SYS,id:a.activity[h].id,type:f.DEVICE_TYPE.ACTIVITY,name:a.activity[h].label})}this._callback&&this._callback(null,this._devices);this._hub&&this._hub._onJobFinish(this,this._closeSocket)}};c.prototype._onSocketTimeout=function(){this._callback&&this._callback(null,this._devices);this._hub&&this._hub._onJobFinish(this,!0)};c.prototype._onJobCancelled=function(){this._callback&&this._callback(Error("job cancelled"))};
var b=function(a,h,b,k){this._type="send command";this._hub=a;this._closeSocket=h;this._callback=k;this._type=b.type;this._id=b.id;this._command=b.command;this._socket=null;this._released=!1};b.prototype.execute=function(a){if("IRCommand"==this._type){this._hub&&this._hub._logger.log("debug","send press");var b='<iq type="render" id="3669650010" from="'+this._hub._sessionToken+'"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?holdAction">status=press:action={"command"::"'+
this._command+'","type"::"'+this._type+'","deviceId"::"'+this._id+'"}</oa></iq>\r\n'}else this._hub&&this._hub._logger.log("debug","send activity"),b='<iq type="startActivity" id="1028178097" from="'+this._hub._sessionToken+'"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?startActivity">activityId='+this._id+"</oa></iq>\r\n";this._socket=a;a.write(b)};b.prototype._onSocketData=function(){var a=!1;"IRCommand"==this._type&&this._released?a=!0:"IRCommand"!=this._type&&
(a=!0);"IRCommand"!=this._type||this._released||(this._hub&&this._hub._logger.log("debug","send release"),this._socket.write('<iq type="render" id="3669650010" from="'+this._hub._sessionToken+'"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?holdAction">status=release:action={"command"::"'+this._command+'","type"::"'+this._type+'","deviceId"::"'+this._id+'"}</oa></iq>\r\n'),this._released=!0);a&&(this._callback&&this._callback(null),this._hub&&this._hub._onJobFinish(this))};
b.prototype._onSocketTimeout=function(){this._callback&&this._callback(Error("harmony response timeout"));this._hub&&this._hub._onJobFinish(this)};b.prototype._onJobCancelled=function(){this._callback&&this._callback(Error("job cancelled"))};var d=function(a,b){this._type="ping";this._hub=a;this._callback=b;this._socket=null;this._released=!1};d.prototype.execute=function(a){this._socket=a;a.write('<iq type="get" id="ping"><ping xmlns="urn:xmpp:ping"/></iq>\r\n')};d.prototype._onSocketData=function(a){var b=
!1;-1!=a.indexOf("id='ping'")&&(b=!0);b&&(this._callback&&this._callback(null),this._hub&&this._hub._onJobFinish(this))};d.prototype._onSocketTimeout=function(){this._callback&&this._callback(Error("harmony response timeout"));this._hub&&this._hub._onJobFinish(this)};d.prototype._onJobCancelled=function(){this._callback&&this._callback(Error("job cancelled"))};var e=function(a,b){this._hub=a;this._callback=b;this._data="";this._devices={devices:[],activities:[]}};e.prototype.execute=function(a){a.write('<iq type="get" id="current_activity"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?getCurrentActivity"></oa></iq>')};
e.prototype._onSocketData=function(a){if("<iq/>"!=a&&(this._data+=a,-1!=this._data.indexOf("</iq>"))){a=null;var b=this._data.indexOf("<![CDATA["),d=this._data.indexOf("]]\x3e");0<b&&d>b&&(b=this._data.substring(b+9,d),0==b.indexOf("result=")&&(a=b.substr(7)));this._callback&&this._callback(null,a);this._hub&&this._hub._onJobFinish(this)}};e.prototype._onSocketTimeout=function(){this._callback&&this._callback(null,this._devices);this._hub&&this._hub._onJobFinish(this)};e.prototype._onJobCancelled=
function(){this._callback&&this._callback(Error("job cancelled"))};var f=function(a,b,d,k,f,c){this._logger=require("x.logger.js").getLogger("xnm.aio.harmony.Hub");this.ip=a;this.port=5222;b&&(this.port=b);this.user=d;this.password=k;this.uuid=c;this._authToken=f;this._socket=this._sessionToken=null;this._fsm=0;this._jobQueue=[];this._listener=this._pingIT=null};f.SO_TIMEOUT=5E3;f.FSM_STATE={IDLE:0,CONNECTING:1,CONNECTED:2};f.DEVICE_TYPE={IR:"IRCommand",ACTIVITY:"Activity"};f.prototype.startMonitor=
function(a){var b=this;this._createSession(function(d){b._logger.log("debug","create session finish:"+d);d?(b._fsm=f.FSM_STATE.IDLE,b._clean()):(b._fsm=f.FSM_STATE.CONNECTED,b._startPing());a&&a(d)})};f.prototype.setMonitorListener=function(a){this._listener=a};f.prototype.executeCommandCreator=function(a,b,d,k){b&&b.value?a&&a.id?a.type?(this._logger.log("debug","execute command:"+b.value),this._sendCommand(a.type,b.value,a.id,k,function(a){d&&d(a)})):d&&d(Error("device has no type")):d&&d(Error("device has no id")):
d&&d(Error("command invalid"))};f.prototype.getStatesCreator=function(a,b,d){b?this.getCurrentActivity(function(a,f){for(var k=[],c=0;c<b.length;c++){var h=b[c];h&&h.id&&b[c].device&&(h=a?"?":-1==f?"off":h.device.id==f?"on":"off",k.push({id:b[c].id,status:h}))}d&&d(null,k)}):d&&d(Error("deviceList is null"))};f.prototype.getDevices=function(a,b){a=new c(this,a,b);this._addJob(a)};f.prototype.getCurrentActivity=function(a){a=new e(this,a);this._addJob(a)};f.prototype._getAuthToken=function(a){this._logger.log("debug",
"get auth token");var b='{"password":"'+this.password+'", "email":"'+this.user+'"}',d=this,k=require("url").parse("https://svcs.myharmony.com/CompositeSecurityServices/Security.svc/json/GetUserAuthToken");k.port||(k.port=80);k={host:k.hostname,port:k.port,path:k.path,method:"POST",headers:{"Content-Type":"application/json; charset=utf-8","Content-Length":b.length,Connection:"close"}};var c=a;a=require("http").request(k,function(a){if(200==a.statusCode){a.setEncoding("binary");var b="";a.on("data",
function(a){b+=a});a.on("end",function(){var a=JSON.parse(b);a&&a.GetUserAuthTokenResult&&a.GetUserAuthTokenResult.UserAuthToken?((a=a.GetUserAuthTokenResult.UserAuthToken)||(a="dummy_token"),c&&(d._logger.log("trace","get auth token:"+a),c(null,a),c=null)):c&&(d._logger.log("trace","get token http reponse has no token, use dummy token"),c(null,"dummy_token"),c=null)})}else c&&(c(Error("get auth token http response:"+a.statusCode)),c=null)});if(a.on&&"function"==typeof a.on)a.on("error",function(a){c&&
(c(a),c=null)});a.write(b);a.end()};f.prototype._getSessionToken=function(a){this._logger.log("debug","get session token");if(this._sessionToken)a&&a(null,this._sessionToken);else{var b='<iq type="get" id="3174962747" from="guest"><oa xmlns="connect.logitech.com" mime="vnd.logitech.connect/vnd.logitech.pair">token='+this._authToken+":name=1vm7ATw/tN6HXGpQcCs/A5MkuvI#iOS6.0.1#iPhone</oa></iq>",d=!1,c=a,e=this;a={port:this.port,host:this.ip};var g=require("net").connect(a);g.setTimeout(f.SO_TIMEOUT);
g.setEncoding("utf8");g.on("connect",function(){e._logger.log("trace","get session token connect to hub:"+e.ip);d=!0;g.write(b)});g.on("data",function(a){e._logger.log("trace","get session token receive from hub:"+e.ip+" data:"+a);if("<iq/>"!=a){var b=a.indexOf(":identity=");0<b?c&&(c(null,a.substr(b+10,36)),c=null):c&&(c(Error("get session token response has no token")),c=null);g.end()}});g.on("error",function(a){d?(e._logger.log("trace","get session token hub:"+e.ip+" error:"+a.message),g.end()):
e._logger.log("trace","get session token hub:"+e.ip+" connection error:"+a.message);c&&(c(a),c=null)});g.on("timeout",function(){d?(e._logger.log("trace","get session token hub:"+e.ip+" data timeout"),c&&(c(Error("read timeout")),c=null),g.end()):(e._logger.log("trace","get session token hub:"+e.ip+" connection timeout"),c&&(c(Error("connection timeout")),c=null))});g.on("close",function(){e._logger.log("trace","get session token hub:"+e.ip+" close socket");c&&(c(Error("get session token socket closed")),
c=null)});g._doConnect&&"function"==typeof g._doConnect&&g._doConnect()}};f.prototype._login=function(a){this._logger.log("debug","login");var b='<auth xmlns="urn:ietf:params:xml:ns:xmpp-sasl" mechanism="PLAIN">'+(new Buffer(this._sessionToken+"@x.com"+this._sessionToken)).toString("base64")+"</auth>\r\n",c=!1,d=!1,e=a,g=this;a={port:this.port,host:this.ip};var n="",l=require("net").connect(a);l.setTimeout(f.SO_TIMEOUT);l.setEncoding("utf8");l.on("connect",function(){g._logger.log("trace","connect to hub:"+
g.ip);c=!0;l.write("<stream:stream xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams' version='1.0' to='x.com'>\r\n");l.write(b)});l.on("data",function(a){g._logger.log("trace","receive from hub:"+g.ip+" data:"+a);d?g._onSocketData(a):(n+=a,-1!=n.indexOf("<success")&&(g._logger.log("trace","loggin success"),d=!0,e&&(e(null,l),e=null)))});l.on("error",function(a){c?d?(g._logger.log("trace","hub:"+g.ip+" error:"+a.message),g._onSocketError(a)):(g._logger.log("trace","hub:"+g.ip+" login socket error:"+
a.message),e&&(e(a),e=null),l.end()):(g._logger.log("trace","hub:"+g.ip+" connection error:"+a.message),e&&(e(a),e=null))});l.on("timeout",function(){c?d?(g._logger.log("trace","hub:"+g.ip+" data timeout"),g._onSocketTimeout()):(g._logger.log("trace","hub:"+g.ip+" login data timeout"),n?(g._logger.log("trace","authentication fail"),e&&(e(Error("authentication fail")),e=null)):e&&(e(Error("login timeout")),e=null)):(g._logger.log("trace","hub:"+g.ip+" connection timeout"),e&&(e(Error("connection timeout")),
e=null))});l.on("close",function(){g._logger.log("trace","hub:"+g.ip+" close socket");c&&d&&g._onSocketClose()});l._doConnect&&"function"==typeof l._doConnect&&l._doConnect()};f.prototype._startPing=function(){var a=this;this._pingIT=setInterval(function(){var b=new d(a);a._addJob(b)},15E3)};f.prototype._parseNotify=function(a){var b=null;if(!a||-1==a.indexOf('type="connect.stateDigest?notify"'))return null;var c=a.indexOf("<![CDATA[");if(-1==c)return null;c+=9;var d=a.indexOf("]]\x3e",c);if(-1==
d)return null;a=a.substring(c,d);try{var e=JSON.parse(a);if(e.activityId)switch(b={activityId:e.activityId},e.activityStatus){case 3:b.activityStatus="POWERING_OFF";break;case 2:b.activityStatus="RUNNING";break;case 1:b.activityStatus="STARTING";break;case 0:b.activityStatus="NO_ACTIVITY"}return b}catch(g){return null}};f.prototype._sendCommand=function(a,c,d,e,f){a=new b(this,e,{type:a,command:c,id:d},f);this._addJob(a)};f.prototype._addJob=function(a){var b=this._jobQueue.length;this._jobQueue.push(a);
0==b&&this._doNextJob()};f.prototype._onSocketTimeout=function(){if(this._jobQueue&&0<this._jobQueue.length){var a=this._jobQueue[0];a&&a._onSocketTimeout&&a._onSocketTimeout()}};f.prototype._onSocketError=function(){this._closeSocket()};f.prototype._onSocketClose=function(){this._clean();if(this._listener&&this._listener.onClose)this._listener.onClose()};f.prototype._onSocketData=function(a){if(this._jobQueue&&0<this._jobQueue.length){var b=this._jobQueue[0];b&&b._onSocketData&&b._onSocketData(a)}this._listener&&
this._listener.onData&&(b=this._parseNotify(a),this._listener.onData(a,b))};f.prototype._onJobFinish=function(a,b){a&&this._jobQueue&&this._jobQueue[0]===a&&(this._jobQueue.splice(0,1),b&&this._closeSocket(),this._doNextJob())};f.prototype._closeSocket=function(){this._logger.log("trace","manually close socket");this._socket&&this._socket.end();this._clean()};f.prototype._clean=function(){if(this._jobQueue)for(var a=0;a<this._jobQueue.length;a++)this._jobQueue[a]._onJobCancelled();this._jobQueue=
[];this._pingIT&&clearInterval(this._pingIT);this._sessionToken=this._socket=this._pingIT=null;this._fsm=f.FSM_STATE.IDLE};f.prototype._doNextJob=function(){var a=this;this._jobQueue&&0<this._jobQueue.length&&(this._fsm==f.FSM_STATE.IDLE?(this._logger.log("debug","not connected"),this._fsm=f.FSM_STATE.CONNECTING,this._createSession(function(b){a._logger.log("debug","create session finish:"+b);b?(a._fsm=f.FSM_STATE.IDLE,a._clean()):(a._fsm=f.FSM_STATE.CONNECTED,a._doNextJob())})):this._fsm==f.FSM_STATE.CONNECTED&&
(this._logger.log("debug","execute next job"),this._jobQueue[0].execute(this._socket)))};f.prototype._createSession=function(a){var b=this;this._authToken?this._sessionToken?this._login(function(c,d){c||!d?(b._sessionToken=null,a&&a(c?c:Error("socket is null"))):(b._socket=d,a&&a(c))}):this._getSessionToken(function(c,d){c?a&&a(c):d?(b._sessionToken=d,b._createSession(a)):a&&a(Error("invalid session token"))}):this._getAuthToken(function(c,d){c?a&&a(c):d?(b._authToken=d,b._createSession(a)):a&&a(Error("invalid auth token"))})};
f.prototype.toJSON=function(){return{sys:xnm.aio.harmony.DM.SYS,ip:this.ip,port:this.port,username:this.user,password:this.password,token:this._authToken,uuid:this.uuid}};f.prototype.equalsTo=function(a){return a&&a instanceof f?this.ip==a.ip&&this.port==a.port&&this.user==a.user&&this.password==a.password:!1};f.parseJSON=function(a){return a&&a.ip&&a.username&&a.password?new xnm.aio.harmony.Hub(a.ip,a.port,a.username,a.password,a.token,a.uuid):null};return f}();
xnm.aio.harmony.Discovery=function(){var c=function(){this.Hubs={};this._sockets=[];var b=this;this._server=require("net").createServer(function(a){a.on("data",function(a){var c={};a=a.toString().split(";");for(var d=0;d<a.length;d++){var e=a[d].split(":");2==e.length&&(c[e[0]]=e[1])}c.ip&&c.port&&c.uuid&&(b.Hubs[c.uuid]?b.Hubs[c.uuid].ip=c.ip:b.Hubs[c.uuid]=new xnm.aio.harmony.Hub(c.ip,c.port,c.email,null,null,c.uuid))});a.on("end",function(){});a.on("error",function(a){})});this._server.listen();
var c=require("os");require("dgram");if(c&&c.networkInterfaces){c=c.networkInterfaces();for(var e in c)for(var f=c[e],a=0;a<f.length;a++)this._addDiscoverSocket(null,f[a])}else this._addDiscoverSocket(null,null)};c.prototype._addDiscoverSocket=function(b,c){b=require("dgram");if(c)"IPv4"==c.family&&0==c.internal&&(d=b.createSocket("udp4"),d.on("listening",function(){d.setBroadcast(!0)}),d.ip=c.address,this._sockets.push(d));else{var d=b.createSocket("udp4");this._sockets.push(d)}};c.prototype._sendDiscoveryMessages=
function(){for(var b=0;b<this._sockets.length;b++)if(this._sockets[b].ip){var c=this._sockets[b].ip.substr(0,this._sockets[b].ip.lastIndexOf("."))+".255",e=new Buffer("_logitech-reverse-bonjour._tcp.local.\n"+this._server.address().port);this._sockets[b].send(e,0,e.length,5224,c)}};c.prototype.discoverHubs=function(){var b=this,c=0,e=setInterval(function(){b._sendDiscoveryMessages();1<=c++&&clearInterval(e)},250)};return c}();
xnm.aio.harmony.DM=function(){var c=function(b,c){this.code=b;this.message=c;this.stack=Error().stack};c.prototype=Error();c.prototype.name="HarmonyDeviceManagerError";c.prototype.code=0;c.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"harmony",getGatewayType:function(){return{sys:this.SYS,name:"Logitech Harmony Hub"}},createGateway:function(b,d,e){d=c.ERROR_CODE;b?b.ip?b.port?b.username?b.password?e(null,b):e(new c(d.INVALID,"password is invalid")):
e(new c(d.INVALID,"username is invalid")):e(new c(d.INVALID,"port is invalid")):e(new c(d.INVALID,"ip is invalid")):e(new c(d.INVALID,"info is invalid"))},updateGateway:function(b,d,e,f){b=c.ERROR_CODE;d?d.ip?d.port?d.username?d.password?f(null,d):f(new c(b.INVALID,"password is invalid")):f(new c(b.INVALID,"username is invalid")):f(new c(b.INVALID,"port is invalid")):f(new c(b.INVALID,"ip is invalid")):f(new c(b.INVALID,"update is invalid"))},deleteGateway:function(b,c,e){e()},createDevice:function(b,
d,e){var f=c.ERROR_CODE;if(b)if(b.gateway)if(d.data&&d.data.gateways&&0!==d.data.gateways.length){d=d.data.gateways;var a;for(a=0;a<d.length;a++)if(d[a].index===b.gateway){var h=d[a];break}h?e(null,b):e(new c(f.NOT_FOUND,"gateway with index "+b.gateway+" not exists"))}else e(new c(f.NOT_FOUND,"gateway with index "+b.gateway+" not exists"));else e(new c(f.INVALID,"gateway is invalid"));else e(new c(f.INVALID,"info is invalid"))},updateDevice:function(b,d,e){var f=c.ERROR_CODE;if(b)if(b.gateway){d=
d.data.gateways;var a;for(a=0;a<d.length;a++)if(d[a].index===b.gateway){var h=d[a];break}h?e(null,b):e(new c(f.NOT_FOUND,"gateway with index "+b.gateway+" not exists"))}else e(new c(f.INVALID,"gateway is invalid"));else e(new c(f.INVALID,"info is invalid"))},deleteDevice:function(b,c,e){e()},getCommandStatusMap:function(b){var c={command:[]};if(b&&b.type&&b.type==xnm.aio.harmony.Hub.DEVICE_TYPE.IR){if(b&&b.ircodes&&b.ircodes.codes){for(var e=0;e<b.ircodes.codes.length;e++){var f=b.ircodes.codes[e];
c.command.push({type:"enum",name:f.key,ref:{value:f.key}})}return c}}else if(b&&b.type&&b.type==xnm.aio.harmony.Hub.DEVICE_TYPE.ACTIVITY)return c.command.push({type:"enum",name:"execute",ref:{value:"execute"}}),c.status=[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}],c.ipevt="-1"==b.id?[{type:"enum",name:"event",ref:{value:"event",options:["allOff"]}}]:[{type:"enum",name:"event",ref:{value:"event",options:["on","off"]}}],c;return null},applyUIFilter:function(b,c){var d=function(a,
b){if("*"==a)return!0;for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},f=function(a,b,c){var e=[];switch(c.catagory){case "command":a.command&&a.command.forEach(function(a){d(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){d(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))})}return e},a=function(a,b){var c=[],d=xnm.aio.harmony.DM.getCommandStatusMap(a);d&&(a=f(d,a,b),c=c.concat(a));return c};if(!b.sys)return null;
var h=JSON.parse(JSON.stringify(b)),m=null;switch(c.catagory){case "command":m=a(b,c);h.command=m;break;case "status":m=a(b,c);h.status=m;break;default:return null}return m&&0!=m.length?h:null},applyIPEventFilter:function(b,c){if(!b.sys)return null;c=JSON.parse(JSON.stringify(b));b=xnm.aio.harmony.DM.getCommandStatusMap(b);if(!b)return c;c.ipevt=b.ipevt;return c}}}();xnm.aio.harmony.Handler=function(){this._Discovery=null};xnm.aio.harmony.Handler.prototype.devicemanager=xnm.aio.harmony.DM;
xnm.aio.harmony.Handler.prototype.Hub=xnm.aio.harmony.Hub;xnm.aio.harmony.Handler.prototype.discoverHubs=function(c,b){this._Discovery||(this._Discovery=new xnm.aio.harmony.Discovery);this._Discovery.discoverHubs();var d=this;setTimeout(function(){b&&b(null,d._Discovery.Hubs)},c)};xnm.aio.harmony.Handler.prototype.registModule=function(c){c.register(xnm.aio.harmony.DM.SYS,"harmony")};xnm.aio.harmony.Handler.prototype.resolveGateway=function(c){return xnm.aio.harmony.Hub.parseJSON(c)};
xnm.aio.harmony.Handler.prototype.getDeviceCommands=function(c,b){c=(c=xnm.aio.harmony.DM.applyUIFilter(c,{catagory:"command",elems:"*"}))?c.command:[];b&&b(null,c)};xnm.aio.harmony.Handler.prototype.getDeviceStatus=function(c,b){c=(c=xnm.aio.harmony.DM.applyUIFilter(c,{catagory:"status",elems:"*"}))?c.status:[];b&&b(null,c)};xnm.aio.harmony.Handler.prototype.getDevices=function(c,b){(c=this.resolveGateway(c))?c.getDevices(!0,b):b&&b(Error("gateway json format invalid"))};
xnm.aio.harmony.Handler.prototype.doCommand=function(c,b,d,e){(c=this.resolveGateway(c))?c.executeCommandCreator(b,d,e,!0):e&&e(Error("gateway json format invalid"))};xnm.aio.harmony.Handler.prototype.doStatus=function(c,b,d,e,f){(b=this.resolveGateway(b))?b.getStatesCreator(null,[{id:c,device:d,status:e}],function(a,b){a?f&&f(a):f&&f(null,b[0])}):f&&f(Error("gateway json format invalid"))};
xnm.aio.harmony.Handler.prototype.getAuthToken=function(c,b){(c=this.resolveGateway(c))?c._getAuthToken(b):b&&b(Error("gateway json format invalid"))};"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.harmony.Handler);
