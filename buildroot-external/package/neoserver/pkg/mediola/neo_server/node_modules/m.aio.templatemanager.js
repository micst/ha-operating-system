var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){a=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");var m=m||{};m.aio=m.aio||{};m.aio.templatemanager=m.aio.templatemanager||{};
m.aio.templatemanager.OPTIONS={host:"localhost",port:8080,path:"",headers:{"Content-Type":'application/json; charset="UTF-8"',"User-Agent":"mediola",Connection:"close"}};m.aio.templatemanager.SysTemplateUploader=function(a,b,c){this.authHeader=a;this.skinName=b;this.templateName=c};
m.aio.templatemanager.SysTemplateUploader.prototype={upload:function(a,b){var c=this;require("m.aio.configmanager.js").trace(a,function(a,e){a?b&&b(a):c._processPage(e,b)})},_processPage:function(a,b){var c=a.getChild("pagecontent");c=this._removeDevice(JSON.parse(JSON.stringify(c.content)));var d="/creatorneo/template/uploadSysTemplate?";d+="skin="+encodeURI(this.skinName);d+="&name="+encodeURI(this.templateName);var e=this;this._doPostRequest(d,null,JSON.stringify(c),function(c,g){if(c)b&&b(c);
else if(g){try{g=JSON.parse(g)}catch(k){b&&b("upload system template response json invalid");return}if(g.id){c=a.getFolderPath();var h=c.substr(0,c.length-2)+".png",f=require("fs");f.exists(h,function(a){a?f.readFile(h,function(a,c){a?b&&b():(d="/creatorneo/template/uploadSysTemplateThumb?",d+="id="+g.id,e._doPostRequest(d,{"Content-Type":"application/octet-stream"},c,function(a){b&&b(a)}))}):b&&b()})}else b&&b("upload system template response has not template id")}else b&&b("upload system template response invalid")})},
_removeDevice:function(a){delete a.action;a.labels&&a.labels.forEach(function(a){delete a.action;delete a.status});a.infos&&a.infos.forEach(function(a){delete a.action;delete a.status});a.buttons&&a.buttons.forEach(function(a){delete a.action;delete a.status});a.sliders&&a.sliders.forEach(function(a){delete a.action;delete a.status});a.colorchoosers&&a.colorchoosers.forEach(function(a){delete a.action;delete a.status});a.analogmeters&&a.analogmeters.forEach(function(a){delete a.action;delete a.status});
a.cams&&a.cams.forEach(function(a){a.cam&&delete a.cam.device});a.webpages&&a.webpages.forEach(function(a){a.webpage&&delete a.webpage.device});return a},_doPostRequest:function(a,b,c,d){var e=d,f=JSON.parse(JSON.stringify(m.aio.templatemanager.OPTIONS));f.path+=a;f.method="POST";this.authHeader&&(f.auth=this.authHeader);b&&Object.keys(b).forEach(function(a){f.headers[a]=b[a]});var g="";a=require("http").request(f,function(a){a.setEncoding("utf8");a.on("data",function(a){g+=a});a.on("end",function(){200==
a.statusCode?e&&e(null,g):e&&e(Error("http error with status code:"+a.statusCode),g);e=null})});a.on("error",function(a){e&&(e(a),e=null)});a.write(c);a.end()}};m.aio.templatemanager.Handler=function(){this._configmanager=null};
m.aio.templatemanager.Handler.prototype={init:function(a,b,c,d){this._configmanager=a;b&&(m.aio.templatemanager.OPTIONS.host=b,m.aio.templatemanager.OPTIONS.host=b,m.aio.templatemanager.OPTIONS.host=b);c&&0<c&&(m.aio.templatemanager.OPTIONS.port=c,m.aio.templatemanager.OPTIONS.port=c,m.aio.templatemanager.OPTIONS.port=c);process&&"local"==process.env.CLOUD&&(m.aio.templatemanager.OPTIONS.path="/webservice",m.aio.templatemanager.OPTIONS.path="/webservice",m.aio.templatemanager.OPTIONS.path="/webservice");
d&&d()},uploadSystemTemplate:function(a,b,c,d,e){a&&b&&c&&d?(new m.aio.templatemanager.SysTemplateUploader(a,b,c)).upload(d,e):e&&e(Error("invalid parameter"))},submitUserTemplate:function(a,b,c){a&&a.tenantIdx&&a.remoteIdx&&a.remotePageIdxes||c&&c(Error("options invalid"))}};"undefined"!=typeof module&&null!=module&&(module.exports=new m.aio.templatemanager.Handler);
