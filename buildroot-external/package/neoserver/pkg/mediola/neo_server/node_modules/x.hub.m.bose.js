var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(d,c,a){if(null==d)throw new TypeError("The 'this' value for String.prototype."+a+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+a+" must not be a regular expression");return d+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,c,a){d!=Array.prototype&&d!=Object.prototype&&(d[c]=a.value)};$jscomp.getGlobal=function(d){d=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,d];for(var c=0;c<d.length;++c){var a=d[c];if(a&&a.Math==Math)return a}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,c,a,b){if(c){a=$jscomp.global;d=d.split(".");for(b=0;b<d.length-1;b++){var g=d[b];g in a||(a[g]={});a=a[g]}d=d[d.length-1];b=a[d];c=c(b);c!=b&&null!=c&&$jscomp.defineProperty(a,d,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("String.prototype.repeat",function(d){return d?d:function(c){var a=$jscomp.checkStringArgs(this,null,"repeat");if(0>c||1342177279<c)throw new RangeError("Invalid count value");c|=0;for(var b="";c;)if(c&1&&(b+=a),c>>>=1)a+=a;return b}},"es6","es3");var util=require("util"),EventEmitter=require("events"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.bose=x.hub.m.bose||{};x.hub.m.bose.MODULE=require("xnm.aio.bose.js");
x.hub.m.bose.AudioPlayer=function(){var d=function(){this._process={}};d.prototype.playFile=function(c,a,b){if(a&&a.file){var d=require("x.hub.resource.js").getFileURL(a.file,c.ip);d?(a.url=d,this.playUrl(c,a,b)):b&&b(Error("no such file"))}else b&&b(Error("invalid file"))};d.prototype.playUrl=function(c,a,b){if(a&&a.url){var d=x.hub.m.bose.MODULE.resolveDevice(c);if(d){var f=a.url,e=this;this._cancelPlay(d,function(c){c?b&&b(c):e._setVolume(d,a.volume,function(c){c?b&&b(c):e._setRepeat(d,a.repeat,
function(c){c?b&&b(c):e._unmute(d,function(c){c?b&&b(c):e._playUrl(d,f,function(c){c?b&&b(c):a.repeat&&-1!=a.repeat&&(e._process[d.getIP()]={url:f},e._process[d.getIP()].timeout=setTimeout(function(){var b=e._process[d.getIP()].url;e._process[d.getIP()]=null;e._stopPlay(d,b)},1E3*parseInt(a.repeat)))})})})})});b&&b(null,1)}else b&&b(Error("invalid device json"))}else b&&b(Error("invalid url"))};d.prototype._cancelPlay=function(c,a){var b=c.getIP();if(b&&this._process[b]){this._process[b].timeout&&
clearTimeout(this._process[b].timeout);var d=this._process[b].url;this._process[b]=null;d?this._stopPlay(c,d,a):a&&a()}else a&&a()};d.prototype._stopPlay=function(c,a,b){c._getNowPlaying(function(d,f){d||!f?c._clickKey("STOP",b):f.currentURI&&f.currentURI!=a?b&&b():c._clickKey("STOP",b)})};d.prototype._setVolume=function(c,a,b){a?c._setVolume(a,b):b&&b()};d.prototype._setRepeat=function(c,a,b){a?c._clickKey("REPEAT_ONE",b):b&&b()};d.prototype._unmute=function(c,a){a&&a()};d.prototype._playUrl=function(c,
a,b){a?c.playUrl(a,b):b&&b(Error("invalid url"))};return d}();
x.hub.m.bose.Handler=function(){var d=function(){this._audioPlayer=new x.hub.m.bose.AudioPlayer};util.inherits(d,EventEmitter);d.prototype.init=function(c){c&&c()};d.prototype.getSystems=function(){return["bose"]};d.prototype.executeCommand=function(c,a,b){a?"playFile"==a.value?this._audioPlayer.playFile(c,a,function(a){b&&b({error:a})}):"playUrl"==a.value&&(a.repeat||a.volume)?this._audioPlayer.playUrl(c,a,function(a){b&&b({error:a})}):x.hub.m.bose.MODULE.doCommand(c,a,b):b&&b({error:Error("invalid command")})};
return d}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.bose.Handler);
